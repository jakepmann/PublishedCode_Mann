## code for the following pre-print: https://doi.org/10.1101/2020.04.18.20070417

## code to be run in R 4.0.2

## Installations
install.packages("tidyverse")
install.packages("readxl")
install.packages("corrplot")
install.packages("ggbiplot")
install.packages("factoextra")
install.packages("FactoMineR")
install.packages("paran")
install.packages("cowplot")
install.packages("ggplotify")
install.packages("Hmisc")
BiocManager::install("mixOmics")
library(devtools)
install_github("vqv/ggbiplot")
install.packages("rstatix")
install.packages("devtools")
install_github("phenoscanner/phenoscanner")


## load packages
library(tidyverse)
library(readxl)
library(corrplot)
library(tidyr)
library(factoextra)
library(FactoMineR)
library(paran)
library(cowplot)
library(ggplotify)
library(grid)
library(dplyr)
library(ggplot2)
library(ggrepel)
library(Hmisc)
library(ggbiplot)
library(rstatix)
library(pheatmap)
library(gtools)
require(viridis)
library(devtools)
library(phenoscanner)


## load data
meta_data <- read_excel("AllPt_metadata_Feb21_v3.xlsx")
meta_data$Sex <- as.factor(meta_data$Sex)
Lipids_annotation <- read_excel("Annotation_v2.xlsx")
data <- read_excel("Paed_Lipidom_data_abs.xlsx")


## make annotations for later manipulation
annotation <- c("Beta","SE","T","P")
annotation <- data.frame(annotation)

centre <- subset(meta_data, select = c("Participant", "Centre"))

## only keep lipids with >70% complete
data <- data[colSums(is.na(data))/nrow(data) < .3]

## use minimum value imputation to replace blanks
min_function <- function(x) replace(x, is.na(x), min(x, na.rm = TRUE))
data[] <- lapply(data, min_function)


## log transform and then standardise lipids to mean=0, sd=1, by cohort
data[2:ncol(data)] <- lapply(data[2:ncol(data)], function(x) log(x))
data1 <- as.data.frame(data)
data1[2:ncol(data)] <- lapply(data[2:ncol(data)], function(x) c(scale(x)))

## merge metadata  with lipid data
data_full <- merge(meta_data, data1, by="Participant")


## PCA for all lipids
Lipids_pca <- prcomp(data_full[54:ncol(data_full)], center = TRUE, scale. = TRUE)
Lipids_pca_plot <- ggbiplot(Lipids_pca, var.axes=FALSE, ellipse=TRUE, groups=data_full$Centre) + theme_minimal()
Lipids_scree <- fviz_eig(Lipids_pca)
Lipids_contrib <- fviz_contrib(Lipids_pca, choice = "var", axes = 1:3, top = 20)
Lipids_pca2 <- PCA(data_full[54:ncol(data_full)])
Lipids_pca_desc <- dimdesc(Lipids_pca2, axes = c(1:2), proba = 0.05)
Lipids_pca_desc$Dim.1

top_row <- plot_grid(Lipids_pca_plot, ncol = 1, labels = c('A'), label_fontfamily = 'serif', label_fontface = 'bold', label_size = 22, align = 'w')
bottom_row <- plot_grid(Lipids_scree, Lipids_contrib, ncol = 2, labels = c('B', 'C'), label_fontfamily = 'serif', label_fontface = 'bold', label_size = 22, align = 'w', rel_widths = c(1.5, 1.5))

pdf(file="Lipids_pca_abs_v1.pdf",width=12,height=12)
plot_grid(top_row, bottom_row, ncol = 1, rel_heights = c(1.0, 1.0))
dev.off()

pca_loadings <- Lipids_pca$rotation
write.table(pca_loadings, file="pca_loadings.csv",sep=",")

#################### ------------- #################### ------------- #################### ------------- #################### -------------


## Rome NAFLD Bx group appears different from rest based on PC2, therefore normalise within cohort

data_centre <- merge(centre, data, by="Participant")

Rome_data <- subset(data_centre, Centre=="Rome")
Not_Rome_data <- subset(data_centre, Centre!="Rome")

Rome_data[3:ncol(Rome_data)] <- lapply(Rome_data[3:ncol(Rome_data)], function(x) c(scale(x)))
Not_Rome_data[3:ncol(Not_Rome_data)] <- lapply(Not_Rome_data[3:ncol(Not_Rome_data)], function(x) c(scale(x)))

data_new <- rbind(Rome_data, Not_Rome_data)
data_new = subset(data_new, select = -c(Centre))

## merge metadata  with lipid data
data_full22 <- merge(meta_data, data_new, by="Participant")

## PCA for all lipids
Lipids_pca3 <- prcomp(data_full22[54:ncol(data_full22)], center = TRUE, scale. = TRUE)
Lipids_pca3_plot <- ggbiplot(Lipids_pca3, var.axes=FALSE, ellipse=TRUE, groups=data_full22$Centre) + theme_minimal()
Lipids_scree3 <- fviz_eig(Lipids_pca3)
Lipids_contrib3 <- fviz_contrib(Lipids_pca3, choice = "var", axes = 1:3, top = 20)
Lipids_pca3 <- PCA(data_full22[54:ncol(data_full22)])
Lipids_pca3_desc <- dimdesc(Lipids_pca3, axes = c(1:2), proba = 0.05)
Lipids_pca3_desc$Dim.1

top_row3 <- plot_grid(Lipids_pca3_plot, ncol = 1, labels = c('A'), label_fontfamily = 'serif', label_fontface = 'bold', label_size = 22, align = 'w')
bottom_row3 <- plot_grid(Lipids_scree3, Lipids_contrib3, ncol = 2, labels = c('B', 'C'), label_fontfamily = 'serif', label_fontface = 'bold', label_size = 22, align = 'w', rel_widths = c(1.5, 1.5))

pdf(file="Lipids_pca3_abs_v1.pdf",width=12,height=12)
plot_grid(top_row3, bottom_row3, ncol = 1, rel_heights = c(1.0, 1.0))
dev.off()

pca3_loadings <- Lipids_pca3$rotation
write.table(pca3_loadings, file="pca3_loadings.csv",sep=",")

## PCA appears better. use this data in further analysis
data_full2 = data_full22

#################### ------------- #################### ------------- #################### ------------- #################### -------------

#################### ---- summary table for baseline characteristics

meta_data$Group <- as.factor(meta_data$Group)
meta_data$Group <- factor(meta_data$Group, levels = c("Lean", "Obese", "NAFLD"))

names(meta_data)[names(meta_data) == 'HFF%'] <- 'HFF'

Tab_groups <- meta_data %>% dplyr::group_by(Group) %>% dplyr::summarise(n = n(), Age_mean = mean(Age, na.rm = TRUE), Age_sd = sd(Age, na.rm = TRUE), Female = sum(Sex=="1", na.rm = TRUE), HOMA_mean = mean(HOMA, na.rm = TRUE), HOMA_sd = sd(HOMA, na.rm = TRUE), ALT_mean = mean(ALT, na.rm = TRUE), ALT_sd = sd(ALT, na.rm = TRUE), AST_mean = mean(AST, na.rm = TRUE), AST_sd = sd(AST, na.rm = TRUE), GGT_mean = mean(GGT, na.rm = TRUE), GGT_sd = sd(GGT, na.rm = TRUE), ALP_mean = mean(ALP, na.rm = TRUE), ALP_sd = sd(ALP, na.rm = TRUE), Chol_mean = mean(Chol, na.rm = TRUE), Chol_sd = sd(Chol, na.rm = TRUE), HDL_mean = mean(HDL, na.rm = TRUE), HDL_sd = sd(HDL, na.rm = TRUE), LDL_mean = mean(LDL, na.rm = TRUE), LDL_sd = sd(LDL, na.rm = TRUE), Trig_mean = mean(Trig, na.rm = TRUE), Trig_sd = sd(Trig, na.rm = TRUE), bmi_mean = mean(bmi, na.rm = TRUE), bmi_sd = sd(bmi, na.rm = TRUE), WC_mean = mean(WC, na.rm = TRUE), WC_sd = sd(WC, na.rm = TRUE), HFF_mean = mean(HFF, na.rm = TRUE), HFF_sd = sd(HFF, na.rm = TRUE), TE_mean = mean(TE, na.rm = TRUE), TE_sd = sd(TE, na.rm = TRUE), CAP_mean = mean(CAP, na.rm = TRUE), CAP_sd = sd(CAP, na.rm = TRUE))

Tab_overall <- meta_data %>% dplyr::summarise(n = n(), Age_mean = mean(Age, na.rm = TRUE), Age_sd = sd(Age, na.rm = TRUE), Female = sum(Sex=="1", na.rm = TRUE), HOMA_mean = mean(HOMA, na.rm = TRUE), HOMA_sd = sd(HOMA, na.rm = TRUE), ALT_mean = mean(ALT, na.rm = TRUE), ALT_sd = sd(ALT, na.rm = TRUE), AST_mean = mean(AST, na.rm = TRUE), AST_sd = sd(AST, na.rm = TRUE), GGT_mean = mean(GGT, na.rm = TRUE), GGT_sd = sd(GGT, na.rm = TRUE), ALP_mean = mean(ALP, na.rm = TRUE), ALP_sd = sd(ALP, na.rm = TRUE), Chol_mean = mean(Chol, na.rm = TRUE), Chol_sd = sd(Chol, na.rm = TRUE), HDL_mean = mean(HDL, na.rm = TRUE), HDL_sd = sd(HDL, na.rm = TRUE), LDL_mean = mean(LDL, na.rm = TRUE), LDL_sd = sd(LDL, na.rm = TRUE), Trig_mean = mean(Trig, na.rm = TRUE), Trig_sd = sd(Trig, na.rm = TRUE), bmi_mean = mean(bmi, na.rm = TRUE), bmi_sd = sd(bmi, na.rm = TRUE), WC_mean = mean(WC, na.rm = TRUE), WC_sd = sd(WC, na.rm = TRUE), HFF_mean = mean(HFF, na.rm = TRUE), HFF_sd = sd(HFF, na.rm = TRUE), TE_mean = mean(TE, na.rm = TRUE), TE_sd = sd(TE, na.rm = TRUE), CAP_mean = mean(CAP, na.rm = TRUE), CAP_sd = sd(CAP, na.rm = TRUE))
Tab_overall$Group <- "Overall"

Tab_sum <- rbind(Tab_overall, Tab_groups)
Tab_sum[Tab_sum == "NaN"] <- NA   

Tab_sum$Fem_per = (Tab_sum$Female / Tab_sum$n)*100
Tab_sum$Age <- paste(format(round(Tab_sum$Age_mean, 1), nsmall = 1), format(round(Tab_sum$Age_sd, 1), nsmall = 1), sep = " (", collapse = NULL)
Tab_sum$Age <- paste(Tab_sum$Age, "", sep = ")", collapse = NULL)
Tab_sum$HOMA <- paste(format(round(Tab_sum$HOMA_mean, 1), nsmall = 1), format(round(Tab_sum$HOMA_sd, 1), nsmall = 1), sep = " (", collapse = NULL)
Tab_sum$HOMA <- paste(Tab_sum$HOMA, "", sep = ")", collapse = NULL)
Tab_sum$ALT <- paste(format(round(Tab_sum$ALT_mean, 1), nsmall = 1), format(round(Tab_sum$ALT_sd, 1), nsmall = 1), sep = " (", collapse = NULL)
Tab_sum$ALT <- paste(Tab_sum$ALT, "", sep = ")", collapse = NULL)
Tab_sum$AST <- paste(format(round(Tab_sum$AST_mean, 1), nsmall = 1), format(round(Tab_sum$AST_sd, 1), nsmall = 1), sep = " (", collapse = NULL)
Tab_sum$AST <- paste(Tab_sum$AST, "", sep = ")", collapse = NULL)
Tab_sum$GGT <- paste(format(round(Tab_sum$GGT_mean, 1), nsmall = 1), format(round(Tab_sum$GGT_sd, 1), nsmall = 1), sep = " (", collapse = NULL)
Tab_sum$GGT <- paste(Tab_sum$GGT, "", sep = ")", collapse = NULL)
Tab_sum$ALP <- paste(format(round(Tab_sum$ALP_mean, 1), nsmall = 1), format(round(Tab_sum$ALP_sd, 1), nsmall = 1), sep = " (", collapse = NULL)
Tab_sum$ALP <- paste(Tab_sum$ALP, "", sep = ")", collapse = NULL)
Tab_sum$Chol <- paste(format(round(Tab_sum$Chol_mean, 1), nsmall = 1), format(round(Tab_sum$Chol_sd, 1), nsmall = 1), sep = " (", collapse = NULL)
Tab_sum$Chol <- paste(Tab_sum$Chol, "", sep = ")", collapse = NULL)
Tab_sum$HDL <- paste(format(round(Tab_sum$HDL_mean, 1), nsmall = 1), format(round(Tab_sum$HDL_sd, 1), nsmall = 1), sep = " (", collapse = NULL)
Tab_sum$HDL <- paste(Tab_sum$HDL, "", sep = ")", collapse = NULL)
Tab_sum$LDL <- paste(format(round(Tab_sum$LDL_mean, 1), nsmall = 1), format(round(Tab_sum$LDL_sd, 1), nsmall = 1), sep = " (", collapse = NULL)
Tab_sum$LDL <- paste(Tab_sum$LDL, "", sep = ")", collapse = NULL)
Tab_sum$Trig <- paste(format(round(Tab_sum$Trig_mean, 1), nsmall = 1), format(round(Tab_sum$Trig_sd, 1), nsmall = 1), sep = " (", collapse = NULL)
Tab_sum$Trig <- paste(Tab_sum$Trig, "", sep = ")", collapse = NULL)
Tab_sum$bmi <- paste(format(round(Tab_sum$bmi_mean, 2), nsmall = 2), format(round(Tab_sum$bmi_sd, 1), nsmall = 1), sep = " (", collapse = NULL)
Tab_sum$bmi <- paste(Tab_sum$bmi, "", sep = ")", collapse = NULL)
Tab_sum$WC <- paste(format(round(Tab_sum$WC_mean, 1), nsmall = 1), format(round(Tab_sum$WC_sd, 1), nsmall = 1), sep = " (", collapse = NULL)
Tab_sum$WC <- paste(Tab_sum$WC, "", sep = ")", collapse = NULL)
Tab_sum$HFF <- paste(format(round(Tab_sum$HFF_mean, 1), nsmall = 1), format(round(Tab_sum$HFF_sd, 1), nsmall = 1), sep = " (", collapse = NULL)
Tab_sum$HFF <- paste(Tab_sum$HFF, "", sep = ")", collapse = NULL)
Tab_sum$TE <- paste(format(round(Tab_sum$TE_mean, 1), nsmall = 1), format(round(Tab_sum$TE_sd, 1), nsmall = 1), sep = " (", collapse = NULL)
Tab_sum$TE <- paste(Tab_sum$TE, "", sep = ")", collapse = NULL)
Tab_sum$CAP <- paste(format(round(Tab_sum$CAP_mean, 1), nsmall = 1), format(round(Tab_sum$CAP_sd, 1), nsmall = 1), sep = " (", collapse = NULL)
Tab_sum$CAP <- paste(Tab_sum$CAP, "", sep = ")", collapse = NULL)
Tab_sum$FemaleSex <- paste(Tab_sum$Female, format(round(Tab_sum$Fem_per, 1), nsmall = 1), sep = " (", collapse = NULL)
Tab_sum$FemaleSex <- paste(Tab_sum$FemaleSex, "", sep = ")", collapse = NULL)

Tab_sum = t(subset(Tab_sum, select = c(Group, n, FemaleSex, Age, bmi, WC, HOMA, Chol, HDL, LDL, Trig, ALT, AST, GGT, ALP, HFF, CAP, TE)))
Tab_sum[Tab_sum == " NA ( NA)"] <- NA
Tab_sum[Tab_sum == "  NA ( NA)"] <- NA
Tab_sum[Tab_sum == "   NA ( NA)"] <- NA
Tab_sum[Tab_sum == " NA (   NA)"] <- NA
Tab_sum[Tab_sum == "  NA (   NA)"] <- NA
Tab_sum[Tab_sum == "   NA (   NA)"] <- NA
Tab_sum[Tab_sum == "   NA (  NA)"] <- NA
Tab_sum[Tab_sum == "   NA (  NA)"] <- NA
Tab_sum[Tab_sum == "  NA (  NA)"] <- NA

colnames(Tab_sum) <- c("Overall", 'Lean', 'Obese', 'NAFLD')
Tab_sum <- as.data.frame(Tab_sum[-1,])

Tab_sum$var <- rownames(Tab_sum)


## annotate table with comparison of obese vs NAFLD cohorts

meta_data$log_Age <- log(meta_data$Age)
meta_data$log_bmi <- log(meta_data$bmi)
meta_data$log_WC <- log(meta_data$WC)
meta_data$log_HOMA <- log(meta_data$HOMA)
meta_data$log_Chol <- log(meta_data$Chol)
meta_data$log_HDL <- log(meta_data$HDL)
meta_data$log_LDL <- log(meta_data$LDL)
meta_data$log_Trig <- log(meta_data$Trig)
meta_data$log_ALT <- log(meta_data$ALT)
meta_data$log_AST <- log(meta_data$AST)
meta_data$log_GGT <- log(meta_data$GGT)
meta_data$log_ALP <- log(meta_data$ALP)
meta_data$log_HFF <- log(meta_data$HFF)
meta_data$log_CAP <- log(meta_data$CAP)
meta_data$log_TE <- log(meta_data$TE)

meta_data$Group2 = meta_data$Group
meta_data$Group2[meta_data$Group2 == "Lean"] <- NA
meta_data$Group2 <- droplevels(meta_data$Group2)

Age_t <- meta_data %>% pairwise_t_test(log_Age ~ Group2, p.adjust.method = 'bonferroni')
bmi_t <- meta_data %>% pairwise_t_test(log_bmi ~ Group2, p.adjust.method = 'bonferroni')
WC_t <- meta_data %>% pairwise_t_test(log_WC ~ Group2, p.adjust.method = 'bonferroni')
HOMA_t <- meta_data %>% pairwise_t_test(log_HOMA ~ Group2, p.adjust.method = 'bonferroni')
Chol_t <- meta_data %>% pairwise_t_test(log_Chol ~ Group2, p.adjust.method = 'bonferroni')
HDL_t <- meta_data %>% pairwise_t_test(log_HDL ~ Group2, p.adjust.method = 'bonferroni')
LDL_t <- meta_data %>% pairwise_t_test(log_LDL ~ Group2, p.adjust.method = 'bonferroni')
Trig_t <- meta_data %>% pairwise_t_test(log_Trig ~ Group2, p.adjust.method = 'bonferroni')
ALT_t <- meta_data %>% pairwise_t_test(log_ALT ~ Group2, p.adjust.method = 'bonferroni')
AST_t <- meta_data %>% pairwise_t_test(log_AST ~ Group2, p.adjust.method = 'bonferroni')
GGT_t <- meta_data %>% pairwise_t_test(log_GGT ~ Group2, p.adjust.method = 'bonferroni')
ALP_t <- meta_data %>% pairwise_t_test(log_ALP ~ Group2, p.adjust.method = 'bonferroni')
HFF_t <- meta_data %>% pairwise_t_test(log_HFF ~ Group2, p.adjust.method = 'bonferroni')
CAP_t <- meta_data %>% pairwise_t_test(log_CAP ~ Group2, p.adjust.method = 'bonferroni')
TE_t <- meta_data %>% pairwise_t_test(log_TE ~ Group2, p.adjust.method = 'bonferroni')

Tab_sum2 <- rbind(Tab_overall, Tab_groups)
sex_table = subset(Tab_sum2, select = c(Group, Female, n))
sex_table$Male = sex_table$n - sex_table$Female
sex_table = sex_table[-1,]
sex_table = sex_table[-1,]
sex_table = subset(sex_table, select = c(Female, Male))
Sex_t <- chisq.test(sex_table)

Tab_sum_pval <- as.data.frame(Age_t$p.adj)
Tab_sum_pval$Age <- Age_t$p.adj
Tab_sum_pval$bmi <- bmi_t$p.adj
Tab_sum_pval$WC <- NA
Tab_sum_pval$HOMA <- HOMA_t$p.adj
Tab_sum_pval$Chol <- Chol_t$p.adj
Tab_sum_pval$HDL <- HDL_t$p.adj
Tab_sum_pval$LDL <- LDL_t$p.adj
Tab_sum_pval$Trig <- Trig_t$p.adj
Tab_sum_pval$ALT <- ALT_t$p.adj
Tab_sum_pval$AST <- AST_t$p.adj
Tab_sum_pval$GGT <- GGT_t$p.adj
Tab_sum_pval$ALP <- ALP_t$p.adj
Tab_sum_pval$HFF <- NA
Tab_sum_pval$CAP <- NA
Tab_sum_pval$TE <- TE_t$p.adj
Tab_sum_pval$Sex <- Sex_t$p.value
Tab_sum_pval$n <- NA
Tab_sum_pval <- as.data.frame(t(Tab_sum_pval))
Tab_sum_pval$var <- rownames(Tab_sum_pval)
Tab_sum_pval = Tab_sum_pval[-1,]
colnames(Tab_sum_pval) <- c("pval", "var")
Tab_sum_pval$qval <- p.adjust(Tab_sum_pval$pval, method = "hochberg")

Tab_sum <- merge(Tab_sum, Tab_sum_pval, by="var", all=TRUE)
Tab_sum = subset(Tab_sum, select = -c(pval))
rownames(Tab_sum) = Tab_sum$var
Tab_sum = subset(Tab_sum, select = -c(var))
Tab_sum$qval2 <- ifelse(Tab_sum$qval >= 0.01, format(round(Tab_sum$qval, 2), nsmall = 2), formatC(Tab_sum$qval, format = "e", digits = 1))
Tab_sum = subset(Tab_sum, select = -c(qval))
write.table(Tab_sum, file="Table1.csv",sep=",")

#################### ---- summary table for histology

SteatTab <- meta_data %>% dplyr::group_by(Steat) %>% dplyr::summarise(Steatosis = n())
SteatTab <- SteatTab[complete.cases(SteatTab), ]
SteatTab  = SteatTab [-1,]
SteatTab$Steatosis_per = (SteatTab$Steatosis / (sum(SteatTab$Steatosis)))*100
SteatTab$score <- SteatTab$Steat
SteatTab$Steatosis2 <- paste(SteatTab$Steatosis, format(round(SteatTab$Steatosis_per, 1), nsmall = 1), sep = " (", collapse = NULL)
SteatTab$Steatosis2 <- paste(SteatTab$Steatosis2, "", sep = ")", collapse = NULL)
SteatTab = subset(SteatTab, select = c(score, Steatosis2))

LobularTab <- meta_data %>% dplyr::group_by(Inflam) %>% dplyr::summarise(Lobular = n())
LobularTab <- LobularTab[complete.cases(LobularTab), ]
LobularTab$Lobular_per = (LobularTab$Lobular / (sum(LobularTab$Lobular)))*100
LobularTab$score <- LobularTab$Inflam
LobularTab$Lobular2 <- paste(LobularTab$Lobular, format(round(LobularTab$Lobular_per, 1), nsmall = 1), sep = " (", collapse = NULL)
LobularTab$Lobular2 <- paste(LobularTab$Lobular2, "", sep = ")", collapse = NULL)
LobularTab = subset(LobularTab, select = c(score, Lobular2))

BalloonTab <- meta_data %>% dplyr::group_by(Ballooning) %>% dplyr::summarise(Balloon = n())
BalloonTab <- BalloonTab[complete.cases(BalloonTab), ]
BalloonTab$Balloon_per = (BalloonTab$Balloon / (sum(BalloonTab$Balloon)))*100
BalloonTab$score <- BalloonTab$Ballooning
BalloonTab$Balloon2 <- paste(BalloonTab$Balloon, format(round(BalloonTab$Balloon_per, 1), nsmall = 1), sep = " (", collapse = NULL)
BalloonTab$Balloon2 <- paste(BalloonTab$Balloon2, "", sep = ")", collapse = NULL)
BalloonTab = subset(BalloonTab, select = c(score, Balloon2))

PortalInflamTab <- meta_data %>% dplyr::group_by(Portal) %>% dplyr::summarise(PortalInflam = n())
PortalInflamTab <- PortalInflamTab[complete.cases(PortalInflamTab), ]
PortalInflamTab$PortalInflam_per = (PortalInflamTab$PortalInflam / (sum(PortalInflamTab$PortalInflam)))*100
PortalInflamTab$score <- PortalInflamTab$Portal
PortalInflamTab$PortalInflam2 <- paste(PortalInflamTab$PortalInflam, format(round(PortalInflamTab$PortalInflam_per, 1), nsmall = 1), sep = " (", collapse = NULL)
PortalInflamTab$PortalInflam2 <- paste(PortalInflamTab$PortalInflam2, "", sep = ")", collapse = NULL)
PortalInflamTab = subset(PortalInflamTab, select = c(score, PortalInflam2))

FibrosisTab <- meta_data %>% dplyr::group_by(Fib) %>% dplyr::summarise(Fibrosis = n())
FibrosisTab <- FibrosisTab[complete.cases(FibrosisTab), ]
FibrosisTab$Fibrosis_per = (FibrosisTab$Fibrosis / (sum(FibrosisTab$Fibrosis)))*100
FibrosisTab$score <- FibrosisTab$Fib
FibrosisTab$Fibrosis2 <- paste(FibrosisTab$Fibrosis, format(round(FibrosisTab$Fibrosis_per, 1), nsmall = 1), sep = " (", collapse = NULL)
FibrosisTab$Fibrosis2 <- paste(FibrosisTab$Fibrosis2, "", sep = ")", collapse = NULL)
FibrosisTab = subset(FibrosisTab, select = c(score, Fibrosis2))

NAFLDActScTab <- meta_data %>% dplyr::group_by(NAS) %>% dplyr::summarise(NAFLDActSc = n())
NAFLDActScTab <- NAFLDActScTab[complete.cases(NAFLDActScTab), ]
NAFLDActScTab$NAFLDActSc_per = (NAFLDActScTab$NAFLDActSc / (sum(NAFLDActScTab$NAFLDActSc)))*100
NAFLDActScTab$score <- NAFLDActScTab$NAS
NAFLDActScTab$NAFLDActSc2 <- paste(NAFLDActScTab$NAFLDActSc, format(round(NAFLDActScTab$NAFLDActSc_per, 1), nsmall = 1), sep = " (", collapse = NULL)
NAFLDActScTab$NAFLDActSc2 <- paste(NAFLDActScTab$NAFLDActSc2, "", sep = ")", collapse = NULL)
NAFLDActScTab = subset(NAFLDActScTab, select = c(score, NAFLDActSc2))

HistolTab <- merge(SteatTab, LobularTab, by="score", all=TRUE)
HistolTab <- merge(HistolTab, BalloonTab, by="score", all=TRUE)
HistolTab <- merge(HistolTab, PortalInflamTab, by="score", all=TRUE)
HistolTab <- merge(HistolTab, FibrosisTab, by="score", all=TRUE)
HistolTab <- merge(HistolTab, NAFLDActScTab, by="score", all=TRUE)
colnames(HistolTab) <- c("Score", 'Steatosis', 'Ballooning', 'Lobular Inflammation', 'Portal Inflammation', 'Fibrosis', 'NAFLD Actvitiy Score')
write.table(HistolTab, file="Table S1.csv",sep=",")


#################### ----

## make a correlation matrix for lipids 
library(Hmisc)

flattenCorrMatrix <- function(cormat, pmat) {
  ut <- upper.tri(cormat)
  data.frame(
    row = rownames(cormat)[row(cormat)[ut]],
    column = rownames(cormat)[col(cormat)[ut]],
    cor  =(cormat)[ut],
    p = pmat[ut]
    )
}

Lipids_corr <- rcorr(as.matrix(data_full2[54:ncol(data_full2)]), type="pearson")
Lipids_corr_tab <- flattenCorrMatrix(Lipids_corr$r, Lipids_corr$P)
write.table(Lipids_corr_tab, file="Lipids_corr_tab.csv",sep=",")

pdf(file="lipids_cor_nosig_v1.pdf",width=10,height=8)
corrplot(Lipids_corr$r, method="color", order = "alphabet", type = "upper", tl.cex = .2)
dev.off()

pdf(file="lipids_cor_nolab_v1.pdf",width=10,height=8)
corrplot(Lipids_corr$r, method="color", order = "alphabet", type = "upper", tl.pos = "n")
dev.off()

## define significance thresholds
lipid_sig = 0.05/(sqrt(ncol(data) - 1))


###### make heatmap of all lipids

data_full2_hm <- data_full2
rownames(data_full2_hm) = data_full2_hm$Participant
Group_simple = data.frame("Group_simple" = data_full2$Group)
rownames(Group_simple) = rownames(data_full2_hm)

hm_lipids <- as.data.frame(colnames(data_full2_hm[54:281]))
names(hm_lipids)[names(hm_lipids) == 'colnames(data_full2_hm[54:281])'] <- 'var'

hm_lipids$var_orig <- hm_lipids$var

hm_lipids <- merge(hm_lipids, Lipids_annotation, by="var")
rownames(hm_lipids) <- hm_lipids$var
hm_lipids = subset(hm_lipids, select = c("LipidGroup"))

library(pheatmap)

pdf(file="hm_overall_v1.pdf",width=10, height=10)
hm_overall <- pheatmap(data_full2_hm[54:281], cluster_rows = TRUE, cluster_cols = TRUE, cutree_rows = 6, cutree_cols = 3, show_rownames = FALSE, show_colnames = FALSE, treeheight_row = 0, treeheight_col = 0, annotation_row = Group_simple, annotation_col = hm_lipids, cellheight=1,cellwidth=1.5)
hm_overall
dev.off()


## log-transform variables to meet normal distribution, if needed
names(data_full2)[names(data_full2) == 'HFF%'] <- 'HFF'
hist(data_full2$HFF)
data_full2$log_HFF <- log(data_full2$HFF)
hist(data_full2$log_HFF)

hist(data_full2$ALT)
data_full2$log_ALT <- log(data_full2$ALT)
hist(data_full2$log_ALT)

data_full2$mABP <- data_full2$dias_bp + ((data_full2$syst_bp - data_full2$dias_bp) / 3)
hist(data_full2$mABP)
data_full2$log_mABP <- log(data_full2$mABP)
hist(data_full2$log_mABP)

hist(data_full2$bmi)

hist(data_full2$HOMA)
data_full2$log_HOMA <- log(data_full2$HOMA)
hist(data_full2$log_HOMA)

hist(data_full2$CAP)

hist(data_full2$TE)
data_full2$log_TE <- log(data_full2$TE)
hist(data_full2$log_TE)





############

## correlation matrix of traits in obese & NAFLD cohorts

Obese_cor <- subset(meta_data, Centre=="DutchA" | Centre=="DutchB")
NAFLDBx_cor <- subset(meta_data, Centre=="Rome")

Obese_cor = subset(Obese_cor, select = c("Age","HOMA","ALT","AST","GGT","Chol","HDL","LDL","Trig","bmi","WC","HipCirc","HFF"))
NAFLDBx_cor = subset(NAFLDBx_cor, select = c("Age","HOMA","ALT","AST","Chol","HDL","LDL","Trig","bmi","HSD17B13","PNPLA3","TM6SF2","MTARC1","Steat","Ballooning","Inflam","Portal","Fib"))

NAFLDBx_cor2 = subset(NAFLDBx_cor, select = c("Age","HOMA","ALT","AST","Chol","HDL","LDL","Trig","bmi","Steat","Ballooning","Inflam","Portal","Fib"))


library(Hmisc)
Obese_cor_pears <- rcorr(as.matrix(Obese_cor), type="pearson")
Obese_cor_pears_tab <- flattenCorrMatrix(Obese_cor_pears$r, Obese_cor_pears$P)
write.table(Obese_cor_pears_tab, file="Obese_cor_pears_tab.csv",sep=",")

NAFLDBx_cor_pears <- rcorr(as.matrix(NAFLDBx_cor2), type="pearson")
NAFLDBx_cor_pears_tab <- flattenCorrMatrix(NAFLDBx_cor_pears$r, NAFLDBx_cor_pears$P)
write.table(NAFLDBx_cor_pears_tab, file="NAFLDBx_cor_pears_tab.csv",sep=",")

col<- colorRampPalette(c("blue4", "white", "firebrick3"))(20)

pdf(file="Obese_corrplot_v1.pdf",width=8,height=8)
Obese_corrplot <- corrplot(Obese_cor_pears$r, tl.cex = 1, order = "hclust", addgrid.col = "darkgray",bg="snow2",outline = T,tl.col="black", col=col,tl.srt=45,p.mat = Obese_cor_pears$P, insig = "label_sig", sig.level = c(.001, .01, .05), pch.cex=1.2, pch.col = "black", type = "upper")
Obese_corrplot
dev.off()


pdf(file="NAFLDBx_corrplot_v1.pdf",width=8,height=8)
NAFLDBx_corrplot <- corrplot(NAFLDBx_cor_pears$r, tl.cex = 1, order = "hclust", addgrid.col = "darkgray",bg="snow2",outline = T,tl.col="black", col=col,tl.srt=45,p.mat = NAFLDBx_cor_pears$P, insig = "label_sig", sig.level = c(.001, .01, .05), pch.cex=1.2, pch.col = "black", type = "upper")
NAFLDBx_corrplot
dev.off()




############################## ------ ready to start analysis ------- ################################

### test associations of lipids with ALT in obesity cohorts

obese_data <- subset(data_full2, Centre=="DutchA" | Centre=="DutchB")

hist(obese_data$HFF)
hist(obese_data$log_HFF)

## Regress ALT with lipids in obese cohort
obese_data_ALT_lm_full <- lapply(obese_data[54:281], function(x) summary(lm(x ~ obese_data$log_ALT + obese_data$Sex + obese_data$Age)))
obese_data_ALT_lm <- lapply(obese_data_ALT_lm_full, coef)
obese_data_ALT_lm <- data.frame(obese_data_ALT_lm)
obese_data_ALT_lm <- t(obese_data_ALT_lm)
obese_data_ALT_lm = subset(obese_data_ALT_lm, select = -c(1,3,4) )
obese_data_ALT_lm <- data.frame(obese_data_ALT_lm)
obese_data_ALT_lm$annot <- rep(annotation$annotation, each=1, length.out=nrow(obese_data_ALT_lm))
obese_data_ALT_lm <- obese_data_ALT_lm[order(obese_data_ALT_lm$annot),]
obese_data_ALT_lm_beta <- obese_data_ALT_lm[1:((nrow(obese_data_ALT_lm)/4)),]
obese_data_ALT_lm_p <- obese_data_ALT_lm[((nrow(obese_data_ALT_lm)/4)+1):((nrow(obese_data_ALT_lm)/4)*2),]
obese_data_ALT_lm_SE <- obese_data_ALT_lm[(((nrow(obese_data_ALT_lm)/4)*2)+1):((nrow(obese_data_ALT_lm)/4)*3),]
obese_data_ALT_lm_t <- obese_data_ALT_lm[(((nrow(obese_data_ALT_lm)/4)*3)+1):(nrow(obese_data_ALT_lm)),]

obese_data_ALT_lm_beta$beta <- obese_data_ALT_lm_beta$obese_data.log_ALT
obese_data_ALT_lm_beta = subset(obese_data_ALT_lm_beta, select = -c(1,2))
obese_data_ALT_lm_SE$SE <- obese_data_ALT_lm_SE$obese_data.log_ALT
obese_data_ALT_lm_SE = subset(obese_data_ALT_lm_SE, select = -c(1,2))
obese_data_ALT_lm_p$p <- obese_data_ALT_lm_p$obese_data.log_ALT
obese_data_ALT_lm_p = subset(obese_data_ALT_lm_p, select = -c(1,2))
obese_data_ALT_lm_t$t <- obese_data_ALT_lm_t$obese_data.log_ALT
obese_data_ALT_lm_t = subset(obese_data_ALT_lm_t, select = -c(1,2))

obese_data_ALT_lm_beta$name <- row.names(obese_data_ALT_lm_beta)
obese_data_ALT_lm_beta$name2 = substr(obese_data_ALT_lm_beta$name,1,nchar(obese_data_ALT_lm_beta$name)-9)
obese_data_ALT_lm_p$name <- row.names(obese_data_ALT_lm_p)
obese_data_ALT_lm_p$name2 = substr(obese_data_ALT_lm_p$name,1,nchar(obese_data_ALT_lm_p$name)-9)
obese_data_ALT_lm_SE$name <- row.names(obese_data_ALT_lm_SE)
obese_data_ALT_lm_SE$name2 = substr(obese_data_ALT_lm_SE$name,1,nchar(obese_data_ALT_lm_SE$name)-11)
obese_data_ALT_lm_t$name <- row.names(obese_data_ALT_lm_t)
obese_data_ALT_lm_t$name2 = substr(obese_data_ALT_lm_t$name,1,nchar(obese_data_ALT_lm_t$name)-8)

obese_data_ALT_lm_sum <- merge(obese_data_ALT_lm_beta, obese_data_ALT_lm_SE, by="name2")
obese_data_ALT_lm_sum <- merge(obese_data_ALT_lm_sum, obese_data_ALT_lm_p, by="name2")
obese_data_ALT_lm_sum <- merge(obese_data_ALT_lm_sum, obese_data_ALT_lm_t, by="name2")

obese_data_ALT_lm_sum = subset(obese_data_ALT_lm_sum, select = c("name2","beta","SE","t","p"))
names(obese_data_ALT_lm_sum)[names(obese_data_ALT_lm_sum) == 'name2'] <- 'var'
obese_data_ALT_lm_sum2 <- merge(Lipids_annotation, obese_data_ALT_lm_sum, by="var")
obese_data_ALT_lm_sum2$num <- nrow(obese_data)
obese_data_ALT_lm_sum2$sig <- NA
obese_data_ALT_lm_sum2 <- obese_data_ALT_lm_sum2 %>% mutate(sig = ifelse(p < lipid_sig, "Significant", "Not significant"))

obese_data_ALT_lm_sum2$qval <- p.adjust(obese_data_ALT_lm_sum2$p, method = "hochberg")
obese_data_ALT_lm_sum2$neglog_p <- -log10(obese_data_ALT_lm_sum2$p)
write.table(obese_data_ALT_lm_sum2,file="Obese_ALT_lm_summary.csv",sep=",")

#####

## volcano plot

pdf(file="Obese_ALT_lm_vol_v1.pdf",width=5,height=6)
Obese_ALT_vol <- ggplot(data= obese_data_ALT_lm_sum2, aes(x=beta, y=neglog_p, colour=LipidGroup)) + geom_point(alpha=0.4, size=1.75) + geom_text_repel(data = subset(obese_data_ALT_lm_sum2, neglog_p > 2.3), aes(label = var), size = 3, key_glyph = "point") + xlab("Beta-regression coefficient") + ylab("-log10 p-value") + theme_bw() + theme(legend.position="right")  + theme(plot.title = element_text(face = "bold")) + theme(plot.title = element_text(hjust = 0.2)) + ggtitle("Plasma lipids associated with ALT") + labs(color = "Lipid class")
Obese_ALT_vol
dev.off()


############


## identify trends using meta-regression with beta vs carbons & db

Obese_ALT_PC_db_reg <- lm(beta ~ db, data=subset(obese_data_ALT_lm_sum2, LipidGroup=="PC"))
Obese_ALT_PC_db_reg_sm <- summary(Obese_ALT_PC_db_reg)
Obese_ALT_PC_db_reg_coef <- as.data.frame(Obese_ALT_PC_db_reg_sm$coefficients)
Obese_ALT_PC_db_reg_coef$LipidGroup <- "PC"
Obese_ALT_PC_db_reg_coef$MetaReg <- "db"
Obese_ALT_PC_db_reg_coef <- Obese_ALT_PC_db_reg_coef[-c(1),]
Obese_ALT_PC_db_reg_coef$r_sq <- Obese_ALT_PC_db_reg_sm$adj.r.squared

Obese_ALT_LPC_db_reg <- lm(beta ~ db, data=subset(obese_data_ALT_lm_sum2, LipidGroup=="LysoPC"))
Obese_ALT_LPC_db_reg_sm <- summary(Obese_ALT_LPC_db_reg)
Obese_ALT_LPC_db_reg_coef <- as.data.frame(Obese_ALT_LPC_db_reg_sm$coefficients)
Obese_ALT_LPC_db_reg_coef$LipidGroup <- "LPC"
Obese_ALT_LPC_db_reg_coef$MetaReg <- "db"
Obese_ALT_LPC_db_reg_coef <- Obese_ALT_LPC_db_reg_coef[-c(1),]
Obese_ALT_LPC_db_reg_coef$r_sq <- Obese_ALT_LPC_db_reg_sm$adj.r.squared

Obese_ALT_DG_db_reg <- lm(beta ~ db, data=subset(obese_data_ALT_lm_sum2, LipidGroup=="Diglyceride"))
Obese_ALT_DG_db_reg_sm <- summary(Obese_ALT_DG_db_reg)
Obese_ALT_DG_db_reg_coef <- as.data.frame(Obese_ALT_DG_db_reg_sm$coefficients)
Obese_ALT_DG_db_reg_coef$LipidGroup <- "DG"
Obese_ALT_DG_db_reg_coef$MetaReg <- "db"
Obese_ALT_DG_db_reg_coef <- Obese_ALT_DG_db_reg_coef[-c(1),]
Obese_ALT_DG_db_reg_coef$r_sq <- Obese_ALT_DG_db_reg_sm$adj.r.squared

Obese_ALT_TG_db_reg <- lm(beta ~ db, data=subset(obese_data_ALT_lm_sum2, LipidGroup=="Triglyceride"))
Obese_ALT_TG_db_reg_sm <- summary(Obese_ALT_TG_db_reg)
Obese_ALT_TG_db_reg_coef <- as.data.frame(Obese_ALT_TG_db_reg_sm$coefficients)
Obese_ALT_TG_db_reg_coef$LipidGroup <- "TG"
Obese_ALT_TG_db_reg_coef$MetaReg <- "db"
Obese_ALT_TG_db_reg_coef <- Obese_ALT_TG_db_reg_coef[-c(1),]
Obese_ALT_TG_db_reg_coef$r_sq <- Obese_ALT_TG_db_reg_sm$adj.r.squared

Obese_ALT_SM_db_reg <- lm(beta ~ db, data=subset(obese_data_ALT_lm_sum2, LipidGroup=="Sphingomyelin"))
Obese_ALT_SM_db_reg_sm <- summary(Obese_ALT_SM_db_reg)
Obese_ALT_SM_db_reg_coef <- as.data.frame(Obese_ALT_SM_db_reg_sm$coefficients)
Obese_ALT_SM_db_reg_coef$LipidGroup <- "SM"
Obese_ALT_SM_db_reg_coef$MetaReg <- "db"
Obese_ALT_SM_db_reg_coef <- Obese_ALT_SM_db_reg_coef[-c(1),]
Obese_ALT_SM_db_reg_coef$r_sq <- Obese_ALT_SM_db_reg_sm$adj.r.squared

Obese_ALT_PE_db_reg <- lm(beta ~ db, data=subset(obese_data_ALT_lm_sum2, LipidGroup=="PE"))
Obese_ALT_PE_db_reg_sm <- summary(Obese_ALT_PE_db_reg)
Obese_ALT_PE_db_reg_coef <- as.data.frame(Obese_ALT_PE_db_reg_sm$coefficients)
Obese_ALT_PE_db_reg_coef$LipidGroup <- "PE"
Obese_ALT_PE_db_reg_coef$MetaReg <- "db"
Obese_ALT_PE_db_reg_coef <- Obese_ALT_PE_db_reg_coef[-c(1),]
Obese_ALT_PE_db_reg_coef$r_sq <- Obese_ALT_PE_db_reg_sm$adj.r.squared

Obese_ALT_PS_db_reg <- lm(beta ~ db, data=subset(obese_data_ALT_lm_sum2, LipidGroup=="PS"))
Obese_ALT_PS_db_reg_sm <- summary(Obese_ALT_PS_db_reg)
Obese_ALT_PS_db_reg_coef <- as.data.frame(Obese_ALT_PS_db_reg_sm$coefficients)
Obese_ALT_PS_db_reg_coef$LipidGroup <- "PS"
Obese_ALT_PS_db_reg_coef$MetaReg <- "db"
Obese_ALT_PS_db_reg_coef <- Obese_ALT_PS_db_reg_coef[-c(1),]
Obese_ALT_PS_db_reg_coef$r_sq <- Obese_ALT_PS_db_reg_sm$adj.r.squared

Obese_ALT_PI_db_reg <- lm(beta ~ db, data=subset(obese_data_ALT_lm_sum2, LipidGroup=="PI"))
Obese_ALT_PI_db_reg_sm <- summary(Obese_ALT_PI_db_reg)
Obese_ALT_PI_db_reg_coef <- as.data.frame(Obese_ALT_PI_db_reg_sm$coefficients)
Obese_ALT_PI_db_reg_coef$LipidGroup <- "PI"
Obese_ALT_PI_db_reg_coef$MetaReg <- "db"
Obese_ALT_PI_db_reg_coef <- Obese_ALT_PI_db_reg_coef[-c(1),]
Obese_ALT_PI_db_reg_coef$r_sq <- Obese_ALT_PI_db_reg_sm$adj.r.squared

Obese_ALT_Cer_db_reg <- lm(beta ~ db, data=subset(obese_data_ALT_lm_sum2, LipidGroup=="Ceramide"))
Obese_ALT_Cer_db_reg_sm <- summary(Obese_ALT_Cer_db_reg)
Obese_ALT_Cer_db_reg_coef <- as.data.frame(Obese_ALT_Cer_db_reg_sm$coefficients)
Obese_ALT_Cer_db_reg_coef$LipidGroup <- "Cer"
Obese_ALT_Cer_db_reg_coef$MetaReg <- "db"
Obese_ALT_Cer_db_reg_coef <- Obese_ALT_Cer_db_reg_coef[-c(1),]
Obese_ALT_Cer_db_reg_coef$r_sq <- Obese_ALT_Cer_db_reg_sm$adj.r.squared

Obese_ALT_PG_db_reg <- lm(beta ~ db, data=subset(obese_data_ALT_lm_sum2, LipidGroup=="PG"))
Obese_ALT_PG_db_reg_sm <- summary(Obese_ALT_PG_db_reg)
Obese_ALT_PG_db_reg_coef <- as.data.frame(Obese_ALT_PG_db_reg_sm$coefficients)
Obese_ALT_PG_db_reg_coef$LipidGroup <- "PG"
Obese_ALT_PG_db_reg_coef$MetaReg <- "db"
Obese_ALT_PG_db_reg_coef <- Obese_ALT_PG_db_reg_coef[-c(1),]
Obese_ALT_PG_db_reg_coef$r_sq <- Obese_ALT_PG_db_reg_sm$adj.r.squared

Obese_ALT_Gang_db_reg <- lm(beta ~ db, data=subset(obese_data_ALT_lm_sum2, LipidGroup=="Ganglioside"))
Obese_ALT_Gang_db_reg_sm <- summary(Obese_ALT_Gang_db_reg)
Obese_ALT_Gang_db_reg_coef <- as.data.frame(Obese_ALT_Gang_db_reg_sm$coefficients)
Obese_ALT_Gang_db_reg_coef$LipidGroup <- "Gang"
Obese_ALT_Gang_db_reg_coef$MetaReg <- "db"
Obese_ALT_Gang_db_reg_coef <- Obese_ALT_Gang_db_reg_coef[-c(1),]
Obese_ALT_Gang_db_reg_coef$r_sq <- Obese_ALT_Gang_db_reg_sm$adj.r.squared

Obese_ALT_HexCer_db_reg <- lm(beta ~ db, data=subset(obese_data_ALT_lm_sum2, LipidGroup=="Hexosylceramide"))
Obese_ALT_HexCer_db_reg_sm <- summary(Obese_ALT_HexCer_db_reg)
Obese_ALT_HexCer_db_reg_coef <- as.data.frame(Obese_ALT_HexCer_db_reg_sm$coefficients)
Obese_ALT_HexCer_db_reg_coef$LipidGroup <- "HexCer"
Obese_ALT_HexCer_db_reg_coef$MetaReg <- "db"
Obese_ALT_HexCer_db_reg_coef <- Obese_ALT_HexCer_db_reg_coef[-c(1),]
Obese_ALT_HexCer_db_reg_coef$r_sq <- Obese_ALT_HexCer_db_reg_sm$adj.r.squared

Obese_ALT_LPE_db_reg <- lm(beta ~ db, data=subset(obese_data_ALT_lm_sum2, LipidGroup=="LysoPE"))
Obese_ALT_LPE_db_reg_sm <- summary(Obese_ALT_LPE_db_reg)
Obese_ALT_LPE_db_reg_coef <- as.data.frame(Obese_ALT_LPE_db_reg_sm$coefficients)
Obese_ALT_LPE_db_reg_coef$LipidGroup <- "LPE"
Obese_ALT_LPE_db_reg_coef$MetaReg <- "db"
Obese_ALT_LPE_db_reg_coef <- Obese_ALT_LPE_db_reg_coef[-c(1),]
Obese_ALT_LPE_db_reg_coef$r_sq <- Obese_ALT_LPE_db_reg_sm$adj.r.squared

Obese_ALT_LPI_db_reg <- lm(beta ~ db, data=subset(obese_data_ALT_lm_sum2, LipidGroup=="LysoPI"))
Obese_ALT_LPI_db_reg_sm <- summary(Obese_ALT_LPI_db_reg)
Obese_ALT_LPI_db_reg_coef <- as.data.frame(Obese_ALT_LPI_db_reg_sm$coefficients)
Obese_ALT_LPI_db_reg_coef$LipidGroup <- "LPI"
Obese_ALT_LPI_db_reg_coef$MetaReg <- "db"
Obese_ALT_LPI_db_reg_coef <- Obese_ALT_LPI_db_reg_coef[-c(1),]
Obese_ALT_LPI_db_reg_coef$r_sq <- Obese_ALT_LPI_db_reg_sm$adj.r.squared

Obese_ALT_Sphing_db_reg <- lm(beta ~ db, data=subset(obese_data_ALT_lm_sum2, LipidGroup=="Sphingolipid"))
Obese_ALT_Sphing_db_reg_sm <- summary(Obese_ALT_Sphing_db_reg)
Obese_ALT_Sphing_db_reg_coef <- as.data.frame(Obese_ALT_Sphing_db_reg_sm$coefficients)
Obese_ALT_Sphing_db_reg_coef$LipidGroup <- "Sphing"
Obese_ALT_Sphing_db_reg_coef$MetaReg <- "db"
Obese_ALT_Sphing_db_reg_coef <- Obese_ALT_Sphing_db_reg_coef[-c(1),]
Obese_ALT_Sphing_db_reg_coef$r_sq <- Obese_ALT_Sphing_db_reg_sm$adj.r.squared

Obese_ALT_db_metareg <- rbind(Obese_ALT_PC_db_reg_coef, Obese_ALT_LPC_db_reg_coef)
Obese_ALT_db_metareg <- rbind(Obese_ALT_db_metareg, Obese_ALT_DG_db_reg_coef)
Obese_ALT_db_metareg <- rbind(Obese_ALT_db_metareg, Obese_ALT_TG_db_reg_coef)
Obese_ALT_db_metareg <- rbind(Obese_ALT_db_metareg, Obese_ALT_SM_db_reg_coef)
Obese_ALT_db_metareg <- rbind(Obese_ALT_db_metareg, Obese_ALT_PE_db_reg_coef)
Obese_ALT_db_metareg <- rbind(Obese_ALT_db_metareg, Obese_ALT_PS_db_reg_coef)
Obese_ALT_db_metareg <- rbind(Obese_ALT_db_metareg, Obese_ALT_PI_db_reg_coef)
Obese_ALT_db_metareg <- rbind(Obese_ALT_db_metareg, Obese_ALT_Cer_db_reg_coef)
Obese_ALT_db_metareg <- rbind(Obese_ALT_db_metareg, Obese_ALT_PG_db_reg_coef)
Obese_ALT_db_metareg <- rbind(Obese_ALT_db_metareg, Obese_ALT_Gang_db_reg_coef)
Obese_ALT_db_metareg <- rbind(Obese_ALT_db_metareg, Obese_ALT_HexCer_db_reg_coef)
Obese_ALT_db_metareg <- rbind(Obese_ALT_db_metareg, Obese_ALT_LPE_db_reg_coef)
Obese_ALT_db_metareg <- rbind(Obese_ALT_db_metareg, Obese_ALT_LPI_db_reg_coef)
Obese_ALT_db_metareg <- rbind(Obese_ALT_db_metareg, Obese_ALT_Sphing_db_reg_coef)

## run for carbons


Obese_ALT_PC_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_ALT_lm_sum2, LipidGroup=="PC"))
Obese_ALT_PC_Carb_reg_sm <- summary(Obese_ALT_PC_Carb_reg)
Obese_ALT_PC_Carb_reg_coef <- as.data.frame(Obese_ALT_PC_Carb_reg_sm$coefficients)
Obese_ALT_PC_Carb_reg_coef$LipidGroup <- "PC"
Obese_ALT_PC_Carb_reg_coef$MetaReg <- "Carb"
Obese_ALT_PC_Carb_reg_coef <- Obese_ALT_PC_Carb_reg_coef[-c(1),]
Obese_ALT_PC_Carb_reg_coef$r_sq <- Obese_ALT_PC_Carb_reg_sm$adj.r.squared

Obese_ALT_LPC_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_ALT_lm_sum2, LipidGroup=="LysoPC"))
Obese_ALT_LPC_Carb_reg_sm <- summary(Obese_ALT_LPC_Carb_reg)
Obese_ALT_LPC_Carb_reg_coef <- as.data.frame(Obese_ALT_LPC_Carb_reg_sm$coefficients)
Obese_ALT_LPC_Carb_reg_coef$LipidGroup <- "LPC"
Obese_ALT_LPC_Carb_reg_coef$MetaReg <- "Carb"
Obese_ALT_LPC_Carb_reg_coef <- Obese_ALT_LPC_Carb_reg_coef[-c(1),]
Obese_ALT_LPC_Carb_reg_coef$r_sq <- Obese_ALT_LPC_Carb_reg_sm$adj.r.squared

Obese_ALT_DG_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_ALT_lm_sum2, LipidGroup=="Diglyceride"))
Obese_ALT_DG_Carb_reg_sm <- summary(Obese_ALT_DG_Carb_reg)
Obese_ALT_DG_Carb_reg_coef <- as.data.frame(Obese_ALT_DG_Carb_reg_sm$coefficients)
Obese_ALT_DG_Carb_reg_coef$LipidGroup <- "DG"
Obese_ALT_DG_Carb_reg_coef$MetaReg <- "Carb"
Obese_ALT_DG_Carb_reg_coef <- Obese_ALT_DG_Carb_reg_coef[-c(1),]
Obese_ALT_DG_Carb_reg_coef$r_sq <- Obese_ALT_DG_Carb_reg_sm$adj.r.squared

Obese_ALT_TG_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_ALT_lm_sum2, LipidGroup=="Triglyceride"))
Obese_ALT_TG_Carb_reg_sm <- summary(Obese_ALT_TG_Carb_reg)
Obese_ALT_TG_Carb_reg_coef <- as.data.frame(Obese_ALT_TG_Carb_reg_sm$coefficients)
Obese_ALT_TG_Carb_reg_coef$LipidGroup <- "TG"
Obese_ALT_TG_Carb_reg_coef$MetaReg <- "Carb"
Obese_ALT_TG_Carb_reg_coef <- Obese_ALT_TG_Carb_reg_coef[-c(1),]
Obese_ALT_TG_Carb_reg_coef$r_sq <- Obese_ALT_TG_Carb_reg_sm$adj.r.squared

Obese_ALT_SM_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_ALT_lm_sum2, LipidGroup=="Sphingomyelin"))
Obese_ALT_SM_Carb_reg_sm <- summary(Obese_ALT_SM_Carb_reg)
Obese_ALT_SM_Carb_reg_coef <- as.data.frame(Obese_ALT_SM_Carb_reg_sm$coefficients)
Obese_ALT_SM_Carb_reg_coef$LipidGroup <- "SM"
Obese_ALT_SM_Carb_reg_coef$MetaReg <- "Carb"
Obese_ALT_SM_Carb_reg_coef <- Obese_ALT_SM_Carb_reg_coef[-c(1),]
Obese_ALT_SM_Carb_reg_coef$r_sq <- Obese_ALT_SM_Carb_reg_sm$adj.r.squared

Obese_ALT_PE_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_ALT_lm_sum2, LipidGroup=="PE"))
Obese_ALT_PE_Carb_reg_sm <- summary(Obese_ALT_PE_Carb_reg)
Obese_ALT_PE_Carb_reg_coef <- as.data.frame(Obese_ALT_PE_Carb_reg_sm$coefficients)
Obese_ALT_PE_Carb_reg_coef$LipidGroup <- "PE"
Obese_ALT_PE_Carb_reg_coef$MetaReg <- "Carb"
Obese_ALT_PE_Carb_reg_coef <- Obese_ALT_PE_Carb_reg_coef[-c(1),]
Obese_ALT_PE_Carb_reg_coef$r_sq <- Obese_ALT_PE_Carb_reg_sm$adj.r.squared

Obese_ALT_PS_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_ALT_lm_sum2, LipidGroup=="PS"))
Obese_ALT_PS_Carb_reg_sm <- summary(Obese_ALT_PS_Carb_reg)
Obese_ALT_PS_Carb_reg_coef <- as.data.frame(Obese_ALT_PS_Carb_reg_sm$coefficients)
Obese_ALT_PS_Carb_reg_coef$LipidGroup <- "PS"
Obese_ALT_PS_Carb_reg_coef$MetaReg <- "Carb"
Obese_ALT_PS_Carb_reg_coef <- Obese_ALT_PS_Carb_reg_coef[-c(1),]
Obese_ALT_PS_Carb_reg_coef$r_sq <- Obese_ALT_PS_Carb_reg_sm$adj.r.squared

Obese_ALT_PI_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_ALT_lm_sum2, LipidGroup=="PI"))
Obese_ALT_PI_Carb_reg_sm <- summary(Obese_ALT_PI_Carb_reg)
Obese_ALT_PI_Carb_reg_coef <- as.data.frame(Obese_ALT_PI_Carb_reg_sm$coefficients)
Obese_ALT_PI_Carb_reg_coef$LipidGroup <- "PI"
Obese_ALT_PI_Carb_reg_coef$MetaReg <- "Carb"
Obese_ALT_PI_Carb_reg_coef <- Obese_ALT_PI_Carb_reg_coef[-c(1),]
Obese_ALT_PI_Carb_reg_coef$r_sq <- Obese_ALT_PI_Carb_reg_sm$adj.r.squared

Obese_ALT_Cer_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_ALT_lm_sum2, LipidGroup=="Ceramide"))
Obese_ALT_Cer_Carb_reg_sm <- summary(Obese_ALT_Cer_Carb_reg)
Obese_ALT_Cer_Carb_reg_coef <- as.data.frame(Obese_ALT_Cer_Carb_reg_sm$coefficients)
Obese_ALT_Cer_Carb_reg_coef$LipidGroup <- "Cer"
Obese_ALT_Cer_Carb_reg_coef$MetaReg <- "Carb"
Obese_ALT_Cer_Carb_reg_coef <- Obese_ALT_Cer_Carb_reg_coef[-c(1),]
Obese_ALT_Cer_Carb_reg_coef$r_sq <- Obese_ALT_Cer_Carb_reg_sm$adj.r.squared

Obese_ALT_PG_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_ALT_lm_sum2, LipidGroup=="PG"))
Obese_ALT_PG_Carb_reg_sm <- summary(Obese_ALT_PG_Carb_reg)
Obese_ALT_PG_Carb_reg_coef <- as.data.frame(Obese_ALT_PG_Carb_reg_sm$coefficients)
Obese_ALT_PG_Carb_reg_coef$LipidGroup <- "PG"
Obese_ALT_PG_Carb_reg_coef$MetaReg <- "Carb"
Obese_ALT_PG_Carb_reg_coef <- Obese_ALT_PG_Carb_reg_coef[-c(1),]
Obese_ALT_PG_Carb_reg_coef$r_sq <- Obese_ALT_PG_Carb_reg_sm$adj.r.squared

Obese_ALT_Gang_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_ALT_lm_sum2, LipidGroup=="Ganglioside"))
Obese_ALT_Gang_Carb_reg_sm <- summary(Obese_ALT_Gang_Carb_reg)
Obese_ALT_Gang_Carb_reg_coef <- as.data.frame(Obese_ALT_Gang_Carb_reg_sm$coefficients)
Obese_ALT_Gang_Carb_reg_coef$LipidGroup <- "Gang"
Obese_ALT_Gang_Carb_reg_coef$MetaReg <- "Carb"
Obese_ALT_Gang_Carb_reg_coef <- Obese_ALT_Gang_Carb_reg_coef[-c(1),]
Obese_ALT_Gang_Carb_reg_coef$r_sq <- Obese_ALT_Gang_Carb_reg_sm$adj.r.squared

Obese_ALT_HexCer_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_ALT_lm_sum2, LipidGroup=="Hexosylceramide"))
Obese_ALT_HexCer_Carb_reg_sm <- summary(Obese_ALT_HexCer_Carb_reg)
Obese_ALT_HexCer_Carb_reg_coef <- as.data.frame(Obese_ALT_HexCer_Carb_reg_sm$coefficients)
Obese_ALT_HexCer_Carb_reg_coef$LipidGroup <- "HexCer"
Obese_ALT_HexCer_Carb_reg_coef$MetaReg <- "Carb"
Obese_ALT_HexCer_Carb_reg_coef <- Obese_ALT_HexCer_Carb_reg_coef[-c(1),]
Obese_ALT_HexCer_Carb_reg_coef$r_sq <- Obese_ALT_HexCer_Carb_reg_sm$adj.r.squared

Obese_ALT_LPE_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_ALT_lm_sum2, LipidGroup=="LysoPE"))
Obese_ALT_LPE_Carb_reg_sm <- summary(Obese_ALT_LPE_Carb_reg)
Obese_ALT_LPE_Carb_reg_coef <- as.data.frame(Obese_ALT_LPE_Carb_reg_sm$coefficients)
Obese_ALT_LPE_Carb_reg_coef$LipidGroup <- "LPE"
Obese_ALT_LPE_Carb_reg_coef$MetaReg <- "Carb"
Obese_ALT_LPE_Carb_reg_coef <- Obese_ALT_LPE_Carb_reg_coef[-c(1),]
Obese_ALT_LPE_Carb_reg_coef$r_sq <- Obese_ALT_LPE_Carb_reg_sm$adj.r.squared

Obese_ALT_LPI_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_ALT_lm_sum2, LipidGroup=="LysoPI"))
Obese_ALT_LPI_Carb_reg_sm <- summary(Obese_ALT_LPI_Carb_reg)
Obese_ALT_LPI_Carb_reg_coef <- as.data.frame(Obese_ALT_LPI_Carb_reg_sm$coefficients)
Obese_ALT_LPI_Carb_reg_coef$LipidGroup <- "LPI"
Obese_ALT_LPI_Carb_reg_coef$MetaReg <- "Carb"
Obese_ALT_LPI_Carb_reg_coef <- Obese_ALT_LPI_Carb_reg_coef[-c(1),]
Obese_ALT_LPI_Carb_reg_coef$r_sq <- Obese_ALT_LPI_Carb_reg_sm$adj.r.squared

Obese_ALT_Sphing_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_ALT_lm_sum2, LipidGroup=="Sphingolipid"))
Obese_ALT_Sphing_Carb_reg_sm <- summary(Obese_ALT_Sphing_Carb_reg)
Obese_ALT_Sphing_Carb_reg_coef <- as.data.frame(Obese_ALT_Sphing_Carb_reg_sm$coefficients)
Obese_ALT_Sphing_Carb_reg_coef$LipidGroup <- "Sphing"
Obese_ALT_Sphing_Carb_reg_coef$MetaReg <- "Carb"
Obese_ALT_Sphing_Carb_reg_coef <- Obese_ALT_Sphing_Carb_reg_coef[-c(1),]
Obese_ALT_Sphing_Carb_reg_coef$r_sq <- Obese_ALT_Sphing_Carb_reg_sm$adj.r.squared


Obese_ALT_Carb_metareg <- rbind(Obese_ALT_PC_Carb_reg_coef, Obese_ALT_LPC_Carb_reg_coef)
Obese_ALT_Carb_metareg <- rbind(Obese_ALT_Carb_metareg, Obese_ALT_DG_Carb_reg_coef)
Obese_ALT_Carb_metareg <- rbind(Obese_ALT_Carb_metareg, Obese_ALT_TG_Carb_reg_coef)
Obese_ALT_Carb_metareg <- rbind(Obese_ALT_Carb_metareg, Obese_ALT_SM_Carb_reg_coef)
Obese_ALT_Carb_metareg <- rbind(Obese_ALT_Carb_metareg, Obese_ALT_PE_Carb_reg_coef)
Obese_ALT_Carb_metareg <- rbind(Obese_ALT_Carb_metareg, Obese_ALT_PS_Carb_reg_coef)
Obese_ALT_Carb_metareg <- rbind(Obese_ALT_Carb_metareg, Obese_ALT_PI_Carb_reg_coef)
Obese_ALT_Carb_metareg <- rbind(Obese_ALT_Carb_metareg, Obese_ALT_Cer_Carb_reg_coef)
Obese_ALT_Carb_metareg <- rbind(Obese_ALT_Carb_metareg, Obese_ALT_PG_Carb_reg_coef)
Obese_ALT_Carb_metareg <- rbind(Obese_ALT_Carb_metareg, Obese_ALT_Gang_Carb_reg_coef)
Obese_ALT_Carb_metareg <- rbind(Obese_ALT_Carb_metareg, Obese_ALT_HexCer_Carb_reg_coef)
Obese_ALT_Carb_metareg <- rbind(Obese_ALT_Carb_metareg, Obese_ALT_LPE_Carb_reg_coef)
Obese_ALT_Carb_metareg <- rbind(Obese_ALT_Carb_metareg, Obese_ALT_LPI_Carb_reg_coef)
Obese_ALT_Carb_metareg <- rbind(Obese_ALT_Carb_metareg, Obese_ALT_Sphing_Carb_reg_coef)

Obese_ALT_metareg_summary <- rbind(Obese_ALT_Carb_metareg, Obese_ALT_db_metareg)
names(Obese_ALT_metareg_summary)[names(Obese_ALT_metareg_summary) == 'Pr(>|t|)'] <- 'pval'
Obese_ALT_metareg_summary$qval <- p.adjust(Obese_ALT_metareg_summary$pval, method = "hochberg")
write.table(Obese_ALT_metareg_summary,file="Obese_ALT_metareg_summary.csv",sep=",")



#### make meta-regression plots of specific beta vs db/carbon

Obese_ALT_TG_db <- ggplot(subset(obese_data_ALT_lm_sum2, LipidGroup %in% c("Triglyceride")), aes(x=db, y=beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in TG") + ylab("Beta-regression coefficient") + theme_classic() + theme(legend.position="right", legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) 
Obese_ALT_TG_db

## + scale_x_continuous(breaks=seq(0,6,1), limits = c(0,6), expand = c(.05,0))
## + scale_y_continuous(breaks=seq(-.75,0.5,0.25), limits = c(-.75,0.5), expand = c(0,0))
## + annotate(geom = "text", x = 5, y = -.25, label = "italic(AdjR) ^ 2 == 0.06", parse = TRUE, size = 4)
## + annotate(geom = "text", x = 5, y = -.2, label = "P[slope] = 0.025", parse = FALSE, size = 4)

Obese_ALT_SM_db <- ggplot(subset(obese_data_ALT_lm_sum2, LipidGroup %in% c("Sphingomyelin")), aes(x=db, y=beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in SM") + ylab("Beta-regression coefficient") + theme_classic() + theme(legend.position="right", legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) 
Obese_ALT_SM_db

Obese_ALT_PC_db <- ggplot(subset(obese_data_ALT_lm_sum2, LipidGroup %in% c("PC")), aes(x=db, y=beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in PC") + ylab("Beta-regression coefficient") + theme_classic() + theme(legend.position="right", legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) 
Obese_ALT_PC_db

Obese_ALT_PC_Carb <- ggplot(subset(obese_data_ALT_lm_sum2, LipidGroup %in% c("PC")), aes(x=Carb, y=beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in PC") + ylab("Beta-regression coefficient") + theme_classic() + theme(legend.position="right", legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) 
Obese_ALT_PC_Carb

Obese_ALT_top <- plot_grid(Obese_ALT_TG_db, Obese_ALT_SM_db, ncol = 2, labels = c('A','B'), label_fontfamily = 'serif', label_fontface = 'bold', label_size = 22, align = 'w')
Obese_ALT_bottom <- plot_grid(Obese_ALT_PC_db, Obese_ALT_PC_Carb, ncol = 2, labels = c('C','D'), label_fontfamily = 'serif', label_fontface = 'bold', label_size = 22, align = 'w', rel_widths = c(1.5, 1.5))

pdf(file="Obese_ALT_metareg_sumfig_v1.pdf",width=16,height=12)
plot_grid(Obese_ALT_top, Obese_ALT_bottom, ncol = 1, rel_heights = c(1.0, 1.0))
dev.off()


##########

## Regress HOMA with lipids in obese cohort
obese_data_HOMA_lm_full <- lapply(obese_data[54:281], function(x) summary(lm(x ~ obese_data$log_HOMA + obese_data$Sex + obese_data$Age)))
obese_data_HOMA_lm <- lapply(obese_data_HOMA_lm_full, coef)
obese_data_HOMA_lm <- data.frame(obese_data_HOMA_lm)
obese_data_HOMA_lm <- t(obese_data_HOMA_lm)
obese_data_HOMA_lm = subset(obese_data_HOMA_lm, select = -c(1,3,4) )
obese_data_HOMA_lm <- data.frame(obese_data_HOMA_lm)
obese_data_HOMA_lm$annot <- rep(annotation$annotation, each=1, length.out=nrow(obese_data_HOMA_lm))
obese_data_HOMA_lm <- obese_data_HOMA_lm[order(obese_data_HOMA_lm$annot),]
obese_data_HOMA_lm_beta <- obese_data_HOMA_lm[1:((nrow(obese_data_HOMA_lm)/4)),]
obese_data_HOMA_lm_p <- obese_data_HOMA_lm[((nrow(obese_data_HOMA_lm)/4)+1):((nrow(obese_data_HOMA_lm)/4)*2),]
obese_data_HOMA_lm_SE <- obese_data_HOMA_lm[(((nrow(obese_data_HOMA_lm)/4)*2)+1):((nrow(obese_data_HOMA_lm)/4)*3),]
obese_data_HOMA_lm_t <- obese_data_HOMA_lm[(((nrow(obese_data_HOMA_lm)/4)*3)+1):(nrow(obese_data_HOMA_lm)),]

obese_data_HOMA_lm_beta$beta <- obese_data_HOMA_lm_beta$obese_data.log_HOMA
obese_data_HOMA_lm_beta = subset(obese_data_HOMA_lm_beta, select = -c(1,2))
obese_data_HOMA_lm_SE$SE <- obese_data_HOMA_lm_SE$obese_data.log_HOMA
obese_data_HOMA_lm_SE = subset(obese_data_HOMA_lm_SE, select = -c(1,2))
obese_data_HOMA_lm_p$p <- obese_data_HOMA_lm_p$obese_data.log_HOMA
obese_data_HOMA_lm_p = subset(obese_data_HOMA_lm_p, select = -c(1,2))
obese_data_HOMA_lm_t$t <- obese_data_HOMA_lm_t$obese_data.log_HOMA
obese_data_HOMA_lm_t = subset(obese_data_HOMA_lm_t, select = -c(1,2))

obese_data_HOMA_lm_beta$name <- row.names(obese_data_HOMA_lm_beta)
obese_data_HOMA_lm_beta$name2 = substr(obese_data_HOMA_lm_beta$name,1,nchar(obese_data_HOMA_lm_beta$name)-9)
obese_data_HOMA_lm_p$name <- row.names(obese_data_HOMA_lm_p)
obese_data_HOMA_lm_p$name2 = substr(obese_data_HOMA_lm_p$name,1,nchar(obese_data_HOMA_lm_p$name)-9)
obese_data_HOMA_lm_SE$name <- row.names(obese_data_HOMA_lm_SE)
obese_data_HOMA_lm_SE$name2 = substr(obese_data_HOMA_lm_SE$name,1,nchar(obese_data_HOMA_lm_SE$name)-11)
obese_data_HOMA_lm_t$name <- row.names(obese_data_HOMA_lm_t)
obese_data_HOMA_lm_t$name2 = substr(obese_data_HOMA_lm_t$name,1,nchar(obese_data_HOMA_lm_t$name)-8)

obese_data_HOMA_lm_sum <- merge(obese_data_HOMA_lm_beta, obese_data_HOMA_lm_SE, by="name2")
obese_data_HOMA_lm_sum <- merge(obese_data_HOMA_lm_sum, obese_data_HOMA_lm_p, by="name2")
obese_data_HOMA_lm_sum <- merge(obese_data_HOMA_lm_sum, obese_data_HOMA_lm_t, by="name2")

obese_data_HOMA_lm_sum = subset(obese_data_HOMA_lm_sum, select = c("name2","beta","SE","t","p"))
names(obese_data_HOMA_lm_sum)[names(obese_data_HOMA_lm_sum) == 'name2'] <- 'var'
obese_data_HOMA_lm_sum2 <- merge(Lipids_annotation, obese_data_HOMA_lm_sum, by="var")
obese_data_HOMA_lm_sum2$num <- nrow(obese_data)
obese_data_HOMA_lm_sum2$sig <- NA
obese_data_HOMA_lm_sum2 <- obese_data_HOMA_lm_sum2 %>% mutate(sig = ifelse(p < lipid_sig, "Significant", "Not significant"))

obese_data_HOMA_lm_sum2$qval <- p.adjust(obese_data_HOMA_lm_sum2$p, method = "hochberg")
obese_data_HOMA_lm_sum2$neglog_p <- -log10(obese_data_HOMA_lm_sum2$p)
write.table(obese_data_HOMA_lm_sum2,file="Obese_HOMA_lm_summary.csv",sep=",")

#####

## volcano plot

pdf(file="Obese_HOMA_lm_vol_v1.pdf",width=5,height=6)
Obese_HOMA_vol <- ggplot(data= obese_data_HOMA_lm_sum2, aes(x=beta, y=neglog_p, colour=LipidGroup)) + geom_point(alpha=0.4, size=1.75) + geom_text_repel(data = subset(obese_data_HOMA_lm_sum2, neglog_p > 2.3), aes(label = var), size = 3, key_glyph = "point") + xlab("Beta-regression coefficient") + ylab("-log10 p-value") + theme_bw() + theme(legend.position="right")  + theme(plot.title = element_text(face = "bold")) + theme(plot.title = element_text(hjust = 0.2)) + ggtitle("Plasma lipids associated with HOMA") + labs(color = "Lipid class")
Obese_HOMA_vol
dev.off()


############


## identify trends using meta-regression with beta vs carbons & db

Obese_HOMA_PC_db_reg <- lm(beta ~ db, data=subset(obese_data_HOMA_lm_sum2, LipidGroup=="PC"))
Obese_HOMA_PC_db_reg_sm <- summary(Obese_HOMA_PC_db_reg)
Obese_HOMA_PC_db_reg_coef <- as.data.frame(Obese_HOMA_PC_db_reg_sm$coefficients)
Obese_HOMA_PC_db_reg_coef$LipidGroup <- "PC"
Obese_HOMA_PC_db_reg_coef$MetaReg <- "db"
Obese_HOMA_PC_db_reg_coef <- Obese_HOMA_PC_db_reg_coef[-c(1),]
Obese_HOMA_PC_db_reg_coef$r_sq <- Obese_HOMA_PC_db_reg_sm$adj.r.squared

Obese_HOMA_LPC_db_reg <- lm(beta ~ db, data=subset(obese_data_HOMA_lm_sum2, LipidGroup=="LysoPC"))
Obese_HOMA_LPC_db_reg_sm <- summary(Obese_HOMA_LPC_db_reg)
Obese_HOMA_LPC_db_reg_coef <- as.data.frame(Obese_HOMA_LPC_db_reg_sm$coefficients)
Obese_HOMA_LPC_db_reg_coef$LipidGroup <- "LPC"
Obese_HOMA_LPC_db_reg_coef$MetaReg <- "db"
Obese_HOMA_LPC_db_reg_coef <- Obese_HOMA_LPC_db_reg_coef[-c(1),]
Obese_HOMA_LPC_db_reg_coef$r_sq <- Obese_HOMA_LPC_db_reg_sm$adj.r.squared

Obese_HOMA_DG_db_reg <- lm(beta ~ db, data=subset(obese_data_HOMA_lm_sum2, LipidGroup=="Diglyceride"))
Obese_HOMA_DG_db_reg_sm <- summary(Obese_HOMA_DG_db_reg)
Obese_HOMA_DG_db_reg_coef <- as.data.frame(Obese_HOMA_DG_db_reg_sm$coefficients)
Obese_HOMA_DG_db_reg_coef$LipidGroup <- "DG"
Obese_HOMA_DG_db_reg_coef$MetaReg <- "db"
Obese_HOMA_DG_db_reg_coef <- Obese_HOMA_DG_db_reg_coef[-c(1),]
Obese_HOMA_DG_db_reg_coef$r_sq <- Obese_HOMA_DG_db_reg_sm$adj.r.squared

Obese_HOMA_TG_db_reg <- lm(beta ~ db, data=subset(obese_data_HOMA_lm_sum2, LipidGroup=="Triglyceride"))
Obese_HOMA_TG_db_reg_sm <- summary(Obese_HOMA_TG_db_reg)
Obese_HOMA_TG_db_reg_coef <- as.data.frame(Obese_HOMA_TG_db_reg_sm$coefficients)
Obese_HOMA_TG_db_reg_coef$LipidGroup <- "TG"
Obese_HOMA_TG_db_reg_coef$MetaReg <- "db"
Obese_HOMA_TG_db_reg_coef <- Obese_HOMA_TG_db_reg_coef[-c(1),]
Obese_HOMA_TG_db_reg_coef$r_sq <- Obese_HOMA_TG_db_reg_sm$adj.r.squared

Obese_HOMA_SM_db_reg <- lm(beta ~ db, data=subset(obese_data_HOMA_lm_sum2, LipidGroup=="Sphingomyelin"))
Obese_HOMA_SM_db_reg_sm <- summary(Obese_HOMA_SM_db_reg)
Obese_HOMA_SM_db_reg_coef <- as.data.frame(Obese_HOMA_SM_db_reg_sm$coefficients)
Obese_HOMA_SM_db_reg_coef$LipidGroup <- "SM"
Obese_HOMA_SM_db_reg_coef$MetaReg <- "db"
Obese_HOMA_SM_db_reg_coef <- Obese_HOMA_SM_db_reg_coef[-c(1),]
Obese_HOMA_SM_db_reg_coef$r_sq <- Obese_HOMA_SM_db_reg_sm$adj.r.squared

Obese_HOMA_PE_db_reg <- lm(beta ~ db, data=subset(obese_data_HOMA_lm_sum2, LipidGroup=="PE"))
Obese_HOMA_PE_db_reg_sm <- summary(Obese_HOMA_PE_db_reg)
Obese_HOMA_PE_db_reg_coef <- as.data.frame(Obese_HOMA_PE_db_reg_sm$coefficients)
Obese_HOMA_PE_db_reg_coef$LipidGroup <- "PE"
Obese_HOMA_PE_db_reg_coef$MetaReg <- "db"
Obese_HOMA_PE_db_reg_coef <- Obese_HOMA_PE_db_reg_coef[-c(1),]
Obese_HOMA_PE_db_reg_coef$r_sq <- Obese_HOMA_PE_db_reg_sm$adj.r.squared

Obese_HOMA_PS_db_reg <- lm(beta ~ db, data=subset(obese_data_HOMA_lm_sum2, LipidGroup=="PS"))
Obese_HOMA_PS_db_reg_sm <- summary(Obese_HOMA_PS_db_reg)
Obese_HOMA_PS_db_reg_coef <- as.data.frame(Obese_HOMA_PS_db_reg_sm$coefficients)
Obese_HOMA_PS_db_reg_coef$LipidGroup <- "PS"
Obese_HOMA_PS_db_reg_coef$MetaReg <- "db"
Obese_HOMA_PS_db_reg_coef <- Obese_HOMA_PS_db_reg_coef[-c(1),]
Obese_HOMA_PS_db_reg_coef$r_sq <- Obese_HOMA_PS_db_reg_sm$adj.r.squared

Obese_HOMA_PI_db_reg <- lm(beta ~ db, data=subset(obese_data_HOMA_lm_sum2, LipidGroup=="PI"))
Obese_HOMA_PI_db_reg_sm <- summary(Obese_HOMA_PI_db_reg)
Obese_HOMA_PI_db_reg_coef <- as.data.frame(Obese_HOMA_PI_db_reg_sm$coefficients)
Obese_HOMA_PI_db_reg_coef$LipidGroup <- "PI"
Obese_HOMA_PI_db_reg_coef$MetaReg <- "db"
Obese_HOMA_PI_db_reg_coef <- Obese_HOMA_PI_db_reg_coef[-c(1),]
Obese_HOMA_PI_db_reg_coef$r_sq <- Obese_HOMA_PI_db_reg_sm$adj.r.squared

Obese_HOMA_Cer_db_reg <- lm(beta ~ db, data=subset(obese_data_HOMA_lm_sum2, LipidGroup=="Ceramide"))
Obese_HOMA_Cer_db_reg_sm <- summary(Obese_HOMA_Cer_db_reg)
Obese_HOMA_Cer_db_reg_coef <- as.data.frame(Obese_HOMA_Cer_db_reg_sm$coefficients)
Obese_HOMA_Cer_db_reg_coef$LipidGroup <- "Cer"
Obese_HOMA_Cer_db_reg_coef$MetaReg <- "db"
Obese_HOMA_Cer_db_reg_coef <- Obese_HOMA_Cer_db_reg_coef[-c(1),]
Obese_HOMA_Cer_db_reg_coef$r_sq <- Obese_HOMA_Cer_db_reg_sm$adj.r.squared

Obese_HOMA_PG_db_reg <- lm(beta ~ db, data=subset(obese_data_HOMA_lm_sum2, LipidGroup=="PG"))
Obese_HOMA_PG_db_reg_sm <- summary(Obese_HOMA_PG_db_reg)
Obese_HOMA_PG_db_reg_coef <- as.data.frame(Obese_HOMA_PG_db_reg_sm$coefficients)
Obese_HOMA_PG_db_reg_coef$LipidGroup <- "PG"
Obese_HOMA_PG_db_reg_coef$MetaReg <- "db"
Obese_HOMA_PG_db_reg_coef <- Obese_HOMA_PG_db_reg_coef[-c(1),]
Obese_HOMA_PG_db_reg_coef$r_sq <- Obese_HOMA_PG_db_reg_sm$adj.r.squared

Obese_HOMA_Gang_db_reg <- lm(beta ~ db, data=subset(obese_data_HOMA_lm_sum2, LipidGroup=="Ganglioside"))
Obese_HOMA_Gang_db_reg_sm <- summary(Obese_HOMA_Gang_db_reg)
Obese_HOMA_Gang_db_reg_coef <- as.data.frame(Obese_HOMA_Gang_db_reg_sm$coefficients)
Obese_HOMA_Gang_db_reg_coef$LipidGroup <- "Gang"
Obese_HOMA_Gang_db_reg_coef$MetaReg <- "db"
Obese_HOMA_Gang_db_reg_coef <- Obese_HOMA_Gang_db_reg_coef[-c(1),]
Obese_HOMA_Gang_db_reg_coef$r_sq <- Obese_HOMA_Gang_db_reg_sm$adj.r.squared

Obese_HOMA_HexCer_db_reg <- lm(beta ~ db, data=subset(obese_data_HOMA_lm_sum2, LipidGroup=="Hexosylceramide"))
Obese_HOMA_HexCer_db_reg_sm <- summary(Obese_HOMA_HexCer_db_reg)
Obese_HOMA_HexCer_db_reg_coef <- as.data.frame(Obese_HOMA_HexCer_db_reg_sm$coefficients)
Obese_HOMA_HexCer_db_reg_coef$LipidGroup <- "HexCer"
Obese_HOMA_HexCer_db_reg_coef$MetaReg <- "db"
Obese_HOMA_HexCer_db_reg_coef <- Obese_HOMA_HexCer_db_reg_coef[-c(1),]
Obese_HOMA_HexCer_db_reg_coef$r_sq <- Obese_HOMA_HexCer_db_reg_sm$adj.r.squared

Obese_HOMA_LPE_db_reg <- lm(beta ~ db, data=subset(obese_data_HOMA_lm_sum2, LipidGroup=="LysoPE"))
Obese_HOMA_LPE_db_reg_sm <- summary(Obese_HOMA_LPE_db_reg)
Obese_HOMA_LPE_db_reg_coef <- as.data.frame(Obese_HOMA_LPE_db_reg_sm$coefficients)
Obese_HOMA_LPE_db_reg_coef$LipidGroup <- "LPE"
Obese_HOMA_LPE_db_reg_coef$MetaReg <- "db"
Obese_HOMA_LPE_db_reg_coef <- Obese_HOMA_LPE_db_reg_coef[-c(1),]
Obese_HOMA_LPE_db_reg_coef$r_sq <- Obese_HOMA_LPE_db_reg_sm$adj.r.squared

Obese_HOMA_LPI_db_reg <- lm(beta ~ db, data=subset(obese_data_HOMA_lm_sum2, LipidGroup=="LysoPI"))
Obese_HOMA_LPI_db_reg_sm <- summary(Obese_HOMA_LPI_db_reg)
Obese_HOMA_LPI_db_reg_coef <- as.data.frame(Obese_HOMA_LPI_db_reg_sm$coefficients)
Obese_HOMA_LPI_db_reg_coef$LipidGroup <- "LPI"
Obese_HOMA_LPI_db_reg_coef$MetaReg <- "db"
Obese_HOMA_LPI_db_reg_coef <- Obese_HOMA_LPI_db_reg_coef[-c(1),]
Obese_HOMA_LPI_db_reg_coef$r_sq <- Obese_HOMA_LPI_db_reg_sm$adj.r.squared

Obese_HOMA_Sphing_db_reg <- lm(beta ~ db, data=subset(obese_data_HOMA_lm_sum2, LipidGroup=="Sphingolipid"))
Obese_HOMA_Sphing_db_reg_sm <- summary(Obese_HOMA_Sphing_db_reg)
Obese_HOMA_Sphing_db_reg_coef <- as.data.frame(Obese_HOMA_Sphing_db_reg_sm$coefficients)
Obese_HOMA_Sphing_db_reg_coef$LipidGroup <- "Sphing"
Obese_HOMA_Sphing_db_reg_coef$MetaReg <- "db"
Obese_HOMA_Sphing_db_reg_coef <- Obese_HOMA_Sphing_db_reg_coef[-c(1),]
Obese_HOMA_Sphing_db_reg_coef$r_sq <- Obese_HOMA_Sphing_db_reg_sm$adj.r.squared

Obese_HOMA_db_metareg <- rbind(Obese_HOMA_PC_db_reg_coef, Obese_HOMA_LPC_db_reg_coef)
Obese_HOMA_db_metareg <- rbind(Obese_HOMA_db_metareg, Obese_HOMA_DG_db_reg_coef)
Obese_HOMA_db_metareg <- rbind(Obese_HOMA_db_metareg, Obese_HOMA_TG_db_reg_coef)
Obese_HOMA_db_metareg <- rbind(Obese_HOMA_db_metareg, Obese_HOMA_SM_db_reg_coef)
Obese_HOMA_db_metareg <- rbind(Obese_HOMA_db_metareg, Obese_HOMA_PE_db_reg_coef)
Obese_HOMA_db_metareg <- rbind(Obese_HOMA_db_metareg, Obese_HOMA_PS_db_reg_coef)
Obese_HOMA_db_metareg <- rbind(Obese_HOMA_db_metareg, Obese_HOMA_PI_db_reg_coef)
Obese_HOMA_db_metareg <- rbind(Obese_HOMA_db_metareg, Obese_HOMA_Cer_db_reg_coef)
Obese_HOMA_db_metareg <- rbind(Obese_HOMA_db_metareg, Obese_HOMA_PG_db_reg_coef)
Obese_HOMA_db_metareg <- rbind(Obese_HOMA_db_metareg, Obese_HOMA_Gang_db_reg_coef)
Obese_HOMA_db_metareg <- rbind(Obese_HOMA_db_metareg, Obese_HOMA_HexCer_db_reg_coef)
Obese_HOMA_db_metareg <- rbind(Obese_HOMA_db_metareg, Obese_HOMA_LPE_db_reg_coef)
Obese_HOMA_db_metareg <- rbind(Obese_HOMA_db_metareg, Obese_HOMA_LPI_db_reg_coef)
Obese_HOMA_db_metareg <- rbind(Obese_HOMA_db_metareg, Obese_HOMA_Sphing_db_reg_coef)

## run for carbons


Obese_HOMA_PC_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_HOMA_lm_sum2, LipidGroup=="PC"))
Obese_HOMA_PC_Carb_reg_sm <- summary(Obese_HOMA_PC_Carb_reg)
Obese_HOMA_PC_Carb_reg_coef <- as.data.frame(Obese_HOMA_PC_Carb_reg_sm$coefficients)
Obese_HOMA_PC_Carb_reg_coef$LipidGroup <- "PC"
Obese_HOMA_PC_Carb_reg_coef$MetaReg <- "Carb"
Obese_HOMA_PC_Carb_reg_coef <- Obese_HOMA_PC_Carb_reg_coef[-c(1),]
Obese_HOMA_PC_Carb_reg_coef$r_sq <- Obese_HOMA_PC_Carb_reg_sm$adj.r.squared

Obese_HOMA_LPC_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_HOMA_lm_sum2, LipidGroup=="LysoPC"))
Obese_HOMA_LPC_Carb_reg_sm <- summary(Obese_HOMA_LPC_Carb_reg)
Obese_HOMA_LPC_Carb_reg_coef <- as.data.frame(Obese_HOMA_LPC_Carb_reg_sm$coefficients)
Obese_HOMA_LPC_Carb_reg_coef$LipidGroup <- "LPC"
Obese_HOMA_LPC_Carb_reg_coef$MetaReg <- "Carb"
Obese_HOMA_LPC_Carb_reg_coef <- Obese_HOMA_LPC_Carb_reg_coef[-c(1),]
Obese_HOMA_LPC_Carb_reg_coef$r_sq <- Obese_HOMA_LPC_Carb_reg_sm$adj.r.squared

Obese_HOMA_DG_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_HOMA_lm_sum2, LipidGroup=="Diglyceride"))
Obese_HOMA_DG_Carb_reg_sm <- summary(Obese_HOMA_DG_Carb_reg)
Obese_HOMA_DG_Carb_reg_coef <- as.data.frame(Obese_HOMA_DG_Carb_reg_sm$coefficients)
Obese_HOMA_DG_Carb_reg_coef$LipidGroup <- "DG"
Obese_HOMA_DG_Carb_reg_coef$MetaReg <- "Carb"
Obese_HOMA_DG_Carb_reg_coef <- Obese_HOMA_DG_Carb_reg_coef[-c(1),]
Obese_HOMA_DG_Carb_reg_coef$r_sq <- Obese_HOMA_DG_Carb_reg_sm$adj.r.squared

Obese_HOMA_TG_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_HOMA_lm_sum2, LipidGroup=="Triglyceride"))
Obese_HOMA_TG_Carb_reg_sm <- summary(Obese_HOMA_TG_Carb_reg)
Obese_HOMA_TG_Carb_reg_coef <- as.data.frame(Obese_HOMA_TG_Carb_reg_sm$coefficients)
Obese_HOMA_TG_Carb_reg_coef$LipidGroup <- "TG"
Obese_HOMA_TG_Carb_reg_coef$MetaReg <- "Carb"
Obese_HOMA_TG_Carb_reg_coef <- Obese_HOMA_TG_Carb_reg_coef[-c(1),]
Obese_HOMA_TG_Carb_reg_coef$r_sq <- Obese_HOMA_TG_Carb_reg_sm$adj.r.squared

Obese_HOMA_SM_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_HOMA_lm_sum2, LipidGroup=="Sphingomyelin"))
Obese_HOMA_SM_Carb_reg_sm <- summary(Obese_HOMA_SM_Carb_reg)
Obese_HOMA_SM_Carb_reg_coef <- as.data.frame(Obese_HOMA_SM_Carb_reg_sm$coefficients)
Obese_HOMA_SM_Carb_reg_coef$LipidGroup <- "SM"
Obese_HOMA_SM_Carb_reg_coef$MetaReg <- "Carb"
Obese_HOMA_SM_Carb_reg_coef <- Obese_HOMA_SM_Carb_reg_coef[-c(1),]
Obese_HOMA_SM_Carb_reg_coef$r_sq <- Obese_HOMA_SM_Carb_reg_sm$adj.r.squared

Obese_HOMA_PE_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_HOMA_lm_sum2, LipidGroup=="PE"))
Obese_HOMA_PE_Carb_reg_sm <- summary(Obese_HOMA_PE_Carb_reg)
Obese_HOMA_PE_Carb_reg_coef <- as.data.frame(Obese_HOMA_PE_Carb_reg_sm$coefficients)
Obese_HOMA_PE_Carb_reg_coef$LipidGroup <- "PE"
Obese_HOMA_PE_Carb_reg_coef$MetaReg <- "Carb"
Obese_HOMA_PE_Carb_reg_coef <- Obese_HOMA_PE_Carb_reg_coef[-c(1),]
Obese_HOMA_PE_Carb_reg_coef$r_sq <- Obese_HOMA_PE_Carb_reg_sm$adj.r.squared

Obese_HOMA_PS_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_HOMA_lm_sum2, LipidGroup=="PS"))
Obese_HOMA_PS_Carb_reg_sm <- summary(Obese_HOMA_PS_Carb_reg)
Obese_HOMA_PS_Carb_reg_coef <- as.data.frame(Obese_HOMA_PS_Carb_reg_sm$coefficients)
Obese_HOMA_PS_Carb_reg_coef$LipidGroup <- "PS"
Obese_HOMA_PS_Carb_reg_coef$MetaReg <- "Carb"
Obese_HOMA_PS_Carb_reg_coef <- Obese_HOMA_PS_Carb_reg_coef[-c(1),]
Obese_HOMA_PS_Carb_reg_coef$r_sq <- Obese_HOMA_PS_Carb_reg_sm$adj.r.squared

Obese_HOMA_PI_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_HOMA_lm_sum2, LipidGroup=="PI"))
Obese_HOMA_PI_Carb_reg_sm <- summary(Obese_HOMA_PI_Carb_reg)
Obese_HOMA_PI_Carb_reg_coef <- as.data.frame(Obese_HOMA_PI_Carb_reg_sm$coefficients)
Obese_HOMA_PI_Carb_reg_coef$LipidGroup <- "PI"
Obese_HOMA_PI_Carb_reg_coef$MetaReg <- "Carb"
Obese_HOMA_PI_Carb_reg_coef <- Obese_HOMA_PI_Carb_reg_coef[-c(1),]
Obese_HOMA_PI_Carb_reg_coef$r_sq <- Obese_HOMA_PI_Carb_reg_sm$adj.r.squared

Obese_HOMA_Cer_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_HOMA_lm_sum2, LipidGroup=="Ceramide"))
Obese_HOMA_Cer_Carb_reg_sm <- summary(Obese_HOMA_Cer_Carb_reg)
Obese_HOMA_Cer_Carb_reg_coef <- as.data.frame(Obese_HOMA_Cer_Carb_reg_sm$coefficients)
Obese_HOMA_Cer_Carb_reg_coef$LipidGroup <- "Cer"
Obese_HOMA_Cer_Carb_reg_coef$MetaReg <- "Carb"
Obese_HOMA_Cer_Carb_reg_coef <- Obese_HOMA_Cer_Carb_reg_coef[-c(1),]
Obese_HOMA_Cer_Carb_reg_coef$r_sq <- Obese_HOMA_Cer_Carb_reg_sm$adj.r.squared

Obese_HOMA_PG_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_HOMA_lm_sum2, LipidGroup=="PG"))
Obese_HOMA_PG_Carb_reg_sm <- summary(Obese_HOMA_PG_Carb_reg)
Obese_HOMA_PG_Carb_reg_coef <- as.data.frame(Obese_HOMA_PG_Carb_reg_sm$coefficients)
Obese_HOMA_PG_Carb_reg_coef$LipidGroup <- "PG"
Obese_HOMA_PG_Carb_reg_coef$MetaReg <- "Carb"
Obese_HOMA_PG_Carb_reg_coef <- Obese_HOMA_PG_Carb_reg_coef[-c(1),]
Obese_HOMA_PG_Carb_reg_coef$r_sq <- Obese_HOMA_PG_Carb_reg_sm$adj.r.squared

Obese_HOMA_Gang_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_HOMA_lm_sum2, LipidGroup=="Ganglioside"))
Obese_HOMA_Gang_Carb_reg_sm <- summary(Obese_HOMA_Gang_Carb_reg)
Obese_HOMA_Gang_Carb_reg_coef <- as.data.frame(Obese_HOMA_Gang_Carb_reg_sm$coefficients)
Obese_HOMA_Gang_Carb_reg_coef$LipidGroup <- "Gang"
Obese_HOMA_Gang_Carb_reg_coef$MetaReg <- "Carb"
Obese_HOMA_Gang_Carb_reg_coef <- Obese_HOMA_Gang_Carb_reg_coef[-c(1),]
Obese_HOMA_Gang_Carb_reg_coef$r_sq <- Obese_HOMA_Gang_Carb_reg_sm$adj.r.squared

Obese_HOMA_HexCer_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_HOMA_lm_sum2, LipidGroup=="Hexosylceramide"))
Obese_HOMA_HexCer_Carb_reg_sm <- summary(Obese_HOMA_HexCer_Carb_reg)
Obese_HOMA_HexCer_Carb_reg_coef <- as.data.frame(Obese_HOMA_HexCer_Carb_reg_sm$coefficients)
Obese_HOMA_HexCer_Carb_reg_coef$LipidGroup <- "HexCer"
Obese_HOMA_HexCer_Carb_reg_coef$MetaReg <- "Carb"
Obese_HOMA_HexCer_Carb_reg_coef <- Obese_HOMA_HexCer_Carb_reg_coef[-c(1),]
Obese_HOMA_HexCer_Carb_reg_coef$r_sq <- Obese_HOMA_HexCer_Carb_reg_sm$adj.r.squared

Obese_HOMA_LPE_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_HOMA_lm_sum2, LipidGroup=="LysoPE"))
Obese_HOMA_LPE_Carb_reg_sm <- summary(Obese_HOMA_LPE_Carb_reg)
Obese_HOMA_LPE_Carb_reg_coef <- as.data.frame(Obese_HOMA_LPE_Carb_reg_sm$coefficients)
Obese_HOMA_LPE_Carb_reg_coef$LipidGroup <- "LPE"
Obese_HOMA_LPE_Carb_reg_coef$MetaReg <- "Carb"
Obese_HOMA_LPE_Carb_reg_coef <- Obese_HOMA_LPE_Carb_reg_coef[-c(1),]
Obese_HOMA_LPE_Carb_reg_coef$r_sq <- Obese_HOMA_LPE_Carb_reg_sm$adj.r.squared

Obese_HOMA_LPI_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_HOMA_lm_sum2, LipidGroup=="LysoPI"))
Obese_HOMA_LPI_Carb_reg_sm <- summary(Obese_HOMA_LPI_Carb_reg)
Obese_HOMA_LPI_Carb_reg_coef <- as.data.frame(Obese_HOMA_LPI_Carb_reg_sm$coefficients)
Obese_HOMA_LPI_Carb_reg_coef$LipidGroup <- "LPI"
Obese_HOMA_LPI_Carb_reg_coef$MetaReg <- "Carb"
Obese_HOMA_LPI_Carb_reg_coef <- Obese_HOMA_LPI_Carb_reg_coef[-c(1),]
Obese_HOMA_LPI_Carb_reg_coef$r_sq <- Obese_HOMA_LPI_Carb_reg_sm$adj.r.squared

Obese_HOMA_Sphing_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_HOMA_lm_sum2, LipidGroup=="Sphingolipid"))
Obese_HOMA_Sphing_Carb_reg_sm <- summary(Obese_HOMA_Sphing_Carb_reg)
Obese_HOMA_Sphing_Carb_reg_coef <- as.data.frame(Obese_HOMA_Sphing_Carb_reg_sm$coefficients)
Obese_HOMA_Sphing_Carb_reg_coef$LipidGroup <- "Sphing"
Obese_HOMA_Sphing_Carb_reg_coef$MetaReg <- "Carb"
Obese_HOMA_Sphing_Carb_reg_coef <- Obese_HOMA_Sphing_Carb_reg_coef[-c(1),]
Obese_HOMA_Sphing_Carb_reg_coef$r_sq <- Obese_HOMA_Sphing_Carb_reg_sm$adj.r.squared


Obese_HOMA_Carb_metareg <- rbind(Obese_HOMA_PC_Carb_reg_coef, Obese_HOMA_LPC_Carb_reg_coef)
Obese_HOMA_Carb_metareg <- rbind(Obese_HOMA_Carb_metareg, Obese_HOMA_DG_Carb_reg_coef)
Obese_HOMA_Carb_metareg <- rbind(Obese_HOMA_Carb_metareg, Obese_HOMA_TG_Carb_reg_coef)
Obese_HOMA_Carb_metareg <- rbind(Obese_HOMA_Carb_metareg, Obese_HOMA_SM_Carb_reg_coef)
Obese_HOMA_Carb_metareg <- rbind(Obese_HOMA_Carb_metareg, Obese_HOMA_PE_Carb_reg_coef)
Obese_HOMA_Carb_metareg <- rbind(Obese_HOMA_Carb_metareg, Obese_HOMA_PS_Carb_reg_coef)
Obese_HOMA_Carb_metareg <- rbind(Obese_HOMA_Carb_metareg, Obese_HOMA_PI_Carb_reg_coef)
Obese_HOMA_Carb_metareg <- rbind(Obese_HOMA_Carb_metareg, Obese_HOMA_Cer_Carb_reg_coef)
Obese_HOMA_Carb_metareg <- rbind(Obese_HOMA_Carb_metareg, Obese_HOMA_PG_Carb_reg_coef)
Obese_HOMA_Carb_metareg <- rbind(Obese_HOMA_Carb_metareg, Obese_HOMA_Gang_Carb_reg_coef)
Obese_HOMA_Carb_metareg <- rbind(Obese_HOMA_Carb_metareg, Obese_HOMA_HexCer_Carb_reg_coef)
Obese_HOMA_Carb_metareg <- rbind(Obese_HOMA_Carb_metareg, Obese_HOMA_LPE_Carb_reg_coef)
Obese_HOMA_Carb_metareg <- rbind(Obese_HOMA_Carb_metareg, Obese_HOMA_LPI_Carb_reg_coef)
Obese_HOMA_Carb_metareg <- rbind(Obese_HOMA_Carb_metareg, Obese_HOMA_Sphing_Carb_reg_coef)

Obese_HOMA_metareg_summary <- rbind(Obese_HOMA_Carb_metareg, Obese_HOMA_db_metareg)
names(Obese_HOMA_metareg_summary)[names(Obese_HOMA_metareg_summary) == 'Pr(>|t|)'] <- 'pval'
Obese_HOMA_metareg_summary$qval <- p.adjust(Obese_HOMA_metareg_summary$pval, method = "hochberg")
write.table(Obese_HOMA_metareg_summary,file="Obese_HOMA_metareg_summary.csv",sep=",")


#### make meta-regression plots of specific beta vs db/carbon

Obese_HOMA_TG_db <- ggplot(subset(obese_data_HOMA_lm_sum2, LipidGroup %in% c("Triglyceride")), aes(x=db, y=beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in TG") + ylab("Beta-regression coefficient") + theme_classic() + theme(legend.position="right", legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) 
Obese_HOMA_TG_db

## + scale_x_continuous(breaks=seq(0,6,1), limits = c(0,6), expand = c(.05,0))
## + scale_y_continuous(breaks=seq(-.75,0.5,0.25), limits = c(-.75,0.5), expand = c(0,0))
## + annotate(geom = "text", x = 5, y = -.25, label = "italic(AdjR) ^ 2 == 0.06", parse = TRUE, size = 4)
## + annotate(geom = "text", x = 5, y = -.2, label = "P[slope] = 0.025", parse = FALSE, size = 4)

Obese_HOMA_SM_db <- ggplot(subset(obese_data_HOMA_lm_sum2, LipidGroup %in% c("Sphingomyelin")), aes(x=db, y=beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in SM") + ylab("Beta-regression coefficient") + theme_classic() + theme(legend.position="right", legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) 
Obese_HOMA_SM_db

Obese_HOMA_PC_db <- ggplot(subset(obese_data_HOMA_lm_sum2, LipidGroup %in% c("PC")), aes(x=db, y=beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in PC") + ylab("Beta-regression coefficient") + theme_classic() + theme(legend.position="right", legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) 
Obese_HOMA_PC_db

Obese_HOMA_PC_Carb <- ggplot(subset(obese_data_HOMA_lm_sum2, LipidGroup %in% c("PC")), aes(x=Carb, y=beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in PC") + ylab("Beta-regression coefficient") + theme_classic() + theme(legend.position="right", legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) 
Obese_HOMA_PC_Carb

Obese_HOMA_top <- plot_grid(Obese_HOMA_TG_db, Obese_HOMA_SM_db, ncol = 2, labels = c('A','B'), label_fontfamily = 'serif', label_fontface = 'bold', label_size = 22, align = 'w')
Obese_HOMA_bottom <- plot_grid(Obese_HOMA_PC_db, Obese_HOMA_PC_Carb, ncol = 2, labels = c('C','D'), label_fontfamily = 'serif', label_fontface = 'bold', label_size = 22, align = 'w', rel_widths = c(1.5, 1.5))

pdf(file="Obese_HOMA_metareg_sumfig_v1.pdf",width=16,height=12)
plot_grid(Obese_HOMA_top, Obese_HOMA_bottom, ncol = 1, rel_heights = c(1.0, 1.0))
dev.off()


##### repeat for other markers of steatosis (HFF, CAP, & TE)

## Regress HFF with lipids in obese cohort
obese_data_HFF_lm_full <- lapply(obese_data[54:281], function(x) summary(lm(x ~ obese_data$log_HFF + obese_data$Sex + obese_data$Age)))
obese_data_HFF_lm <- lapply(obese_data_HFF_lm_full, coef)
obese_data_HFF_lm <- data.frame(obese_data_HFF_lm)
obese_data_HFF_lm <- t(obese_data_HFF_lm)
obese_data_HFF_lm = subset(obese_data_HFF_lm, select = -c(1,3,4) )
obese_data_HFF_lm <- data.frame(obese_data_HFF_lm)
obese_data_HFF_lm$annot <- rep(annotation$annotation, each=1, length.out=nrow(obese_data_HFF_lm))
obese_data_HFF_lm <- obese_data_HFF_lm[order(obese_data_HFF_lm$annot),]
obese_data_HFF_lm_beta <- obese_data_HFF_lm[1:((nrow(obese_data_HFF_lm)/4)),]
obese_data_HFF_lm_p <- obese_data_HFF_lm[((nrow(obese_data_HFF_lm)/4)+1):((nrow(obese_data_HFF_lm)/4)*2),]
obese_data_HFF_lm_SE <- obese_data_HFF_lm[(((nrow(obese_data_HFF_lm)/4)*2)+1):((nrow(obese_data_HFF_lm)/4)*3),]
obese_data_HFF_lm_t <- obese_data_HFF_lm[(((nrow(obese_data_HFF_lm)/4)*3)+1):(nrow(obese_data_HFF_lm)),]

obese_data_HFF_lm_beta$beta <- obese_data_HFF_lm_beta$obese_data.log_HFF
obese_data_HFF_lm_beta = subset(obese_data_HFF_lm_beta, select = -c(1,2))
obese_data_HFF_lm_SE$SE <- obese_data_HFF_lm_SE$obese_data.log_HFF
obese_data_HFF_lm_SE = subset(obese_data_HFF_lm_SE, select = -c(1,2))
obese_data_HFF_lm_p$p <- obese_data_HFF_lm_p$obese_data.log_HFF
obese_data_HFF_lm_p = subset(obese_data_HFF_lm_p, select = -c(1,2))
obese_data_HFF_lm_t$t <- obese_data_HFF_lm_t$obese_data.log_HFF
obese_data_HFF_lm_t = subset(obese_data_HFF_lm_t, select = -c(1,2))

obese_data_HFF_lm_beta$name <- row.names(obese_data_HFF_lm_beta)
obese_data_HFF_lm_beta$name2 = substr(obese_data_HFF_lm_beta$name,1,nchar(obese_data_HFF_lm_beta$name)-9)
obese_data_HFF_lm_p$name <- row.names(obese_data_HFF_lm_p)
obese_data_HFF_lm_p$name2 = substr(obese_data_HFF_lm_p$name,1,nchar(obese_data_HFF_lm_p$name)-9)
obese_data_HFF_lm_SE$name <- row.names(obese_data_HFF_lm_SE)
obese_data_HFF_lm_SE$name2 = substr(obese_data_HFF_lm_SE$name,1,nchar(obese_data_HFF_lm_SE$name)-11)
obese_data_HFF_lm_t$name <- row.names(obese_data_HFF_lm_t)
obese_data_HFF_lm_t$name2 = substr(obese_data_HFF_lm_t$name,1,nchar(obese_data_HFF_lm_t$name)-8)

obese_data_HFF_lm_sum <- merge(obese_data_HFF_lm_beta, obese_data_HFF_lm_SE, by="name2")
obese_data_HFF_lm_sum <- merge(obese_data_HFF_lm_sum, obese_data_HFF_lm_p, by="name2")
obese_data_HFF_lm_sum <- merge(obese_data_HFF_lm_sum, obese_data_HFF_lm_t, by="name2")

obese_data_HFF_lm_sum = subset(obese_data_HFF_lm_sum, select = c("name2","beta","SE","t","p"))
names(obese_data_HFF_lm_sum)[names(obese_data_HFF_lm_sum) == 'name2'] <- 'var'
obese_data_HFF_lm_sum2 <- merge(Lipids_annotation, obese_data_HFF_lm_sum, by="var")
obese_data_HFF_lm_sum2$num <- nrow(obese_data)
obese_data_HFF_lm_sum2$sig <- NA
obese_data_HFF_lm_sum2 <- obese_data_HFF_lm_sum2 %>% mutate(sig = ifelse(p < lipid_sig, "Significant", "Not significant"))

obese_data_HFF_lm_sum2$qval <- p.adjust(obese_data_HFF_lm_sum2$p, method = "hochberg")
obese_data_HFF_lm_sum2$neglog_p <- -log10(obese_data_HFF_lm_sum2$p)
write.table(obese_data_HFF_lm_sum2,file="Obese_HFF_lm_summary.csv",sep=",")

#####

## volcano plot

pdf(file="Obese_HFF_lm_vol_v1.pdf",width=5,height=6)
Obese_HFF_vol <- ggplot(data= obese_data_HFF_lm_sum2, aes(x=beta, y=neglog_p, colour=LipidGroup)) + geom_point(alpha=0.4, size=1.75) + geom_text_repel(data = subset(obese_data_HFF_lm_sum2, neglog_p > 2.3), aes(label = var), size = 3, key_glyph = "point") + xlab("Beta-regression coefficient") + ylab("-log10 p-value") + theme_bw() + theme(legend.position="right")  + theme(plot.title = element_text(face = "bold")) + theme(plot.title = element_text(hjust = 0.2)) + ggtitle("Plasma lipids associated with HFF") + labs(color = "Lipid class")
Obese_HFF_vol
dev.off()


############


## identify trends using meta-regression with beta vs carbons & db

Obese_HFF_PC_db_reg <- lm(beta ~ db, data=subset(obese_data_HFF_lm_sum2, LipidGroup=="PC"))
Obese_HFF_PC_db_reg_sm <- summary(Obese_HFF_PC_db_reg)
Obese_HFF_PC_db_reg_coef <- as.data.frame(Obese_HFF_PC_db_reg_sm$coefficients)
Obese_HFF_PC_db_reg_coef$LipidGroup <- "PC"
Obese_HFF_PC_db_reg_coef$MetaReg <- "db"
Obese_HFF_PC_db_reg_coef <- Obese_HFF_PC_db_reg_coef[-c(1),]
Obese_HFF_PC_db_reg_coef$r_sq <- Obese_HFF_PC_db_reg_sm$adj.r.squared

Obese_HFF_LPC_db_reg <- lm(beta ~ db, data=subset(obese_data_HFF_lm_sum2, LipidGroup=="LysoPC"))
Obese_HFF_LPC_db_reg_sm <- summary(Obese_HFF_LPC_db_reg)
Obese_HFF_LPC_db_reg_coef <- as.data.frame(Obese_HFF_LPC_db_reg_sm$coefficients)
Obese_HFF_LPC_db_reg_coef$LipidGroup <- "LPC"
Obese_HFF_LPC_db_reg_coef$MetaReg <- "db"
Obese_HFF_LPC_db_reg_coef <- Obese_HFF_LPC_db_reg_coef[-c(1),]
Obese_HFF_LPC_db_reg_coef$r_sq <- Obese_HFF_LPC_db_reg_sm$adj.r.squared

Obese_HFF_DG_db_reg <- lm(beta ~ db, data=subset(obese_data_HFF_lm_sum2, LipidGroup=="Diglyceride"))
Obese_HFF_DG_db_reg_sm <- summary(Obese_HFF_DG_db_reg)
Obese_HFF_DG_db_reg_coef <- as.data.frame(Obese_HFF_DG_db_reg_sm$coefficients)
Obese_HFF_DG_db_reg_coef$LipidGroup <- "DG"
Obese_HFF_DG_db_reg_coef$MetaReg <- "db"
Obese_HFF_DG_db_reg_coef <- Obese_HFF_DG_db_reg_coef[-c(1),]
Obese_HFF_DG_db_reg_coef$r_sq <- Obese_HFF_DG_db_reg_sm$adj.r.squared

Obese_HFF_TG_db_reg <- lm(beta ~ db, data=subset(obese_data_HFF_lm_sum2, LipidGroup=="Triglyceride"))
Obese_HFF_TG_db_reg_sm <- summary(Obese_HFF_TG_db_reg)
Obese_HFF_TG_db_reg_coef <- as.data.frame(Obese_HFF_TG_db_reg_sm$coefficients)
Obese_HFF_TG_db_reg_coef$LipidGroup <- "TG"
Obese_HFF_TG_db_reg_coef$MetaReg <- "db"
Obese_HFF_TG_db_reg_coef <- Obese_HFF_TG_db_reg_coef[-c(1),]
Obese_HFF_TG_db_reg_coef$r_sq <- Obese_HFF_TG_db_reg_sm$adj.r.squared

Obese_HFF_SM_db_reg <- lm(beta ~ db, data=subset(obese_data_HFF_lm_sum2, LipidGroup=="Sphingomyelin"))
Obese_HFF_SM_db_reg_sm <- summary(Obese_HFF_SM_db_reg)
Obese_HFF_SM_db_reg_coef <- as.data.frame(Obese_HFF_SM_db_reg_sm$coefficients)
Obese_HFF_SM_db_reg_coef$LipidGroup <- "SM"
Obese_HFF_SM_db_reg_coef$MetaReg <- "db"
Obese_HFF_SM_db_reg_coef <- Obese_HFF_SM_db_reg_coef[-c(1),]
Obese_HFF_SM_db_reg_coef$r_sq <- Obese_HFF_SM_db_reg_sm$adj.r.squared

Obese_HFF_PE_db_reg <- lm(beta ~ db, data=subset(obese_data_HFF_lm_sum2, LipidGroup=="PE"))
Obese_HFF_PE_db_reg_sm <- summary(Obese_HFF_PE_db_reg)
Obese_HFF_PE_db_reg_coef <- as.data.frame(Obese_HFF_PE_db_reg_sm$coefficients)
Obese_HFF_PE_db_reg_coef$LipidGroup <- "PE"
Obese_HFF_PE_db_reg_coef$MetaReg <- "db"
Obese_HFF_PE_db_reg_coef <- Obese_HFF_PE_db_reg_coef[-c(1),]
Obese_HFF_PE_db_reg_coef$r_sq <- Obese_HFF_PE_db_reg_sm$adj.r.squared

Obese_HFF_PS_db_reg <- lm(beta ~ db, data=subset(obese_data_HFF_lm_sum2, LipidGroup=="PS"))
Obese_HFF_PS_db_reg_sm <- summary(Obese_HFF_PS_db_reg)
Obese_HFF_PS_db_reg_coef <- as.data.frame(Obese_HFF_PS_db_reg_sm$coefficients)
Obese_HFF_PS_db_reg_coef$LipidGroup <- "PS"
Obese_HFF_PS_db_reg_coef$MetaReg <- "db"
Obese_HFF_PS_db_reg_coef <- Obese_HFF_PS_db_reg_coef[-c(1),]
Obese_HFF_PS_db_reg_coef$r_sq <- Obese_HFF_PS_db_reg_sm$adj.r.squared

Obese_HFF_PI_db_reg <- lm(beta ~ db, data=subset(obese_data_HFF_lm_sum2, LipidGroup=="PI"))
Obese_HFF_PI_db_reg_sm <- summary(Obese_HFF_PI_db_reg)
Obese_HFF_PI_db_reg_coef <- as.data.frame(Obese_HFF_PI_db_reg_sm$coefficients)
Obese_HFF_PI_db_reg_coef$LipidGroup <- "PI"
Obese_HFF_PI_db_reg_coef$MetaReg <- "db"
Obese_HFF_PI_db_reg_coef <- Obese_HFF_PI_db_reg_coef[-c(1),]
Obese_HFF_PI_db_reg_coef$r_sq <- Obese_HFF_PI_db_reg_sm$adj.r.squared

Obese_HFF_Cer_db_reg <- lm(beta ~ db, data=subset(obese_data_HFF_lm_sum2, LipidGroup=="Ceramide"))
Obese_HFF_Cer_db_reg_sm <- summary(Obese_HFF_Cer_db_reg)
Obese_HFF_Cer_db_reg_coef <- as.data.frame(Obese_HFF_Cer_db_reg_sm$coefficients)
Obese_HFF_Cer_db_reg_coef$LipidGroup <- "Cer"
Obese_HFF_Cer_db_reg_coef$MetaReg <- "db"
Obese_HFF_Cer_db_reg_coef <- Obese_HFF_Cer_db_reg_coef[-c(1),]
Obese_HFF_Cer_db_reg_coef$r_sq <- Obese_HFF_Cer_db_reg_sm$adj.r.squared

Obese_HFF_PG_db_reg <- lm(beta ~ db, data=subset(obese_data_HFF_lm_sum2, LipidGroup=="PG"))
Obese_HFF_PG_db_reg_sm <- summary(Obese_HFF_PG_db_reg)
Obese_HFF_PG_db_reg_coef <- as.data.frame(Obese_HFF_PG_db_reg_sm$coefficients)
Obese_HFF_PG_db_reg_coef$LipidGroup <- "PG"
Obese_HFF_PG_db_reg_coef$MetaReg <- "db"
Obese_HFF_PG_db_reg_coef <- Obese_HFF_PG_db_reg_coef[-c(1),]
Obese_HFF_PG_db_reg_coef$r_sq <- Obese_HFF_PG_db_reg_sm$adj.r.squared

Obese_HFF_Gang_db_reg <- lm(beta ~ db, data=subset(obese_data_HFF_lm_sum2, LipidGroup=="Ganglioside"))
Obese_HFF_Gang_db_reg_sm <- summary(Obese_HFF_Gang_db_reg)
Obese_HFF_Gang_db_reg_coef <- as.data.frame(Obese_HFF_Gang_db_reg_sm$coefficients)
Obese_HFF_Gang_db_reg_coef$LipidGroup <- "Gang"
Obese_HFF_Gang_db_reg_coef$MetaReg <- "db"
Obese_HFF_Gang_db_reg_coef <- Obese_HFF_Gang_db_reg_coef[-c(1),]
Obese_HFF_Gang_db_reg_coef$r_sq <- Obese_HFF_Gang_db_reg_sm$adj.r.squared

Obese_HFF_HexCer_db_reg <- lm(beta ~ db, data=subset(obese_data_HFF_lm_sum2, LipidGroup=="Hexosylceramide"))
Obese_HFF_HexCer_db_reg_sm <- summary(Obese_HFF_HexCer_db_reg)
Obese_HFF_HexCer_db_reg_coef <- as.data.frame(Obese_HFF_HexCer_db_reg_sm$coefficients)
Obese_HFF_HexCer_db_reg_coef$LipidGroup <- "HexCer"
Obese_HFF_HexCer_db_reg_coef$MetaReg <- "db"
Obese_HFF_HexCer_db_reg_coef <- Obese_HFF_HexCer_db_reg_coef[-c(1),]
Obese_HFF_HexCer_db_reg_coef$r_sq <- Obese_HFF_HexCer_db_reg_sm$adj.r.squared

Obese_HFF_LPE_db_reg <- lm(beta ~ db, data=subset(obese_data_HFF_lm_sum2, LipidGroup=="LysoPE"))
Obese_HFF_LPE_db_reg_sm <- summary(Obese_HFF_LPE_db_reg)
Obese_HFF_LPE_db_reg_coef <- as.data.frame(Obese_HFF_LPE_db_reg_sm$coefficients)
Obese_HFF_LPE_db_reg_coef$LipidGroup <- "LPE"
Obese_HFF_LPE_db_reg_coef$MetaReg <- "db"
Obese_HFF_LPE_db_reg_coef <- Obese_HFF_LPE_db_reg_coef[-c(1),]
Obese_HFF_LPE_db_reg_coef$r_sq <- Obese_HFF_LPE_db_reg_sm$adj.r.squared

Obese_HFF_LPI_db_reg <- lm(beta ~ db, data=subset(obese_data_HFF_lm_sum2, LipidGroup=="LysoPI"))
Obese_HFF_LPI_db_reg_sm <- summary(Obese_HFF_LPI_db_reg)
Obese_HFF_LPI_db_reg_coef <- as.data.frame(Obese_HFF_LPI_db_reg_sm$coefficients)
Obese_HFF_LPI_db_reg_coef$LipidGroup <- "LPI"
Obese_HFF_LPI_db_reg_coef$MetaReg <- "db"
Obese_HFF_LPI_db_reg_coef <- Obese_HFF_LPI_db_reg_coef[-c(1),]
Obese_HFF_LPI_db_reg_coef$r_sq <- Obese_HFF_LPI_db_reg_sm$adj.r.squared

Obese_HFF_Sphing_db_reg <- lm(beta ~ db, data=subset(obese_data_HFF_lm_sum2, LipidGroup=="Sphingolipid"))
Obese_HFF_Sphing_db_reg_sm <- summary(Obese_HFF_Sphing_db_reg)
Obese_HFF_Sphing_db_reg_coef <- as.data.frame(Obese_HFF_Sphing_db_reg_sm$coefficients)
Obese_HFF_Sphing_db_reg_coef$LipidGroup <- "Sphing"
Obese_HFF_Sphing_db_reg_coef$MetaReg <- "db"
Obese_HFF_Sphing_db_reg_coef <- Obese_HFF_Sphing_db_reg_coef[-c(1),]
Obese_HFF_Sphing_db_reg_coef$r_sq <- Obese_HFF_Sphing_db_reg_sm$adj.r.squared

Obese_HFF_db_metareg <- rbind(Obese_HFF_PC_db_reg_coef, Obese_HFF_LPC_db_reg_coef)
Obese_HFF_db_metareg <- rbind(Obese_HFF_db_metareg, Obese_HFF_DG_db_reg_coef)
Obese_HFF_db_metareg <- rbind(Obese_HFF_db_metareg, Obese_HFF_TG_db_reg_coef)
Obese_HFF_db_metareg <- rbind(Obese_HFF_db_metareg, Obese_HFF_SM_db_reg_coef)
Obese_HFF_db_metareg <- rbind(Obese_HFF_db_metareg, Obese_HFF_PE_db_reg_coef)
Obese_HFF_db_metareg <- rbind(Obese_HFF_db_metareg, Obese_HFF_PS_db_reg_coef)
Obese_HFF_db_metareg <- rbind(Obese_HFF_db_metareg, Obese_HFF_PI_db_reg_coef)
Obese_HFF_db_metareg <- rbind(Obese_HFF_db_metareg, Obese_HFF_Cer_db_reg_coef)
Obese_HFF_db_metareg <- rbind(Obese_HFF_db_metareg, Obese_HFF_PG_db_reg_coef)
Obese_HFF_db_metareg <- rbind(Obese_HFF_db_metareg, Obese_HFF_Gang_db_reg_coef)
Obese_HFF_db_metareg <- rbind(Obese_HFF_db_metareg, Obese_HFF_HexCer_db_reg_coef)
Obese_HFF_db_metareg <- rbind(Obese_HFF_db_metareg, Obese_HFF_LPE_db_reg_coef)
Obese_HFF_db_metareg <- rbind(Obese_HFF_db_metareg, Obese_HFF_LPI_db_reg_coef)
Obese_HFF_db_metareg <- rbind(Obese_HFF_db_metareg, Obese_HFF_Sphing_db_reg_coef)

## run for carbons


Obese_HFF_PC_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_HFF_lm_sum2, LipidGroup=="PC"))
Obese_HFF_PC_Carb_reg_sm <- summary(Obese_HFF_PC_Carb_reg)
Obese_HFF_PC_Carb_reg_coef <- as.data.frame(Obese_HFF_PC_Carb_reg_sm$coefficients)
Obese_HFF_PC_Carb_reg_coef$LipidGroup <- "PC"
Obese_HFF_PC_Carb_reg_coef$MetaReg <- "Carb"
Obese_HFF_PC_Carb_reg_coef <- Obese_HFF_PC_Carb_reg_coef[-c(1),]
Obese_HFF_PC_Carb_reg_coef$r_sq <- Obese_HFF_PC_Carb_reg_sm$adj.r.squared

Obese_HFF_LPC_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_HFF_lm_sum2, LipidGroup=="LysoPC"))
Obese_HFF_LPC_Carb_reg_sm <- summary(Obese_HFF_LPC_Carb_reg)
Obese_HFF_LPC_Carb_reg_coef <- as.data.frame(Obese_HFF_LPC_Carb_reg_sm$coefficients)
Obese_HFF_LPC_Carb_reg_coef$LipidGroup <- "LPC"
Obese_HFF_LPC_Carb_reg_coef$MetaReg <- "Carb"
Obese_HFF_LPC_Carb_reg_coef <- Obese_HFF_LPC_Carb_reg_coef[-c(1),]
Obese_HFF_LPC_Carb_reg_coef$r_sq <- Obese_HFF_LPC_Carb_reg_sm$adj.r.squared

Obese_HFF_DG_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_HFF_lm_sum2, LipidGroup=="Diglyceride"))
Obese_HFF_DG_Carb_reg_sm <- summary(Obese_HFF_DG_Carb_reg)
Obese_HFF_DG_Carb_reg_coef <- as.data.frame(Obese_HFF_DG_Carb_reg_sm$coefficients)
Obese_HFF_DG_Carb_reg_coef$LipidGroup <- "DG"
Obese_HFF_DG_Carb_reg_coef$MetaReg <- "Carb"
Obese_HFF_DG_Carb_reg_coef <- Obese_HFF_DG_Carb_reg_coef[-c(1),]
Obese_HFF_DG_Carb_reg_coef$r_sq <- Obese_HFF_DG_Carb_reg_sm$adj.r.squared

Obese_HFF_TG_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_HFF_lm_sum2, LipidGroup=="Triglyceride"))
Obese_HFF_TG_Carb_reg_sm <- summary(Obese_HFF_TG_Carb_reg)
Obese_HFF_TG_Carb_reg_coef <- as.data.frame(Obese_HFF_TG_Carb_reg_sm$coefficients)
Obese_HFF_TG_Carb_reg_coef$LipidGroup <- "TG"
Obese_HFF_TG_Carb_reg_coef$MetaReg <- "Carb"
Obese_HFF_TG_Carb_reg_coef <- Obese_HFF_TG_Carb_reg_coef[-c(1),]
Obese_HFF_TG_Carb_reg_coef$r_sq <- Obese_HFF_TG_Carb_reg_sm$adj.r.squared

Obese_HFF_SM_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_HFF_lm_sum2, LipidGroup=="Sphingomyelin"))
Obese_HFF_SM_Carb_reg_sm <- summary(Obese_HFF_SM_Carb_reg)
Obese_HFF_SM_Carb_reg_coef <- as.data.frame(Obese_HFF_SM_Carb_reg_sm$coefficients)
Obese_HFF_SM_Carb_reg_coef$LipidGroup <- "SM"
Obese_HFF_SM_Carb_reg_coef$MetaReg <- "Carb"
Obese_HFF_SM_Carb_reg_coef <- Obese_HFF_SM_Carb_reg_coef[-c(1),]
Obese_HFF_SM_Carb_reg_coef$r_sq <- Obese_HFF_SM_Carb_reg_sm$adj.r.squared

Obese_HFF_PE_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_HFF_lm_sum2, LipidGroup=="PE"))
Obese_HFF_PE_Carb_reg_sm <- summary(Obese_HFF_PE_Carb_reg)
Obese_HFF_PE_Carb_reg_coef <- as.data.frame(Obese_HFF_PE_Carb_reg_sm$coefficients)
Obese_HFF_PE_Carb_reg_coef$LipidGroup <- "PE"
Obese_HFF_PE_Carb_reg_coef$MetaReg <- "Carb"
Obese_HFF_PE_Carb_reg_coef <- Obese_HFF_PE_Carb_reg_coef[-c(1),]
Obese_HFF_PE_Carb_reg_coef$r_sq <- Obese_HFF_PE_Carb_reg_sm$adj.r.squared

Obese_HFF_PS_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_HFF_lm_sum2, LipidGroup=="PS"))
Obese_HFF_PS_Carb_reg_sm <- summary(Obese_HFF_PS_Carb_reg)
Obese_HFF_PS_Carb_reg_coef <- as.data.frame(Obese_HFF_PS_Carb_reg_sm$coefficients)
Obese_HFF_PS_Carb_reg_coef$LipidGroup <- "PS"
Obese_HFF_PS_Carb_reg_coef$MetaReg <- "Carb"
Obese_HFF_PS_Carb_reg_coef <- Obese_HFF_PS_Carb_reg_coef[-c(1),]
Obese_HFF_PS_Carb_reg_coef$r_sq <- Obese_HFF_PS_Carb_reg_sm$adj.r.squared

Obese_HFF_PI_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_HFF_lm_sum2, LipidGroup=="PI"))
Obese_HFF_PI_Carb_reg_sm <- summary(Obese_HFF_PI_Carb_reg)
Obese_HFF_PI_Carb_reg_coef <- as.data.frame(Obese_HFF_PI_Carb_reg_sm$coefficients)
Obese_HFF_PI_Carb_reg_coef$LipidGroup <- "PI"
Obese_HFF_PI_Carb_reg_coef$MetaReg <- "Carb"
Obese_HFF_PI_Carb_reg_coef <- Obese_HFF_PI_Carb_reg_coef[-c(1),]
Obese_HFF_PI_Carb_reg_coef$r_sq <- Obese_HFF_PI_Carb_reg_sm$adj.r.squared

Obese_HFF_Cer_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_HFF_lm_sum2, LipidGroup=="Ceramide"))
Obese_HFF_Cer_Carb_reg_sm <- summary(Obese_HFF_Cer_Carb_reg)
Obese_HFF_Cer_Carb_reg_coef <- as.data.frame(Obese_HFF_Cer_Carb_reg_sm$coefficients)
Obese_HFF_Cer_Carb_reg_coef$LipidGroup <- "Cer"
Obese_HFF_Cer_Carb_reg_coef$MetaReg <- "Carb"
Obese_HFF_Cer_Carb_reg_coef <- Obese_HFF_Cer_Carb_reg_coef[-c(1),]
Obese_HFF_Cer_Carb_reg_coef$r_sq <- Obese_HFF_Cer_Carb_reg_sm$adj.r.squared

Obese_HFF_PG_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_HFF_lm_sum2, LipidGroup=="PG"))
Obese_HFF_PG_Carb_reg_sm <- summary(Obese_HFF_PG_Carb_reg)
Obese_HFF_PG_Carb_reg_coef <- as.data.frame(Obese_HFF_PG_Carb_reg_sm$coefficients)
Obese_HFF_PG_Carb_reg_coef$LipidGroup <- "PG"
Obese_HFF_PG_Carb_reg_coef$MetaReg <- "Carb"
Obese_HFF_PG_Carb_reg_coef <- Obese_HFF_PG_Carb_reg_coef[-c(1),]
Obese_HFF_PG_Carb_reg_coef$r_sq <- Obese_HFF_PG_Carb_reg_sm$adj.r.squared

Obese_HFF_Gang_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_HFF_lm_sum2, LipidGroup=="Ganglioside"))
Obese_HFF_Gang_Carb_reg_sm <- summary(Obese_HFF_Gang_Carb_reg)
Obese_HFF_Gang_Carb_reg_coef <- as.data.frame(Obese_HFF_Gang_Carb_reg_sm$coefficients)
Obese_HFF_Gang_Carb_reg_coef$LipidGroup <- "Gang"
Obese_HFF_Gang_Carb_reg_coef$MetaReg <- "Carb"
Obese_HFF_Gang_Carb_reg_coef <- Obese_HFF_Gang_Carb_reg_coef[-c(1),]
Obese_HFF_Gang_Carb_reg_coef$r_sq <- Obese_HFF_Gang_Carb_reg_sm$adj.r.squared

Obese_HFF_HexCer_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_HFF_lm_sum2, LipidGroup=="Hexosylceramide"))
Obese_HFF_HexCer_Carb_reg_sm <- summary(Obese_HFF_HexCer_Carb_reg)
Obese_HFF_HexCer_Carb_reg_coef <- as.data.frame(Obese_HFF_HexCer_Carb_reg_sm$coefficients)
Obese_HFF_HexCer_Carb_reg_coef$LipidGroup <- "HexCer"
Obese_HFF_HexCer_Carb_reg_coef$MetaReg <- "Carb"
Obese_HFF_HexCer_Carb_reg_coef <- Obese_HFF_HexCer_Carb_reg_coef[-c(1),]
Obese_HFF_HexCer_Carb_reg_coef$r_sq <- Obese_HFF_HexCer_Carb_reg_sm$adj.r.squared

Obese_HFF_LPE_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_HFF_lm_sum2, LipidGroup=="LysoPE"))
Obese_HFF_LPE_Carb_reg_sm <- summary(Obese_HFF_LPE_Carb_reg)
Obese_HFF_LPE_Carb_reg_coef <- as.data.frame(Obese_HFF_LPE_Carb_reg_sm$coefficients)
Obese_HFF_LPE_Carb_reg_coef$LipidGroup <- "LPE"
Obese_HFF_LPE_Carb_reg_coef$MetaReg <- "Carb"
Obese_HFF_LPE_Carb_reg_coef <- Obese_HFF_LPE_Carb_reg_coef[-c(1),]
Obese_HFF_LPE_Carb_reg_coef$r_sq <- Obese_HFF_LPE_Carb_reg_sm$adj.r.squared

Obese_HFF_LPI_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_HFF_lm_sum2, LipidGroup=="LysoPI"))
Obese_HFF_LPI_Carb_reg_sm <- summary(Obese_HFF_LPI_Carb_reg)
Obese_HFF_LPI_Carb_reg_coef <- as.data.frame(Obese_HFF_LPI_Carb_reg_sm$coefficients)
Obese_HFF_LPI_Carb_reg_coef$LipidGroup <- "LPI"
Obese_HFF_LPI_Carb_reg_coef$MetaReg <- "Carb"
Obese_HFF_LPI_Carb_reg_coef <- Obese_HFF_LPI_Carb_reg_coef[-c(1),]
Obese_HFF_LPI_Carb_reg_coef$r_sq <- Obese_HFF_LPI_Carb_reg_sm$adj.r.squared

Obese_HFF_Sphing_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_HFF_lm_sum2, LipidGroup=="Sphingolipid"))
Obese_HFF_Sphing_Carb_reg_sm <- summary(Obese_HFF_Sphing_Carb_reg)
Obese_HFF_Sphing_Carb_reg_coef <- as.data.frame(Obese_HFF_Sphing_Carb_reg_sm$coefficients)
Obese_HFF_Sphing_Carb_reg_coef$LipidGroup <- "Sphing"
Obese_HFF_Sphing_Carb_reg_coef$MetaReg <- "Carb"
Obese_HFF_Sphing_Carb_reg_coef <- Obese_HFF_Sphing_Carb_reg_coef[-c(1),]
Obese_HFF_Sphing_Carb_reg_coef$r_sq <- Obese_HFF_Sphing_Carb_reg_sm$adj.r.squared


Obese_HFF_Carb_metareg <- rbind(Obese_HFF_PC_Carb_reg_coef, Obese_HFF_LPC_Carb_reg_coef)
Obese_HFF_Carb_metareg <- rbind(Obese_HFF_Carb_metareg, Obese_HFF_DG_Carb_reg_coef)
Obese_HFF_Carb_metareg <- rbind(Obese_HFF_Carb_metareg, Obese_HFF_TG_Carb_reg_coef)
Obese_HFF_Carb_metareg <- rbind(Obese_HFF_Carb_metareg, Obese_HFF_SM_Carb_reg_coef)
Obese_HFF_Carb_metareg <- rbind(Obese_HFF_Carb_metareg, Obese_HFF_PE_Carb_reg_coef)
Obese_HFF_Carb_metareg <- rbind(Obese_HFF_Carb_metareg, Obese_HFF_PS_Carb_reg_coef)
Obese_HFF_Carb_metareg <- rbind(Obese_HFF_Carb_metareg, Obese_HFF_PI_Carb_reg_coef)
Obese_HFF_Carb_metareg <- rbind(Obese_HFF_Carb_metareg, Obese_HFF_Cer_Carb_reg_coef)
Obese_HFF_Carb_metareg <- rbind(Obese_HFF_Carb_metareg, Obese_HFF_PG_Carb_reg_coef)
Obese_HFF_Carb_metareg <- rbind(Obese_HFF_Carb_metareg, Obese_HFF_Gang_Carb_reg_coef)
Obese_HFF_Carb_metareg <- rbind(Obese_HFF_Carb_metareg, Obese_HFF_HexCer_Carb_reg_coef)
Obese_HFF_Carb_metareg <- rbind(Obese_HFF_Carb_metareg, Obese_HFF_LPE_Carb_reg_coef)
Obese_HFF_Carb_metareg <- rbind(Obese_HFF_Carb_metareg, Obese_HFF_LPI_Carb_reg_coef)
Obese_HFF_Carb_metareg <- rbind(Obese_HFF_Carb_metareg, Obese_HFF_Sphing_Carb_reg_coef)

Obese_HFF_metareg_summary <- rbind(Obese_HFF_Carb_metareg, Obese_HFF_db_metareg)
names(Obese_HFF_metareg_summary)[names(Obese_HFF_metareg_summary) == 'Pr(>|t|)'] <- 'pval'
Obese_HFF_metareg_summary$qval <- p.adjust(Obese_HFF_metareg_summary$pval, method = "hochberg")
write.table(Obese_HFF_metareg_summary,file="Obese_HFF_metareg_summary.csv",sep=",")



#### make meta-regression plots of specific beta vs db/carbon

Obese_HFF_TG_db <- ggplot(subset(obese_data_HFF_lm_sum2, LipidGroup %in% c("Triglyceride")), aes(x=db, y=beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in TG") + ylab("Beta-regression coefficient") + theme_classic() + theme(legend.position="right", legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) 
Obese_HFF_TG_db

## + scale_x_continuous(breaks=seq(0,6,1), limits = c(0,6), expand = c(.05,0))
## + scale_y_continuous(breaks=seq(-.75,0.5,0.25), limits = c(-.75,0.5), expand = c(0,0))
## + annotate(geom = "text", x = 5, y = -.25, label = "italic(AdjR) ^ 2 == 0.06", parse = TRUE, size = 4)
## + annotate(geom = "text", x = 5, y = -.2, label = "P[slope] = 0.025", parse = FALSE, size = 4)

Obese_HFF_SM_db <- ggplot(subset(obese_data_HFF_lm_sum2, LipidGroup %in% c("Sphingomyelin")), aes(x=db, y=beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in SM") + ylab("Beta-regression coefficient") + theme_classic() + theme(legend.position="right", legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) 
Obese_HFF_SM_db

Obese_HFF_PC_db <- ggplot(subset(obese_data_HFF_lm_sum2, LipidGroup %in% c("PC")), aes(x=db, y=beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in PC") + ylab("Beta-regression coefficient") + theme_classic() + theme(legend.position="right", legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) 
Obese_HFF_PC_db

Obese_HFF_PC_Carb <- ggplot(subset(obese_data_HFF_lm_sum2, LipidGroup %in% c("PC")), aes(x=Carb, y=beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in PC") + ylab("Beta-regression coefficient") + theme_classic() + theme(legend.position="right", legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) 
Obese_HFF_PC_Carb

Obese_HFF_top <- plot_grid(Obese_HFF_TG_db, Obese_HFF_SM_db, ncol = 2, labels = c('A','B'), label_fontfamily = 'serif', label_fontface = 'bold', label_size = 22, align = 'w')
Obese_HFF_bottom <- plot_grid(Obese_HFF_PC_db, Obese_HFF_PC_Carb, ncol = 2, labels = c('C','D'), label_fontfamily = 'serif', label_fontface = 'bold', label_size = 22, align = 'w', rel_widths = c(1.5, 1.5))

pdf(file="Obese_HFF_metareg_sumfig_v1.pdf",width=16,height=12)
plot_grid(Obese_HFF_top, Obese_HFF_bottom, ncol = 1, rel_heights = c(1.0, 1.0))
dev.off()

## TE [different individuals to those who have HFF]

## Regress TE with lipids in obese cohort
obese_data_TE_lm_full <- lapply(obese_data[54:281], function(x) summary(lm(x ~ obese_data$log_TE + obese_data$Sex + obese_data$Age)))
obese_data_TE_lm <- lapply(obese_data_TE_lm_full, coef)
obese_data_TE_lm <- data.frame(obese_data_TE_lm)
obese_data_TE_lm <- t(obese_data_TE_lm)
obese_data_TE_lm = subset(obese_data_TE_lm, select = -c(1,3,4) )
obese_data_TE_lm <- data.frame(obese_data_TE_lm)
obese_data_TE_lm$annot <- rep(annotation$annotation, each=1, length.out=nrow(obese_data_TE_lm))
obese_data_TE_lm <- obese_data_TE_lm[order(obese_data_TE_lm$annot),]
obese_data_TE_lm_beta <- obese_data_TE_lm[1:((nrow(obese_data_TE_lm)/4)),]
obese_data_TE_lm_p <- obese_data_TE_lm[((nrow(obese_data_TE_lm)/4)+1):((nrow(obese_data_TE_lm)/4)*2),]
obese_data_TE_lm_SE <- obese_data_TE_lm[(((nrow(obese_data_TE_lm)/4)*2)+1):((nrow(obese_data_TE_lm)/4)*3),]
obese_data_TE_lm_t <- obese_data_TE_lm[(((nrow(obese_data_TE_lm)/4)*3)+1):(nrow(obese_data_TE_lm)),]

obese_data_TE_lm_beta$beta <- obese_data_TE_lm_beta$obese_data.log_TE
obese_data_TE_lm_beta = subset(obese_data_TE_lm_beta, select = -c(1,2))
obese_data_TE_lm_SE$SE <- obese_data_TE_lm_SE$obese_data.log_TE
obese_data_TE_lm_SE = subset(obese_data_TE_lm_SE, select = -c(1,2))
obese_data_TE_lm_p$p <- obese_data_TE_lm_p$obese_data.log_TE
obese_data_TE_lm_p = subset(obese_data_TE_lm_p, select = -c(1,2))
obese_data_TE_lm_t$t <- obese_data_TE_lm_t$obese_data.log_TE
obese_data_TE_lm_t = subset(obese_data_TE_lm_t, select = -c(1,2))

obese_data_TE_lm_beta$name <- row.names(obese_data_TE_lm_beta)
obese_data_TE_lm_beta$name2 = substr(obese_data_TE_lm_beta$name,1,nchar(obese_data_TE_lm_beta$name)-9)
obese_data_TE_lm_p$name <- row.names(obese_data_TE_lm_p)
obese_data_TE_lm_p$name2 = substr(obese_data_TE_lm_p$name,1,nchar(obese_data_TE_lm_p$name)-9)
obese_data_TE_lm_SE$name <- row.names(obese_data_TE_lm_SE)
obese_data_TE_lm_SE$name2 = substr(obese_data_TE_lm_SE$name,1,nchar(obese_data_TE_lm_SE$name)-11)
obese_data_TE_lm_t$name <- row.names(obese_data_TE_lm_t)
obese_data_TE_lm_t$name2 = substr(obese_data_TE_lm_t$name,1,nchar(obese_data_TE_lm_t$name)-8)

obese_data_TE_lm_sum <- merge(obese_data_TE_lm_beta, obese_data_TE_lm_SE, by="name2")
obese_data_TE_lm_sum <- merge(obese_data_TE_lm_sum, obese_data_TE_lm_p, by="name2")
obese_data_TE_lm_sum <- merge(obese_data_TE_lm_sum, obese_data_TE_lm_t, by="name2")

obese_data_TE_lm_sum = subset(obese_data_TE_lm_sum, select = c("name2","beta","SE","t","p"))
names(obese_data_TE_lm_sum)[names(obese_data_TE_lm_sum) == 'name2'] <- 'var'
obese_data_TE_lm_sum2 <- merge(Lipids_annotation, obese_data_TE_lm_sum, by="var")
obese_data_TE_lm_sum2$num <- nrow(obese_data)
obese_data_TE_lm_sum2$sig <- NA
obese_data_TE_lm_sum2 <- obese_data_TE_lm_sum2 %>% mutate(sig = ifelse(p < lipid_sig, "Significant", "Not significant"))

obese_data_TE_lm_sum2$qval <- p.adjust(obese_data_TE_lm_sum2$p, method = "hochberg")
obese_data_TE_lm_sum2$neglog_p <- -log10(obese_data_TE_lm_sum2$p)
write.table(obese_data_TE_lm_sum2,file="Obese_TE_lm_summary.csv",sep=",")

#####

## volcano plot

pdf(file="Obese_TE_lm_vol_v1.pdf",width=5,height=6)
Obese_TE_vol <- ggplot(data= obese_data_TE_lm_sum2, aes(x=beta, y=neglog_p, colour=LipidGroup)) + geom_point(alpha=0.4, size=1.75) + geom_text_repel(data = subset(obese_data_TE_lm_sum2, neglog_p > 2.3), aes(label = var), size = 3, key_glyph = "point") + xlab("Beta-regression coefficient") + ylab("-log10 p-value") + theme_bw() + theme(legend.position="right")  + theme(plot.title = element_text(face = "bold")) + theme(plot.title = element_text(hjust = 0.2)) + ggtitle("Plasma lipids associated with TE") + labs(color = "Lipid class")
Obese_TE_vol
dev.off()


############


## identify trends using meta-regression with beta vs carbons & db

Obese_TE_PC_db_reg <- lm(beta ~ db, data=subset(obese_data_TE_lm_sum2, LipidGroup=="PC"))
Obese_TE_PC_db_reg_sm <- summary(Obese_TE_PC_db_reg)
Obese_TE_PC_db_reg_coef <- as.data.frame(Obese_TE_PC_db_reg_sm$coefficients)
Obese_TE_PC_db_reg_coef$LipidGroup <- "PC"
Obese_TE_PC_db_reg_coef$MetaReg <- "db"
Obese_TE_PC_db_reg_coef <- Obese_TE_PC_db_reg_coef[-c(1),]
Obese_TE_PC_db_reg_coef$r_sq <- Obese_TE_PC_db_reg_sm$adj.r.squared

Obese_TE_LPC_db_reg <- lm(beta ~ db, data=subset(obese_data_TE_lm_sum2, LipidGroup=="LysoPC"))
Obese_TE_LPC_db_reg_sm <- summary(Obese_TE_LPC_db_reg)
Obese_TE_LPC_db_reg_coef <- as.data.frame(Obese_TE_LPC_db_reg_sm$coefficients)
Obese_TE_LPC_db_reg_coef$LipidGroup <- "LPC"
Obese_TE_LPC_db_reg_coef$MetaReg <- "db"
Obese_TE_LPC_db_reg_coef <- Obese_TE_LPC_db_reg_coef[-c(1),]
Obese_TE_LPC_db_reg_coef$r_sq <- Obese_TE_LPC_db_reg_sm$adj.r.squared

Obese_TE_DG_db_reg <- lm(beta ~ db, data=subset(obese_data_TE_lm_sum2, LipidGroup=="Diglyceride"))
Obese_TE_DG_db_reg_sm <- summary(Obese_TE_DG_db_reg)
Obese_TE_DG_db_reg_coef <- as.data.frame(Obese_TE_DG_db_reg_sm$coefficients)
Obese_TE_DG_db_reg_coef$LipidGroup <- "DG"
Obese_TE_DG_db_reg_coef$MetaReg <- "db"
Obese_TE_DG_db_reg_coef <- Obese_TE_DG_db_reg_coef[-c(1),]
Obese_TE_DG_db_reg_coef$r_sq <- Obese_TE_DG_db_reg_sm$adj.r.squared

Obese_TE_TG_db_reg <- lm(beta ~ db, data=subset(obese_data_TE_lm_sum2, LipidGroup=="Triglyceride"))
Obese_TE_TG_db_reg_sm <- summary(Obese_TE_TG_db_reg)
Obese_TE_TG_db_reg_coef <- as.data.frame(Obese_TE_TG_db_reg_sm$coefficients)
Obese_TE_TG_db_reg_coef$LipidGroup <- "TG"
Obese_TE_TG_db_reg_coef$MetaReg <- "db"
Obese_TE_TG_db_reg_coef <- Obese_TE_TG_db_reg_coef[-c(1),]
Obese_TE_TG_db_reg_coef$r_sq <- Obese_TE_TG_db_reg_sm$adj.r.squared

Obese_TE_SM_db_reg <- lm(beta ~ db, data=subset(obese_data_TE_lm_sum2, LipidGroup=="Sphingomyelin"))
Obese_TE_SM_db_reg_sm <- summary(Obese_TE_SM_db_reg)
Obese_TE_SM_db_reg_coef <- as.data.frame(Obese_TE_SM_db_reg_sm$coefficients)
Obese_TE_SM_db_reg_coef$LipidGroup <- "SM"
Obese_TE_SM_db_reg_coef$MetaReg <- "db"
Obese_TE_SM_db_reg_coef <- Obese_TE_SM_db_reg_coef[-c(1),]
Obese_TE_SM_db_reg_coef$r_sq <- Obese_TE_SM_db_reg_sm$adj.r.squared

Obese_TE_PE_db_reg <- lm(beta ~ db, data=subset(obese_data_TE_lm_sum2, LipidGroup=="PE"))
Obese_TE_PE_db_reg_sm <- summary(Obese_TE_PE_db_reg)
Obese_TE_PE_db_reg_coef <- as.data.frame(Obese_TE_PE_db_reg_sm$coefficients)
Obese_TE_PE_db_reg_coef$LipidGroup <- "PE"
Obese_TE_PE_db_reg_coef$MetaReg <- "db"
Obese_TE_PE_db_reg_coef <- Obese_TE_PE_db_reg_coef[-c(1),]
Obese_TE_PE_db_reg_coef$r_sq <- Obese_TE_PE_db_reg_sm$adj.r.squared

Obese_TE_PS_db_reg <- lm(beta ~ db, data=subset(obese_data_TE_lm_sum2, LipidGroup=="PS"))
Obese_TE_PS_db_reg_sm <- summary(Obese_TE_PS_db_reg)
Obese_TE_PS_db_reg_coef <- as.data.frame(Obese_TE_PS_db_reg_sm$coefficients)
Obese_TE_PS_db_reg_coef$LipidGroup <- "PS"
Obese_TE_PS_db_reg_coef$MetaReg <- "db"
Obese_TE_PS_db_reg_coef <- Obese_TE_PS_db_reg_coef[-c(1),]
Obese_TE_PS_db_reg_coef$r_sq <- Obese_TE_PS_db_reg_sm$adj.r.squared

Obese_TE_PI_db_reg <- lm(beta ~ db, data=subset(obese_data_TE_lm_sum2, LipidGroup=="PI"))
Obese_TE_PI_db_reg_sm <- summary(Obese_TE_PI_db_reg)
Obese_TE_PI_db_reg_coef <- as.data.frame(Obese_TE_PI_db_reg_sm$coefficients)
Obese_TE_PI_db_reg_coef$LipidGroup <- "PI"
Obese_TE_PI_db_reg_coef$MetaReg <- "db"
Obese_TE_PI_db_reg_coef <- Obese_TE_PI_db_reg_coef[-c(1),]
Obese_TE_PI_db_reg_coef$r_sq <- Obese_TE_PI_db_reg_sm$adj.r.squared

Obese_TE_Cer_db_reg <- lm(beta ~ db, data=subset(obese_data_TE_lm_sum2, LipidGroup=="Ceramide"))
Obese_TE_Cer_db_reg_sm <- summary(Obese_TE_Cer_db_reg)
Obese_TE_Cer_db_reg_coef <- as.data.frame(Obese_TE_Cer_db_reg_sm$coefficients)
Obese_TE_Cer_db_reg_coef$LipidGroup <- "Cer"
Obese_TE_Cer_db_reg_coef$MetaReg <- "db"
Obese_TE_Cer_db_reg_coef <- Obese_TE_Cer_db_reg_coef[-c(1),]
Obese_TE_Cer_db_reg_coef$r_sq <- Obese_TE_Cer_db_reg_sm$adj.r.squared

Obese_TE_PG_db_reg <- lm(beta ~ db, data=subset(obese_data_TE_lm_sum2, LipidGroup=="PG"))
Obese_TE_PG_db_reg_sm <- summary(Obese_TE_PG_db_reg)
Obese_TE_PG_db_reg_coef <- as.data.frame(Obese_TE_PG_db_reg_sm$coefficients)
Obese_TE_PG_db_reg_coef$LipidGroup <- "PG"
Obese_TE_PG_db_reg_coef$MetaReg <- "db"
Obese_TE_PG_db_reg_coef <- Obese_TE_PG_db_reg_coef[-c(1),]
Obese_TE_PG_db_reg_coef$r_sq <- Obese_TE_PG_db_reg_sm$adj.r.squared

Obese_TE_Gang_db_reg <- lm(beta ~ db, data=subset(obese_data_TE_lm_sum2, LipidGroup=="Ganglioside"))
Obese_TE_Gang_db_reg_sm <- summary(Obese_TE_Gang_db_reg)
Obese_TE_Gang_db_reg_coef <- as.data.frame(Obese_TE_Gang_db_reg_sm$coefficients)
Obese_TE_Gang_db_reg_coef$LipidGroup <- "Gang"
Obese_TE_Gang_db_reg_coef$MetaReg <- "db"
Obese_TE_Gang_db_reg_coef <- Obese_TE_Gang_db_reg_coef[-c(1),]
Obese_TE_Gang_db_reg_coef$r_sq <- Obese_TE_Gang_db_reg_sm$adj.r.squared

Obese_TE_HexCer_db_reg <- lm(beta ~ db, data=subset(obese_data_TE_lm_sum2, LipidGroup=="Hexosylceramide"))
Obese_TE_HexCer_db_reg_sm <- summary(Obese_TE_HexCer_db_reg)
Obese_TE_HexCer_db_reg_coef <- as.data.frame(Obese_TE_HexCer_db_reg_sm$coefficients)
Obese_TE_HexCer_db_reg_coef$LipidGroup <- "HexCer"
Obese_TE_HexCer_db_reg_coef$MetaReg <- "db"
Obese_TE_HexCer_db_reg_coef <- Obese_TE_HexCer_db_reg_coef[-c(1),]
Obese_TE_HexCer_db_reg_coef$r_sq <- Obese_TE_HexCer_db_reg_sm$adj.r.squared

Obese_TE_LPE_db_reg <- lm(beta ~ db, data=subset(obese_data_TE_lm_sum2, LipidGroup=="LysoPE"))
Obese_TE_LPE_db_reg_sm <- summary(Obese_TE_LPE_db_reg)
Obese_TE_LPE_db_reg_coef <- as.data.frame(Obese_TE_LPE_db_reg_sm$coefficients)
Obese_TE_LPE_db_reg_coef$LipidGroup <- "LPE"
Obese_TE_LPE_db_reg_coef$MetaReg <- "db"
Obese_TE_LPE_db_reg_coef <- Obese_TE_LPE_db_reg_coef[-c(1),]
Obese_TE_LPE_db_reg_coef$r_sq <- Obese_TE_LPE_db_reg_sm$adj.r.squared

Obese_TE_LPI_db_reg <- lm(beta ~ db, data=subset(obese_data_TE_lm_sum2, LipidGroup=="LysoPI"))
Obese_TE_LPI_db_reg_sm <- summary(Obese_TE_LPI_db_reg)
Obese_TE_LPI_db_reg_coef <- as.data.frame(Obese_TE_LPI_db_reg_sm$coefficients)
Obese_TE_LPI_db_reg_coef$LipidGroup <- "LPI"
Obese_TE_LPI_db_reg_coef$MetaReg <- "db"
Obese_TE_LPI_db_reg_coef <- Obese_TE_LPI_db_reg_coef[-c(1),]
Obese_TE_LPI_db_reg_coef$r_sq <- Obese_TE_LPI_db_reg_sm$adj.r.squared

Obese_TE_Sphing_db_reg <- lm(beta ~ db, data=subset(obese_data_TE_lm_sum2, LipidGroup=="Sphingolipid"))
Obese_TE_Sphing_db_reg_sm <- summary(Obese_TE_Sphing_db_reg)
Obese_TE_Sphing_db_reg_coef <- as.data.frame(Obese_TE_Sphing_db_reg_sm$coefficients)
Obese_TE_Sphing_db_reg_coef$LipidGroup <- "Sphing"
Obese_TE_Sphing_db_reg_coef$MetaReg <- "db"
Obese_TE_Sphing_db_reg_coef <- Obese_TE_Sphing_db_reg_coef[-c(1),]
Obese_TE_Sphing_db_reg_coef$r_sq <- Obese_TE_Sphing_db_reg_sm$adj.r.squared

Obese_TE_db_metareg <- rbind(Obese_TE_PC_db_reg_coef, Obese_TE_LPC_db_reg_coef)
Obese_TE_db_metareg <- rbind(Obese_TE_db_metareg, Obese_TE_DG_db_reg_coef)
Obese_TE_db_metareg <- rbind(Obese_TE_db_metareg, Obese_TE_TG_db_reg_coef)
Obese_TE_db_metareg <- rbind(Obese_TE_db_metareg, Obese_TE_SM_db_reg_coef)
Obese_TE_db_metareg <- rbind(Obese_TE_db_metareg, Obese_TE_PE_db_reg_coef)
Obese_TE_db_metareg <- rbind(Obese_TE_db_metareg, Obese_TE_PS_db_reg_coef)
Obese_TE_db_metareg <- rbind(Obese_TE_db_metareg, Obese_TE_PI_db_reg_coef)
Obese_TE_db_metareg <- rbind(Obese_TE_db_metareg, Obese_TE_Cer_db_reg_coef)
Obese_TE_db_metareg <- rbind(Obese_TE_db_metareg, Obese_TE_PG_db_reg_coef)
Obese_TE_db_metareg <- rbind(Obese_TE_db_metareg, Obese_TE_Gang_db_reg_coef)
Obese_TE_db_metareg <- rbind(Obese_TE_db_metareg, Obese_TE_HexCer_db_reg_coef)
Obese_TE_db_metareg <- rbind(Obese_TE_db_metareg, Obese_TE_LPE_db_reg_coef)
Obese_TE_db_metareg <- rbind(Obese_TE_db_metareg, Obese_TE_LPI_db_reg_coef)
Obese_TE_db_metareg <- rbind(Obese_TE_db_metareg, Obese_TE_Sphing_db_reg_coef)

## run for carbons


Obese_TE_PC_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_TE_lm_sum2, LipidGroup=="PC"))
Obese_TE_PC_Carb_reg_sm <- summary(Obese_TE_PC_Carb_reg)
Obese_TE_PC_Carb_reg_coef <- as.data.frame(Obese_TE_PC_Carb_reg_sm$coefficients)
Obese_TE_PC_Carb_reg_coef$LipidGroup <- "PC"
Obese_TE_PC_Carb_reg_coef$MetaReg <- "Carb"
Obese_TE_PC_Carb_reg_coef <- Obese_TE_PC_Carb_reg_coef[-c(1),]
Obese_TE_PC_Carb_reg_coef$r_sq <- Obese_TE_PC_Carb_reg_sm$adj.r.squared

Obese_TE_LPC_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_TE_lm_sum2, LipidGroup=="LysoPC"))
Obese_TE_LPC_Carb_reg_sm <- summary(Obese_TE_LPC_Carb_reg)
Obese_TE_LPC_Carb_reg_coef <- as.data.frame(Obese_TE_LPC_Carb_reg_sm$coefficients)
Obese_TE_LPC_Carb_reg_coef$LipidGroup <- "LPC"
Obese_TE_LPC_Carb_reg_coef$MetaReg <- "Carb"
Obese_TE_LPC_Carb_reg_coef <- Obese_TE_LPC_Carb_reg_coef[-c(1),]
Obese_TE_LPC_Carb_reg_coef$r_sq <- Obese_TE_LPC_Carb_reg_sm$adj.r.squared

Obese_TE_DG_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_TE_lm_sum2, LipidGroup=="Diglyceride"))
Obese_TE_DG_Carb_reg_sm <- summary(Obese_TE_DG_Carb_reg)
Obese_TE_DG_Carb_reg_coef <- as.data.frame(Obese_TE_DG_Carb_reg_sm$coefficients)
Obese_TE_DG_Carb_reg_coef$LipidGroup <- "DG"
Obese_TE_DG_Carb_reg_coef$MetaReg <- "Carb"
Obese_TE_DG_Carb_reg_coef <- Obese_TE_DG_Carb_reg_coef[-c(1),]
Obese_TE_DG_Carb_reg_coef$r_sq <- Obese_TE_DG_Carb_reg_sm$adj.r.squared

Obese_TE_TG_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_TE_lm_sum2, LipidGroup=="Triglyceride"))
Obese_TE_TG_Carb_reg_sm <- summary(Obese_TE_TG_Carb_reg)
Obese_TE_TG_Carb_reg_coef <- as.data.frame(Obese_TE_TG_Carb_reg_sm$coefficients)
Obese_TE_TG_Carb_reg_coef$LipidGroup <- "TG"
Obese_TE_TG_Carb_reg_coef$MetaReg <- "Carb"
Obese_TE_TG_Carb_reg_coef <- Obese_TE_TG_Carb_reg_coef[-c(1),]
Obese_TE_TG_Carb_reg_coef$r_sq <- Obese_TE_TG_Carb_reg_sm$adj.r.squared

Obese_TE_SM_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_TE_lm_sum2, LipidGroup=="Sphingomyelin"))
Obese_TE_SM_Carb_reg_sm <- summary(Obese_TE_SM_Carb_reg)
Obese_TE_SM_Carb_reg_coef <- as.data.frame(Obese_TE_SM_Carb_reg_sm$coefficients)
Obese_TE_SM_Carb_reg_coef$LipidGroup <- "SM"
Obese_TE_SM_Carb_reg_coef$MetaReg <- "Carb"
Obese_TE_SM_Carb_reg_coef <- Obese_TE_SM_Carb_reg_coef[-c(1),]
Obese_TE_SM_Carb_reg_coef$r_sq <- Obese_TE_SM_Carb_reg_sm$adj.r.squared

Obese_TE_PE_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_TE_lm_sum2, LipidGroup=="PE"))
Obese_TE_PE_Carb_reg_sm <- summary(Obese_TE_PE_Carb_reg)
Obese_TE_PE_Carb_reg_coef <- as.data.frame(Obese_TE_PE_Carb_reg_sm$coefficients)
Obese_TE_PE_Carb_reg_coef$LipidGroup <- "PE"
Obese_TE_PE_Carb_reg_coef$MetaReg <- "Carb"
Obese_TE_PE_Carb_reg_coef <- Obese_TE_PE_Carb_reg_coef[-c(1),]
Obese_TE_PE_Carb_reg_coef$r_sq <- Obese_TE_PE_Carb_reg_sm$adj.r.squared

Obese_TE_PS_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_TE_lm_sum2, LipidGroup=="PS"))
Obese_TE_PS_Carb_reg_sm <- summary(Obese_TE_PS_Carb_reg)
Obese_TE_PS_Carb_reg_coef <- as.data.frame(Obese_TE_PS_Carb_reg_sm$coefficients)
Obese_TE_PS_Carb_reg_coef$LipidGroup <- "PS"
Obese_TE_PS_Carb_reg_coef$MetaReg <- "Carb"
Obese_TE_PS_Carb_reg_coef <- Obese_TE_PS_Carb_reg_coef[-c(1),]
Obese_TE_PS_Carb_reg_coef$r_sq <- Obese_TE_PS_Carb_reg_sm$adj.r.squared

Obese_TE_PI_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_TE_lm_sum2, LipidGroup=="PI"))
Obese_TE_PI_Carb_reg_sm <- summary(Obese_TE_PI_Carb_reg)
Obese_TE_PI_Carb_reg_coef <- as.data.frame(Obese_TE_PI_Carb_reg_sm$coefficients)
Obese_TE_PI_Carb_reg_coef$LipidGroup <- "PI"
Obese_TE_PI_Carb_reg_coef$MetaReg <- "Carb"
Obese_TE_PI_Carb_reg_coef <- Obese_TE_PI_Carb_reg_coef[-c(1),]
Obese_TE_PI_Carb_reg_coef$r_sq <- Obese_TE_PI_Carb_reg_sm$adj.r.squared

Obese_TE_Cer_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_TE_lm_sum2, LipidGroup=="Ceramide"))
Obese_TE_Cer_Carb_reg_sm <- summary(Obese_TE_Cer_Carb_reg)
Obese_TE_Cer_Carb_reg_coef <- as.data.frame(Obese_TE_Cer_Carb_reg_sm$coefficients)
Obese_TE_Cer_Carb_reg_coef$LipidGroup <- "Cer"
Obese_TE_Cer_Carb_reg_coef$MetaReg <- "Carb"
Obese_TE_Cer_Carb_reg_coef <- Obese_TE_Cer_Carb_reg_coef[-c(1),]
Obese_TE_Cer_Carb_reg_coef$r_sq <- Obese_TE_Cer_Carb_reg_sm$adj.r.squared

Obese_TE_PG_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_TE_lm_sum2, LipidGroup=="PG"))
Obese_TE_PG_Carb_reg_sm <- summary(Obese_TE_PG_Carb_reg)
Obese_TE_PG_Carb_reg_coef <- as.data.frame(Obese_TE_PG_Carb_reg_sm$coefficients)
Obese_TE_PG_Carb_reg_coef$LipidGroup <- "PG"
Obese_TE_PG_Carb_reg_coef$MetaReg <- "Carb"
Obese_TE_PG_Carb_reg_coef <- Obese_TE_PG_Carb_reg_coef[-c(1),]
Obese_TE_PG_Carb_reg_coef$r_sq <- Obese_TE_PG_Carb_reg_sm$adj.r.squared

Obese_TE_Gang_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_TE_lm_sum2, LipidGroup=="Ganglioside"))
Obese_TE_Gang_Carb_reg_sm <- summary(Obese_TE_Gang_Carb_reg)
Obese_TE_Gang_Carb_reg_coef <- as.data.frame(Obese_TE_Gang_Carb_reg_sm$coefficients)
Obese_TE_Gang_Carb_reg_coef$LipidGroup <- "Gang"
Obese_TE_Gang_Carb_reg_coef$MetaReg <- "Carb"
Obese_TE_Gang_Carb_reg_coef <- Obese_TE_Gang_Carb_reg_coef[-c(1),]
Obese_TE_Gang_Carb_reg_coef$r_sq <- Obese_TE_Gang_Carb_reg_sm$adj.r.squared

Obese_TE_HexCer_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_TE_lm_sum2, LipidGroup=="Hexosylceramide"))
Obese_TE_HexCer_Carb_reg_sm <- summary(Obese_TE_HexCer_Carb_reg)
Obese_TE_HexCer_Carb_reg_coef <- as.data.frame(Obese_TE_HexCer_Carb_reg_sm$coefficients)
Obese_TE_HexCer_Carb_reg_coef$LipidGroup <- "HexCer"
Obese_TE_HexCer_Carb_reg_coef$MetaReg <- "Carb"
Obese_TE_HexCer_Carb_reg_coef <- Obese_TE_HexCer_Carb_reg_coef[-c(1),]
Obese_TE_HexCer_Carb_reg_coef$r_sq <- Obese_TE_HexCer_Carb_reg_sm$adj.r.squared

Obese_TE_LPE_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_TE_lm_sum2, LipidGroup=="LysoPE"))
Obese_TE_LPE_Carb_reg_sm <- summary(Obese_TE_LPE_Carb_reg)
Obese_TE_LPE_Carb_reg_coef <- as.data.frame(Obese_TE_LPE_Carb_reg_sm$coefficients)
Obese_TE_LPE_Carb_reg_coef$LipidGroup <- "LPE"
Obese_TE_LPE_Carb_reg_coef$MetaReg <- "Carb"
Obese_TE_LPE_Carb_reg_coef <- Obese_TE_LPE_Carb_reg_coef[-c(1),]
Obese_TE_LPE_Carb_reg_coef$r_sq <- Obese_TE_LPE_Carb_reg_sm$adj.r.squared

Obese_TE_LPI_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_TE_lm_sum2, LipidGroup=="LysoPI"))
Obese_TE_LPI_Carb_reg_sm <- summary(Obese_TE_LPI_Carb_reg)
Obese_TE_LPI_Carb_reg_coef <- as.data.frame(Obese_TE_LPI_Carb_reg_sm$coefficients)
Obese_TE_LPI_Carb_reg_coef$LipidGroup <- "LPI"
Obese_TE_LPI_Carb_reg_coef$MetaReg <- "Carb"
Obese_TE_LPI_Carb_reg_coef <- Obese_TE_LPI_Carb_reg_coef[-c(1),]
Obese_TE_LPI_Carb_reg_coef$r_sq <- Obese_TE_LPI_Carb_reg_sm$adj.r.squared

Obese_TE_Sphing_Carb_reg <- lm(beta ~ Carb, data=subset(obese_data_TE_lm_sum2, LipidGroup=="Sphingolipid"))
Obese_TE_Sphing_Carb_reg_sm <- summary(Obese_TE_Sphing_Carb_reg)
Obese_TE_Sphing_Carb_reg_coef <- as.data.frame(Obese_TE_Sphing_Carb_reg_sm$coefficients)
Obese_TE_Sphing_Carb_reg_coef$LipidGroup <- "Sphing"
Obese_TE_Sphing_Carb_reg_coef$MetaReg <- "Carb"
Obese_TE_Sphing_Carb_reg_coef <- Obese_TE_Sphing_Carb_reg_coef[-c(1),]
Obese_TE_Sphing_Carb_reg_coef$r_sq <- Obese_TE_Sphing_Carb_reg_sm$adj.r.squared


Obese_TE_Carb_metareg <- rbind(Obese_TE_PC_Carb_reg_coef, Obese_TE_LPC_Carb_reg_coef)
Obese_TE_Carb_metareg <- rbind(Obese_TE_Carb_metareg, Obese_TE_DG_Carb_reg_coef)
Obese_TE_Carb_metareg <- rbind(Obese_TE_Carb_metareg, Obese_TE_TG_Carb_reg_coef)
Obese_TE_Carb_metareg <- rbind(Obese_TE_Carb_metareg, Obese_TE_SM_Carb_reg_coef)
Obese_TE_Carb_metareg <- rbind(Obese_TE_Carb_metareg, Obese_TE_PE_Carb_reg_coef)
Obese_TE_Carb_metareg <- rbind(Obese_TE_Carb_metareg, Obese_TE_PS_Carb_reg_coef)
Obese_TE_Carb_metareg <- rbind(Obese_TE_Carb_metareg, Obese_TE_PI_Carb_reg_coef)
Obese_TE_Carb_metareg <- rbind(Obese_TE_Carb_metareg, Obese_TE_Cer_Carb_reg_coef)
Obese_TE_Carb_metareg <- rbind(Obese_TE_Carb_metareg, Obese_TE_PG_Carb_reg_coef)
Obese_TE_Carb_metareg <- rbind(Obese_TE_Carb_metareg, Obese_TE_Gang_Carb_reg_coef)
Obese_TE_Carb_metareg <- rbind(Obese_TE_Carb_metareg, Obese_TE_HexCer_Carb_reg_coef)
Obese_TE_Carb_metareg <- rbind(Obese_TE_Carb_metareg, Obese_TE_LPE_Carb_reg_coef)
Obese_TE_Carb_metareg <- rbind(Obese_TE_Carb_metareg, Obese_TE_LPI_Carb_reg_coef)
Obese_TE_Carb_metareg <- rbind(Obese_TE_Carb_metareg, Obese_TE_Sphing_Carb_reg_coef)

Obese_TE_metareg_summary <- rbind(Obese_TE_Carb_metareg, Obese_TE_db_metareg)
names(Obese_TE_metareg_summary)[names(Obese_TE_metareg_summary) == 'Pr(>|t|)'] <- 'pval'
Obese_TE_metareg_summary$qval <- p.adjust(Obese_TE_metareg_summary$pval, method = "hochberg")
write.table(Obese_TE_metareg_summary,file="Obese_TE_metareg_summary.csv",sep=",")


#### make meta-regression plots of specific beta vs db/carbon

Obese_TE_TG_db <- ggplot(subset(obese_data_TE_lm_sum2, LipidGroup %in% c("Triglyceride")), aes(x=db, y=beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in TG") + ylab("Beta-regression coefficient") + theme_classic() + theme(legend.position="right", legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) 
Obese_TE_TG_db

## + scale_x_continuous(breaks=seq(0,6,1), limits = c(0,6), expand = c(.05,0))
## + scale_y_continuous(breaks=seq(-.75,0.5,0.25), limits = c(-.75,0.5), expand = c(0,0))
## + annotate(geom = "text", x = 5, y = -.25, label = "italic(AdjR) ^ 2 == 0.06", parse = TRUE, size = 4)
## + annotate(geom = "text", x = 5, y = -.2, label = "P[slope] = 0.025", parse = FALSE, size = 4)

Obese_TE_SM_db <- ggplot(subset(obese_data_TE_lm_sum2, LipidGroup %in% c("Sphingomyelin")), aes(x=db, y=beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in SM") + ylab("Beta-regression coefficient") + theme_classic() + theme(legend.position="right", legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) 
Obese_TE_SM_db

Obese_TE_PC_db <- ggplot(subset(obese_data_TE_lm_sum2, LipidGroup %in% c("PC")), aes(x=db, y=beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in PC") + ylab("Beta-regression coefficient") + theme_classic() + theme(legend.position="right", legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) 
Obese_TE_PC_db

Obese_TE_SM_Carb <- ggplot(subset(obese_data_TE_lm_sum2, LipidGroup %in% c("Sphingomyelin")), aes(x=Carb, y=beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in SM") + ylab("Beta-regression coefficient") + theme_classic() + theme(legend.position="right", legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) 
Obese_TE_SM_Carb

Obese_TE_top <- plot_grid(Obese_TE_TG_db, Obese_TE_SM_db, ncol = 2, labels = c('A','B'), label_fontfamily = 'serif', label_fontface = 'bold', label_size = 22, align = 'w')
Obese_TE_bottom <- plot_grid(Obese_TE_PC_db, Obese_TE_SM_Carb, ncol = 2, labels = c('C','D'), label_fontfamily = 'serif', label_fontface = 'bold', label_size = 22, align = 'w', rel_widths = c(1.5, 1.5))

pdf(file="Obese_TE_metareg_sumfig_v1.pdf",width=16,height=12)
plot_grid(Obese_TE_top, Obese_TE_bottom, ncol = 1, rel_heights = c(1.0, 1.0))
dev.off()


## nil observed using CAP (very small number of individuals)

############################## ------ test associations of lipids with histology in NAFLD Bx cohorts ------- ################################

###

NAFLDBx_data <- subset(data_full2, Centre=="Rome")

## Regress NAS with lipids in NAFLDBx cohort
NAFLDBx_data_NAS_lm_full <- lapply(NAFLDBx_data[54:281], function(x) summary(lm(x ~ NAFLDBx_data$NAS + NAFLDBx_data$Sex + NAFLDBx_data$Age)))
NAFLDBx_data_NAS_lm <- lapply(NAFLDBx_data_NAS_lm_full, coef)
NAFLDBx_data_NAS_lm <- data.frame(NAFLDBx_data_NAS_lm)
NAFLDBx_data_NAS_lm <- t(NAFLDBx_data_NAS_lm)
NAFLDBx_data_NAS_lm = subset(NAFLDBx_data_NAS_lm, select = -c(1,3,4) )
NAFLDBx_data_NAS_lm <- data.frame(NAFLDBx_data_NAS_lm)
NAFLDBx_data_NAS_lm$annot <- rep(annotation$annotation, each=1, length.out=nrow(NAFLDBx_data_NAS_lm))
NAFLDBx_data_NAS_lm <- NAFLDBx_data_NAS_lm[order(NAFLDBx_data_NAS_lm$annot),]
NAFLDBx_data_NAS_lm_beta <- NAFLDBx_data_NAS_lm[1:((nrow(NAFLDBx_data_NAS_lm)/4)),]
NAFLDBx_data_NAS_lm_p <- NAFLDBx_data_NAS_lm[((nrow(NAFLDBx_data_NAS_lm)/4)+1):((nrow(NAFLDBx_data_NAS_lm)/4)*2),]
NAFLDBx_data_NAS_lm_SE <- NAFLDBx_data_NAS_lm[(((nrow(NAFLDBx_data_NAS_lm)/4)*2)+1):((nrow(NAFLDBx_data_NAS_lm)/4)*3),]
NAFLDBx_data_NAS_lm_t <- NAFLDBx_data_NAS_lm[(((nrow(NAFLDBx_data_NAS_lm)/4)*3)+1):(nrow(NAFLDBx_data_NAS_lm)),]

NAFLDBx_data_NAS_lm_beta$beta <- NAFLDBx_data_NAS_lm_beta$NAFLDBx_data.NAS
NAFLDBx_data_NAS_lm_beta = subset(NAFLDBx_data_NAS_lm_beta, select = -c(1,2))
NAFLDBx_data_NAS_lm_SE$SE <- NAFLDBx_data_NAS_lm_SE$NAFLDBx_data.NAS
NAFLDBx_data_NAS_lm_SE = subset(NAFLDBx_data_NAS_lm_SE, select = -c(1,2))
NAFLDBx_data_NAS_lm_p$p <- NAFLDBx_data_NAS_lm_p$NAFLDBx_data.NAS
NAFLDBx_data_NAS_lm_p = subset(NAFLDBx_data_NAS_lm_p, select = -c(1,2))
NAFLDBx_data_NAS_lm_t$t <- NAFLDBx_data_NAS_lm_t$NAFLDBx_data.NAS
NAFLDBx_data_NAS_lm_t = subset(NAFLDBx_data_NAS_lm_t, select = -c(1,2))

NAFLDBx_data_NAS_lm_beta$name <- row.names(NAFLDBx_data_NAS_lm_beta)
NAFLDBx_data_NAS_lm_beta$name2 = substr(NAFLDBx_data_NAS_lm_beta$name,1,nchar(NAFLDBx_data_NAS_lm_beta$name)-9)
NAFLDBx_data_NAS_lm_p$name <- row.names(NAFLDBx_data_NAS_lm_p)
NAFLDBx_data_NAS_lm_p$name2 = substr(NAFLDBx_data_NAS_lm_p$name,1,nchar(NAFLDBx_data_NAS_lm_p$name)-9)
NAFLDBx_data_NAS_lm_SE$name <- row.names(NAFLDBx_data_NAS_lm_SE)
NAFLDBx_data_NAS_lm_SE$name2 = substr(NAFLDBx_data_NAS_lm_SE$name,1,nchar(NAFLDBx_data_NAS_lm_SE$name)-11)
NAFLDBx_data_NAS_lm_t$name <- row.names(NAFLDBx_data_NAS_lm_t)
NAFLDBx_data_NAS_lm_t$name2 = substr(NAFLDBx_data_NAS_lm_t$name,1,nchar(NAFLDBx_data_NAS_lm_t$name)-8)

NAFLDBx_data_NAS_lm_sum <- merge(NAFLDBx_data_NAS_lm_beta, NAFLDBx_data_NAS_lm_SE, by="name2")
NAFLDBx_data_NAS_lm_sum <- merge(NAFLDBx_data_NAS_lm_sum, NAFLDBx_data_NAS_lm_p, by="name2")
NAFLDBx_data_NAS_lm_sum <- merge(NAFLDBx_data_NAS_lm_sum, NAFLDBx_data_NAS_lm_t, by="name2")

NAFLDBx_data_NAS_lm_sum = subset(NAFLDBx_data_NAS_lm_sum, select = c("name2","beta","SE","t","p"))
names(NAFLDBx_data_NAS_lm_sum)[names(NAFLDBx_data_NAS_lm_sum) == 'name2'] <- 'var'
NAFLDBx_data_NAS_lm_sum2 <- merge(Lipids_annotation, NAFLDBx_data_NAS_lm_sum, by="var")
NAFLDBx_data_NAS_lm_sum2$num <- nrow(NAFLDBx_data)
NAFLDBx_data_NAS_lm_sum2$sig <- NA
NAFLDBx_data_NAS_lm_sum2 <- NAFLDBx_data_NAS_lm_sum2 %>% mutate(sig = ifelse(p < lipid_sig, "Significant", "Not significant"))

NAFLDBx_data_NAS_lm_sum2$qval <- p.adjust(NAFLDBx_data_NAS_lm_sum2$p, method = "hochberg")
NAFLDBx_data_NAS_lm_sum2$negp <- -log10(NAFLDBx_data_NAS_lm_sum2$p)
write.table(NAFLDBx_data_NAS_lm_sum2,file="NAFLDBx_NAS_lm_summary.csv",sep=",")

#####

## volcano plot

pdf(file="NAFLDBx_NAS_lm_vol_v1.pdf",width=5,height=6)
NAFLDBx_NAS_vol <- ggplot(data= NAFLDBx_data_NAS_lm_sum2, aes(x=beta, y=negp, colour=LipidGroup)) + geom_point(alpha=0.4, size=1.75) + geom_text_repel(data = subset(NAFLDBx_data_NAS_lm_sum2, negp > 2.3), aes(label = var), size = 3, key_glyph = "point") + xlab("Beta-regression coefficient") + ylab("-log10 p-value") + theme_bw() + theme(legend.position="right")  + theme(plot.title = element_text(face = "bold")) + theme(plot.title = element_text(hjust = 0.2)) + ggtitle("Plasma lipids associated with NAS") + labs(color = "Lipid class")
NAFLDBx_NAS_vol
dev.off()


############


## identify trends using meta-regression with beta vs carbons & db

NAFLDBx_NAS_PC_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup=="PC"))
NAFLDBx_NAS_PC_db_reg_sm <- summary(NAFLDBx_NAS_PC_db_reg)
NAFLDBx_NAS_PC_db_reg_coef <- as.data.frame(NAFLDBx_NAS_PC_db_reg_sm$coefficients)
NAFLDBx_NAS_PC_db_reg_coef$LipidGroup <- "PC"
NAFLDBx_NAS_PC_db_reg_coef$MetaReg <- "db"
NAFLDBx_NAS_PC_db_reg_coef <- NAFLDBx_NAS_PC_db_reg_coef[-c(1),]
NAFLDBx_NAS_PC_db_reg_coef$r_sq <- NAFLDBx_NAS_PC_db_reg_sm$adj.r.squared

NAFLDBx_NAS_LPC_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup=="LysoPC"))
NAFLDBx_NAS_LPC_db_reg_sm <- summary(NAFLDBx_NAS_LPC_db_reg)
NAFLDBx_NAS_LPC_db_reg_coef <- as.data.frame(NAFLDBx_NAS_LPC_db_reg_sm$coefficients)
NAFLDBx_NAS_LPC_db_reg_coef$LipidGroup <- "LPC"
NAFLDBx_NAS_LPC_db_reg_coef$MetaReg <- "db"
NAFLDBx_NAS_LPC_db_reg_coef <- NAFLDBx_NAS_LPC_db_reg_coef[-c(1),]
NAFLDBx_NAS_LPC_db_reg_coef$r_sq <- NAFLDBx_NAS_LPC_db_reg_sm$adj.r.squared

NAFLDBx_NAS_DG_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup=="Diglyceride"))
NAFLDBx_NAS_DG_db_reg_sm <- summary(NAFLDBx_NAS_DG_db_reg)
NAFLDBx_NAS_DG_db_reg_coef <- as.data.frame(NAFLDBx_NAS_DG_db_reg_sm$coefficients)
NAFLDBx_NAS_DG_db_reg_coef$LipidGroup <- "DG"
NAFLDBx_NAS_DG_db_reg_coef$MetaReg <- "db"
NAFLDBx_NAS_DG_db_reg_coef <- NAFLDBx_NAS_DG_db_reg_coef[-c(1),]
NAFLDBx_NAS_DG_db_reg_coef$r_sq <- NAFLDBx_NAS_DG_db_reg_sm$adj.r.squared

NAFLDBx_NAS_TG_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup=="Triglyceride"))
NAFLDBx_NAS_TG_db_reg_sm <- summary(NAFLDBx_NAS_TG_db_reg)
NAFLDBx_NAS_TG_db_reg_coef <- as.data.frame(NAFLDBx_NAS_TG_db_reg_sm$coefficients)
NAFLDBx_NAS_TG_db_reg_coef$LipidGroup <- "TG"
NAFLDBx_NAS_TG_db_reg_coef$MetaReg <- "db"
NAFLDBx_NAS_TG_db_reg_coef <- NAFLDBx_NAS_TG_db_reg_coef[-c(1),]
NAFLDBx_NAS_TG_db_reg_coef$r_sq <- NAFLDBx_NAS_TG_db_reg_sm$adj.r.squared

NAFLDBx_NAS_SM_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup=="Sphingomyelin"))
NAFLDBx_NAS_SM_db_reg_sm <- summary(NAFLDBx_NAS_SM_db_reg)
NAFLDBx_NAS_SM_db_reg_coef <- as.data.frame(NAFLDBx_NAS_SM_db_reg_sm$coefficients)
NAFLDBx_NAS_SM_db_reg_coef$LipidGroup <- "SM"
NAFLDBx_NAS_SM_db_reg_coef$MetaReg <- "db"
NAFLDBx_NAS_SM_db_reg_coef <- NAFLDBx_NAS_SM_db_reg_coef[-c(1),]
NAFLDBx_NAS_SM_db_reg_coef$r_sq <- NAFLDBx_NAS_SM_db_reg_sm$adj.r.squared

NAFLDBx_NAS_PE_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup=="PE"))
NAFLDBx_NAS_PE_db_reg_sm <- summary(NAFLDBx_NAS_PE_db_reg)
NAFLDBx_NAS_PE_db_reg_coef <- as.data.frame(NAFLDBx_NAS_PE_db_reg_sm$coefficients)
NAFLDBx_NAS_PE_db_reg_coef$LipidGroup <- "PE"
NAFLDBx_NAS_PE_db_reg_coef$MetaReg <- "db"
NAFLDBx_NAS_PE_db_reg_coef <- NAFLDBx_NAS_PE_db_reg_coef[-c(1),]
NAFLDBx_NAS_PE_db_reg_coef$r_sq <- NAFLDBx_NAS_PE_db_reg_sm$adj.r.squared

NAFLDBx_NAS_PS_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup=="PS"))
NAFLDBx_NAS_PS_db_reg_sm <- summary(NAFLDBx_NAS_PS_db_reg)
NAFLDBx_NAS_PS_db_reg_coef <- as.data.frame(NAFLDBx_NAS_PS_db_reg_sm$coefficients)
NAFLDBx_NAS_PS_db_reg_coef$LipidGroup <- "PS"
NAFLDBx_NAS_PS_db_reg_coef$MetaReg <- "db"
NAFLDBx_NAS_PS_db_reg_coef <- NAFLDBx_NAS_PS_db_reg_coef[-c(1),]
NAFLDBx_NAS_PS_db_reg_coef$r_sq <- NAFLDBx_NAS_PS_db_reg_sm$adj.r.squared

NAFLDBx_NAS_PI_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup=="PI"))
NAFLDBx_NAS_PI_db_reg_sm <- summary(NAFLDBx_NAS_PI_db_reg)
NAFLDBx_NAS_PI_db_reg_coef <- as.data.frame(NAFLDBx_NAS_PI_db_reg_sm$coefficients)
NAFLDBx_NAS_PI_db_reg_coef$LipidGroup <- "PI"
NAFLDBx_NAS_PI_db_reg_coef$MetaReg <- "db"
NAFLDBx_NAS_PI_db_reg_coef <- NAFLDBx_NAS_PI_db_reg_coef[-c(1),]
NAFLDBx_NAS_PI_db_reg_coef$r_sq <- NAFLDBx_NAS_PI_db_reg_sm$adj.r.squared

NAFLDBx_NAS_Cer_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup=="Ceramide"))
NAFLDBx_NAS_Cer_db_reg_sm <- summary(NAFLDBx_NAS_Cer_db_reg)
NAFLDBx_NAS_Cer_db_reg_coef <- as.data.frame(NAFLDBx_NAS_Cer_db_reg_sm$coefficients)
NAFLDBx_NAS_Cer_db_reg_coef$LipidGroup <- "Cer"
NAFLDBx_NAS_Cer_db_reg_coef$MetaReg <- "db"
NAFLDBx_NAS_Cer_db_reg_coef <- NAFLDBx_NAS_Cer_db_reg_coef[-c(1),]
NAFLDBx_NAS_Cer_db_reg_coef$r_sq <- NAFLDBx_NAS_Cer_db_reg_sm$adj.r.squared

NAFLDBx_NAS_PG_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup=="PG"))
NAFLDBx_NAS_PG_db_reg_sm <- summary(NAFLDBx_NAS_PG_db_reg)
NAFLDBx_NAS_PG_db_reg_coef <- as.data.frame(NAFLDBx_NAS_PG_db_reg_sm$coefficients)
NAFLDBx_NAS_PG_db_reg_coef$LipidGroup <- "PG"
NAFLDBx_NAS_PG_db_reg_coef$MetaReg <- "db"
NAFLDBx_NAS_PG_db_reg_coef <- NAFLDBx_NAS_PG_db_reg_coef[-c(1),]
NAFLDBx_NAS_PG_db_reg_coef$r_sq <- NAFLDBx_NAS_PG_db_reg_sm$adj.r.squared

NAFLDBx_NAS_Gang_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup=="Ganglioside"))
NAFLDBx_NAS_Gang_db_reg_sm <- summary(NAFLDBx_NAS_Gang_db_reg)
NAFLDBx_NAS_Gang_db_reg_coef <- as.data.frame(NAFLDBx_NAS_Gang_db_reg_sm$coefficients)
NAFLDBx_NAS_Gang_db_reg_coef$LipidGroup <- "Gang"
NAFLDBx_NAS_Gang_db_reg_coef$MetaReg <- "db"
NAFLDBx_NAS_Gang_db_reg_coef <- NAFLDBx_NAS_Gang_db_reg_coef[-c(1),]
NAFLDBx_NAS_Gang_db_reg_coef$r_sq <- NAFLDBx_NAS_Gang_db_reg_sm$adj.r.squared

NAFLDBx_NAS_HexCer_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup=="Hexosylceramide"))
NAFLDBx_NAS_HexCer_db_reg_sm <- summary(NAFLDBx_NAS_HexCer_db_reg)
NAFLDBx_NAS_HexCer_db_reg_coef <- as.data.frame(NAFLDBx_NAS_HexCer_db_reg_sm$coefficients)
NAFLDBx_NAS_HexCer_db_reg_coef$LipidGroup <- "HexCer"
NAFLDBx_NAS_HexCer_db_reg_coef$MetaReg <- "db"
NAFLDBx_NAS_HexCer_db_reg_coef <- NAFLDBx_NAS_HexCer_db_reg_coef[-c(1),]
NAFLDBx_NAS_HexCer_db_reg_coef$r_sq <- NAFLDBx_NAS_HexCer_db_reg_sm$adj.r.squared

NAFLDBx_NAS_LPE_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup=="LysoPE"))
NAFLDBx_NAS_LPE_db_reg_sm <- summary(NAFLDBx_NAS_LPE_db_reg)
NAFLDBx_NAS_LPE_db_reg_coef <- as.data.frame(NAFLDBx_NAS_LPE_db_reg_sm$coefficients)
NAFLDBx_NAS_LPE_db_reg_coef$LipidGroup <- "LPE"
NAFLDBx_NAS_LPE_db_reg_coef$MetaReg <- "db"
NAFLDBx_NAS_LPE_db_reg_coef <- NAFLDBx_NAS_LPE_db_reg_coef[-c(1),]
NAFLDBx_NAS_LPE_db_reg_coef$r_sq <- NAFLDBx_NAS_LPE_db_reg_sm$adj.r.squared

NAFLDBx_NAS_LPI_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup=="LysoPI"))
NAFLDBx_NAS_LPI_db_reg_sm <- summary(NAFLDBx_NAS_LPI_db_reg)
NAFLDBx_NAS_LPI_db_reg_coef <- as.data.frame(NAFLDBx_NAS_LPI_db_reg_sm$coefficients)
NAFLDBx_NAS_LPI_db_reg_coef$LipidGroup <- "LPI"
NAFLDBx_NAS_LPI_db_reg_coef$MetaReg <- "db"
NAFLDBx_NAS_LPI_db_reg_coef <- NAFLDBx_NAS_LPI_db_reg_coef[-c(1),]
NAFLDBx_NAS_LPI_db_reg_coef$r_sq <- NAFLDBx_NAS_LPI_db_reg_sm$adj.r.squared

NAFLDBx_NAS_Sphing_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup=="Sphingolipid"))
NAFLDBx_NAS_Sphing_db_reg_sm <- summary(NAFLDBx_NAS_Sphing_db_reg)
NAFLDBx_NAS_Sphing_db_reg_coef <- as.data.frame(NAFLDBx_NAS_Sphing_db_reg_sm$coefficients)
NAFLDBx_NAS_Sphing_db_reg_coef$LipidGroup <- "Sphing"
NAFLDBx_NAS_Sphing_db_reg_coef$MetaReg <- "db"
NAFLDBx_NAS_Sphing_db_reg_coef <- NAFLDBx_NAS_Sphing_db_reg_coef[-c(1),]
NAFLDBx_NAS_Sphing_db_reg_coef$r_sq <- NAFLDBx_NAS_Sphing_db_reg_sm$adj.r.squared

NAFLDBx_NAS_db_metareg <- rbind(NAFLDBx_NAS_PC_db_reg_coef, NAFLDBx_NAS_LPC_db_reg_coef)
NAFLDBx_NAS_db_metareg <- rbind(NAFLDBx_NAS_db_metareg, NAFLDBx_NAS_DG_db_reg_coef)
NAFLDBx_NAS_db_metareg <- rbind(NAFLDBx_NAS_db_metareg, NAFLDBx_NAS_TG_db_reg_coef)
NAFLDBx_NAS_db_metareg <- rbind(NAFLDBx_NAS_db_metareg, NAFLDBx_NAS_SM_db_reg_coef)
NAFLDBx_NAS_db_metareg <- rbind(NAFLDBx_NAS_db_metareg, NAFLDBx_NAS_PE_db_reg_coef)
NAFLDBx_NAS_db_metareg <- rbind(NAFLDBx_NAS_db_metareg, NAFLDBx_NAS_PS_db_reg_coef)
NAFLDBx_NAS_db_metareg <- rbind(NAFLDBx_NAS_db_metareg, NAFLDBx_NAS_PI_db_reg_coef)
NAFLDBx_NAS_db_metareg <- rbind(NAFLDBx_NAS_db_metareg, NAFLDBx_NAS_Cer_db_reg_coef)
NAFLDBx_NAS_db_metareg <- rbind(NAFLDBx_NAS_db_metareg, NAFLDBx_NAS_PG_db_reg_coef)
NAFLDBx_NAS_db_metareg <- rbind(NAFLDBx_NAS_db_metareg, NAFLDBx_NAS_Gang_db_reg_coef)
NAFLDBx_NAS_db_metareg <- rbind(NAFLDBx_NAS_db_metareg, NAFLDBx_NAS_HexCer_db_reg_coef)
NAFLDBx_NAS_db_metareg <- rbind(NAFLDBx_NAS_db_metareg, NAFLDBx_NAS_LPE_db_reg_coef)
NAFLDBx_NAS_db_metareg <- rbind(NAFLDBx_NAS_db_metareg, NAFLDBx_NAS_LPI_db_reg_coef)
NAFLDBx_NAS_db_metareg <- rbind(NAFLDBx_NAS_db_metareg, NAFLDBx_NAS_Sphing_db_reg_coef)

## run for carbons


NAFLDBx_NAS_PC_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup=="PC"))
NAFLDBx_NAS_PC_Carb_reg_sm <- summary(NAFLDBx_NAS_PC_Carb_reg)
NAFLDBx_NAS_PC_Carb_reg_coef <- as.data.frame(NAFLDBx_NAS_PC_Carb_reg_sm$coefficients)
NAFLDBx_NAS_PC_Carb_reg_coef$LipidGroup <- "PC"
NAFLDBx_NAS_PC_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_NAS_PC_Carb_reg_coef <- NAFLDBx_NAS_PC_Carb_reg_coef[-c(1),]
NAFLDBx_NAS_PC_Carb_reg_coef$r_sq <- NAFLDBx_NAS_PC_Carb_reg_sm$adj.r.squared

NAFLDBx_NAS_LPC_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup=="LysoPC"))
NAFLDBx_NAS_LPC_Carb_reg_sm <- summary(NAFLDBx_NAS_LPC_Carb_reg)
NAFLDBx_NAS_LPC_Carb_reg_coef <- as.data.frame(NAFLDBx_NAS_LPC_Carb_reg_sm$coefficients)
NAFLDBx_NAS_LPC_Carb_reg_coef$LipidGroup <- "LPC"
NAFLDBx_NAS_LPC_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_NAS_LPC_Carb_reg_coef <- NAFLDBx_NAS_LPC_Carb_reg_coef[-c(1),]
NAFLDBx_NAS_LPC_Carb_reg_coef$r_sq <- NAFLDBx_NAS_LPC_Carb_reg_sm$adj.r.squared

NAFLDBx_NAS_DG_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup=="Diglyceride"))
NAFLDBx_NAS_DG_Carb_reg_sm <- summary(NAFLDBx_NAS_DG_Carb_reg)
NAFLDBx_NAS_DG_Carb_reg_coef <- as.data.frame(NAFLDBx_NAS_DG_Carb_reg_sm$coefficients)
NAFLDBx_NAS_DG_Carb_reg_coef$LipidGroup <- "DG"
NAFLDBx_NAS_DG_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_NAS_DG_Carb_reg_coef <- NAFLDBx_NAS_DG_Carb_reg_coef[-c(1),]
NAFLDBx_NAS_DG_Carb_reg_coef$r_sq <- NAFLDBx_NAS_DG_Carb_reg_sm$adj.r.squared

NAFLDBx_NAS_TG_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup=="Triglyceride"))
NAFLDBx_NAS_TG_Carb_reg_sm <- summary(NAFLDBx_NAS_TG_Carb_reg)
NAFLDBx_NAS_TG_Carb_reg_coef <- as.data.frame(NAFLDBx_NAS_TG_Carb_reg_sm$coefficients)
NAFLDBx_NAS_TG_Carb_reg_coef$LipidGroup <- "TG"
NAFLDBx_NAS_TG_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_NAS_TG_Carb_reg_coef <- NAFLDBx_NAS_TG_Carb_reg_coef[-c(1),]
NAFLDBx_NAS_TG_Carb_reg_coef$r_sq <- NAFLDBx_NAS_TG_Carb_reg_sm$adj.r.squared

NAFLDBx_NAS_SM_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup=="Sphingomyelin"))
NAFLDBx_NAS_SM_Carb_reg_sm <- summary(NAFLDBx_NAS_SM_Carb_reg)
NAFLDBx_NAS_SM_Carb_reg_coef <- as.data.frame(NAFLDBx_NAS_SM_Carb_reg_sm$coefficients)
NAFLDBx_NAS_SM_Carb_reg_coef$LipidGroup <- "SM"
NAFLDBx_NAS_SM_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_NAS_SM_Carb_reg_coef <- NAFLDBx_NAS_SM_Carb_reg_coef[-c(1),]
NAFLDBx_NAS_SM_Carb_reg_coef$r_sq <- NAFLDBx_NAS_SM_Carb_reg_sm$adj.r.squared

NAFLDBx_NAS_PE_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup=="PE"))
NAFLDBx_NAS_PE_Carb_reg_sm <- summary(NAFLDBx_NAS_PE_Carb_reg)
NAFLDBx_NAS_PE_Carb_reg_coef <- as.data.frame(NAFLDBx_NAS_PE_Carb_reg_sm$coefficients)
NAFLDBx_NAS_PE_Carb_reg_coef$LipidGroup <- "PE"
NAFLDBx_NAS_PE_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_NAS_PE_Carb_reg_coef <- NAFLDBx_NAS_PE_Carb_reg_coef[-c(1),]
NAFLDBx_NAS_PE_Carb_reg_coef$r_sq <- NAFLDBx_NAS_PE_Carb_reg_sm$adj.r.squared

NAFLDBx_NAS_PS_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup=="PS"))
NAFLDBx_NAS_PS_Carb_reg_sm <- summary(NAFLDBx_NAS_PS_Carb_reg)
NAFLDBx_NAS_PS_Carb_reg_coef <- as.data.frame(NAFLDBx_NAS_PS_Carb_reg_sm$coefficients)
NAFLDBx_NAS_PS_Carb_reg_coef$LipidGroup <- "PS"
NAFLDBx_NAS_PS_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_NAS_PS_Carb_reg_coef <- NAFLDBx_NAS_PS_Carb_reg_coef[-c(1),]
NAFLDBx_NAS_PS_Carb_reg_coef$r_sq <- NAFLDBx_NAS_PS_Carb_reg_sm$adj.r.squared

NAFLDBx_NAS_PI_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup=="PI"))
NAFLDBx_NAS_PI_Carb_reg_sm <- summary(NAFLDBx_NAS_PI_Carb_reg)
NAFLDBx_NAS_PI_Carb_reg_coef <- as.data.frame(NAFLDBx_NAS_PI_Carb_reg_sm$coefficients)
NAFLDBx_NAS_PI_Carb_reg_coef$LipidGroup <- "PI"
NAFLDBx_NAS_PI_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_NAS_PI_Carb_reg_coef <- NAFLDBx_NAS_PI_Carb_reg_coef[-c(1),]
NAFLDBx_NAS_PI_Carb_reg_coef$r_sq <- NAFLDBx_NAS_PI_Carb_reg_sm$adj.r.squared

NAFLDBx_NAS_Cer_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup=="Ceramide"))
NAFLDBx_NAS_Cer_Carb_reg_sm <- summary(NAFLDBx_NAS_Cer_Carb_reg)
NAFLDBx_NAS_Cer_Carb_reg_coef <- as.data.frame(NAFLDBx_NAS_Cer_Carb_reg_sm$coefficients)
NAFLDBx_NAS_Cer_Carb_reg_coef$LipidGroup <- "Cer"
NAFLDBx_NAS_Cer_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_NAS_Cer_Carb_reg_coef <- NAFLDBx_NAS_Cer_Carb_reg_coef[-c(1),]
NAFLDBx_NAS_Cer_Carb_reg_coef$r_sq <- NAFLDBx_NAS_Cer_Carb_reg_sm$adj.r.squared

NAFLDBx_NAS_PG_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup=="PG"))
NAFLDBx_NAS_PG_Carb_reg_sm <- summary(NAFLDBx_NAS_PG_Carb_reg)
NAFLDBx_NAS_PG_Carb_reg_coef <- as.data.frame(NAFLDBx_NAS_PG_Carb_reg_sm$coefficients)
NAFLDBx_NAS_PG_Carb_reg_coef$LipidGroup <- "PG"
NAFLDBx_NAS_PG_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_NAS_PG_Carb_reg_coef <- NAFLDBx_NAS_PG_Carb_reg_coef[-c(1),]
NAFLDBx_NAS_PG_Carb_reg_coef$r_sq <- NAFLDBx_NAS_PG_Carb_reg_sm$adj.r.squared

NAFLDBx_NAS_Gang_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup=="Ganglioside"))
NAFLDBx_NAS_Gang_Carb_reg_sm <- summary(NAFLDBx_NAS_Gang_Carb_reg)
NAFLDBx_NAS_Gang_Carb_reg_coef <- as.data.frame(NAFLDBx_NAS_Gang_Carb_reg_sm$coefficients)
NAFLDBx_NAS_Gang_Carb_reg_coef$LipidGroup <- "Gang"
NAFLDBx_NAS_Gang_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_NAS_Gang_Carb_reg_coef <- NAFLDBx_NAS_Gang_Carb_reg_coef[-c(1),]
NAFLDBx_NAS_Gang_Carb_reg_coef$r_sq <- NAFLDBx_NAS_Gang_Carb_reg_sm$adj.r.squared

NAFLDBx_NAS_HexCer_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup=="Hexosylceramide"))
NAFLDBx_NAS_HexCer_Carb_reg_sm <- summary(NAFLDBx_NAS_HexCer_Carb_reg)
NAFLDBx_NAS_HexCer_Carb_reg_coef <- as.data.frame(NAFLDBx_NAS_HexCer_Carb_reg_sm$coefficients)
NAFLDBx_NAS_HexCer_Carb_reg_coef$LipidGroup <- "HexCer"
NAFLDBx_NAS_HexCer_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_NAS_HexCer_Carb_reg_coef <- NAFLDBx_NAS_HexCer_Carb_reg_coef[-c(1),]
NAFLDBx_NAS_HexCer_Carb_reg_coef$r_sq <- NAFLDBx_NAS_HexCer_Carb_reg_sm$adj.r.squared

NAFLDBx_NAS_LPE_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup=="LysoPE"))
NAFLDBx_NAS_LPE_Carb_reg_sm <- summary(NAFLDBx_NAS_LPE_Carb_reg)
NAFLDBx_NAS_LPE_Carb_reg_coef <- as.data.frame(NAFLDBx_NAS_LPE_Carb_reg_sm$coefficients)
NAFLDBx_NAS_LPE_Carb_reg_coef$LipidGroup <- "LPE"
NAFLDBx_NAS_LPE_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_NAS_LPE_Carb_reg_coef <- NAFLDBx_NAS_LPE_Carb_reg_coef[-c(1),]
NAFLDBx_NAS_LPE_Carb_reg_coef$r_sq <- NAFLDBx_NAS_LPE_Carb_reg_sm$adj.r.squared

NAFLDBx_NAS_LPI_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup=="LysoPI"))
NAFLDBx_NAS_LPI_Carb_reg_sm <- summary(NAFLDBx_NAS_LPI_Carb_reg)
NAFLDBx_NAS_LPI_Carb_reg_coef <- as.data.frame(NAFLDBx_NAS_LPI_Carb_reg_sm$coefficients)
NAFLDBx_NAS_LPI_Carb_reg_coef$LipidGroup <- "LPI"
NAFLDBx_NAS_LPI_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_NAS_LPI_Carb_reg_coef <- NAFLDBx_NAS_LPI_Carb_reg_coef[-c(1),]
NAFLDBx_NAS_LPI_Carb_reg_coef$r_sq <- NAFLDBx_NAS_LPI_Carb_reg_sm$adj.r.squared

NAFLDBx_NAS_Sphing_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup=="Sphingolipid"))
NAFLDBx_NAS_Sphing_Carb_reg_sm <- summary(NAFLDBx_NAS_Sphing_Carb_reg)
NAFLDBx_NAS_Sphing_Carb_reg_coef <- as.data.frame(NAFLDBx_NAS_Sphing_Carb_reg_sm$coefficients)
NAFLDBx_NAS_Sphing_Carb_reg_coef$LipidGroup <- "Sphing"
NAFLDBx_NAS_Sphing_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_NAS_Sphing_Carb_reg_coef <- NAFLDBx_NAS_Sphing_Carb_reg_coef[-c(1),]
NAFLDBx_NAS_Sphing_Carb_reg_coef$r_sq <- NAFLDBx_NAS_Sphing_Carb_reg_sm$adj.r.squared


NAFLDBx_NAS_Carb_metareg <- rbind(NAFLDBx_NAS_PC_Carb_reg_coef, NAFLDBx_NAS_LPC_Carb_reg_coef)
NAFLDBx_NAS_Carb_metareg <- rbind(NAFLDBx_NAS_Carb_metareg, NAFLDBx_NAS_DG_Carb_reg_coef)
NAFLDBx_NAS_Carb_metareg <- rbind(NAFLDBx_NAS_Carb_metareg, NAFLDBx_NAS_TG_Carb_reg_coef)
NAFLDBx_NAS_Carb_metareg <- rbind(NAFLDBx_NAS_Carb_metareg, NAFLDBx_NAS_SM_Carb_reg_coef)
NAFLDBx_NAS_Carb_metareg <- rbind(NAFLDBx_NAS_Carb_metareg, NAFLDBx_NAS_PE_Carb_reg_coef)
NAFLDBx_NAS_Carb_metareg <- rbind(NAFLDBx_NAS_Carb_metareg, NAFLDBx_NAS_PS_Carb_reg_coef)
NAFLDBx_NAS_Carb_metareg <- rbind(NAFLDBx_NAS_Carb_metareg, NAFLDBx_NAS_PI_Carb_reg_coef)
NAFLDBx_NAS_Carb_metareg <- rbind(NAFLDBx_NAS_Carb_metareg, NAFLDBx_NAS_Cer_Carb_reg_coef)
NAFLDBx_NAS_Carb_metareg <- rbind(NAFLDBx_NAS_Carb_metareg, NAFLDBx_NAS_PG_Carb_reg_coef)
NAFLDBx_NAS_Carb_metareg <- rbind(NAFLDBx_NAS_Carb_metareg, NAFLDBx_NAS_Gang_Carb_reg_coef)
NAFLDBx_NAS_Carb_metareg <- rbind(NAFLDBx_NAS_Carb_metareg, NAFLDBx_NAS_HexCer_Carb_reg_coef)
NAFLDBx_NAS_Carb_metareg <- rbind(NAFLDBx_NAS_Carb_metareg, NAFLDBx_NAS_LPE_Carb_reg_coef)
NAFLDBx_NAS_Carb_metareg <- rbind(NAFLDBx_NAS_Carb_metareg, NAFLDBx_NAS_LPI_Carb_reg_coef)
NAFLDBx_NAS_Carb_metareg <- rbind(NAFLDBx_NAS_Carb_metareg, NAFLDBx_NAS_Sphing_Carb_reg_coef)

NAFLDBx_NAS_metareg_summary <- rbind(NAFLDBx_NAS_Carb_metareg, NAFLDBx_NAS_db_metareg)
names(NAFLDBx_NAS_metareg_summary)[names(NAFLDBx_NAS_metareg_summary) == 'Pr(>|t|)'] <- 'pval'
NAFLDBx_NAS_metareg_summary$qval <- p.adjust(NAFLDBx_NAS_metareg_summary$pval, method = "hochberg")
write.table(NAFLDBx_NAS_metareg_summary,file="NAFLDBx_NAS_metareg_summary.csv",sep=",")



#### make meta-regression plots of specific beta vs db/carbon

NAFLDBx_NAS_TG_db <- ggplot(subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup %in% c("Triglyceride")), aes(x=db, y=beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in TG") + ylab("Beta-regression coefficient") + theme_classic() + theme(legend.position="right", legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) 
NAFLDBx_NAS_TG_db

## + scale_x_continuous(breaks=seq(0,6,1), limits = c(0,6), expand = c(.05,0))
## + scale_y_continuous(breaks=seq(-.75,0.5,0.25), limits = c(-.75,0.5), expand = c(0,0))
## + annotate(geom = "text", x = 5, y = -.25, label = "italic(AdjR) ^ 2 == 0.06", parse = TRUE, size = 4)
## + annotate(geom = "text", x = 5, y = -.2, label = "P[slope] = 0.025", parse = FALSE, size = 4)

NAFLDBx_NAS_SM_db <- ggplot(subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup %in% c("Sphingomyelin")), aes(x=db, y=beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in SM") + ylab("Beta-regression coefficient") + theme_classic() + theme(legend.position="right", legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) 
NAFLDBx_NAS_SM_db

NAFLDBx_NAS_PC_db <- ggplot(subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup %in% c("PC")), aes(x=db, y=beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in PC") + ylab("Beta-regression coefficient") + theme_classic() + theme(legend.position="right", legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) 
NAFLDBx_NAS_PC_db

NAFLDBx_NAS_PC_Carb <- ggplot(subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup %in% c("PC")), aes(x=Carb, y=beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in PC") + ylab("Beta-regression coefficient") + theme_classic() + theme(legend.position="right", legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) 
NAFLDBx_NAS_PC_Carb

NAFLDBx_NAS_top <- plot_grid(NAFLDBx_NAS_TG_db, NAFLDBx_NAS_SM_db, ncol = 2, labels = c('A','B'), label_fontfamily = 'serif', label_fontface = 'bold', label_size = 22, align = 'w')
NAFLDBx_NAS_bottom <- plot_grid(NAFLDBx_NAS_PC_db, NAFLDBx_NAS_PC_Carb, ncol = 2, labels = c('C','D'), label_fontfamily = 'serif', label_fontface = 'bold', label_size = 22, align = 'w', rel_widths = c(1.5, 1.5))

pdf(file="NAFLDBx_NAS_metareg_sumfig_v1.pdf",width=16,height=12)
plot_grid(NAFLDBx_NAS_top, NAFLDBx_NAS_bottom, ncol = 1, rel_heights = c(1.0, 1.0))
dev.off()

#### examine whether the relationship is the same for just steatosis, portal inflammation, fibrosis

## Regress Steat with lipids in NAFLDBx cohort
NAFLDBx_data_Steat_lm_full <- lapply(NAFLDBx_data[54:281], function(x) summary(lm(x ~ NAFLDBx_data$Steat + NAFLDBx_data$Sex + NAFLDBx_data$Age)))
NAFLDBx_data_Steat_lm <- lapply(NAFLDBx_data_Steat_lm_full, coef)
NAFLDBx_data_Steat_lm <- data.frame(NAFLDBx_data_Steat_lm)
NAFLDBx_data_Steat_lm <- t(NAFLDBx_data_Steat_lm)
NAFLDBx_data_Steat_lm = subset(NAFLDBx_data_Steat_lm, select = -c(1,3,4) )
NAFLDBx_data_Steat_lm <- data.frame(NAFLDBx_data_Steat_lm)
NAFLDBx_data_Steat_lm$annot <- rep(annotation$annotation, each=1, length.out=nrow(NAFLDBx_data_Steat_lm))
NAFLDBx_data_Steat_lm <- NAFLDBx_data_Steat_lm[order(NAFLDBx_data_Steat_lm$annot),]
NAFLDBx_data_Steat_lm_beta <- NAFLDBx_data_Steat_lm[1:((nrow(NAFLDBx_data_Steat_lm)/4)),]
NAFLDBx_data_Steat_lm_p <- NAFLDBx_data_Steat_lm[((nrow(NAFLDBx_data_Steat_lm)/4)+1):((nrow(NAFLDBx_data_Steat_lm)/4)*2),]
NAFLDBx_data_Steat_lm_SE <- NAFLDBx_data_Steat_lm[(((nrow(NAFLDBx_data_Steat_lm)/4)*2)+1):((nrow(NAFLDBx_data_Steat_lm)/4)*3),]
NAFLDBx_data_Steat_lm_t <- NAFLDBx_data_Steat_lm[(((nrow(NAFLDBx_data_Steat_lm)/4)*3)+1):(nrow(NAFLDBx_data_Steat_lm)),]

NAFLDBx_data_Steat_lm_beta$beta <- NAFLDBx_data_Steat_lm_beta$NAFLDBx_data.Steat
NAFLDBx_data_Steat_lm_beta = subset(NAFLDBx_data_Steat_lm_beta, select = -c(1,2))
NAFLDBx_data_Steat_lm_SE$SE <- NAFLDBx_data_Steat_lm_SE$NAFLDBx_data.Steat
NAFLDBx_data_Steat_lm_SE = subset(NAFLDBx_data_Steat_lm_SE, select = -c(1,2))
NAFLDBx_data_Steat_lm_p$p <- NAFLDBx_data_Steat_lm_p$NAFLDBx_data.Steat
NAFLDBx_data_Steat_lm_p = subset(NAFLDBx_data_Steat_lm_p, select = -c(1,2))
NAFLDBx_data_Steat_lm_t$t <- NAFLDBx_data_Steat_lm_t$NAFLDBx_data.Steat
NAFLDBx_data_Steat_lm_t = subset(NAFLDBx_data_Steat_lm_t, select = -c(1,2))

NAFLDBx_data_Steat_lm_beta$name <- row.names(NAFLDBx_data_Steat_lm_beta)
NAFLDBx_data_Steat_lm_beta$name2 = substr(NAFLDBx_data_Steat_lm_beta$name,1,nchar(NAFLDBx_data_Steat_lm_beta$name)-9)
NAFLDBx_data_Steat_lm_p$name <- row.names(NAFLDBx_data_Steat_lm_p)
NAFLDBx_data_Steat_lm_p$name2 = substr(NAFLDBx_data_Steat_lm_p$name,1,nchar(NAFLDBx_data_Steat_lm_p$name)-9)
NAFLDBx_data_Steat_lm_SE$name <- row.names(NAFLDBx_data_Steat_lm_SE)
NAFLDBx_data_Steat_lm_SE$name2 = substr(NAFLDBx_data_Steat_lm_SE$name,1,nchar(NAFLDBx_data_Steat_lm_SE$name)-11)
NAFLDBx_data_Steat_lm_t$name <- row.names(NAFLDBx_data_Steat_lm_t)
NAFLDBx_data_Steat_lm_t$name2 = substr(NAFLDBx_data_Steat_lm_t$name,1,nchar(NAFLDBx_data_Steat_lm_t$name)-8)

NAFLDBx_data_Steat_lm_sum <- merge(NAFLDBx_data_Steat_lm_beta, NAFLDBx_data_Steat_lm_SE, by="name2")
NAFLDBx_data_Steat_lm_sum <- merge(NAFLDBx_data_Steat_lm_sum, NAFLDBx_data_Steat_lm_p, by="name2")
NAFLDBx_data_Steat_lm_sum <- merge(NAFLDBx_data_Steat_lm_sum, NAFLDBx_data_Steat_lm_t, by="name2")

NAFLDBx_data_Steat_lm_sum = subset(NAFLDBx_data_Steat_lm_sum, select = c("name2","beta","SE","t","p"))
names(NAFLDBx_data_Steat_lm_sum)[names(NAFLDBx_data_Steat_lm_sum) == 'name2'] <- 'var'
NAFLDBx_data_Steat_lm_sum2 <- merge(Lipids_annotation, NAFLDBx_data_Steat_lm_sum, by="var")
NAFLDBx_data_Steat_lm_sum2$num <- nrow(NAFLDBx_data)
NAFLDBx_data_Steat_lm_sum2$sig <- NA
NAFLDBx_data_Steat_lm_sum2 <- NAFLDBx_data_Steat_lm_sum2 %>% mutate(sig = ifelse(p < lipid_sig, "Significant", "Not significant"))

NAFLDBx_data_Steat_lm_sum2$qval <- p.adjust(NAFLDBx_data_Steat_lm_sum2$p, method = "hochberg")
NAFLDBx_data_Steat_lm_sum2$negp <- -log10(NAFLDBx_data_Steat_lm_sum2$p)
write.table(NAFLDBx_data_Steat_lm_sum2,file="NAFLDBx_Steat_lm_summary.csv",sep=",")

#####

## volcano plot

pdf(file="NAFLDBx_Steat_lm_vol_v1.pdf",width=5,height=6)
NAFLDBx_Steat_vol <- ggplot(data= NAFLDBx_data_Steat_lm_sum2, aes(x=beta, y=negp, colour=LipidGroup)) + geom_point(alpha=0.4, size=1.75) + geom_text_repel(data = subset(NAFLDBx_data_Steat_lm_sum2, negp > 2.3), aes(label = var), size = 3, key_glyph = "point") + xlab("Beta-regression coefficient") + ylab("-log10 p-value") + theme_bw() + theme(legend.position="right")  + theme(plot.title = element_text(face = "bold")) + theme(plot.title = element_text(hjust = 0.2)) + ggtitle("Plasma lipids associated with Steat") + labs(color = "Lipid class")
NAFLDBx_Steat_vol
dev.off()


############


## identify trends using meta-regression with beta vs carbons & db

NAFLDBx_Steat_PC_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Steat_lm_sum2, LipidGroup=="PC"))
NAFLDBx_Steat_PC_db_reg_sm <- summary(NAFLDBx_Steat_PC_db_reg)
NAFLDBx_Steat_PC_db_reg_coef <- as.data.frame(NAFLDBx_Steat_PC_db_reg_sm$coefficients)
NAFLDBx_Steat_PC_db_reg_coef$LipidGroup <- "PC"
NAFLDBx_Steat_PC_db_reg_coef$MetaReg <- "db"
NAFLDBx_Steat_PC_db_reg_coef <- NAFLDBx_Steat_PC_db_reg_coef[-c(1),]
NAFLDBx_Steat_PC_db_reg_coef$r_sq <- NAFLDBx_Steat_PC_db_reg_sm$adj.r.squared

NAFLDBx_Steat_LPC_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Steat_lm_sum2, LipidGroup=="LysoPC"))
NAFLDBx_Steat_LPC_db_reg_sm <- summary(NAFLDBx_Steat_LPC_db_reg)
NAFLDBx_Steat_LPC_db_reg_coef <- as.data.frame(NAFLDBx_Steat_LPC_db_reg_sm$coefficients)
NAFLDBx_Steat_LPC_db_reg_coef$LipidGroup <- "LPC"
NAFLDBx_Steat_LPC_db_reg_coef$MetaReg <- "db"
NAFLDBx_Steat_LPC_db_reg_coef <- NAFLDBx_Steat_LPC_db_reg_coef[-c(1),]
NAFLDBx_Steat_LPC_db_reg_coef$r_sq <- NAFLDBx_Steat_LPC_db_reg_sm$adj.r.squared

NAFLDBx_Steat_DG_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Steat_lm_sum2, LipidGroup=="Diglyceride"))
NAFLDBx_Steat_DG_db_reg_sm <- summary(NAFLDBx_Steat_DG_db_reg)
NAFLDBx_Steat_DG_db_reg_coef <- as.data.frame(NAFLDBx_Steat_DG_db_reg_sm$coefficients)
NAFLDBx_Steat_DG_db_reg_coef$LipidGroup <- "DG"
NAFLDBx_Steat_DG_db_reg_coef$MetaReg <- "db"
NAFLDBx_Steat_DG_db_reg_coef <- NAFLDBx_Steat_DG_db_reg_coef[-c(1),]
NAFLDBx_Steat_DG_db_reg_coef$r_sq <- NAFLDBx_Steat_DG_db_reg_sm$adj.r.squared

NAFLDBx_Steat_TG_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Steat_lm_sum2, LipidGroup=="Triglyceride"))
NAFLDBx_Steat_TG_db_reg_sm <- summary(NAFLDBx_Steat_TG_db_reg)
NAFLDBx_Steat_TG_db_reg_coef <- as.data.frame(NAFLDBx_Steat_TG_db_reg_sm$coefficients)
NAFLDBx_Steat_TG_db_reg_coef$LipidGroup <- "TG"
NAFLDBx_Steat_TG_db_reg_coef$MetaReg <- "db"
NAFLDBx_Steat_TG_db_reg_coef <- NAFLDBx_Steat_TG_db_reg_coef[-c(1),]
NAFLDBx_Steat_TG_db_reg_coef$r_sq <- NAFLDBx_Steat_TG_db_reg_sm$adj.r.squared

NAFLDBx_Steat_SM_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Steat_lm_sum2, LipidGroup=="Sphingomyelin"))
NAFLDBx_Steat_SM_db_reg_sm <- summary(NAFLDBx_Steat_SM_db_reg)
NAFLDBx_Steat_SM_db_reg_coef <- as.data.frame(NAFLDBx_Steat_SM_db_reg_sm$coefficients)
NAFLDBx_Steat_SM_db_reg_coef$LipidGroup <- "SM"
NAFLDBx_Steat_SM_db_reg_coef$MetaReg <- "db"
NAFLDBx_Steat_SM_db_reg_coef <- NAFLDBx_Steat_SM_db_reg_coef[-c(1),]
NAFLDBx_Steat_SM_db_reg_coef$r_sq <- NAFLDBx_Steat_SM_db_reg_sm$adj.r.squared

NAFLDBx_Steat_PE_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Steat_lm_sum2, LipidGroup=="PE"))
NAFLDBx_Steat_PE_db_reg_sm <- summary(NAFLDBx_Steat_PE_db_reg)
NAFLDBx_Steat_PE_db_reg_coef <- as.data.frame(NAFLDBx_Steat_PE_db_reg_sm$coefficients)
NAFLDBx_Steat_PE_db_reg_coef$LipidGroup <- "PE"
NAFLDBx_Steat_PE_db_reg_coef$MetaReg <- "db"
NAFLDBx_Steat_PE_db_reg_coef <- NAFLDBx_Steat_PE_db_reg_coef[-c(1),]
NAFLDBx_Steat_PE_db_reg_coef$r_sq <- NAFLDBx_Steat_PE_db_reg_sm$adj.r.squared

NAFLDBx_Steat_PS_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Steat_lm_sum2, LipidGroup=="PS"))
NAFLDBx_Steat_PS_db_reg_sm <- summary(NAFLDBx_Steat_PS_db_reg)
NAFLDBx_Steat_PS_db_reg_coef <- as.data.frame(NAFLDBx_Steat_PS_db_reg_sm$coefficients)
NAFLDBx_Steat_PS_db_reg_coef$LipidGroup <- "PS"
NAFLDBx_Steat_PS_db_reg_coef$MetaReg <- "db"
NAFLDBx_Steat_PS_db_reg_coef <- NAFLDBx_Steat_PS_db_reg_coef[-c(1),]
NAFLDBx_Steat_PS_db_reg_coef$r_sq <- NAFLDBx_Steat_PS_db_reg_sm$adj.r.squared

NAFLDBx_Steat_PI_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Steat_lm_sum2, LipidGroup=="PI"))
NAFLDBx_Steat_PI_db_reg_sm <- summary(NAFLDBx_Steat_PI_db_reg)
NAFLDBx_Steat_PI_db_reg_coef <- as.data.frame(NAFLDBx_Steat_PI_db_reg_sm$coefficients)
NAFLDBx_Steat_PI_db_reg_coef$LipidGroup <- "PI"
NAFLDBx_Steat_PI_db_reg_coef$MetaReg <- "db"
NAFLDBx_Steat_PI_db_reg_coef <- NAFLDBx_Steat_PI_db_reg_coef[-c(1),]
NAFLDBx_Steat_PI_db_reg_coef$r_sq <- NAFLDBx_Steat_PI_db_reg_sm$adj.r.squared

NAFLDBx_Steat_Cer_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Steat_lm_sum2, LipidGroup=="Ceramide"))
NAFLDBx_Steat_Cer_db_reg_sm <- summary(NAFLDBx_Steat_Cer_db_reg)
NAFLDBx_Steat_Cer_db_reg_coef <- as.data.frame(NAFLDBx_Steat_Cer_db_reg_sm$coefficients)
NAFLDBx_Steat_Cer_db_reg_coef$LipidGroup <- "Cer"
NAFLDBx_Steat_Cer_db_reg_coef$MetaReg <- "db"
NAFLDBx_Steat_Cer_db_reg_coef <- NAFLDBx_Steat_Cer_db_reg_coef[-c(1),]
NAFLDBx_Steat_Cer_db_reg_coef$r_sq <- NAFLDBx_Steat_Cer_db_reg_sm$adj.r.squared

NAFLDBx_Steat_PG_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Steat_lm_sum2, LipidGroup=="PG"))
NAFLDBx_Steat_PG_db_reg_sm <- summary(NAFLDBx_Steat_PG_db_reg)
NAFLDBx_Steat_PG_db_reg_coef <- as.data.frame(NAFLDBx_Steat_PG_db_reg_sm$coefficients)
NAFLDBx_Steat_PG_db_reg_coef$LipidGroup <- "PG"
NAFLDBx_Steat_PG_db_reg_coef$MetaReg <- "db"
NAFLDBx_Steat_PG_db_reg_coef <- NAFLDBx_Steat_PG_db_reg_coef[-c(1),]
NAFLDBx_Steat_PG_db_reg_coef$r_sq <- NAFLDBx_Steat_PG_db_reg_sm$adj.r.squared

NAFLDBx_Steat_Gang_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Steat_lm_sum2, LipidGroup=="Ganglioside"))
NAFLDBx_Steat_Gang_db_reg_sm <- summary(NAFLDBx_Steat_Gang_db_reg)
NAFLDBx_Steat_Gang_db_reg_coef <- as.data.frame(NAFLDBx_Steat_Gang_db_reg_sm$coefficients)
NAFLDBx_Steat_Gang_db_reg_coef$LipidGroup <- "Gang"
NAFLDBx_Steat_Gang_db_reg_coef$MetaReg <- "db"
NAFLDBx_Steat_Gang_db_reg_coef <- NAFLDBx_Steat_Gang_db_reg_coef[-c(1),]
NAFLDBx_Steat_Gang_db_reg_coef$r_sq <- NAFLDBx_Steat_Gang_db_reg_sm$adj.r.squared

NAFLDBx_Steat_HexCer_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Steat_lm_sum2, LipidGroup=="Hexosylceramide"))
NAFLDBx_Steat_HexCer_db_reg_sm <- summary(NAFLDBx_Steat_HexCer_db_reg)
NAFLDBx_Steat_HexCer_db_reg_coef <- as.data.frame(NAFLDBx_Steat_HexCer_db_reg_sm$coefficients)
NAFLDBx_Steat_HexCer_db_reg_coef$LipidGroup <- "HexCer"
NAFLDBx_Steat_HexCer_db_reg_coef$MetaReg <- "db"
NAFLDBx_Steat_HexCer_db_reg_coef <- NAFLDBx_Steat_HexCer_db_reg_coef[-c(1),]
NAFLDBx_Steat_HexCer_db_reg_coef$r_sq <- NAFLDBx_Steat_HexCer_db_reg_sm$adj.r.squared

NAFLDBx_Steat_LPE_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Steat_lm_sum2, LipidGroup=="LysoPE"))
NAFLDBx_Steat_LPE_db_reg_sm <- summary(NAFLDBx_Steat_LPE_db_reg)
NAFLDBx_Steat_LPE_db_reg_coef <- as.data.frame(NAFLDBx_Steat_LPE_db_reg_sm$coefficients)
NAFLDBx_Steat_LPE_db_reg_coef$LipidGroup <- "LPE"
NAFLDBx_Steat_LPE_db_reg_coef$MetaReg <- "db"
NAFLDBx_Steat_LPE_db_reg_coef <- NAFLDBx_Steat_LPE_db_reg_coef[-c(1),]
NAFLDBx_Steat_LPE_db_reg_coef$r_sq <- NAFLDBx_Steat_LPE_db_reg_sm$adj.r.squared

NAFLDBx_Steat_LPI_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Steat_lm_sum2, LipidGroup=="LysoPI"))
NAFLDBx_Steat_LPI_db_reg_sm <- summary(NAFLDBx_Steat_LPI_db_reg)
NAFLDBx_Steat_LPI_db_reg_coef <- as.data.frame(NAFLDBx_Steat_LPI_db_reg_sm$coefficients)
NAFLDBx_Steat_LPI_db_reg_coef$LipidGroup <- "LPI"
NAFLDBx_Steat_LPI_db_reg_coef$MetaReg <- "db"
NAFLDBx_Steat_LPI_db_reg_coef <- NAFLDBx_Steat_LPI_db_reg_coef[-c(1),]
NAFLDBx_Steat_LPI_db_reg_coef$r_sq <- NAFLDBx_Steat_LPI_db_reg_sm$adj.r.squared

NAFLDBx_Steat_Sphing_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Steat_lm_sum2, LipidGroup=="Sphingolipid"))
NAFLDBx_Steat_Sphing_db_reg_sm <- summary(NAFLDBx_Steat_Sphing_db_reg)
NAFLDBx_Steat_Sphing_db_reg_coef <- as.data.frame(NAFLDBx_Steat_Sphing_db_reg_sm$coefficients)
NAFLDBx_Steat_Sphing_db_reg_coef$LipidGroup <- "Sphing"
NAFLDBx_Steat_Sphing_db_reg_coef$MetaReg <- "db"
NAFLDBx_Steat_Sphing_db_reg_coef <- NAFLDBx_Steat_Sphing_db_reg_coef[-c(1),]
NAFLDBx_Steat_Sphing_db_reg_coef$r_sq <- NAFLDBx_Steat_Sphing_db_reg_sm$adj.r.squared

NAFLDBx_Steat_db_metareg <- rbind(NAFLDBx_Steat_PC_db_reg_coef, NAFLDBx_Steat_LPC_db_reg_coef)
NAFLDBx_Steat_db_metareg <- rbind(NAFLDBx_Steat_db_metareg, NAFLDBx_Steat_DG_db_reg_coef)
NAFLDBx_Steat_db_metareg <- rbind(NAFLDBx_Steat_db_metareg, NAFLDBx_Steat_TG_db_reg_coef)
NAFLDBx_Steat_db_metareg <- rbind(NAFLDBx_Steat_db_metareg, NAFLDBx_Steat_SM_db_reg_coef)
NAFLDBx_Steat_db_metareg <- rbind(NAFLDBx_Steat_db_metareg, NAFLDBx_Steat_PE_db_reg_coef)
NAFLDBx_Steat_db_metareg <- rbind(NAFLDBx_Steat_db_metareg, NAFLDBx_Steat_PS_db_reg_coef)
NAFLDBx_Steat_db_metareg <- rbind(NAFLDBx_Steat_db_metareg, NAFLDBx_Steat_PI_db_reg_coef)
NAFLDBx_Steat_db_metareg <- rbind(NAFLDBx_Steat_db_metareg, NAFLDBx_Steat_Cer_db_reg_coef)
NAFLDBx_Steat_db_metareg <- rbind(NAFLDBx_Steat_db_metareg, NAFLDBx_Steat_PG_db_reg_coef)
NAFLDBx_Steat_db_metareg <- rbind(NAFLDBx_Steat_db_metareg, NAFLDBx_Steat_Gang_db_reg_coef)
NAFLDBx_Steat_db_metareg <- rbind(NAFLDBx_Steat_db_metareg, NAFLDBx_Steat_HexCer_db_reg_coef)
NAFLDBx_Steat_db_metareg <- rbind(NAFLDBx_Steat_db_metareg, NAFLDBx_Steat_LPE_db_reg_coef)
NAFLDBx_Steat_db_metareg <- rbind(NAFLDBx_Steat_db_metareg, NAFLDBx_Steat_LPI_db_reg_coef)
NAFLDBx_Steat_db_metareg <- rbind(NAFLDBx_Steat_db_metareg, NAFLDBx_Steat_Sphing_db_reg_coef)

## run for carbons


NAFLDBx_Steat_PC_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Steat_lm_sum2, LipidGroup=="PC"))
NAFLDBx_Steat_PC_Carb_reg_sm <- summary(NAFLDBx_Steat_PC_Carb_reg)
NAFLDBx_Steat_PC_Carb_reg_coef <- as.data.frame(NAFLDBx_Steat_PC_Carb_reg_sm$coefficients)
NAFLDBx_Steat_PC_Carb_reg_coef$LipidGroup <- "PC"
NAFLDBx_Steat_PC_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Steat_PC_Carb_reg_coef <- NAFLDBx_Steat_PC_Carb_reg_coef[-c(1),]
NAFLDBx_Steat_PC_Carb_reg_coef$r_sq <- NAFLDBx_Steat_PC_Carb_reg_sm$adj.r.squared

NAFLDBx_Steat_LPC_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Steat_lm_sum2, LipidGroup=="LysoPC"))
NAFLDBx_Steat_LPC_Carb_reg_sm <- summary(NAFLDBx_Steat_LPC_Carb_reg)
NAFLDBx_Steat_LPC_Carb_reg_coef <- as.data.frame(NAFLDBx_Steat_LPC_Carb_reg_sm$coefficients)
NAFLDBx_Steat_LPC_Carb_reg_coef$LipidGroup <- "LPC"
NAFLDBx_Steat_LPC_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Steat_LPC_Carb_reg_coef <- NAFLDBx_Steat_LPC_Carb_reg_coef[-c(1),]
NAFLDBx_Steat_LPC_Carb_reg_coef$r_sq <- NAFLDBx_Steat_LPC_Carb_reg_sm$adj.r.squared

NAFLDBx_Steat_DG_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Steat_lm_sum2, LipidGroup=="Diglyceride"))
NAFLDBx_Steat_DG_Carb_reg_sm <- summary(NAFLDBx_Steat_DG_Carb_reg)
NAFLDBx_Steat_DG_Carb_reg_coef <- as.data.frame(NAFLDBx_Steat_DG_Carb_reg_sm$coefficients)
NAFLDBx_Steat_DG_Carb_reg_coef$LipidGroup <- "DG"
NAFLDBx_Steat_DG_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Steat_DG_Carb_reg_coef <- NAFLDBx_Steat_DG_Carb_reg_coef[-c(1),]
NAFLDBx_Steat_DG_Carb_reg_coef$r_sq <- NAFLDBx_Steat_DG_Carb_reg_sm$adj.r.squared

NAFLDBx_Steat_TG_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Steat_lm_sum2, LipidGroup=="Triglyceride"))
NAFLDBx_Steat_TG_Carb_reg_sm <- summary(NAFLDBx_Steat_TG_Carb_reg)
NAFLDBx_Steat_TG_Carb_reg_coef <- as.data.frame(NAFLDBx_Steat_TG_Carb_reg_sm$coefficients)
NAFLDBx_Steat_TG_Carb_reg_coef$LipidGroup <- "TG"
NAFLDBx_Steat_TG_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Steat_TG_Carb_reg_coef <- NAFLDBx_Steat_TG_Carb_reg_coef[-c(1),]
NAFLDBx_Steat_TG_Carb_reg_coef$r_sq <- NAFLDBx_Steat_TG_Carb_reg_sm$adj.r.squared

NAFLDBx_Steat_SM_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Steat_lm_sum2, LipidGroup=="Sphingomyelin"))
NAFLDBx_Steat_SM_Carb_reg_sm <- summary(NAFLDBx_Steat_SM_Carb_reg)
NAFLDBx_Steat_SM_Carb_reg_coef <- as.data.frame(NAFLDBx_Steat_SM_Carb_reg_sm$coefficients)
NAFLDBx_Steat_SM_Carb_reg_coef$LipidGroup <- "SM"
NAFLDBx_Steat_SM_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Steat_SM_Carb_reg_coef <- NAFLDBx_Steat_SM_Carb_reg_coef[-c(1),]
NAFLDBx_Steat_SM_Carb_reg_coef$r_sq <- NAFLDBx_Steat_SM_Carb_reg_sm$adj.r.squared

NAFLDBx_Steat_PE_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Steat_lm_sum2, LipidGroup=="PE"))
NAFLDBx_Steat_PE_Carb_reg_sm <- summary(NAFLDBx_Steat_PE_Carb_reg)
NAFLDBx_Steat_PE_Carb_reg_coef <- as.data.frame(NAFLDBx_Steat_PE_Carb_reg_sm$coefficients)
NAFLDBx_Steat_PE_Carb_reg_coef$LipidGroup <- "PE"
NAFLDBx_Steat_PE_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Steat_PE_Carb_reg_coef <- NAFLDBx_Steat_PE_Carb_reg_coef[-c(1),]
NAFLDBx_Steat_PE_Carb_reg_coef$r_sq <- NAFLDBx_Steat_PE_Carb_reg_sm$adj.r.squared

NAFLDBx_Steat_PS_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Steat_lm_sum2, LipidGroup=="PS"))
NAFLDBx_Steat_PS_Carb_reg_sm <- summary(NAFLDBx_Steat_PS_Carb_reg)
NAFLDBx_Steat_PS_Carb_reg_coef <- as.data.frame(NAFLDBx_Steat_PS_Carb_reg_sm$coefficients)
NAFLDBx_Steat_PS_Carb_reg_coef$LipidGroup <- "PS"
NAFLDBx_Steat_PS_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Steat_PS_Carb_reg_coef <- NAFLDBx_Steat_PS_Carb_reg_coef[-c(1),]
NAFLDBx_Steat_PS_Carb_reg_coef$r_sq <- NAFLDBx_Steat_PS_Carb_reg_sm$adj.r.squared

NAFLDBx_Steat_PI_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Steat_lm_sum2, LipidGroup=="PI"))
NAFLDBx_Steat_PI_Carb_reg_sm <- summary(NAFLDBx_Steat_PI_Carb_reg)
NAFLDBx_Steat_PI_Carb_reg_coef <- as.data.frame(NAFLDBx_Steat_PI_Carb_reg_sm$coefficients)
NAFLDBx_Steat_PI_Carb_reg_coef$LipidGroup <- "PI"
NAFLDBx_Steat_PI_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Steat_PI_Carb_reg_coef <- NAFLDBx_Steat_PI_Carb_reg_coef[-c(1),]
NAFLDBx_Steat_PI_Carb_reg_coef$r_sq <- NAFLDBx_Steat_PI_Carb_reg_sm$adj.r.squared

NAFLDBx_Steat_Cer_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Steat_lm_sum2, LipidGroup=="Ceramide"))
NAFLDBx_Steat_Cer_Carb_reg_sm <- summary(NAFLDBx_Steat_Cer_Carb_reg)
NAFLDBx_Steat_Cer_Carb_reg_coef <- as.data.frame(NAFLDBx_Steat_Cer_Carb_reg_sm$coefficients)
NAFLDBx_Steat_Cer_Carb_reg_coef$LipidGroup <- "Cer"
NAFLDBx_Steat_Cer_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Steat_Cer_Carb_reg_coef <- NAFLDBx_Steat_Cer_Carb_reg_coef[-c(1),]
NAFLDBx_Steat_Cer_Carb_reg_coef$r_sq <- NAFLDBx_Steat_Cer_Carb_reg_sm$adj.r.squared

NAFLDBx_Steat_PG_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Steat_lm_sum2, LipidGroup=="PG"))
NAFLDBx_Steat_PG_Carb_reg_sm <- summary(NAFLDBx_Steat_PG_Carb_reg)
NAFLDBx_Steat_PG_Carb_reg_coef <- as.data.frame(NAFLDBx_Steat_PG_Carb_reg_sm$coefficients)
NAFLDBx_Steat_PG_Carb_reg_coef$LipidGroup <- "PG"
NAFLDBx_Steat_PG_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Steat_PG_Carb_reg_coef <- NAFLDBx_Steat_PG_Carb_reg_coef[-c(1),]
NAFLDBx_Steat_PG_Carb_reg_coef$r_sq <- NAFLDBx_Steat_PG_Carb_reg_sm$adj.r.squared

NAFLDBx_Steat_Gang_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Steat_lm_sum2, LipidGroup=="Ganglioside"))
NAFLDBx_Steat_Gang_Carb_reg_sm <- summary(NAFLDBx_Steat_Gang_Carb_reg)
NAFLDBx_Steat_Gang_Carb_reg_coef <- as.data.frame(NAFLDBx_Steat_Gang_Carb_reg_sm$coefficients)
NAFLDBx_Steat_Gang_Carb_reg_coef$LipidGroup <- "Gang"
NAFLDBx_Steat_Gang_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Steat_Gang_Carb_reg_coef <- NAFLDBx_Steat_Gang_Carb_reg_coef[-c(1),]
NAFLDBx_Steat_Gang_Carb_reg_coef$r_sq <- NAFLDBx_Steat_Gang_Carb_reg_sm$adj.r.squared

NAFLDBx_Steat_HexCer_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Steat_lm_sum2, LipidGroup=="Hexosylceramide"))
NAFLDBx_Steat_HexCer_Carb_reg_sm <- summary(NAFLDBx_Steat_HexCer_Carb_reg)
NAFLDBx_Steat_HexCer_Carb_reg_coef <- as.data.frame(NAFLDBx_Steat_HexCer_Carb_reg_sm$coefficients)
NAFLDBx_Steat_HexCer_Carb_reg_coef$LipidGroup <- "HexCer"
NAFLDBx_Steat_HexCer_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Steat_HexCer_Carb_reg_coef <- NAFLDBx_Steat_HexCer_Carb_reg_coef[-c(1),]
NAFLDBx_Steat_HexCer_Carb_reg_coef$r_sq <- NAFLDBx_Steat_HexCer_Carb_reg_sm$adj.r.squared

NAFLDBx_Steat_LPE_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Steat_lm_sum2, LipidGroup=="LysoPE"))
NAFLDBx_Steat_LPE_Carb_reg_sm <- summary(NAFLDBx_Steat_LPE_Carb_reg)
NAFLDBx_Steat_LPE_Carb_reg_coef <- as.data.frame(NAFLDBx_Steat_LPE_Carb_reg_sm$coefficients)
NAFLDBx_Steat_LPE_Carb_reg_coef$LipidGroup <- "LPE"
NAFLDBx_Steat_LPE_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Steat_LPE_Carb_reg_coef <- NAFLDBx_Steat_LPE_Carb_reg_coef[-c(1),]
NAFLDBx_Steat_LPE_Carb_reg_coef$r_sq <- NAFLDBx_Steat_LPE_Carb_reg_sm$adj.r.squared

NAFLDBx_Steat_LPI_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Steat_lm_sum2, LipidGroup=="LysoPI"))
NAFLDBx_Steat_LPI_Carb_reg_sm <- summary(NAFLDBx_Steat_LPI_Carb_reg)
NAFLDBx_Steat_LPI_Carb_reg_coef <- as.data.frame(NAFLDBx_Steat_LPI_Carb_reg_sm$coefficients)
NAFLDBx_Steat_LPI_Carb_reg_coef$LipidGroup <- "LPI"
NAFLDBx_Steat_LPI_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Steat_LPI_Carb_reg_coef <- NAFLDBx_Steat_LPI_Carb_reg_coef[-c(1),]
NAFLDBx_Steat_LPI_Carb_reg_coef$r_sq <- NAFLDBx_Steat_LPI_Carb_reg_sm$adj.r.squared

NAFLDBx_Steat_Sphing_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Steat_lm_sum2, LipidGroup=="Sphingolipid"))
NAFLDBx_Steat_Sphing_Carb_reg_sm <- summary(NAFLDBx_Steat_Sphing_Carb_reg)
NAFLDBx_Steat_Sphing_Carb_reg_coef <- as.data.frame(NAFLDBx_Steat_Sphing_Carb_reg_sm$coefficients)
NAFLDBx_Steat_Sphing_Carb_reg_coef$LipidGroup <- "Sphing"
NAFLDBx_Steat_Sphing_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Steat_Sphing_Carb_reg_coef <- NAFLDBx_Steat_Sphing_Carb_reg_coef[-c(1),]
NAFLDBx_Steat_Sphing_Carb_reg_coef$r_sq <- NAFLDBx_Steat_Sphing_Carb_reg_sm$adj.r.squared


NAFLDBx_Steat_Carb_metareg <- rbind(NAFLDBx_Steat_PC_Carb_reg_coef, NAFLDBx_Steat_LPC_Carb_reg_coef)
NAFLDBx_Steat_Carb_metareg <- rbind(NAFLDBx_Steat_Carb_metareg, NAFLDBx_Steat_DG_Carb_reg_coef)
NAFLDBx_Steat_Carb_metareg <- rbind(NAFLDBx_Steat_Carb_metareg, NAFLDBx_Steat_TG_Carb_reg_coef)
NAFLDBx_Steat_Carb_metareg <- rbind(NAFLDBx_Steat_Carb_metareg, NAFLDBx_Steat_SM_Carb_reg_coef)
NAFLDBx_Steat_Carb_metareg <- rbind(NAFLDBx_Steat_Carb_metareg, NAFLDBx_Steat_PE_Carb_reg_coef)
NAFLDBx_Steat_Carb_metareg <- rbind(NAFLDBx_Steat_Carb_metareg, NAFLDBx_Steat_PS_Carb_reg_coef)
NAFLDBx_Steat_Carb_metareg <- rbind(NAFLDBx_Steat_Carb_metareg, NAFLDBx_Steat_PI_Carb_reg_coef)
NAFLDBx_Steat_Carb_metareg <- rbind(NAFLDBx_Steat_Carb_metareg, NAFLDBx_Steat_Cer_Carb_reg_coef)
NAFLDBx_Steat_Carb_metareg <- rbind(NAFLDBx_Steat_Carb_metareg, NAFLDBx_Steat_PG_Carb_reg_coef)
NAFLDBx_Steat_Carb_metareg <- rbind(NAFLDBx_Steat_Carb_metareg, NAFLDBx_Steat_Gang_Carb_reg_coef)
NAFLDBx_Steat_Carb_metareg <- rbind(NAFLDBx_Steat_Carb_metareg, NAFLDBx_Steat_HexCer_Carb_reg_coef)
NAFLDBx_Steat_Carb_metareg <- rbind(NAFLDBx_Steat_Carb_metareg, NAFLDBx_Steat_LPE_Carb_reg_coef)
NAFLDBx_Steat_Carb_metareg <- rbind(NAFLDBx_Steat_Carb_metareg, NAFLDBx_Steat_LPI_Carb_reg_coef)
NAFLDBx_Steat_Carb_metareg <- rbind(NAFLDBx_Steat_Carb_metareg, NAFLDBx_Steat_Sphing_Carb_reg_coef)

NAFLDBx_Steat_metareg_summary <- rbind(NAFLDBx_Steat_Carb_metareg, NAFLDBx_Steat_db_metareg)
names(NAFLDBx_Steat_metareg_summary)[names(NAFLDBx_Steat_metareg_summary) == 'Pr(>|t|)'] <- 'pval'
NAFLDBx_Steat_metareg_summary$qval <- p.adjust(NAFLDBx_Steat_metareg_summary$pval, method = "hochberg")
write.table(NAFLDBx_Steat_metareg_summary,file="NAFLDBx_Steat_metareg_summary.csv",sep=",")



#### make meta-regression plots of specific beta vs db/carbon

NAFLDBx_Steat_TG_db <- ggplot(subset(NAFLDBx_data_Steat_lm_sum2, LipidGroup %in% c("Triglyceride")), aes(x=db, y=beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in TG") + ylab("Beta-regression coefficient") + theme_classic() + theme(legend.position="right", legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) 
NAFLDBx_Steat_TG_db

## + scale_x_continuous(breaks=seq(0,6,1), limits = c(0,6), expand = c(.05,0))
## + scale_y_continuous(breaks=seq(-.75,0.5,0.25), limits = c(-.75,0.5), expand = c(0,0))
## + annotate(geom = "text", x = 5, y = -.25, label = "italic(AdjR) ^ 2 == 0.06", parse = TRUE, size = 4)
## + annotate(geom = "text", x = 5, y = -.2, label = "P[slope] = 0.025", parse = FALSE, size = 4)

NAFLDBx_Steat_SM_db <- ggplot(subset(NAFLDBx_data_Steat_lm_sum2, LipidGroup %in% c("Sphingomyelin")), aes(x=db, y=beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in SM") + ylab("Beta-regression coefficient") + theme_classic() + theme(legend.position="right", legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) 
NAFLDBx_Steat_SM_db

NAFLDBx_Steat_PC_db <- ggplot(subset(NAFLDBx_data_Steat_lm_sum2, LipidGroup %in% c("PC")), aes(x=db, y=beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in PC") + ylab("Beta-regression coefficient") + theme_classic() + theme(legend.position="right", legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) 
NAFLDBx_Steat_PC_db

NAFLDBx_Steat_PC_Carb <- ggplot(subset(NAFLDBx_data_Steat_lm_sum2, LipidGroup %in% c("PC")), aes(x=Carb, y=beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in PC") + ylab("Beta-regression coefficient") + theme_classic() + theme(legend.position="right", legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) 
NAFLDBx_Steat_PC_Carb

NAFLDBx_Steat_top <- plot_grid(NAFLDBx_Steat_TG_db, NAFLDBx_Steat_SM_db, ncol = 2, labels = c('A','B'), label_fontfamily = 'serif', label_fontface = 'bold', label_size = 22, align = 'w')
NAFLDBx_Steat_bottom <- plot_grid(NAFLDBx_Steat_PC_db, NAFLDBx_Steat_PC_Carb, ncol = 2, labels = c('C','D'), label_fontfamily = 'serif', label_fontface = 'bold', label_size = 22, align = 'w', rel_widths = c(1.5, 1.5))

pdf(file="NAFLDBx_Steat_metareg_sumfig_v1.pdf",width=16,height=12)
plot_grid(NAFLDBx_Steat_top, NAFLDBx_Steat_bottom, ncol = 1, rel_heights = c(1.0, 1.0))
dev.off()

## for fibrosis

## Regress Fib with lipids in NAFLDBx cohort
NAFLDBx_data_Fib_lm_full <- lapply(NAFLDBx_data[54:281], function(x) summary(lm(x ~ NAFLDBx_data$Fib + NAFLDBx_data$Sex + NAFLDBx_data$Age)))
NAFLDBx_data_Fib_lm <- lapply(NAFLDBx_data_Fib_lm_full, coef)
NAFLDBx_data_Fib_lm <- data.frame(NAFLDBx_data_Fib_lm)
NAFLDBx_data_Fib_lm <- t(NAFLDBx_data_Fib_lm)
NAFLDBx_data_Fib_lm = subset(NAFLDBx_data_Fib_lm, select = -c(1,3,4) )
NAFLDBx_data_Fib_lm <- data.frame(NAFLDBx_data_Fib_lm)
NAFLDBx_data_Fib_lm$annot <- rep(annotation$annotation, each=1, length.out=nrow(NAFLDBx_data_Fib_lm))
NAFLDBx_data_Fib_lm <- NAFLDBx_data_Fib_lm[order(NAFLDBx_data_Fib_lm$annot),]
NAFLDBx_data_Fib_lm_beta <- NAFLDBx_data_Fib_lm[1:((nrow(NAFLDBx_data_Fib_lm)/4)),]
NAFLDBx_data_Fib_lm_p <- NAFLDBx_data_Fib_lm[((nrow(NAFLDBx_data_Fib_lm)/4)+1):((nrow(NAFLDBx_data_Fib_lm)/4)*2),]
NAFLDBx_data_Fib_lm_SE <- NAFLDBx_data_Fib_lm[(((nrow(NAFLDBx_data_Fib_lm)/4)*2)+1):((nrow(NAFLDBx_data_Fib_lm)/4)*3),]
NAFLDBx_data_Fib_lm_t <- NAFLDBx_data_Fib_lm[(((nrow(NAFLDBx_data_Fib_lm)/4)*3)+1):(nrow(NAFLDBx_data_Fib_lm)),]

NAFLDBx_data_Fib_lm_beta$beta <- NAFLDBx_data_Fib_lm_beta$NAFLDBx_data.Fib
NAFLDBx_data_Fib_lm_beta = subset(NAFLDBx_data_Fib_lm_beta, select = -c(1,2))
NAFLDBx_data_Fib_lm_SE$SE <- NAFLDBx_data_Fib_lm_SE$NAFLDBx_data.Fib
NAFLDBx_data_Fib_lm_SE = subset(NAFLDBx_data_Fib_lm_SE, select = -c(1,2))
NAFLDBx_data_Fib_lm_p$p <- NAFLDBx_data_Fib_lm_p$NAFLDBx_data.Fib
NAFLDBx_data_Fib_lm_p = subset(NAFLDBx_data_Fib_lm_p, select = -c(1,2))
NAFLDBx_data_Fib_lm_t$t <- NAFLDBx_data_Fib_lm_t$NAFLDBx_data.Fib
NAFLDBx_data_Fib_lm_t = subset(NAFLDBx_data_Fib_lm_t, select = -c(1,2))

NAFLDBx_data_Fib_lm_beta$name <- row.names(NAFLDBx_data_Fib_lm_beta)
NAFLDBx_data_Fib_lm_beta$name2 = substr(NAFLDBx_data_Fib_lm_beta$name,1,nchar(NAFLDBx_data_Fib_lm_beta$name)-9)
NAFLDBx_data_Fib_lm_p$name <- row.names(NAFLDBx_data_Fib_lm_p)
NAFLDBx_data_Fib_lm_p$name2 = substr(NAFLDBx_data_Fib_lm_p$name,1,nchar(NAFLDBx_data_Fib_lm_p$name)-9)
NAFLDBx_data_Fib_lm_SE$name <- row.names(NAFLDBx_data_Fib_lm_SE)
NAFLDBx_data_Fib_lm_SE$name2 = substr(NAFLDBx_data_Fib_lm_SE$name,1,nchar(NAFLDBx_data_Fib_lm_SE$name)-11)
NAFLDBx_data_Fib_lm_t$name <- row.names(NAFLDBx_data_Fib_lm_t)
NAFLDBx_data_Fib_lm_t$name2 = substr(NAFLDBx_data_Fib_lm_t$name,1,nchar(NAFLDBx_data_Fib_lm_t$name)-8)

NAFLDBx_data_Fib_lm_sum <- merge(NAFLDBx_data_Fib_lm_beta, NAFLDBx_data_Fib_lm_SE, by="name2")
NAFLDBx_data_Fib_lm_sum <- merge(NAFLDBx_data_Fib_lm_sum, NAFLDBx_data_Fib_lm_p, by="name2")
NAFLDBx_data_Fib_lm_sum <- merge(NAFLDBx_data_Fib_lm_sum, NAFLDBx_data_Fib_lm_t, by="name2")

NAFLDBx_data_Fib_lm_sum = subset(NAFLDBx_data_Fib_lm_sum, select = c("name2","beta","SE","t","p"))
names(NAFLDBx_data_Fib_lm_sum)[names(NAFLDBx_data_Fib_lm_sum) == 'name2'] <- 'var'
NAFLDBx_data_Fib_lm_sum2 <- merge(Lipids_annotation, NAFLDBx_data_Fib_lm_sum, by="var")
NAFLDBx_data_Fib_lm_sum2$num <- nrow(NAFLDBx_data)
NAFLDBx_data_Fib_lm_sum2$sig <- NA
NAFLDBx_data_Fib_lm_sum2 <- NAFLDBx_data_Fib_lm_sum2 %>% mutate(sig = ifelse(p < lipid_sig, "Significant", "Not significant"))

NAFLDBx_data_Fib_lm_sum2$qval <- p.adjust(NAFLDBx_data_Fib_lm_sum2$p, method = "hochberg")
NAFLDBx_data_Fib_lm_sum2$negp <- -log10(NAFLDBx_data_Fib_lm_sum2$p)
write.table(NAFLDBx_data_Fib_lm_sum2,file="NAFLDBx_Fib_lm_summary.csv",sep=",")

#####

## volcano plot

pdf(file="NAFLDBx_Fib_lm_vol_v1.pdf",width=5,height=6)
NAFLDBx_Fib_vol <- ggplot(data= NAFLDBx_data_Fib_lm_sum2, aes(x=beta, y=negp, colour=LipidGroup)) + geom_point(alpha=0.4, size=1.75) + geom_text_repel(data = subset(NAFLDBx_data_Fib_lm_sum2, negp > 2.3), aes(label = var), size = 3, key_glyph = "point") + xlab("Beta-regression coefficient") + ylab("-log10 p-value") + theme_bw() + theme(legend.position="right")  + theme(plot.title = element_text(face = "bold")) + theme(plot.title = element_text(hjust = 0.2)) + ggtitle("Plasma lipids associated with Fib") + labs(color = "Lipid class")
NAFLDBx_Fib_vol
dev.off()


############


## identify trends using meta-regression with beta vs carbons & db

NAFLDBx_Fib_PC_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Fib_lm_sum2, LipidGroup=="PC"))
NAFLDBx_Fib_PC_db_reg_sm <- summary(NAFLDBx_Fib_PC_db_reg)
NAFLDBx_Fib_PC_db_reg_coef <- as.data.frame(NAFLDBx_Fib_PC_db_reg_sm$coefficients)
NAFLDBx_Fib_PC_db_reg_coef$LipidGroup <- "PC"
NAFLDBx_Fib_PC_db_reg_coef$MetaReg <- "db"
NAFLDBx_Fib_PC_db_reg_coef <- NAFLDBx_Fib_PC_db_reg_coef[-c(1),]
NAFLDBx_Fib_PC_db_reg_coef$r_sq <- NAFLDBx_Fib_PC_db_reg_sm$adj.r.squared

NAFLDBx_Fib_LPC_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Fib_lm_sum2, LipidGroup=="LysoPC"))
NAFLDBx_Fib_LPC_db_reg_sm <- summary(NAFLDBx_Fib_LPC_db_reg)
NAFLDBx_Fib_LPC_db_reg_coef <- as.data.frame(NAFLDBx_Fib_LPC_db_reg_sm$coefficients)
NAFLDBx_Fib_LPC_db_reg_coef$LipidGroup <- "LPC"
NAFLDBx_Fib_LPC_db_reg_coef$MetaReg <- "db"
NAFLDBx_Fib_LPC_db_reg_coef <- NAFLDBx_Fib_LPC_db_reg_coef[-c(1),]
NAFLDBx_Fib_LPC_db_reg_coef$r_sq <- NAFLDBx_Fib_LPC_db_reg_sm$adj.r.squared

NAFLDBx_Fib_DG_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Fib_lm_sum2, LipidGroup=="Diglyceride"))
NAFLDBx_Fib_DG_db_reg_sm <- summary(NAFLDBx_Fib_DG_db_reg)
NAFLDBx_Fib_DG_db_reg_coef <- as.data.frame(NAFLDBx_Fib_DG_db_reg_sm$coefficients)
NAFLDBx_Fib_DG_db_reg_coef$LipidGroup <- "DG"
NAFLDBx_Fib_DG_db_reg_coef$MetaReg <- "db"
NAFLDBx_Fib_DG_db_reg_coef <- NAFLDBx_Fib_DG_db_reg_coef[-c(1),]
NAFLDBx_Fib_DG_db_reg_coef$r_sq <- NAFLDBx_Fib_DG_db_reg_sm$adj.r.squared

NAFLDBx_Fib_TG_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Fib_lm_sum2, LipidGroup=="Triglyceride"))
NAFLDBx_Fib_TG_db_reg_sm <- summary(NAFLDBx_Fib_TG_db_reg)
NAFLDBx_Fib_TG_db_reg_coef <- as.data.frame(NAFLDBx_Fib_TG_db_reg_sm$coefficients)
NAFLDBx_Fib_TG_db_reg_coef$LipidGroup <- "TG"
NAFLDBx_Fib_TG_db_reg_coef$MetaReg <- "db"
NAFLDBx_Fib_TG_db_reg_coef <- NAFLDBx_Fib_TG_db_reg_coef[-c(1),]
NAFLDBx_Fib_TG_db_reg_coef$r_sq <- NAFLDBx_Fib_TG_db_reg_sm$adj.r.squared

NAFLDBx_Fib_SM_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Fib_lm_sum2, LipidGroup=="Sphingomyelin"))
NAFLDBx_Fib_SM_db_reg_sm <- summary(NAFLDBx_Fib_SM_db_reg)
NAFLDBx_Fib_SM_db_reg_coef <- as.data.frame(NAFLDBx_Fib_SM_db_reg_sm$coefficients)
NAFLDBx_Fib_SM_db_reg_coef$LipidGroup <- "SM"
NAFLDBx_Fib_SM_db_reg_coef$MetaReg <- "db"
NAFLDBx_Fib_SM_db_reg_coef <- NAFLDBx_Fib_SM_db_reg_coef[-c(1),]
NAFLDBx_Fib_SM_db_reg_coef$r_sq <- NAFLDBx_Fib_SM_db_reg_sm$adj.r.squared

NAFLDBx_Fib_PE_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Fib_lm_sum2, LipidGroup=="PE"))
NAFLDBx_Fib_PE_db_reg_sm <- summary(NAFLDBx_Fib_PE_db_reg)
NAFLDBx_Fib_PE_db_reg_coef <- as.data.frame(NAFLDBx_Fib_PE_db_reg_sm$coefficients)
NAFLDBx_Fib_PE_db_reg_coef$LipidGroup <- "PE"
NAFLDBx_Fib_PE_db_reg_coef$MetaReg <- "db"
NAFLDBx_Fib_PE_db_reg_coef <- NAFLDBx_Fib_PE_db_reg_coef[-c(1),]
NAFLDBx_Fib_PE_db_reg_coef$r_sq <- NAFLDBx_Fib_PE_db_reg_sm$adj.r.squared

NAFLDBx_Fib_PS_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Fib_lm_sum2, LipidGroup=="PS"))
NAFLDBx_Fib_PS_db_reg_sm <- summary(NAFLDBx_Fib_PS_db_reg)
NAFLDBx_Fib_PS_db_reg_coef <- as.data.frame(NAFLDBx_Fib_PS_db_reg_sm$coefficients)
NAFLDBx_Fib_PS_db_reg_coef$LipidGroup <- "PS"
NAFLDBx_Fib_PS_db_reg_coef$MetaReg <- "db"
NAFLDBx_Fib_PS_db_reg_coef <- NAFLDBx_Fib_PS_db_reg_coef[-c(1),]
NAFLDBx_Fib_PS_db_reg_coef$r_sq <- NAFLDBx_Fib_PS_db_reg_sm$adj.r.squared

NAFLDBx_Fib_PI_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Fib_lm_sum2, LipidGroup=="PI"))
NAFLDBx_Fib_PI_db_reg_sm <- summary(NAFLDBx_Fib_PI_db_reg)
NAFLDBx_Fib_PI_db_reg_coef <- as.data.frame(NAFLDBx_Fib_PI_db_reg_sm$coefficients)
NAFLDBx_Fib_PI_db_reg_coef$LipidGroup <- "PI"
NAFLDBx_Fib_PI_db_reg_coef$MetaReg <- "db"
NAFLDBx_Fib_PI_db_reg_coef <- NAFLDBx_Fib_PI_db_reg_coef[-c(1),]
NAFLDBx_Fib_PI_db_reg_coef$r_sq <- NAFLDBx_Fib_PI_db_reg_sm$adj.r.squared

NAFLDBx_Fib_Cer_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Fib_lm_sum2, LipidGroup=="Ceramide"))
NAFLDBx_Fib_Cer_db_reg_sm <- summary(NAFLDBx_Fib_Cer_db_reg)
NAFLDBx_Fib_Cer_db_reg_coef <- as.data.frame(NAFLDBx_Fib_Cer_db_reg_sm$coefficients)
NAFLDBx_Fib_Cer_db_reg_coef$LipidGroup <- "Cer"
NAFLDBx_Fib_Cer_db_reg_coef$MetaReg <- "db"
NAFLDBx_Fib_Cer_db_reg_coef <- NAFLDBx_Fib_Cer_db_reg_coef[-c(1),]
NAFLDBx_Fib_Cer_db_reg_coef$r_sq <- NAFLDBx_Fib_Cer_db_reg_sm$adj.r.squared

NAFLDBx_Fib_PG_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Fib_lm_sum2, LipidGroup=="PG"))
NAFLDBx_Fib_PG_db_reg_sm <- summary(NAFLDBx_Fib_PG_db_reg)
NAFLDBx_Fib_PG_db_reg_coef <- as.data.frame(NAFLDBx_Fib_PG_db_reg_sm$coefficients)
NAFLDBx_Fib_PG_db_reg_coef$LipidGroup <- "PG"
NAFLDBx_Fib_PG_db_reg_coef$MetaReg <- "db"
NAFLDBx_Fib_PG_db_reg_coef <- NAFLDBx_Fib_PG_db_reg_coef[-c(1),]
NAFLDBx_Fib_PG_db_reg_coef$r_sq <- NAFLDBx_Fib_PG_db_reg_sm$adj.r.squared

NAFLDBx_Fib_Gang_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Fib_lm_sum2, LipidGroup=="Ganglioside"))
NAFLDBx_Fib_Gang_db_reg_sm <- summary(NAFLDBx_Fib_Gang_db_reg)
NAFLDBx_Fib_Gang_db_reg_coef <- as.data.frame(NAFLDBx_Fib_Gang_db_reg_sm$coefficients)
NAFLDBx_Fib_Gang_db_reg_coef$LipidGroup <- "Gang"
NAFLDBx_Fib_Gang_db_reg_coef$MetaReg <- "db"
NAFLDBx_Fib_Gang_db_reg_coef <- NAFLDBx_Fib_Gang_db_reg_coef[-c(1),]
NAFLDBx_Fib_Gang_db_reg_coef$r_sq <- NAFLDBx_Fib_Gang_db_reg_sm$adj.r.squared

NAFLDBx_Fib_HexCer_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Fib_lm_sum2, LipidGroup=="Hexosylceramide"))
NAFLDBx_Fib_HexCer_db_reg_sm <- summary(NAFLDBx_Fib_HexCer_db_reg)
NAFLDBx_Fib_HexCer_db_reg_coef <- as.data.frame(NAFLDBx_Fib_HexCer_db_reg_sm$coefficients)
NAFLDBx_Fib_HexCer_db_reg_coef$LipidGroup <- "HexCer"
NAFLDBx_Fib_HexCer_db_reg_coef$MetaReg <- "db"
NAFLDBx_Fib_HexCer_db_reg_coef <- NAFLDBx_Fib_HexCer_db_reg_coef[-c(1),]
NAFLDBx_Fib_HexCer_db_reg_coef$r_sq <- NAFLDBx_Fib_HexCer_db_reg_sm$adj.r.squared

NAFLDBx_Fib_LPE_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Fib_lm_sum2, LipidGroup=="LysoPE"))
NAFLDBx_Fib_LPE_db_reg_sm <- summary(NAFLDBx_Fib_LPE_db_reg)
NAFLDBx_Fib_LPE_db_reg_coef <- as.data.frame(NAFLDBx_Fib_LPE_db_reg_sm$coefficients)
NAFLDBx_Fib_LPE_db_reg_coef$LipidGroup <- "LPE"
NAFLDBx_Fib_LPE_db_reg_coef$MetaReg <- "db"
NAFLDBx_Fib_LPE_db_reg_coef <- NAFLDBx_Fib_LPE_db_reg_coef[-c(1),]
NAFLDBx_Fib_LPE_db_reg_coef$r_sq <- NAFLDBx_Fib_LPE_db_reg_sm$adj.r.squared

NAFLDBx_Fib_LPI_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Fib_lm_sum2, LipidGroup=="LysoPI"))
NAFLDBx_Fib_LPI_db_reg_sm <- summary(NAFLDBx_Fib_LPI_db_reg)
NAFLDBx_Fib_LPI_db_reg_coef <- as.data.frame(NAFLDBx_Fib_LPI_db_reg_sm$coefficients)
NAFLDBx_Fib_LPI_db_reg_coef$LipidGroup <- "LPI"
NAFLDBx_Fib_LPI_db_reg_coef$MetaReg <- "db"
NAFLDBx_Fib_LPI_db_reg_coef <- NAFLDBx_Fib_LPI_db_reg_coef[-c(1),]
NAFLDBx_Fib_LPI_db_reg_coef$r_sq <- NAFLDBx_Fib_LPI_db_reg_sm$adj.r.squared

NAFLDBx_Fib_Sphing_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Fib_lm_sum2, LipidGroup=="Sphingolipid"))
NAFLDBx_Fib_Sphing_db_reg_sm <- summary(NAFLDBx_Fib_Sphing_db_reg)
NAFLDBx_Fib_Sphing_db_reg_coef <- as.data.frame(NAFLDBx_Fib_Sphing_db_reg_sm$coefficients)
NAFLDBx_Fib_Sphing_db_reg_coef$LipidGroup <- "Sphing"
NAFLDBx_Fib_Sphing_db_reg_coef$MetaReg <- "db"
NAFLDBx_Fib_Sphing_db_reg_coef <- NAFLDBx_Fib_Sphing_db_reg_coef[-c(1),]
NAFLDBx_Fib_Sphing_db_reg_coef$r_sq <- NAFLDBx_Fib_Sphing_db_reg_sm$adj.r.squared

NAFLDBx_Fib_db_metareg <- rbind(NAFLDBx_Fib_PC_db_reg_coef, NAFLDBx_Fib_LPC_db_reg_coef)
NAFLDBx_Fib_db_metareg <- rbind(NAFLDBx_Fib_db_metareg, NAFLDBx_Fib_DG_db_reg_coef)
NAFLDBx_Fib_db_metareg <- rbind(NAFLDBx_Fib_db_metareg, NAFLDBx_Fib_TG_db_reg_coef)
NAFLDBx_Fib_db_metareg <- rbind(NAFLDBx_Fib_db_metareg, NAFLDBx_Fib_SM_db_reg_coef)
NAFLDBx_Fib_db_metareg <- rbind(NAFLDBx_Fib_db_metareg, NAFLDBx_Fib_PE_db_reg_coef)
NAFLDBx_Fib_db_metareg <- rbind(NAFLDBx_Fib_db_metareg, NAFLDBx_Fib_PS_db_reg_coef)
NAFLDBx_Fib_db_metareg <- rbind(NAFLDBx_Fib_db_metareg, NAFLDBx_Fib_PI_db_reg_coef)
NAFLDBx_Fib_db_metareg <- rbind(NAFLDBx_Fib_db_metareg, NAFLDBx_Fib_Cer_db_reg_coef)
NAFLDBx_Fib_db_metareg <- rbind(NAFLDBx_Fib_db_metareg, NAFLDBx_Fib_PG_db_reg_coef)
NAFLDBx_Fib_db_metareg <- rbind(NAFLDBx_Fib_db_metareg, NAFLDBx_Fib_Gang_db_reg_coef)
NAFLDBx_Fib_db_metareg <- rbind(NAFLDBx_Fib_db_metareg, NAFLDBx_Fib_HexCer_db_reg_coef)
NAFLDBx_Fib_db_metareg <- rbind(NAFLDBx_Fib_db_metareg, NAFLDBx_Fib_LPE_db_reg_coef)
NAFLDBx_Fib_db_metareg <- rbind(NAFLDBx_Fib_db_metareg, NAFLDBx_Fib_LPI_db_reg_coef)
NAFLDBx_Fib_db_metareg <- rbind(NAFLDBx_Fib_db_metareg, NAFLDBx_Fib_Sphing_db_reg_coef)

## run for carbons


NAFLDBx_Fib_PC_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Fib_lm_sum2, LipidGroup=="PC"))
NAFLDBx_Fib_PC_Carb_reg_sm <- summary(NAFLDBx_Fib_PC_Carb_reg)
NAFLDBx_Fib_PC_Carb_reg_coef <- as.data.frame(NAFLDBx_Fib_PC_Carb_reg_sm$coefficients)
NAFLDBx_Fib_PC_Carb_reg_coef$LipidGroup <- "PC"
NAFLDBx_Fib_PC_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Fib_PC_Carb_reg_coef <- NAFLDBx_Fib_PC_Carb_reg_coef[-c(1),]
NAFLDBx_Fib_PC_Carb_reg_coef$r_sq <- NAFLDBx_Fib_PC_Carb_reg_sm$adj.r.squared

NAFLDBx_Fib_LPC_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Fib_lm_sum2, LipidGroup=="LysoPC"))
NAFLDBx_Fib_LPC_Carb_reg_sm <- summary(NAFLDBx_Fib_LPC_Carb_reg)
NAFLDBx_Fib_LPC_Carb_reg_coef <- as.data.frame(NAFLDBx_Fib_LPC_Carb_reg_sm$coefficients)
NAFLDBx_Fib_LPC_Carb_reg_coef$LipidGroup <- "LPC"
NAFLDBx_Fib_LPC_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Fib_LPC_Carb_reg_coef <- NAFLDBx_Fib_LPC_Carb_reg_coef[-c(1),]
NAFLDBx_Fib_LPC_Carb_reg_coef$r_sq <- NAFLDBx_Fib_LPC_Carb_reg_sm$adj.r.squared

NAFLDBx_Fib_DG_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Fib_lm_sum2, LipidGroup=="Diglyceride"))
NAFLDBx_Fib_DG_Carb_reg_sm <- summary(NAFLDBx_Fib_DG_Carb_reg)
NAFLDBx_Fib_DG_Carb_reg_coef <- as.data.frame(NAFLDBx_Fib_DG_Carb_reg_sm$coefficients)
NAFLDBx_Fib_DG_Carb_reg_coef$LipidGroup <- "DG"
NAFLDBx_Fib_DG_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Fib_DG_Carb_reg_coef <- NAFLDBx_Fib_DG_Carb_reg_coef[-c(1),]
NAFLDBx_Fib_DG_Carb_reg_coef$r_sq <- NAFLDBx_Fib_DG_Carb_reg_sm$adj.r.squared

NAFLDBx_Fib_TG_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Fib_lm_sum2, LipidGroup=="Triglyceride"))
NAFLDBx_Fib_TG_Carb_reg_sm <- summary(NAFLDBx_Fib_TG_Carb_reg)
NAFLDBx_Fib_TG_Carb_reg_coef <- as.data.frame(NAFLDBx_Fib_TG_Carb_reg_sm$coefficients)
NAFLDBx_Fib_TG_Carb_reg_coef$LipidGroup <- "TG"
NAFLDBx_Fib_TG_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Fib_TG_Carb_reg_coef <- NAFLDBx_Fib_TG_Carb_reg_coef[-c(1),]
NAFLDBx_Fib_TG_Carb_reg_coef$r_sq <- NAFLDBx_Fib_TG_Carb_reg_sm$adj.r.squared

NAFLDBx_Fib_SM_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Fib_lm_sum2, LipidGroup=="Sphingomyelin"))
NAFLDBx_Fib_SM_Carb_reg_sm <- summary(NAFLDBx_Fib_SM_Carb_reg)
NAFLDBx_Fib_SM_Carb_reg_coef <- as.data.frame(NAFLDBx_Fib_SM_Carb_reg_sm$coefficients)
NAFLDBx_Fib_SM_Carb_reg_coef$LipidGroup <- "SM"
NAFLDBx_Fib_SM_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Fib_SM_Carb_reg_coef <- NAFLDBx_Fib_SM_Carb_reg_coef[-c(1),]
NAFLDBx_Fib_SM_Carb_reg_coef$r_sq <- NAFLDBx_Fib_SM_Carb_reg_sm$adj.r.squared

NAFLDBx_Fib_PE_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Fib_lm_sum2, LipidGroup=="PE"))
NAFLDBx_Fib_PE_Carb_reg_sm <- summary(NAFLDBx_Fib_PE_Carb_reg)
NAFLDBx_Fib_PE_Carb_reg_coef <- as.data.frame(NAFLDBx_Fib_PE_Carb_reg_sm$coefficients)
NAFLDBx_Fib_PE_Carb_reg_coef$LipidGroup <- "PE"
NAFLDBx_Fib_PE_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Fib_PE_Carb_reg_coef <- NAFLDBx_Fib_PE_Carb_reg_coef[-c(1),]
NAFLDBx_Fib_PE_Carb_reg_coef$r_sq <- NAFLDBx_Fib_PE_Carb_reg_sm$adj.r.squared

NAFLDBx_Fib_PS_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Fib_lm_sum2, LipidGroup=="PS"))
NAFLDBx_Fib_PS_Carb_reg_sm <- summary(NAFLDBx_Fib_PS_Carb_reg)
NAFLDBx_Fib_PS_Carb_reg_coef <- as.data.frame(NAFLDBx_Fib_PS_Carb_reg_sm$coefficients)
NAFLDBx_Fib_PS_Carb_reg_coef$LipidGroup <- "PS"
NAFLDBx_Fib_PS_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Fib_PS_Carb_reg_coef <- NAFLDBx_Fib_PS_Carb_reg_coef[-c(1),]
NAFLDBx_Fib_PS_Carb_reg_coef$r_sq <- NAFLDBx_Fib_PS_Carb_reg_sm$adj.r.squared

NAFLDBx_Fib_PI_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Fib_lm_sum2, LipidGroup=="PI"))
NAFLDBx_Fib_PI_Carb_reg_sm <- summary(NAFLDBx_Fib_PI_Carb_reg)
NAFLDBx_Fib_PI_Carb_reg_coef <- as.data.frame(NAFLDBx_Fib_PI_Carb_reg_sm$coefficients)
NAFLDBx_Fib_PI_Carb_reg_coef$LipidGroup <- "PI"
NAFLDBx_Fib_PI_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Fib_PI_Carb_reg_coef <- NAFLDBx_Fib_PI_Carb_reg_coef[-c(1),]
NAFLDBx_Fib_PI_Carb_reg_coef$r_sq <- NAFLDBx_Fib_PI_Carb_reg_sm$adj.r.squared

NAFLDBx_Fib_Cer_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Fib_lm_sum2, LipidGroup=="Ceramide"))
NAFLDBx_Fib_Cer_Carb_reg_sm <- summary(NAFLDBx_Fib_Cer_Carb_reg)
NAFLDBx_Fib_Cer_Carb_reg_coef <- as.data.frame(NAFLDBx_Fib_Cer_Carb_reg_sm$coefficients)
NAFLDBx_Fib_Cer_Carb_reg_coef$LipidGroup <- "Cer"
NAFLDBx_Fib_Cer_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Fib_Cer_Carb_reg_coef <- NAFLDBx_Fib_Cer_Carb_reg_coef[-c(1),]
NAFLDBx_Fib_Cer_Carb_reg_coef$r_sq <- NAFLDBx_Fib_Cer_Carb_reg_sm$adj.r.squared

NAFLDBx_Fib_PG_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Fib_lm_sum2, LipidGroup=="PG"))
NAFLDBx_Fib_PG_Carb_reg_sm <- summary(NAFLDBx_Fib_PG_Carb_reg)
NAFLDBx_Fib_PG_Carb_reg_coef <- as.data.frame(NAFLDBx_Fib_PG_Carb_reg_sm$coefficients)
NAFLDBx_Fib_PG_Carb_reg_coef$LipidGroup <- "PG"
NAFLDBx_Fib_PG_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Fib_PG_Carb_reg_coef <- NAFLDBx_Fib_PG_Carb_reg_coef[-c(1),]
NAFLDBx_Fib_PG_Carb_reg_coef$r_sq <- NAFLDBx_Fib_PG_Carb_reg_sm$adj.r.squared

NAFLDBx_Fib_Gang_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Fib_lm_sum2, LipidGroup=="Ganglioside"))
NAFLDBx_Fib_Gang_Carb_reg_sm <- summary(NAFLDBx_Fib_Gang_Carb_reg)
NAFLDBx_Fib_Gang_Carb_reg_coef <- as.data.frame(NAFLDBx_Fib_Gang_Carb_reg_sm$coefficients)
NAFLDBx_Fib_Gang_Carb_reg_coef$LipidGroup <- "Gang"
NAFLDBx_Fib_Gang_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Fib_Gang_Carb_reg_coef <- NAFLDBx_Fib_Gang_Carb_reg_coef[-c(1),]
NAFLDBx_Fib_Gang_Carb_reg_coef$r_sq <- NAFLDBx_Fib_Gang_Carb_reg_sm$adj.r.squared

NAFLDBx_Fib_HexCer_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Fib_lm_sum2, LipidGroup=="Hexosylceramide"))
NAFLDBx_Fib_HexCer_Carb_reg_sm <- summary(NAFLDBx_Fib_HexCer_Carb_reg)
NAFLDBx_Fib_HexCer_Carb_reg_coef <- as.data.frame(NAFLDBx_Fib_HexCer_Carb_reg_sm$coefficients)
NAFLDBx_Fib_HexCer_Carb_reg_coef$LipidGroup <- "HexCer"
NAFLDBx_Fib_HexCer_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Fib_HexCer_Carb_reg_coef <- NAFLDBx_Fib_HexCer_Carb_reg_coef[-c(1),]
NAFLDBx_Fib_HexCer_Carb_reg_coef$r_sq <- NAFLDBx_Fib_HexCer_Carb_reg_sm$adj.r.squared

NAFLDBx_Fib_LPE_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Fib_lm_sum2, LipidGroup=="LysoPE"))
NAFLDBx_Fib_LPE_Carb_reg_sm <- summary(NAFLDBx_Fib_LPE_Carb_reg)
NAFLDBx_Fib_LPE_Carb_reg_coef <- as.data.frame(NAFLDBx_Fib_LPE_Carb_reg_sm$coefficients)
NAFLDBx_Fib_LPE_Carb_reg_coef$LipidGroup <- "LPE"
NAFLDBx_Fib_LPE_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Fib_LPE_Carb_reg_coef <- NAFLDBx_Fib_LPE_Carb_reg_coef[-c(1),]
NAFLDBx_Fib_LPE_Carb_reg_coef$r_sq <- NAFLDBx_Fib_LPE_Carb_reg_sm$adj.r.squared

NAFLDBx_Fib_LPI_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Fib_lm_sum2, LipidGroup=="LysoPI"))
NAFLDBx_Fib_LPI_Carb_reg_sm <- summary(NAFLDBx_Fib_LPI_Carb_reg)
NAFLDBx_Fib_LPI_Carb_reg_coef <- as.data.frame(NAFLDBx_Fib_LPI_Carb_reg_sm$coefficients)
NAFLDBx_Fib_LPI_Carb_reg_coef$LipidGroup <- "LPI"
NAFLDBx_Fib_LPI_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Fib_LPI_Carb_reg_coef <- NAFLDBx_Fib_LPI_Carb_reg_coef[-c(1),]
NAFLDBx_Fib_LPI_Carb_reg_coef$r_sq <- NAFLDBx_Fib_LPI_Carb_reg_sm$adj.r.squared

NAFLDBx_Fib_Sphing_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Fib_lm_sum2, LipidGroup=="Sphingolipid"))
NAFLDBx_Fib_Sphing_Carb_reg_sm <- summary(NAFLDBx_Fib_Sphing_Carb_reg)
NAFLDBx_Fib_Sphing_Carb_reg_coef <- as.data.frame(NAFLDBx_Fib_Sphing_Carb_reg_sm$coefficients)
NAFLDBx_Fib_Sphing_Carb_reg_coef$LipidGroup <- "Sphing"
NAFLDBx_Fib_Sphing_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Fib_Sphing_Carb_reg_coef <- NAFLDBx_Fib_Sphing_Carb_reg_coef[-c(1),]
NAFLDBx_Fib_Sphing_Carb_reg_coef$r_sq <- NAFLDBx_Fib_Sphing_Carb_reg_sm$adj.r.squared


NAFLDBx_Fib_Carb_metareg <- rbind(NAFLDBx_Fib_PC_Carb_reg_coef, NAFLDBx_Fib_LPC_Carb_reg_coef)
NAFLDBx_Fib_Carb_metareg <- rbind(NAFLDBx_Fib_Carb_metareg, NAFLDBx_Fib_DG_Carb_reg_coef)
NAFLDBx_Fib_Carb_metareg <- rbind(NAFLDBx_Fib_Carb_metareg, NAFLDBx_Fib_TG_Carb_reg_coef)
NAFLDBx_Fib_Carb_metareg <- rbind(NAFLDBx_Fib_Carb_metareg, NAFLDBx_Fib_SM_Carb_reg_coef)
NAFLDBx_Fib_Carb_metareg <- rbind(NAFLDBx_Fib_Carb_metareg, NAFLDBx_Fib_PE_Carb_reg_coef)
NAFLDBx_Fib_Carb_metareg <- rbind(NAFLDBx_Fib_Carb_metareg, NAFLDBx_Fib_PS_Carb_reg_coef)
NAFLDBx_Fib_Carb_metareg <- rbind(NAFLDBx_Fib_Carb_metareg, NAFLDBx_Fib_PI_Carb_reg_coef)
NAFLDBx_Fib_Carb_metareg <- rbind(NAFLDBx_Fib_Carb_metareg, NAFLDBx_Fib_Cer_Carb_reg_coef)
NAFLDBx_Fib_Carb_metareg <- rbind(NAFLDBx_Fib_Carb_metareg, NAFLDBx_Fib_PG_Carb_reg_coef)
NAFLDBx_Fib_Carb_metareg <- rbind(NAFLDBx_Fib_Carb_metareg, NAFLDBx_Fib_Gang_Carb_reg_coef)
NAFLDBx_Fib_Carb_metareg <- rbind(NAFLDBx_Fib_Carb_metareg, NAFLDBx_Fib_HexCer_Carb_reg_coef)
NAFLDBx_Fib_Carb_metareg <- rbind(NAFLDBx_Fib_Carb_metareg, NAFLDBx_Fib_LPE_Carb_reg_coef)
NAFLDBx_Fib_Carb_metareg <- rbind(NAFLDBx_Fib_Carb_metareg, NAFLDBx_Fib_LPI_Carb_reg_coef)
NAFLDBx_Fib_Carb_metareg <- rbind(NAFLDBx_Fib_Carb_metareg, NAFLDBx_Fib_Sphing_Carb_reg_coef)

NAFLDBx_Fib_metareg_summary <- rbind(NAFLDBx_Fib_Carb_metareg, NAFLDBx_Fib_db_metareg)
names(NAFLDBx_Fib_metareg_summary)[names(NAFLDBx_Fib_metareg_summary) == 'Pr(>|t|)'] <- 'pval'
NAFLDBx_Fib_metareg_summary$qval <- p.adjust(NAFLDBx_Fib_metareg_summary$pval, method = "hochberg")
write.table(NAFLDBx_Fib_metareg_summary,file="NAFLDBx_Fib_metareg_summary.csv",sep=",")



#### make meta-regression plots of specific beta vs db/carbon

NAFLDBx_Fib_TG_db <- ggplot(subset(NAFLDBx_data_Fib_lm_sum2, LipidGroup %in% c("Triglyceride")), aes(x=db, y=beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in TG") + ylab("Beta-regression coefficient") + theme_classic() + theme(legend.position="right", legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) 
NAFLDBx_Fib_TG_db

## + scale_x_continuous(breaks=seq(0,6,1), limits = c(0,6), expand = c(.05,0))
## + scale_y_continuous(breaks=seq(-.75,0.5,0.25), limits = c(-.75,0.5), expand = c(0,0))
## + annotate(geom = "text", x = 5, y = -.25, label = "italic(AdjR) ^ 2 == 0.06", parse = TRUE, size = 4)
## + annotate(geom = "text", x = 5, y = -.2, label = "P[slope] = 0.025", parse = FALSE, size = 4)

NAFLDBx_Fib_SM_db <- ggplot(subset(NAFLDBx_data_Fib_lm_sum2, LipidGroup %in% c("Sphingomyelin")), aes(x=db, y=beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in SM") + ylab("Beta-regression coefficient") + theme_classic() + theme(legend.position="right", legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) 
NAFLDBx_Fib_SM_db

NAFLDBx_Fib_PC_db <- ggplot(subset(NAFLDBx_data_Fib_lm_sum2, LipidGroup %in% c("PC")), aes(x=db, y=beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in PC") + ylab("Beta-regression coefficient") + theme_classic() + theme(legend.position="right", legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) 
NAFLDBx_Fib_PC_db

NAFLDBx_Fib_PC_Carb <- ggplot(subset(NAFLDBx_data_Fib_lm_sum2, LipidGroup %in% c("PC")), aes(x=Carb, y=beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in PC") + ylab("Beta-regression coefficient") + theme_classic() + theme(legend.position="right", legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) 
NAFLDBx_Fib_PC_Carb

NAFLDBx_Fib_top <- plot_grid(NAFLDBx_Fib_TG_db, NAFLDBx_Fib_SM_db, ncol = 2, labels = c('A','B'), label_fontfamily = 'serif', label_fontface = 'bold', label_size = 22, align = 'w')
NAFLDBx_Fib_bottom <- plot_grid(NAFLDBx_Fib_PC_db, NAFLDBx_Fib_PC_Carb, ncol = 2, labels = c('C','D'), label_fontfamily = 'serif', label_fontface = 'bold', label_size = 22, align = 'w', rel_widths = c(1.5, 1.5))

pdf(file="NAFLDBx_Fib_metareg_sumfig_v1.pdf",width=16,height=12)
plot_grid(NAFLDBx_Fib_top, NAFLDBx_Fib_bottom, ncol = 1, rel_heights = c(1.0, 1.0))
dev.off()

## for portal inflammation

## Regress Portal with lipids in NAFLDBx cohort
NAFLDBx_data_Portal_lm_full <- lapply(NAFLDBx_data[54:281], function(x) summary(lm(x ~ NAFLDBx_data$Portal + NAFLDBx_data$Sex + NAFLDBx_data$Age)))
NAFLDBx_data_Portal_lm <- lapply(NAFLDBx_data_Portal_lm_full, coef)
NAFLDBx_data_Portal_lm <- data.frame(NAFLDBx_data_Portal_lm)
NAFLDBx_data_Portal_lm <- t(NAFLDBx_data_Portal_lm)
NAFLDBx_data_Portal_lm = subset(NAFLDBx_data_Portal_lm, select = -c(1,3,4) )
NAFLDBx_data_Portal_lm <- data.frame(NAFLDBx_data_Portal_lm)
NAFLDBx_data_Portal_lm$annot <- rep(annotation$annotation, each=1, length.out=nrow(NAFLDBx_data_Portal_lm))
NAFLDBx_data_Portal_lm <- NAFLDBx_data_Portal_lm[order(NAFLDBx_data_Portal_lm$annot),]
NAFLDBx_data_Portal_lm_beta <- NAFLDBx_data_Portal_lm[1:((nrow(NAFLDBx_data_Portal_lm)/4)),]
NAFLDBx_data_Portal_lm_p <- NAFLDBx_data_Portal_lm[((nrow(NAFLDBx_data_Portal_lm)/4)+1):((nrow(NAFLDBx_data_Portal_lm)/4)*2),]
NAFLDBx_data_Portal_lm_SE <- NAFLDBx_data_Portal_lm[(((nrow(NAFLDBx_data_Portal_lm)/4)*2)+1):((nrow(NAFLDBx_data_Portal_lm)/4)*3),]
NAFLDBx_data_Portal_lm_t <- NAFLDBx_data_Portal_lm[(((nrow(NAFLDBx_data_Portal_lm)/4)*3)+1):(nrow(NAFLDBx_data_Portal_lm)),]

NAFLDBx_data_Portal_lm_beta$beta <- NAFLDBx_data_Portal_lm_beta$NAFLDBx_data.Portal
NAFLDBx_data_Portal_lm_beta = subset(NAFLDBx_data_Portal_lm_beta, select = -c(1,2))
NAFLDBx_data_Portal_lm_SE$SE <- NAFLDBx_data_Portal_lm_SE$NAFLDBx_data.Portal
NAFLDBx_data_Portal_lm_SE = subset(NAFLDBx_data_Portal_lm_SE, select = -c(1,2))
NAFLDBx_data_Portal_lm_p$p <- NAFLDBx_data_Portal_lm_p$NAFLDBx_data.Portal
NAFLDBx_data_Portal_lm_p = subset(NAFLDBx_data_Portal_lm_p, select = -c(1,2))
NAFLDBx_data_Portal_lm_t$t <- NAFLDBx_data_Portal_lm_t$NAFLDBx_data.Portal
NAFLDBx_data_Portal_lm_t = subset(NAFLDBx_data_Portal_lm_t, select = -c(1,2))

NAFLDBx_data_Portal_lm_beta$name <- row.names(NAFLDBx_data_Portal_lm_beta)
NAFLDBx_data_Portal_lm_beta$name2 = substr(NAFLDBx_data_Portal_lm_beta$name,1,nchar(NAFLDBx_data_Portal_lm_beta$name)-9)
NAFLDBx_data_Portal_lm_p$name <- row.names(NAFLDBx_data_Portal_lm_p)
NAFLDBx_data_Portal_lm_p$name2 = substr(NAFLDBx_data_Portal_lm_p$name,1,nchar(NAFLDBx_data_Portal_lm_p$name)-9)
NAFLDBx_data_Portal_lm_SE$name <- row.names(NAFLDBx_data_Portal_lm_SE)
NAFLDBx_data_Portal_lm_SE$name2 = substr(NAFLDBx_data_Portal_lm_SE$name,1,nchar(NAFLDBx_data_Portal_lm_SE$name)-11)
NAFLDBx_data_Portal_lm_t$name <- row.names(NAFLDBx_data_Portal_lm_t)
NAFLDBx_data_Portal_lm_t$name2 = substr(NAFLDBx_data_Portal_lm_t$name,1,nchar(NAFLDBx_data_Portal_lm_t$name)-8)

NAFLDBx_data_Portal_lm_sum <- merge(NAFLDBx_data_Portal_lm_beta, NAFLDBx_data_Portal_lm_SE, by="name2")
NAFLDBx_data_Portal_lm_sum <- merge(NAFLDBx_data_Portal_lm_sum, NAFLDBx_data_Portal_lm_p, by="name2")
NAFLDBx_data_Portal_lm_sum <- merge(NAFLDBx_data_Portal_lm_sum, NAFLDBx_data_Portal_lm_t, by="name2")

NAFLDBx_data_Portal_lm_sum = subset(NAFLDBx_data_Portal_lm_sum, select = c("name2","beta","SE","t","p"))
names(NAFLDBx_data_Portal_lm_sum)[names(NAFLDBx_data_Portal_lm_sum) == 'name2'] <- 'var'
NAFLDBx_data_Portal_lm_sum2 <- merge(Lipids_annotation, NAFLDBx_data_Portal_lm_sum, by="var")
NAFLDBx_data_Portal_lm_sum2$num <- nrow(NAFLDBx_data)
NAFLDBx_data_Portal_lm_sum2$sig <- NA
NAFLDBx_data_Portal_lm_sum2 <- NAFLDBx_data_Portal_lm_sum2 %>% mutate(sig = ifelse(p < lipid_sig, "Significant", "Not significant"))

NAFLDBx_data_Portal_lm_sum2$qval <- p.adjust(NAFLDBx_data_Portal_lm_sum2$p, method = "hochberg")
NAFLDBx_data_Portal_lm_sum2$negp <- -log10(NAFLDBx_data_Portal_lm_sum2$p)
write.table(NAFLDBx_data_Portal_lm_sum2,file="NAFLDBx_Portal_lm_summary.csv",sep=",")

#####

## volcano plot

pdf(file="NAFLDBx_Portal_lm_vol_v1.pdf",width=5,height=6)
NAFLDBx_Portal_vol <- ggplot(data= NAFLDBx_data_Portal_lm_sum2, aes(x=beta, y=negp, colour=LipidGroup)) + geom_point(alpha=0.4, size=1.75) + geom_text_repel(data = subset(NAFLDBx_data_Portal_lm_sum2, negp > 2.3), aes(label = var), size = 3, key_glyph = "point") + xlab("Beta-regression coefficient") + ylab("-log10 p-value") + theme_bw() + theme(legend.position="right")  + theme(plot.title = element_text(face = "bold")) + theme(plot.title = element_text(hjust = 0.2)) + ggtitle("Plasma lipids associated with Portal") + labs(color = "Lipid class")
NAFLDBx_Portal_vol
dev.off()


############


## identify trends using meta-regression with beta vs carbons & db

NAFLDBx_Portal_PC_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Portal_lm_sum2, LipidGroup=="PC"))
NAFLDBx_Portal_PC_db_reg_sm <- summary(NAFLDBx_Portal_PC_db_reg)
NAFLDBx_Portal_PC_db_reg_coef <- as.data.frame(NAFLDBx_Portal_PC_db_reg_sm$coefficients)
NAFLDBx_Portal_PC_db_reg_coef$LipidGroup <- "PC"
NAFLDBx_Portal_PC_db_reg_coef$MetaReg <- "db"
NAFLDBx_Portal_PC_db_reg_coef <- NAFLDBx_Portal_PC_db_reg_coef[-c(1),]
NAFLDBx_Portal_PC_db_reg_coef$r_sq <- NAFLDBx_Portal_PC_db_reg_sm$adj.r.squared

NAFLDBx_Portal_LPC_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Portal_lm_sum2, LipidGroup=="LysoPC"))
NAFLDBx_Portal_LPC_db_reg_sm <- summary(NAFLDBx_Portal_LPC_db_reg)
NAFLDBx_Portal_LPC_db_reg_coef <- as.data.frame(NAFLDBx_Portal_LPC_db_reg_sm$coefficients)
NAFLDBx_Portal_LPC_db_reg_coef$LipidGroup <- "LPC"
NAFLDBx_Portal_LPC_db_reg_coef$MetaReg <- "db"
NAFLDBx_Portal_LPC_db_reg_coef <- NAFLDBx_Portal_LPC_db_reg_coef[-c(1),]
NAFLDBx_Portal_LPC_db_reg_coef$r_sq <- NAFLDBx_Portal_LPC_db_reg_sm$adj.r.squared

NAFLDBx_Portal_DG_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Portal_lm_sum2, LipidGroup=="Diglyceride"))
NAFLDBx_Portal_DG_db_reg_sm <- summary(NAFLDBx_Portal_DG_db_reg)
NAFLDBx_Portal_DG_db_reg_coef <- as.data.frame(NAFLDBx_Portal_DG_db_reg_sm$coefficients)
NAFLDBx_Portal_DG_db_reg_coef$LipidGroup <- "DG"
NAFLDBx_Portal_DG_db_reg_coef$MetaReg <- "db"
NAFLDBx_Portal_DG_db_reg_coef <- NAFLDBx_Portal_DG_db_reg_coef[-c(1),]
NAFLDBx_Portal_DG_db_reg_coef$r_sq <- NAFLDBx_Portal_DG_db_reg_sm$adj.r.squared

NAFLDBx_Portal_TG_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Portal_lm_sum2, LipidGroup=="Triglyceride"))
NAFLDBx_Portal_TG_db_reg_sm <- summary(NAFLDBx_Portal_TG_db_reg)
NAFLDBx_Portal_TG_db_reg_coef <- as.data.frame(NAFLDBx_Portal_TG_db_reg_sm$coefficients)
NAFLDBx_Portal_TG_db_reg_coef$LipidGroup <- "TG"
NAFLDBx_Portal_TG_db_reg_coef$MetaReg <- "db"
NAFLDBx_Portal_TG_db_reg_coef <- NAFLDBx_Portal_TG_db_reg_coef[-c(1),]
NAFLDBx_Portal_TG_db_reg_coef$r_sq <- NAFLDBx_Portal_TG_db_reg_sm$adj.r.squared

NAFLDBx_Portal_SM_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Portal_lm_sum2, LipidGroup=="Sphingomyelin"))
NAFLDBx_Portal_SM_db_reg_sm <- summary(NAFLDBx_Portal_SM_db_reg)
NAFLDBx_Portal_SM_db_reg_coef <- as.data.frame(NAFLDBx_Portal_SM_db_reg_sm$coefficients)
NAFLDBx_Portal_SM_db_reg_coef$LipidGroup <- "SM"
NAFLDBx_Portal_SM_db_reg_coef$MetaReg <- "db"
NAFLDBx_Portal_SM_db_reg_coef <- NAFLDBx_Portal_SM_db_reg_coef[-c(1),]
NAFLDBx_Portal_SM_db_reg_coef$r_sq <- NAFLDBx_Portal_SM_db_reg_sm$adj.r.squared

NAFLDBx_Portal_PE_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Portal_lm_sum2, LipidGroup=="PE"))
NAFLDBx_Portal_PE_db_reg_sm <- summary(NAFLDBx_Portal_PE_db_reg)
NAFLDBx_Portal_PE_db_reg_coef <- as.data.frame(NAFLDBx_Portal_PE_db_reg_sm$coefficients)
NAFLDBx_Portal_PE_db_reg_coef$LipidGroup <- "PE"
NAFLDBx_Portal_PE_db_reg_coef$MetaReg <- "db"
NAFLDBx_Portal_PE_db_reg_coef <- NAFLDBx_Portal_PE_db_reg_coef[-c(1),]
NAFLDBx_Portal_PE_db_reg_coef$r_sq <- NAFLDBx_Portal_PE_db_reg_sm$adj.r.squared

NAFLDBx_Portal_PS_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Portal_lm_sum2, LipidGroup=="PS"))
NAFLDBx_Portal_PS_db_reg_sm <- summary(NAFLDBx_Portal_PS_db_reg)
NAFLDBx_Portal_PS_db_reg_coef <- as.data.frame(NAFLDBx_Portal_PS_db_reg_sm$coefficients)
NAFLDBx_Portal_PS_db_reg_coef$LipidGroup <- "PS"
NAFLDBx_Portal_PS_db_reg_coef$MetaReg <- "db"
NAFLDBx_Portal_PS_db_reg_coef <- NAFLDBx_Portal_PS_db_reg_coef[-c(1),]
NAFLDBx_Portal_PS_db_reg_coef$r_sq <- NAFLDBx_Portal_PS_db_reg_sm$adj.r.squared

NAFLDBx_Portal_PI_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Portal_lm_sum2, LipidGroup=="PI"))
NAFLDBx_Portal_PI_db_reg_sm <- summary(NAFLDBx_Portal_PI_db_reg)
NAFLDBx_Portal_PI_db_reg_coef <- as.data.frame(NAFLDBx_Portal_PI_db_reg_sm$coefficients)
NAFLDBx_Portal_PI_db_reg_coef$LipidGroup <- "PI"
NAFLDBx_Portal_PI_db_reg_coef$MetaReg <- "db"
NAFLDBx_Portal_PI_db_reg_coef <- NAFLDBx_Portal_PI_db_reg_coef[-c(1),]
NAFLDBx_Portal_PI_db_reg_coef$r_sq <- NAFLDBx_Portal_PI_db_reg_sm$adj.r.squared

NAFLDBx_Portal_Cer_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Portal_lm_sum2, LipidGroup=="Ceramide"))
NAFLDBx_Portal_Cer_db_reg_sm <- summary(NAFLDBx_Portal_Cer_db_reg)
NAFLDBx_Portal_Cer_db_reg_coef <- as.data.frame(NAFLDBx_Portal_Cer_db_reg_sm$coefficients)
NAFLDBx_Portal_Cer_db_reg_coef$LipidGroup <- "Cer"
NAFLDBx_Portal_Cer_db_reg_coef$MetaReg <- "db"
NAFLDBx_Portal_Cer_db_reg_coef <- NAFLDBx_Portal_Cer_db_reg_coef[-c(1),]
NAFLDBx_Portal_Cer_db_reg_coef$r_sq <- NAFLDBx_Portal_Cer_db_reg_sm$adj.r.squared

NAFLDBx_Portal_PG_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Portal_lm_sum2, LipidGroup=="PG"))
NAFLDBx_Portal_PG_db_reg_sm <- summary(NAFLDBx_Portal_PG_db_reg)
NAFLDBx_Portal_PG_db_reg_coef <- as.data.frame(NAFLDBx_Portal_PG_db_reg_sm$coefficients)
NAFLDBx_Portal_PG_db_reg_coef$LipidGroup <- "PG"
NAFLDBx_Portal_PG_db_reg_coef$MetaReg <- "db"
NAFLDBx_Portal_PG_db_reg_coef <- NAFLDBx_Portal_PG_db_reg_coef[-c(1),]
NAFLDBx_Portal_PG_db_reg_coef$r_sq <- NAFLDBx_Portal_PG_db_reg_sm$adj.r.squared

NAFLDBx_Portal_Gang_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Portal_lm_sum2, LipidGroup=="Ganglioside"))
NAFLDBx_Portal_Gang_db_reg_sm <- summary(NAFLDBx_Portal_Gang_db_reg)
NAFLDBx_Portal_Gang_db_reg_coef <- as.data.frame(NAFLDBx_Portal_Gang_db_reg_sm$coefficients)
NAFLDBx_Portal_Gang_db_reg_coef$LipidGroup <- "Gang"
NAFLDBx_Portal_Gang_db_reg_coef$MetaReg <- "db"
NAFLDBx_Portal_Gang_db_reg_coef <- NAFLDBx_Portal_Gang_db_reg_coef[-c(1),]
NAFLDBx_Portal_Gang_db_reg_coef$r_sq <- NAFLDBx_Portal_Gang_db_reg_sm$adj.r.squared

NAFLDBx_Portal_HexCer_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Portal_lm_sum2, LipidGroup=="Hexosylceramide"))
NAFLDBx_Portal_HexCer_db_reg_sm <- summary(NAFLDBx_Portal_HexCer_db_reg)
NAFLDBx_Portal_HexCer_db_reg_coef <- as.data.frame(NAFLDBx_Portal_HexCer_db_reg_sm$coefficients)
NAFLDBx_Portal_HexCer_db_reg_coef$LipidGroup <- "HexCer"
NAFLDBx_Portal_HexCer_db_reg_coef$MetaReg <- "db"
NAFLDBx_Portal_HexCer_db_reg_coef <- NAFLDBx_Portal_HexCer_db_reg_coef[-c(1),]
NAFLDBx_Portal_HexCer_db_reg_coef$r_sq <- NAFLDBx_Portal_HexCer_db_reg_sm$adj.r.squared

NAFLDBx_Portal_LPE_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Portal_lm_sum2, LipidGroup=="LysoPE"))
NAFLDBx_Portal_LPE_db_reg_sm <- summary(NAFLDBx_Portal_LPE_db_reg)
NAFLDBx_Portal_LPE_db_reg_coef <- as.data.frame(NAFLDBx_Portal_LPE_db_reg_sm$coefficients)
NAFLDBx_Portal_LPE_db_reg_coef$LipidGroup <- "LPE"
NAFLDBx_Portal_LPE_db_reg_coef$MetaReg <- "db"
NAFLDBx_Portal_LPE_db_reg_coef <- NAFLDBx_Portal_LPE_db_reg_coef[-c(1),]
NAFLDBx_Portal_LPE_db_reg_coef$r_sq <- NAFLDBx_Portal_LPE_db_reg_sm$adj.r.squared

NAFLDBx_Portal_LPI_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Portal_lm_sum2, LipidGroup=="LysoPI"))
NAFLDBx_Portal_LPI_db_reg_sm <- summary(NAFLDBx_Portal_LPI_db_reg)
NAFLDBx_Portal_LPI_db_reg_coef <- as.data.frame(NAFLDBx_Portal_LPI_db_reg_sm$coefficients)
NAFLDBx_Portal_LPI_db_reg_coef$LipidGroup <- "LPI"
NAFLDBx_Portal_LPI_db_reg_coef$MetaReg <- "db"
NAFLDBx_Portal_LPI_db_reg_coef <- NAFLDBx_Portal_LPI_db_reg_coef[-c(1),]
NAFLDBx_Portal_LPI_db_reg_coef$r_sq <- NAFLDBx_Portal_LPI_db_reg_sm$adj.r.squared

NAFLDBx_Portal_Sphing_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_Portal_lm_sum2, LipidGroup=="Sphingolipid"))
NAFLDBx_Portal_Sphing_db_reg_sm <- summary(NAFLDBx_Portal_Sphing_db_reg)
NAFLDBx_Portal_Sphing_db_reg_coef <- as.data.frame(NAFLDBx_Portal_Sphing_db_reg_sm$coefficients)
NAFLDBx_Portal_Sphing_db_reg_coef$LipidGroup <- "Sphing"
NAFLDBx_Portal_Sphing_db_reg_coef$MetaReg <- "db"
NAFLDBx_Portal_Sphing_db_reg_coef <- NAFLDBx_Portal_Sphing_db_reg_coef[-c(1),]
NAFLDBx_Portal_Sphing_db_reg_coef$r_sq <- NAFLDBx_Portal_Sphing_db_reg_sm$adj.r.squared

NAFLDBx_Portal_db_metareg <- rbind(NAFLDBx_Portal_PC_db_reg_coef, NAFLDBx_Portal_LPC_db_reg_coef)
NAFLDBx_Portal_db_metareg <- rbind(NAFLDBx_Portal_db_metareg, NAFLDBx_Portal_DG_db_reg_coef)
NAFLDBx_Portal_db_metareg <- rbind(NAFLDBx_Portal_db_metareg, NAFLDBx_Portal_TG_db_reg_coef)
NAFLDBx_Portal_db_metareg <- rbind(NAFLDBx_Portal_db_metareg, NAFLDBx_Portal_SM_db_reg_coef)
NAFLDBx_Portal_db_metareg <- rbind(NAFLDBx_Portal_db_metareg, NAFLDBx_Portal_PE_db_reg_coef)
NAFLDBx_Portal_db_metareg <- rbind(NAFLDBx_Portal_db_metareg, NAFLDBx_Portal_PS_db_reg_coef)
NAFLDBx_Portal_db_metareg <- rbind(NAFLDBx_Portal_db_metareg, NAFLDBx_Portal_PI_db_reg_coef)
NAFLDBx_Portal_db_metareg <- rbind(NAFLDBx_Portal_db_metareg, NAFLDBx_Portal_Cer_db_reg_coef)
NAFLDBx_Portal_db_metareg <- rbind(NAFLDBx_Portal_db_metareg, NAFLDBx_Portal_PG_db_reg_coef)
NAFLDBx_Portal_db_metareg <- rbind(NAFLDBx_Portal_db_metareg, NAFLDBx_Portal_Gang_db_reg_coef)
NAFLDBx_Portal_db_metareg <- rbind(NAFLDBx_Portal_db_metareg, NAFLDBx_Portal_HexCer_db_reg_coef)
NAFLDBx_Portal_db_metareg <- rbind(NAFLDBx_Portal_db_metareg, NAFLDBx_Portal_LPE_db_reg_coef)
NAFLDBx_Portal_db_metareg <- rbind(NAFLDBx_Portal_db_metareg, NAFLDBx_Portal_LPI_db_reg_coef)
NAFLDBx_Portal_db_metareg <- rbind(NAFLDBx_Portal_db_metareg, NAFLDBx_Portal_Sphing_db_reg_coef)

## run for carbons


NAFLDBx_Portal_PC_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Portal_lm_sum2, LipidGroup=="PC"))
NAFLDBx_Portal_PC_Carb_reg_sm <- summary(NAFLDBx_Portal_PC_Carb_reg)
NAFLDBx_Portal_PC_Carb_reg_coef <- as.data.frame(NAFLDBx_Portal_PC_Carb_reg_sm$coefficients)
NAFLDBx_Portal_PC_Carb_reg_coef$LipidGroup <- "PC"
NAFLDBx_Portal_PC_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Portal_PC_Carb_reg_coef <- NAFLDBx_Portal_PC_Carb_reg_coef[-c(1),]
NAFLDBx_Portal_PC_Carb_reg_coef$r_sq <- NAFLDBx_Portal_PC_Carb_reg_sm$adj.r.squared

NAFLDBx_Portal_LPC_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Portal_lm_sum2, LipidGroup=="LysoPC"))
NAFLDBx_Portal_LPC_Carb_reg_sm <- summary(NAFLDBx_Portal_LPC_Carb_reg)
NAFLDBx_Portal_LPC_Carb_reg_coef <- as.data.frame(NAFLDBx_Portal_LPC_Carb_reg_sm$coefficients)
NAFLDBx_Portal_LPC_Carb_reg_coef$LipidGroup <- "LPC"
NAFLDBx_Portal_LPC_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Portal_LPC_Carb_reg_coef <- NAFLDBx_Portal_LPC_Carb_reg_coef[-c(1),]
NAFLDBx_Portal_LPC_Carb_reg_coef$r_sq <- NAFLDBx_Portal_LPC_Carb_reg_sm$adj.r.squared

NAFLDBx_Portal_DG_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Portal_lm_sum2, LipidGroup=="Diglyceride"))
NAFLDBx_Portal_DG_Carb_reg_sm <- summary(NAFLDBx_Portal_DG_Carb_reg)
NAFLDBx_Portal_DG_Carb_reg_coef <- as.data.frame(NAFLDBx_Portal_DG_Carb_reg_sm$coefficients)
NAFLDBx_Portal_DG_Carb_reg_coef$LipidGroup <- "DG"
NAFLDBx_Portal_DG_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Portal_DG_Carb_reg_coef <- NAFLDBx_Portal_DG_Carb_reg_coef[-c(1),]
NAFLDBx_Portal_DG_Carb_reg_coef$r_sq <- NAFLDBx_Portal_DG_Carb_reg_sm$adj.r.squared

NAFLDBx_Portal_TG_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Portal_lm_sum2, LipidGroup=="Triglyceride"))
NAFLDBx_Portal_TG_Carb_reg_sm <- summary(NAFLDBx_Portal_TG_Carb_reg)
NAFLDBx_Portal_TG_Carb_reg_coef <- as.data.frame(NAFLDBx_Portal_TG_Carb_reg_sm$coefficients)
NAFLDBx_Portal_TG_Carb_reg_coef$LipidGroup <- "TG"
NAFLDBx_Portal_TG_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Portal_TG_Carb_reg_coef <- NAFLDBx_Portal_TG_Carb_reg_coef[-c(1),]
NAFLDBx_Portal_TG_Carb_reg_coef$r_sq <- NAFLDBx_Portal_TG_Carb_reg_sm$adj.r.squared

NAFLDBx_Portal_SM_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Portal_lm_sum2, LipidGroup=="Sphingomyelin"))
NAFLDBx_Portal_SM_Carb_reg_sm <- summary(NAFLDBx_Portal_SM_Carb_reg)
NAFLDBx_Portal_SM_Carb_reg_coef <- as.data.frame(NAFLDBx_Portal_SM_Carb_reg_sm$coefficients)
NAFLDBx_Portal_SM_Carb_reg_coef$LipidGroup <- "SM"
NAFLDBx_Portal_SM_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Portal_SM_Carb_reg_coef <- NAFLDBx_Portal_SM_Carb_reg_coef[-c(1),]
NAFLDBx_Portal_SM_Carb_reg_coef$r_sq <- NAFLDBx_Portal_SM_Carb_reg_sm$adj.r.squared

NAFLDBx_Portal_PE_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Portal_lm_sum2, LipidGroup=="PE"))
NAFLDBx_Portal_PE_Carb_reg_sm <- summary(NAFLDBx_Portal_PE_Carb_reg)
NAFLDBx_Portal_PE_Carb_reg_coef <- as.data.frame(NAFLDBx_Portal_PE_Carb_reg_sm$coefficients)
NAFLDBx_Portal_PE_Carb_reg_coef$LipidGroup <- "PE"
NAFLDBx_Portal_PE_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Portal_PE_Carb_reg_coef <- NAFLDBx_Portal_PE_Carb_reg_coef[-c(1),]
NAFLDBx_Portal_PE_Carb_reg_coef$r_sq <- NAFLDBx_Portal_PE_Carb_reg_sm$adj.r.squared

NAFLDBx_Portal_PS_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Portal_lm_sum2, LipidGroup=="PS"))
NAFLDBx_Portal_PS_Carb_reg_sm <- summary(NAFLDBx_Portal_PS_Carb_reg)
NAFLDBx_Portal_PS_Carb_reg_coef <- as.data.frame(NAFLDBx_Portal_PS_Carb_reg_sm$coefficients)
NAFLDBx_Portal_PS_Carb_reg_coef$LipidGroup <- "PS"
NAFLDBx_Portal_PS_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Portal_PS_Carb_reg_coef <- NAFLDBx_Portal_PS_Carb_reg_coef[-c(1),]
NAFLDBx_Portal_PS_Carb_reg_coef$r_sq <- NAFLDBx_Portal_PS_Carb_reg_sm$adj.r.squared

NAFLDBx_Portal_PI_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Portal_lm_sum2, LipidGroup=="PI"))
NAFLDBx_Portal_PI_Carb_reg_sm <- summary(NAFLDBx_Portal_PI_Carb_reg)
NAFLDBx_Portal_PI_Carb_reg_coef <- as.data.frame(NAFLDBx_Portal_PI_Carb_reg_sm$coefficients)
NAFLDBx_Portal_PI_Carb_reg_coef$LipidGroup <- "PI"
NAFLDBx_Portal_PI_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Portal_PI_Carb_reg_coef <- NAFLDBx_Portal_PI_Carb_reg_coef[-c(1),]
NAFLDBx_Portal_PI_Carb_reg_coef$r_sq <- NAFLDBx_Portal_PI_Carb_reg_sm$adj.r.squared

NAFLDBx_Portal_Cer_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Portal_lm_sum2, LipidGroup=="Ceramide"))
NAFLDBx_Portal_Cer_Carb_reg_sm <- summary(NAFLDBx_Portal_Cer_Carb_reg)
NAFLDBx_Portal_Cer_Carb_reg_coef <- as.data.frame(NAFLDBx_Portal_Cer_Carb_reg_sm$coefficients)
NAFLDBx_Portal_Cer_Carb_reg_coef$LipidGroup <- "Cer"
NAFLDBx_Portal_Cer_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Portal_Cer_Carb_reg_coef <- NAFLDBx_Portal_Cer_Carb_reg_coef[-c(1),]
NAFLDBx_Portal_Cer_Carb_reg_coef$r_sq <- NAFLDBx_Portal_Cer_Carb_reg_sm$adj.r.squared

NAFLDBx_Portal_PG_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Portal_lm_sum2, LipidGroup=="PG"))
NAFLDBx_Portal_PG_Carb_reg_sm <- summary(NAFLDBx_Portal_PG_Carb_reg)
NAFLDBx_Portal_PG_Carb_reg_coef <- as.data.frame(NAFLDBx_Portal_PG_Carb_reg_sm$coefficients)
NAFLDBx_Portal_PG_Carb_reg_coef$LipidGroup <- "PG"
NAFLDBx_Portal_PG_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Portal_PG_Carb_reg_coef <- NAFLDBx_Portal_PG_Carb_reg_coef[-c(1),]
NAFLDBx_Portal_PG_Carb_reg_coef$r_sq <- NAFLDBx_Portal_PG_Carb_reg_sm$adj.r.squared

NAFLDBx_Portal_Gang_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Portal_lm_sum2, LipidGroup=="Ganglioside"))
NAFLDBx_Portal_Gang_Carb_reg_sm <- summary(NAFLDBx_Portal_Gang_Carb_reg)
NAFLDBx_Portal_Gang_Carb_reg_coef <- as.data.frame(NAFLDBx_Portal_Gang_Carb_reg_sm$coefficients)
NAFLDBx_Portal_Gang_Carb_reg_coef$LipidGroup <- "Gang"
NAFLDBx_Portal_Gang_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Portal_Gang_Carb_reg_coef <- NAFLDBx_Portal_Gang_Carb_reg_coef[-c(1),]
NAFLDBx_Portal_Gang_Carb_reg_coef$r_sq <- NAFLDBx_Portal_Gang_Carb_reg_sm$adj.r.squared

NAFLDBx_Portal_HexCer_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Portal_lm_sum2, LipidGroup=="Hexosylceramide"))
NAFLDBx_Portal_HexCer_Carb_reg_sm <- summary(NAFLDBx_Portal_HexCer_Carb_reg)
NAFLDBx_Portal_HexCer_Carb_reg_coef <- as.data.frame(NAFLDBx_Portal_HexCer_Carb_reg_sm$coefficients)
NAFLDBx_Portal_HexCer_Carb_reg_coef$LipidGroup <- "HexCer"
NAFLDBx_Portal_HexCer_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Portal_HexCer_Carb_reg_coef <- NAFLDBx_Portal_HexCer_Carb_reg_coef[-c(1),]
NAFLDBx_Portal_HexCer_Carb_reg_coef$r_sq <- NAFLDBx_Portal_HexCer_Carb_reg_sm$adj.r.squared

NAFLDBx_Portal_LPE_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Portal_lm_sum2, LipidGroup=="LysoPE"))
NAFLDBx_Portal_LPE_Carb_reg_sm <- summary(NAFLDBx_Portal_LPE_Carb_reg)
NAFLDBx_Portal_LPE_Carb_reg_coef <- as.data.frame(NAFLDBx_Portal_LPE_Carb_reg_sm$coefficients)
NAFLDBx_Portal_LPE_Carb_reg_coef$LipidGroup <- "LPE"
NAFLDBx_Portal_LPE_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Portal_LPE_Carb_reg_coef <- NAFLDBx_Portal_LPE_Carb_reg_coef[-c(1),]
NAFLDBx_Portal_LPE_Carb_reg_coef$r_sq <- NAFLDBx_Portal_LPE_Carb_reg_sm$adj.r.squared

NAFLDBx_Portal_LPI_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Portal_lm_sum2, LipidGroup=="LysoPI"))
NAFLDBx_Portal_LPI_Carb_reg_sm <- summary(NAFLDBx_Portal_LPI_Carb_reg)
NAFLDBx_Portal_LPI_Carb_reg_coef <- as.data.frame(NAFLDBx_Portal_LPI_Carb_reg_sm$coefficients)
NAFLDBx_Portal_LPI_Carb_reg_coef$LipidGroup <- "LPI"
NAFLDBx_Portal_LPI_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Portal_LPI_Carb_reg_coef <- NAFLDBx_Portal_LPI_Carb_reg_coef[-c(1),]
NAFLDBx_Portal_LPI_Carb_reg_coef$r_sq <- NAFLDBx_Portal_LPI_Carb_reg_sm$adj.r.squared

NAFLDBx_Portal_Sphing_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_Portal_lm_sum2, LipidGroup=="Sphingolipid"))
NAFLDBx_Portal_Sphing_Carb_reg_sm <- summary(NAFLDBx_Portal_Sphing_Carb_reg)
NAFLDBx_Portal_Sphing_Carb_reg_coef <- as.data.frame(NAFLDBx_Portal_Sphing_Carb_reg_sm$coefficients)
NAFLDBx_Portal_Sphing_Carb_reg_coef$LipidGroup <- "Sphing"
NAFLDBx_Portal_Sphing_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_Portal_Sphing_Carb_reg_coef <- NAFLDBx_Portal_Sphing_Carb_reg_coef[-c(1),]
NAFLDBx_Portal_Sphing_Carb_reg_coef$r_sq <- NAFLDBx_Portal_Sphing_Carb_reg_sm$adj.r.squared


NAFLDBx_Portal_Carb_metareg <- rbind(NAFLDBx_Portal_PC_Carb_reg_coef, NAFLDBx_Portal_LPC_Carb_reg_coef)
NAFLDBx_Portal_Carb_metareg <- rbind(NAFLDBx_Portal_Carb_metareg, NAFLDBx_Portal_DG_Carb_reg_coef)
NAFLDBx_Portal_Carb_metareg <- rbind(NAFLDBx_Portal_Carb_metareg, NAFLDBx_Portal_TG_Carb_reg_coef)
NAFLDBx_Portal_Carb_metareg <- rbind(NAFLDBx_Portal_Carb_metareg, NAFLDBx_Portal_SM_Carb_reg_coef)
NAFLDBx_Portal_Carb_metareg <- rbind(NAFLDBx_Portal_Carb_metareg, NAFLDBx_Portal_PE_Carb_reg_coef)
NAFLDBx_Portal_Carb_metareg <- rbind(NAFLDBx_Portal_Carb_metareg, NAFLDBx_Portal_PS_Carb_reg_coef)
NAFLDBx_Portal_Carb_metareg <- rbind(NAFLDBx_Portal_Carb_metareg, NAFLDBx_Portal_PI_Carb_reg_coef)
NAFLDBx_Portal_Carb_metareg <- rbind(NAFLDBx_Portal_Carb_metareg, NAFLDBx_Portal_Cer_Carb_reg_coef)
NAFLDBx_Portal_Carb_metareg <- rbind(NAFLDBx_Portal_Carb_metareg, NAFLDBx_Portal_PG_Carb_reg_coef)
NAFLDBx_Portal_Carb_metareg <- rbind(NAFLDBx_Portal_Carb_metareg, NAFLDBx_Portal_Gang_Carb_reg_coef)
NAFLDBx_Portal_Carb_metareg <- rbind(NAFLDBx_Portal_Carb_metareg, NAFLDBx_Portal_HexCer_Carb_reg_coef)
NAFLDBx_Portal_Carb_metareg <- rbind(NAFLDBx_Portal_Carb_metareg, NAFLDBx_Portal_LPE_Carb_reg_coef)
NAFLDBx_Portal_Carb_metareg <- rbind(NAFLDBx_Portal_Carb_metareg, NAFLDBx_Portal_LPI_Carb_reg_coef)
NAFLDBx_Portal_Carb_metareg <- rbind(NAFLDBx_Portal_Carb_metareg, NAFLDBx_Portal_Sphing_Carb_reg_coef)

NAFLDBx_Portal_metareg_summary <- rbind(NAFLDBx_Portal_Carb_metareg, NAFLDBx_Portal_db_metareg)
names(NAFLDBx_Portal_metareg_summary)[names(NAFLDBx_Portal_metareg_summary) == 'Pr(>|t|)'] <- 'pval'
NAFLDBx_Portal_metareg_summary$qval <- p.adjust(NAFLDBx_Portal_metareg_summary$pval, method = "hochberg")
write.table(NAFLDBx_Portal_metareg_summary,file="NAFLDBx_Portal_metareg_summary.csv",sep=",")



#### make meta-regression plots of specific beta vs db/carbon

NAFLDBx_Portal_TG_db <- ggplot(subset(NAFLDBx_data_Portal_lm_sum2, LipidGroup %in% c("Triglyceride")), aes(x=db, y=beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in TG") + ylab("Beta-regression coefficient") + theme_classic() + theme(legend.position="right", legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) 
NAFLDBx_Portal_TG_db

## + scale_x_continuous(breaks=seq(0,6,1), limits = c(0,6), expand = c(.05,0))
## + scale_y_continuous(breaks=seq(-.75,0.5,0.25), limits = c(-.75,0.5), expand = c(0,0))
## + annotate(geom = "text", x = 5, y = -.25, label = "italic(AdjR) ^ 2 == 0.06", parse = TRUE, size = 4)
## + annotate(geom = "text", x = 5, y = -.2, label = "P[slope] = 0.025", parse = FALSE, size = 4)

NAFLDBx_Portal_SM_db <- ggplot(subset(NAFLDBx_data_Portal_lm_sum2, LipidGroup %in% c("Sphingomyelin")), aes(x=db, y=beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in SM") + ylab("Beta-regression coefficient") + theme_classic() + theme(legend.position="right", legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) 
NAFLDBx_Portal_SM_db

NAFLDBx_Portal_PC_db <- ggplot(subset(NAFLDBx_data_Portal_lm_sum2, LipidGroup %in% c("PC")), aes(x=db, y=beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in PC") + ylab("Beta-regression coefficient") + theme_classic() + theme(legend.position="right", legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) 
NAFLDBx_Portal_PC_db

NAFLDBx_Portal_PC_Carb <- ggplot(subset(NAFLDBx_data_Portal_lm_sum2, LipidGroup %in% c("PC")), aes(x=Carb, y=beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in PC") + ylab("Beta-regression coefficient") + theme_classic() + theme(legend.position="right", legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) 
NAFLDBx_Portal_PC_Carb

NAFLDBx_Portal_top <- plot_grid(NAFLDBx_Portal_TG_db, NAFLDBx_Portal_SM_db, ncol = 2, labels = c('A','B'), label_fontfamily = 'serif', label_fontface = 'bold', label_size = 22, align = 'w')
NAFLDBx_Portal_bottom <- plot_grid(NAFLDBx_Portal_PC_db, NAFLDBx_Portal_PC_Carb, ncol = 2, labels = c('C','D'), label_fontfamily = 'serif', label_fontface = 'bold', label_size = 22, align = 'w', rel_widths = c(1.5, 1.5))

pdf(file="NAFLDBx_Portal_metareg_sumfig_v1.pdf",width=16,height=12)
plot_grid(NAFLDBx_Portal_top, NAFLDBx_Portal_bottom, ncol = 1, rel_heights = c(1.0, 1.0))
dev.off()

## attempt replication for ALT and HOMA-IR data from obesity cohorts

## Regress HOMA with lipids in NAFLDBx cohort
NAFLDBx_data_HOMA_lm_full <- lapply(NAFLDBx_data[54:281], function(x) summary(lm(x ~ NAFLDBx_data$log_HOMA + NAFLDBx_data$Sex + NAFLDBx_data$Age)))
NAFLDBx_data_HOMA_lm <- lapply(NAFLDBx_data_HOMA_lm_full, coef)
NAFLDBx_data_HOMA_lm <- data.frame(NAFLDBx_data_HOMA_lm)
NAFLDBx_data_HOMA_lm <- t(NAFLDBx_data_HOMA_lm)
NAFLDBx_data_HOMA_lm = subset(NAFLDBx_data_HOMA_lm, select = -c(1,3,4) )
NAFLDBx_data_HOMA_lm <- data.frame(NAFLDBx_data_HOMA_lm)
NAFLDBx_data_HOMA_lm$annot <- rep(annotation$annotation, each=1, length.out=nrow(NAFLDBx_data_HOMA_lm))
NAFLDBx_data_HOMA_lm <- NAFLDBx_data_HOMA_lm[order(NAFLDBx_data_HOMA_lm$annot),]
NAFLDBx_data_HOMA_lm_beta <- NAFLDBx_data_HOMA_lm[1:((nrow(NAFLDBx_data_HOMA_lm)/4)),]
NAFLDBx_data_HOMA_lm_p <- NAFLDBx_data_HOMA_lm[((nrow(NAFLDBx_data_HOMA_lm)/4)+1):((nrow(NAFLDBx_data_HOMA_lm)/4)*2),]
NAFLDBx_data_HOMA_lm_SE <- NAFLDBx_data_HOMA_lm[(((nrow(NAFLDBx_data_HOMA_lm)/4)*2)+1):((nrow(NAFLDBx_data_HOMA_lm)/4)*3),]
NAFLDBx_data_HOMA_lm_t <- NAFLDBx_data_HOMA_lm[(((nrow(NAFLDBx_data_HOMA_lm)/4)*3)+1):(nrow(NAFLDBx_data_HOMA_lm)),]

NAFLDBx_data_HOMA_lm_beta$beta <- NAFLDBx_data_HOMA_lm_beta$NAFLDBx_data.log_HOMA
NAFLDBx_data_HOMA_lm_beta = subset(NAFLDBx_data_HOMA_lm_beta, select = -c(1,2))
NAFLDBx_data_HOMA_lm_SE$SE <- NAFLDBx_data_HOMA_lm_SE$NAFLDBx_data.log_HOMA
NAFLDBx_data_HOMA_lm_SE = subset(NAFLDBx_data_HOMA_lm_SE, select = -c(1,2))
NAFLDBx_data_HOMA_lm_p$p <- NAFLDBx_data_HOMA_lm_p$NAFLDBx_data.log_HOMA
NAFLDBx_data_HOMA_lm_p = subset(NAFLDBx_data_HOMA_lm_p, select = -c(1,2))
NAFLDBx_data_HOMA_lm_t$t <- NAFLDBx_data_HOMA_lm_t$NAFLDBx_data.log_HOMA
NAFLDBx_data_HOMA_lm_t = subset(NAFLDBx_data_HOMA_lm_t, select = -c(1,2))

NAFLDBx_data_HOMA_lm_beta$name <- row.names(NAFLDBx_data_HOMA_lm_beta)
NAFLDBx_data_HOMA_lm_beta$name2 = substr(NAFLDBx_data_HOMA_lm_beta$name,1,nchar(NAFLDBx_data_HOMA_lm_beta$name)-9)
NAFLDBx_data_HOMA_lm_p$name <- row.names(NAFLDBx_data_HOMA_lm_p)
NAFLDBx_data_HOMA_lm_p$name2 = substr(NAFLDBx_data_HOMA_lm_p$name,1,nchar(NAFLDBx_data_HOMA_lm_p$name)-9)
NAFLDBx_data_HOMA_lm_SE$name <- row.names(NAFLDBx_data_HOMA_lm_SE)
NAFLDBx_data_HOMA_lm_SE$name2 = substr(NAFLDBx_data_HOMA_lm_SE$name,1,nchar(NAFLDBx_data_HOMA_lm_SE$name)-11)
NAFLDBx_data_HOMA_lm_t$name <- row.names(NAFLDBx_data_HOMA_lm_t)
NAFLDBx_data_HOMA_lm_t$name2 = substr(NAFLDBx_data_HOMA_lm_t$name,1,nchar(NAFLDBx_data_HOMA_lm_t$name)-8)

NAFLDBx_data_HOMA_lm_sum <- merge(NAFLDBx_data_HOMA_lm_beta, NAFLDBx_data_HOMA_lm_SE, by="name2")
NAFLDBx_data_HOMA_lm_sum <- merge(NAFLDBx_data_HOMA_lm_sum, NAFLDBx_data_HOMA_lm_p, by="name2")
NAFLDBx_data_HOMA_lm_sum <- merge(NAFLDBx_data_HOMA_lm_sum, NAFLDBx_data_HOMA_lm_t, by="name2")

NAFLDBx_data_HOMA_lm_sum = subset(NAFLDBx_data_HOMA_lm_sum, select = c("name2","beta","SE","t","p"))
names(NAFLDBx_data_HOMA_lm_sum)[names(NAFLDBx_data_HOMA_lm_sum) == 'name2'] <- 'var'
NAFLDBx_data_HOMA_lm_sum2 <- merge(Lipids_annotation, NAFLDBx_data_HOMA_lm_sum, by="var")
NAFLDBx_data_HOMA_lm_sum2$num <- nrow(NAFLDBx_data)
NAFLDBx_data_HOMA_lm_sum2$sig <- NA
NAFLDBx_data_HOMA_lm_sum2 <- NAFLDBx_data_HOMA_lm_sum2 %>% mutate(sig = ifelse(p < lipid_sig, "Significant", "Not significant"))

NAFLDBx_data_HOMA_lm_sum2$qval <- p.adjust(NAFLDBx_data_HOMA_lm_sum2$p, method = "hochberg")
NAFLDBx_data_HOMA_lm_sum2$negp <- -log10(NAFLDBx_data_HOMA_lm_sum2$p)
write.table(NAFLDBx_data_HOMA_lm_sum2,file="NAFLDBx_HOMA_lm_summary.csv",sep=",")

#####

## volcano plot

pdf(file="NAFLDBx_HOMA_lm_vol_v1.pdf",width=5,height=6)
NAFLDBx_HOMA_vol <- ggplot(data= NAFLDBx_data_HOMA_lm_sum2, aes(x=beta, y=negp, colour=LipidGroup)) + geom_point(alpha=0.4, size=1.75) + geom_text_repel(data = subset(NAFLDBx_data_HOMA_lm_sum2, negp > 2.3), aes(label = var), size = 3, key_glyph = "point") + xlab("Beta-regression coefficient") + ylab("-log10 p-value") + theme_bw() + theme(legend.position="right")  + theme(plot.title = element_text(face = "bold")) + theme(plot.title = element_text(hjust = 0.2)) + ggtitle("Plasma lipids associated with HOMA") + labs(color = "Lipid class")
NAFLDBx_HOMA_vol
dev.off()


############


## identify trends using meta-regression with beta vs carbons & db

NAFLDBx_HOMA_PC_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_HOMA_lm_sum2, LipidGroup=="PC"))
NAFLDBx_HOMA_PC_db_reg_sm <- summary(NAFLDBx_HOMA_PC_db_reg)
NAFLDBx_HOMA_PC_db_reg_coef <- as.data.frame(NAFLDBx_HOMA_PC_db_reg_sm$coefficients)
NAFLDBx_HOMA_PC_db_reg_coef$LipidGroup <- "PC"
NAFLDBx_HOMA_PC_db_reg_coef$MetaReg <- "db"
NAFLDBx_HOMA_PC_db_reg_coef <- NAFLDBx_HOMA_PC_db_reg_coef[-c(1),]
NAFLDBx_HOMA_PC_db_reg_coef$r_sq <- NAFLDBx_HOMA_PC_db_reg_sm$adj.r.squared

NAFLDBx_HOMA_LPC_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_HOMA_lm_sum2, LipidGroup=="LysoPC"))
NAFLDBx_HOMA_LPC_db_reg_sm <- summary(NAFLDBx_HOMA_LPC_db_reg)
NAFLDBx_HOMA_LPC_db_reg_coef <- as.data.frame(NAFLDBx_HOMA_LPC_db_reg_sm$coefficients)
NAFLDBx_HOMA_LPC_db_reg_coef$LipidGroup <- "LPC"
NAFLDBx_HOMA_LPC_db_reg_coef$MetaReg <- "db"
NAFLDBx_HOMA_LPC_db_reg_coef <- NAFLDBx_HOMA_LPC_db_reg_coef[-c(1),]
NAFLDBx_HOMA_LPC_db_reg_coef$r_sq <- NAFLDBx_HOMA_LPC_db_reg_sm$adj.r.squared

NAFLDBx_HOMA_DG_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_HOMA_lm_sum2, LipidGroup=="Diglyceride"))
NAFLDBx_HOMA_DG_db_reg_sm <- summary(NAFLDBx_HOMA_DG_db_reg)
NAFLDBx_HOMA_DG_db_reg_coef <- as.data.frame(NAFLDBx_HOMA_DG_db_reg_sm$coefficients)
NAFLDBx_HOMA_DG_db_reg_coef$LipidGroup <- "DG"
NAFLDBx_HOMA_DG_db_reg_coef$MetaReg <- "db"
NAFLDBx_HOMA_DG_db_reg_coef <- NAFLDBx_HOMA_DG_db_reg_coef[-c(1),]
NAFLDBx_HOMA_DG_db_reg_coef$r_sq <- NAFLDBx_HOMA_DG_db_reg_sm$adj.r.squared

NAFLDBx_HOMA_TG_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_HOMA_lm_sum2, LipidGroup=="Triglyceride"))
NAFLDBx_HOMA_TG_db_reg_sm <- summary(NAFLDBx_HOMA_TG_db_reg)
NAFLDBx_HOMA_TG_db_reg_coef <- as.data.frame(NAFLDBx_HOMA_TG_db_reg_sm$coefficients)
NAFLDBx_HOMA_TG_db_reg_coef$LipidGroup <- "TG"
NAFLDBx_HOMA_TG_db_reg_coef$MetaReg <- "db"
NAFLDBx_HOMA_TG_db_reg_coef <- NAFLDBx_HOMA_TG_db_reg_coef[-c(1),]
NAFLDBx_HOMA_TG_db_reg_coef$r_sq <- NAFLDBx_HOMA_TG_db_reg_sm$adj.r.squared

NAFLDBx_HOMA_SM_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_HOMA_lm_sum2, LipidGroup=="Sphingomyelin"))
NAFLDBx_HOMA_SM_db_reg_sm <- summary(NAFLDBx_HOMA_SM_db_reg)
NAFLDBx_HOMA_SM_db_reg_coef <- as.data.frame(NAFLDBx_HOMA_SM_db_reg_sm$coefficients)
NAFLDBx_HOMA_SM_db_reg_coef$LipidGroup <- "SM"
NAFLDBx_HOMA_SM_db_reg_coef$MetaReg <- "db"
NAFLDBx_HOMA_SM_db_reg_coef <- NAFLDBx_HOMA_SM_db_reg_coef[-c(1),]
NAFLDBx_HOMA_SM_db_reg_coef$r_sq <- NAFLDBx_HOMA_SM_db_reg_sm$adj.r.squared

NAFLDBx_HOMA_PE_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_HOMA_lm_sum2, LipidGroup=="PE"))
NAFLDBx_HOMA_PE_db_reg_sm <- summary(NAFLDBx_HOMA_PE_db_reg)
NAFLDBx_HOMA_PE_db_reg_coef <- as.data.frame(NAFLDBx_HOMA_PE_db_reg_sm$coefficients)
NAFLDBx_HOMA_PE_db_reg_coef$LipidGroup <- "PE"
NAFLDBx_HOMA_PE_db_reg_coef$MetaReg <- "db"
NAFLDBx_HOMA_PE_db_reg_coef <- NAFLDBx_HOMA_PE_db_reg_coef[-c(1),]
NAFLDBx_HOMA_PE_db_reg_coef$r_sq <- NAFLDBx_HOMA_PE_db_reg_sm$adj.r.squared

NAFLDBx_HOMA_PS_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_HOMA_lm_sum2, LipidGroup=="PS"))
NAFLDBx_HOMA_PS_db_reg_sm <- summary(NAFLDBx_HOMA_PS_db_reg)
NAFLDBx_HOMA_PS_db_reg_coef <- as.data.frame(NAFLDBx_HOMA_PS_db_reg_sm$coefficients)
NAFLDBx_HOMA_PS_db_reg_coef$LipidGroup <- "PS"
NAFLDBx_HOMA_PS_db_reg_coef$MetaReg <- "db"
NAFLDBx_HOMA_PS_db_reg_coef <- NAFLDBx_HOMA_PS_db_reg_coef[-c(1),]
NAFLDBx_HOMA_PS_db_reg_coef$r_sq <- NAFLDBx_HOMA_PS_db_reg_sm$adj.r.squared

NAFLDBx_HOMA_PI_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_HOMA_lm_sum2, LipidGroup=="PI"))
NAFLDBx_HOMA_PI_db_reg_sm <- summary(NAFLDBx_HOMA_PI_db_reg)
NAFLDBx_HOMA_PI_db_reg_coef <- as.data.frame(NAFLDBx_HOMA_PI_db_reg_sm$coefficients)
NAFLDBx_HOMA_PI_db_reg_coef$LipidGroup <- "PI"
NAFLDBx_HOMA_PI_db_reg_coef$MetaReg <- "db"
NAFLDBx_HOMA_PI_db_reg_coef <- NAFLDBx_HOMA_PI_db_reg_coef[-c(1),]
NAFLDBx_HOMA_PI_db_reg_coef$r_sq <- NAFLDBx_HOMA_PI_db_reg_sm$adj.r.squared

NAFLDBx_HOMA_Cer_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_HOMA_lm_sum2, LipidGroup=="Ceramide"))
NAFLDBx_HOMA_Cer_db_reg_sm <- summary(NAFLDBx_HOMA_Cer_db_reg)
NAFLDBx_HOMA_Cer_db_reg_coef <- as.data.frame(NAFLDBx_HOMA_Cer_db_reg_sm$coefficients)
NAFLDBx_HOMA_Cer_db_reg_coef$LipidGroup <- "Cer"
NAFLDBx_HOMA_Cer_db_reg_coef$MetaReg <- "db"
NAFLDBx_HOMA_Cer_db_reg_coef <- NAFLDBx_HOMA_Cer_db_reg_coef[-c(1),]
NAFLDBx_HOMA_Cer_db_reg_coef$r_sq <- NAFLDBx_HOMA_Cer_db_reg_sm$adj.r.squared

NAFLDBx_HOMA_PG_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_HOMA_lm_sum2, LipidGroup=="PG"))
NAFLDBx_HOMA_PG_db_reg_sm <- summary(NAFLDBx_HOMA_PG_db_reg)
NAFLDBx_HOMA_PG_db_reg_coef <- as.data.frame(NAFLDBx_HOMA_PG_db_reg_sm$coefficients)
NAFLDBx_HOMA_PG_db_reg_coef$LipidGroup <- "PG"
NAFLDBx_HOMA_PG_db_reg_coef$MetaReg <- "db"
NAFLDBx_HOMA_PG_db_reg_coef <- NAFLDBx_HOMA_PG_db_reg_coef[-c(1),]
NAFLDBx_HOMA_PG_db_reg_coef$r_sq <- NAFLDBx_HOMA_PG_db_reg_sm$adj.r.squared

NAFLDBx_HOMA_Gang_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_HOMA_lm_sum2, LipidGroup=="Ganglioside"))
NAFLDBx_HOMA_Gang_db_reg_sm <- summary(NAFLDBx_HOMA_Gang_db_reg)
NAFLDBx_HOMA_Gang_db_reg_coef <- as.data.frame(NAFLDBx_HOMA_Gang_db_reg_sm$coefficients)
NAFLDBx_HOMA_Gang_db_reg_coef$LipidGroup <- "Gang"
NAFLDBx_HOMA_Gang_db_reg_coef$MetaReg <- "db"
NAFLDBx_HOMA_Gang_db_reg_coef <- NAFLDBx_HOMA_Gang_db_reg_coef[-c(1),]
NAFLDBx_HOMA_Gang_db_reg_coef$r_sq <- NAFLDBx_HOMA_Gang_db_reg_sm$adj.r.squared

NAFLDBx_HOMA_HexCer_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_HOMA_lm_sum2, LipidGroup=="Hexosylceramide"))
NAFLDBx_HOMA_HexCer_db_reg_sm <- summary(NAFLDBx_HOMA_HexCer_db_reg)
NAFLDBx_HOMA_HexCer_db_reg_coef <- as.data.frame(NAFLDBx_HOMA_HexCer_db_reg_sm$coefficients)
NAFLDBx_HOMA_HexCer_db_reg_coef$LipidGroup <- "HexCer"
NAFLDBx_HOMA_HexCer_db_reg_coef$MetaReg <- "db"
NAFLDBx_HOMA_HexCer_db_reg_coef <- NAFLDBx_HOMA_HexCer_db_reg_coef[-c(1),]
NAFLDBx_HOMA_HexCer_db_reg_coef$r_sq <- NAFLDBx_HOMA_HexCer_db_reg_sm$adj.r.squared

NAFLDBx_HOMA_LPE_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_HOMA_lm_sum2, LipidGroup=="LysoPE"))
NAFLDBx_HOMA_LPE_db_reg_sm <- summary(NAFLDBx_HOMA_LPE_db_reg)
NAFLDBx_HOMA_LPE_db_reg_coef <- as.data.frame(NAFLDBx_HOMA_LPE_db_reg_sm$coefficients)
NAFLDBx_HOMA_LPE_db_reg_coef$LipidGroup <- "LPE"
NAFLDBx_HOMA_LPE_db_reg_coef$MetaReg <- "db"
NAFLDBx_HOMA_LPE_db_reg_coef <- NAFLDBx_HOMA_LPE_db_reg_coef[-c(1),]
NAFLDBx_HOMA_LPE_db_reg_coef$r_sq <- NAFLDBx_HOMA_LPE_db_reg_sm$adj.r.squared

NAFLDBx_HOMA_LPI_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_HOMA_lm_sum2, LipidGroup=="LysoPI"))
NAFLDBx_HOMA_LPI_db_reg_sm <- summary(NAFLDBx_HOMA_LPI_db_reg)
NAFLDBx_HOMA_LPI_db_reg_coef <- as.data.frame(NAFLDBx_HOMA_LPI_db_reg_sm$coefficients)
NAFLDBx_HOMA_LPI_db_reg_coef$LipidGroup <- "LPI"
NAFLDBx_HOMA_LPI_db_reg_coef$MetaReg <- "db"
NAFLDBx_HOMA_LPI_db_reg_coef <- NAFLDBx_HOMA_LPI_db_reg_coef[-c(1),]
NAFLDBx_HOMA_LPI_db_reg_coef$r_sq <- NAFLDBx_HOMA_LPI_db_reg_sm$adj.r.squared

NAFLDBx_HOMA_Sphing_db_reg <- lm(beta ~ db, data=subset(NAFLDBx_data_HOMA_lm_sum2, LipidGroup=="Sphingolipid"))
NAFLDBx_HOMA_Sphing_db_reg_sm <- summary(NAFLDBx_HOMA_Sphing_db_reg)
NAFLDBx_HOMA_Sphing_db_reg_coef <- as.data.frame(NAFLDBx_HOMA_Sphing_db_reg_sm$coefficients)
NAFLDBx_HOMA_Sphing_db_reg_coef$LipidGroup <- "Sphing"
NAFLDBx_HOMA_Sphing_db_reg_coef$MetaReg <- "db"
NAFLDBx_HOMA_Sphing_db_reg_coef <- NAFLDBx_HOMA_Sphing_db_reg_coef[-c(1),]
NAFLDBx_HOMA_Sphing_db_reg_coef$r_sq <- NAFLDBx_HOMA_Sphing_db_reg_sm$adj.r.squared

NAFLDBx_HOMA_db_metareg <- rbind(NAFLDBx_HOMA_PC_db_reg_coef, NAFLDBx_HOMA_LPC_db_reg_coef)
NAFLDBx_HOMA_db_metareg <- rbind(NAFLDBx_HOMA_db_metareg, NAFLDBx_HOMA_DG_db_reg_coef)
NAFLDBx_HOMA_db_metareg <- rbind(NAFLDBx_HOMA_db_metareg, NAFLDBx_HOMA_TG_db_reg_coef)
NAFLDBx_HOMA_db_metareg <- rbind(NAFLDBx_HOMA_db_metareg, NAFLDBx_HOMA_SM_db_reg_coef)
NAFLDBx_HOMA_db_metareg <- rbind(NAFLDBx_HOMA_db_metareg, NAFLDBx_HOMA_PE_db_reg_coef)
NAFLDBx_HOMA_db_metareg <- rbind(NAFLDBx_HOMA_db_metareg, NAFLDBx_HOMA_PS_db_reg_coef)
NAFLDBx_HOMA_db_metareg <- rbind(NAFLDBx_HOMA_db_metareg, NAFLDBx_HOMA_PI_db_reg_coef)
NAFLDBx_HOMA_db_metareg <- rbind(NAFLDBx_HOMA_db_metareg, NAFLDBx_HOMA_Cer_db_reg_coef)
NAFLDBx_HOMA_db_metareg <- rbind(NAFLDBx_HOMA_db_metareg, NAFLDBx_HOMA_PG_db_reg_coef)
NAFLDBx_HOMA_db_metareg <- rbind(NAFLDBx_HOMA_db_metareg, NAFLDBx_HOMA_Gang_db_reg_coef)
NAFLDBx_HOMA_db_metareg <- rbind(NAFLDBx_HOMA_db_metareg, NAFLDBx_HOMA_HexCer_db_reg_coef)
NAFLDBx_HOMA_db_metareg <- rbind(NAFLDBx_HOMA_db_metareg, NAFLDBx_HOMA_LPE_db_reg_coef)
NAFLDBx_HOMA_db_metareg <- rbind(NAFLDBx_HOMA_db_metareg, NAFLDBx_HOMA_LPI_db_reg_coef)
NAFLDBx_HOMA_db_metareg <- rbind(NAFLDBx_HOMA_db_metareg, NAFLDBx_HOMA_Sphing_db_reg_coef)

## run for carbons


NAFLDBx_HOMA_PC_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_HOMA_lm_sum2, LipidGroup=="PC"))
NAFLDBx_HOMA_PC_Carb_reg_sm <- summary(NAFLDBx_HOMA_PC_Carb_reg)
NAFLDBx_HOMA_PC_Carb_reg_coef <- as.data.frame(NAFLDBx_HOMA_PC_Carb_reg_sm$coefficients)
NAFLDBx_HOMA_PC_Carb_reg_coef$LipidGroup <- "PC"
NAFLDBx_HOMA_PC_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_HOMA_PC_Carb_reg_coef <- NAFLDBx_HOMA_PC_Carb_reg_coef[-c(1),]
NAFLDBx_HOMA_PC_Carb_reg_coef$r_sq <- NAFLDBx_HOMA_PC_Carb_reg_sm$adj.r.squared

NAFLDBx_HOMA_LPC_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_HOMA_lm_sum2, LipidGroup=="LysoPC"))
NAFLDBx_HOMA_LPC_Carb_reg_sm <- summary(NAFLDBx_HOMA_LPC_Carb_reg)
NAFLDBx_HOMA_LPC_Carb_reg_coef <- as.data.frame(NAFLDBx_HOMA_LPC_Carb_reg_sm$coefficients)
NAFLDBx_HOMA_LPC_Carb_reg_coef$LipidGroup <- "LPC"
NAFLDBx_HOMA_LPC_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_HOMA_LPC_Carb_reg_coef <- NAFLDBx_HOMA_LPC_Carb_reg_coef[-c(1),]
NAFLDBx_HOMA_LPC_Carb_reg_coef$r_sq <- NAFLDBx_HOMA_LPC_Carb_reg_sm$adj.r.squared

NAFLDBx_HOMA_DG_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_HOMA_lm_sum2, LipidGroup=="Diglyceride"))
NAFLDBx_HOMA_DG_Carb_reg_sm <- summary(NAFLDBx_HOMA_DG_Carb_reg)
NAFLDBx_HOMA_DG_Carb_reg_coef <- as.data.frame(NAFLDBx_HOMA_DG_Carb_reg_sm$coefficients)
NAFLDBx_HOMA_DG_Carb_reg_coef$LipidGroup <- "DG"
NAFLDBx_HOMA_DG_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_HOMA_DG_Carb_reg_coef <- NAFLDBx_HOMA_DG_Carb_reg_coef[-c(1),]
NAFLDBx_HOMA_DG_Carb_reg_coef$r_sq <- NAFLDBx_HOMA_DG_Carb_reg_sm$adj.r.squared

NAFLDBx_HOMA_TG_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_HOMA_lm_sum2, LipidGroup=="Triglyceride"))
NAFLDBx_HOMA_TG_Carb_reg_sm <- summary(NAFLDBx_HOMA_TG_Carb_reg)
NAFLDBx_HOMA_TG_Carb_reg_coef <- as.data.frame(NAFLDBx_HOMA_TG_Carb_reg_sm$coefficients)
NAFLDBx_HOMA_TG_Carb_reg_coef$LipidGroup <- "TG"
NAFLDBx_HOMA_TG_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_HOMA_TG_Carb_reg_coef <- NAFLDBx_HOMA_TG_Carb_reg_coef[-c(1),]
NAFLDBx_HOMA_TG_Carb_reg_coef$r_sq <- NAFLDBx_HOMA_TG_Carb_reg_sm$adj.r.squared

NAFLDBx_HOMA_SM_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_HOMA_lm_sum2, LipidGroup=="Sphingomyelin"))
NAFLDBx_HOMA_SM_Carb_reg_sm <- summary(NAFLDBx_HOMA_SM_Carb_reg)
NAFLDBx_HOMA_SM_Carb_reg_coef <- as.data.frame(NAFLDBx_HOMA_SM_Carb_reg_sm$coefficients)
NAFLDBx_HOMA_SM_Carb_reg_coef$LipidGroup <- "SM"
NAFLDBx_HOMA_SM_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_HOMA_SM_Carb_reg_coef <- NAFLDBx_HOMA_SM_Carb_reg_coef[-c(1),]
NAFLDBx_HOMA_SM_Carb_reg_coef$r_sq <- NAFLDBx_HOMA_SM_Carb_reg_sm$adj.r.squared

NAFLDBx_HOMA_PE_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_HOMA_lm_sum2, LipidGroup=="PE"))
NAFLDBx_HOMA_PE_Carb_reg_sm <- summary(NAFLDBx_HOMA_PE_Carb_reg)
NAFLDBx_HOMA_PE_Carb_reg_coef <- as.data.frame(NAFLDBx_HOMA_PE_Carb_reg_sm$coefficients)
NAFLDBx_HOMA_PE_Carb_reg_coef$LipidGroup <- "PE"
NAFLDBx_HOMA_PE_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_HOMA_PE_Carb_reg_coef <- NAFLDBx_HOMA_PE_Carb_reg_coef[-c(1),]
NAFLDBx_HOMA_PE_Carb_reg_coef$r_sq <- NAFLDBx_HOMA_PE_Carb_reg_sm$adj.r.squared

NAFLDBx_HOMA_PS_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_HOMA_lm_sum2, LipidGroup=="PS"))
NAFLDBx_HOMA_PS_Carb_reg_sm <- summary(NAFLDBx_HOMA_PS_Carb_reg)
NAFLDBx_HOMA_PS_Carb_reg_coef <- as.data.frame(NAFLDBx_HOMA_PS_Carb_reg_sm$coefficients)
NAFLDBx_HOMA_PS_Carb_reg_coef$LipidGroup <- "PS"
NAFLDBx_HOMA_PS_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_HOMA_PS_Carb_reg_coef <- NAFLDBx_HOMA_PS_Carb_reg_coef[-c(1),]
NAFLDBx_HOMA_PS_Carb_reg_coef$r_sq <- NAFLDBx_HOMA_PS_Carb_reg_sm$adj.r.squared

NAFLDBx_HOMA_PI_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_HOMA_lm_sum2, LipidGroup=="PI"))
NAFLDBx_HOMA_PI_Carb_reg_sm <- summary(NAFLDBx_HOMA_PI_Carb_reg)
NAFLDBx_HOMA_PI_Carb_reg_coef <- as.data.frame(NAFLDBx_HOMA_PI_Carb_reg_sm$coefficients)
NAFLDBx_HOMA_PI_Carb_reg_coef$LipidGroup <- "PI"
NAFLDBx_HOMA_PI_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_HOMA_PI_Carb_reg_coef <- NAFLDBx_HOMA_PI_Carb_reg_coef[-c(1),]
NAFLDBx_HOMA_PI_Carb_reg_coef$r_sq <- NAFLDBx_HOMA_PI_Carb_reg_sm$adj.r.squared

NAFLDBx_HOMA_Cer_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_HOMA_lm_sum2, LipidGroup=="Ceramide"))
NAFLDBx_HOMA_Cer_Carb_reg_sm <- summary(NAFLDBx_HOMA_Cer_Carb_reg)
NAFLDBx_HOMA_Cer_Carb_reg_coef <- as.data.frame(NAFLDBx_HOMA_Cer_Carb_reg_sm$coefficients)
NAFLDBx_HOMA_Cer_Carb_reg_coef$LipidGroup <- "Cer"
NAFLDBx_HOMA_Cer_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_HOMA_Cer_Carb_reg_coef <- NAFLDBx_HOMA_Cer_Carb_reg_coef[-c(1),]
NAFLDBx_HOMA_Cer_Carb_reg_coef$r_sq <- NAFLDBx_HOMA_Cer_Carb_reg_sm$adj.r.squared

NAFLDBx_HOMA_PG_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_HOMA_lm_sum2, LipidGroup=="PG"))
NAFLDBx_HOMA_PG_Carb_reg_sm <- summary(NAFLDBx_HOMA_PG_Carb_reg)
NAFLDBx_HOMA_PG_Carb_reg_coef <- as.data.frame(NAFLDBx_HOMA_PG_Carb_reg_sm$coefficients)
NAFLDBx_HOMA_PG_Carb_reg_coef$LipidGroup <- "PG"
NAFLDBx_HOMA_PG_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_HOMA_PG_Carb_reg_coef <- NAFLDBx_HOMA_PG_Carb_reg_coef[-c(1),]
NAFLDBx_HOMA_PG_Carb_reg_coef$r_sq <- NAFLDBx_HOMA_PG_Carb_reg_sm$adj.r.squared

NAFLDBx_HOMA_Gang_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_HOMA_lm_sum2, LipidGroup=="Ganglioside"))
NAFLDBx_HOMA_Gang_Carb_reg_sm <- summary(NAFLDBx_HOMA_Gang_Carb_reg)
NAFLDBx_HOMA_Gang_Carb_reg_coef <- as.data.frame(NAFLDBx_HOMA_Gang_Carb_reg_sm$coefficients)
NAFLDBx_HOMA_Gang_Carb_reg_coef$LipidGroup <- "Gang"
NAFLDBx_HOMA_Gang_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_HOMA_Gang_Carb_reg_coef <- NAFLDBx_HOMA_Gang_Carb_reg_coef[-c(1),]
NAFLDBx_HOMA_Gang_Carb_reg_coef$r_sq <- NAFLDBx_HOMA_Gang_Carb_reg_sm$adj.r.squared

NAFLDBx_HOMA_HexCer_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_HOMA_lm_sum2, LipidGroup=="Hexosylceramide"))
NAFLDBx_HOMA_HexCer_Carb_reg_sm <- summary(NAFLDBx_HOMA_HexCer_Carb_reg)
NAFLDBx_HOMA_HexCer_Carb_reg_coef <- as.data.frame(NAFLDBx_HOMA_HexCer_Carb_reg_sm$coefficients)
NAFLDBx_HOMA_HexCer_Carb_reg_coef$LipidGroup <- "HexCer"
NAFLDBx_HOMA_HexCer_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_HOMA_HexCer_Carb_reg_coef <- NAFLDBx_HOMA_HexCer_Carb_reg_coef[-c(1),]
NAFLDBx_HOMA_HexCer_Carb_reg_coef$r_sq <- NAFLDBx_HOMA_HexCer_Carb_reg_sm$adj.r.squared

NAFLDBx_HOMA_LPE_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_HOMA_lm_sum2, LipidGroup=="LysoPE"))
NAFLDBx_HOMA_LPE_Carb_reg_sm <- summary(NAFLDBx_HOMA_LPE_Carb_reg)
NAFLDBx_HOMA_LPE_Carb_reg_coef <- as.data.frame(NAFLDBx_HOMA_LPE_Carb_reg_sm$coefficients)
NAFLDBx_HOMA_LPE_Carb_reg_coef$LipidGroup <- "LPE"
NAFLDBx_HOMA_LPE_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_HOMA_LPE_Carb_reg_coef <- NAFLDBx_HOMA_LPE_Carb_reg_coef[-c(1),]
NAFLDBx_HOMA_LPE_Carb_reg_coef$r_sq <- NAFLDBx_HOMA_LPE_Carb_reg_sm$adj.r.squared

NAFLDBx_HOMA_LPI_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_HOMA_lm_sum2, LipidGroup=="LysoPI"))
NAFLDBx_HOMA_LPI_Carb_reg_sm <- summary(NAFLDBx_HOMA_LPI_Carb_reg)
NAFLDBx_HOMA_LPI_Carb_reg_coef <- as.data.frame(NAFLDBx_HOMA_LPI_Carb_reg_sm$coefficients)
NAFLDBx_HOMA_LPI_Carb_reg_coef$LipidGroup <- "LPI"
NAFLDBx_HOMA_LPI_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_HOMA_LPI_Carb_reg_coef <- NAFLDBx_HOMA_LPI_Carb_reg_coef[-c(1),]
NAFLDBx_HOMA_LPI_Carb_reg_coef$r_sq <- NAFLDBx_HOMA_LPI_Carb_reg_sm$adj.r.squared

NAFLDBx_HOMA_Sphing_Carb_reg <- lm(beta ~ Carb, data=subset(NAFLDBx_data_HOMA_lm_sum2, LipidGroup=="Sphingolipid"))
NAFLDBx_HOMA_Sphing_Carb_reg_sm <- summary(NAFLDBx_HOMA_Sphing_Carb_reg)
NAFLDBx_HOMA_Sphing_Carb_reg_coef <- as.data.frame(NAFLDBx_HOMA_Sphing_Carb_reg_sm$coefficients)
NAFLDBx_HOMA_Sphing_Carb_reg_coef$LipidGroup <- "Sphing"
NAFLDBx_HOMA_Sphing_Carb_reg_coef$MetaReg <- "Carb"
NAFLDBx_HOMA_Sphing_Carb_reg_coef <- NAFLDBx_HOMA_Sphing_Carb_reg_coef[-c(1),]
NAFLDBx_HOMA_Sphing_Carb_reg_coef$r_sq <- NAFLDBx_HOMA_Sphing_Carb_reg_sm$adj.r.squared


NAFLDBx_HOMA_Carb_metareg <- rbind(NAFLDBx_HOMA_PC_Carb_reg_coef, NAFLDBx_HOMA_LPC_Carb_reg_coef)
NAFLDBx_HOMA_Carb_metareg <- rbind(NAFLDBx_HOMA_Carb_metareg, NAFLDBx_HOMA_DG_Carb_reg_coef)
NAFLDBx_HOMA_Carb_metareg <- rbind(NAFLDBx_HOMA_Carb_metareg, NAFLDBx_HOMA_TG_Carb_reg_coef)
NAFLDBx_HOMA_Carb_metareg <- rbind(NAFLDBx_HOMA_Carb_metareg, NAFLDBx_HOMA_SM_Carb_reg_coef)
NAFLDBx_HOMA_Carb_metareg <- rbind(NAFLDBx_HOMA_Carb_metareg, NAFLDBx_HOMA_PE_Carb_reg_coef)
NAFLDBx_HOMA_Carb_metareg <- rbind(NAFLDBx_HOMA_Carb_metareg, NAFLDBx_HOMA_PS_Carb_reg_coef)
NAFLDBx_HOMA_Carb_metareg <- rbind(NAFLDBx_HOMA_Carb_metareg, NAFLDBx_HOMA_PI_Carb_reg_coef)
NAFLDBx_HOMA_Carb_metareg <- rbind(NAFLDBx_HOMA_Carb_metareg, NAFLDBx_HOMA_Cer_Carb_reg_coef)
NAFLDBx_HOMA_Carb_metareg <- rbind(NAFLDBx_HOMA_Carb_metareg, NAFLDBx_HOMA_PG_Carb_reg_coef)
NAFLDBx_HOMA_Carb_metareg <- rbind(NAFLDBx_HOMA_Carb_metareg, NAFLDBx_HOMA_Gang_Carb_reg_coef)
NAFLDBx_HOMA_Carb_metareg <- rbind(NAFLDBx_HOMA_Carb_metareg, NAFLDBx_HOMA_HexCer_Carb_reg_coef)
NAFLDBx_HOMA_Carb_metareg <- rbind(NAFLDBx_HOMA_Carb_metareg, NAFLDBx_HOMA_LPE_Carb_reg_coef)
NAFLDBx_HOMA_Carb_metareg <- rbind(NAFLDBx_HOMA_Carb_metareg, NAFLDBx_HOMA_LPI_Carb_reg_coef)
NAFLDBx_HOMA_Carb_metareg <- rbind(NAFLDBx_HOMA_Carb_metareg, NAFLDBx_HOMA_Sphing_Carb_reg_coef)

NAFLDBx_HOMA_metareg_summary <- rbind(NAFLDBx_HOMA_Carb_metareg, NAFLDBx_HOMA_db_metareg)
names(NAFLDBx_HOMA_metareg_summary)[names(NAFLDBx_HOMA_metareg_summary) == 'Pr(>|t|)'] <- 'pval'
NAFLDBx_HOMA_metareg_summary$qval <- p.adjust(NAFLDBx_HOMA_metareg_summary$pval, method = "hochberg")
write.table(NAFLDBx_HOMA_metareg_summary,file="NAFLDBx_HOMA_metareg_summary.csv",sep=",")



#### make meta-regression plots of specific beta vs db/carbon

NAFLDBx_HOMA_TG_db <- ggplot(subset(NAFLDBx_data_HOMA_lm_sum2, LipidGroup %in% c("Triglyceride")), aes(x=db, y=beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in TG") + ylab("Beta-regression coefficient") + theme_classic() + theme(legend.position="right", legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) 
NAFLDBx_HOMA_TG_db

## + scale_x_continuous(breaks=seq(0,6,1), limits = c(0,6), expand = c(.05,0))
## + scale_y_continuous(breaks=seq(-.75,0.5,0.25), limits = c(-.75,0.5), expand = c(0,0))
## + annotate(geom = "text", x = 5, y = -.25, label = "italic(AdjR) ^ 2 == 0.06", parse = TRUE, size = 4)
## + annotate(geom = "text", x = 5, y = -.2, label = "P[slope] = 0.025", parse = FALSE, size = 4)

NAFLDBx_HOMA_SM_db <- ggplot(subset(NAFLDBx_data_HOMA_lm_sum2, LipidGroup %in% c("Sphingomyelin")), aes(x=db, y=beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in SM") + ylab("Beta-regression coefficient") + theme_classic() + theme(legend.position="right", legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) 
NAFLDBx_HOMA_SM_db

NAFLDBx_HOMA_PC_db <- ggplot(subset(NAFLDBx_data_HOMA_lm_sum2, LipidGroup %in% c("PC")), aes(x=db, y=beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in PC") + ylab("Beta-regression coefficient") + theme_classic() + theme(legend.position="right", legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) 
NAFLDBx_HOMA_PC_db

NAFLDBx_HOMA_PC_Carb <- ggplot(subset(NAFLDBx_data_HOMA_lm_sum2, LipidGroup %in% c("PC")), aes(x=Carb, y=beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in PC") + ylab("Beta-regression coefficient") + theme_classic() + theme(legend.position="right", legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) 
NAFLDBx_HOMA_PC_Carb

NAFLDBx_HOMA_top <- plot_grid(NAFLDBx_HOMA_TG_db, NAFLDBx_HOMA_SM_db, ncol = 2, labels = c('A','B'), label_fontfamily = 'serif', label_fontface = 'bold', label_size = 22, align = 'w')
NAFLDBx_HOMA_bottom <- plot_grid(NAFLDBx_HOMA_PC_db, NAFLDBx_HOMA_PC_Carb, ncol = 2, labels = c('C','D'), label_fontfamily = 'serif', label_fontface = 'bold', label_size = 22, align = 'w', rel_widths = c(1.5, 1.5))

pdf(file="NAFLDBx_HOMA_metareg_sumfig_v1.pdf",width=16,height=12)
plot_grid(NAFLDBx_HOMA_top, NAFLDBx_HOMA_bottom, ncol = 1, rel_heights = c(1.0, 1.0))
dev.off()

############


## summary heatmap for linear regression using all lipids

names(obese_data_ALT_lm_sum2)[names(obese_data_ALT_lm_sum2) == 'beta'] <- 'Ob_ALT_beta'
names(obese_data_HOMA_lm_sum2)[names(obese_data_HOMA_lm_sum2) == 'beta'] <- 'Ob_HOMA_beta'
names(obese_data_HFF_lm_sum2)[names(obese_data_HFF_lm_sum2) == 'beta'] <- 'Ob_HFF_beta'
names(obese_data_TE_lm_sum2)[names(obese_data_TE_lm_sum2) == 'beta'] <- 'Ob_TE_beta'
names(NAFLDBx_data_NAS_lm_sum2)[names(NAFLDBx_data_NAS_lm_sum2) == 'beta'] <- 'NAFLD_NAS_beta'
names(NAFLDBx_data_Steat_lm_sum2)[names(NAFLDBx_data_Steat_lm_sum2) == 'beta'] <- 'NAFLD_Steat_beta'
names(NAFLDBx_data_Fib_lm_sum2)[names(NAFLDBx_data_Fib_lm_sum2) == 'beta'] <- 'NAFLD_Fib_beta'
names(NAFLDBx_data_Portal_lm_sum2)[names(NAFLDBx_data_Portal_lm_sum2) == 'beta'] <- 'NAFLD_Portal_beta'
names(NAFLDBx_data_HOMA_lm_sum2)[names(NAFLDBx_data_HOMA_lm_sum2) == 'beta'] <- 'NAFLD_HOMA_beta'


hm_lm_sumtab <- merge(obese_data_ALT_lm_sum2, obese_data_HOMA_lm_sum2, by="var")
hm_lm_sumtab <- merge(hm_lm_sumtab, obese_data_HFF_lm_sum2, by="var")
hm_lm_sumtab <- merge(hm_lm_sumtab, obese_data_TE_lm_sum2, by="var")
hm_lm_sumtab <- merge(hm_lm_sumtab, NAFLDBx_data_NAS_lm_sum2, by="var")
hm_lm_sumtab <- merge(hm_lm_sumtab, NAFLDBx_data_Steat_lm_sum2, by="var")
hm_lm_sumtab <- merge(hm_lm_sumtab, NAFLDBx_data_Fib_lm_sum2, by="var")
hm_lm_sumtab <- merge(hm_lm_sumtab, NAFLDBx_data_Portal_lm_sum2, by="var")
hm_lm_sumtab <- merge(hm_lm_sumtab, NAFLDBx_data_HOMA_lm_sum2, by="var")
rownames(hm_lm_sumtab) = hm_lm_sumtab$var

Group_simple = data.frame("Group_simple" = hm_lm_sumtab$LipidGroup.x)
rownames(Group_simple) = rownames(hm_lm_sumtab)

hm_lm_sumtab = subset(hm_lm_sumtab, select = c("Ob_ALT_beta", "Ob_HOMA_beta", "Ob_HFF_beta", "Ob_TE_beta", "NAFLD_NAS_beta", "NAFLD_Steat_beta", "NAFLD_Fib_beta", "NAFLD_Portal_beta", "NAFLD_HOMA_beta"))

hm_lm_sumtab[1:9] <- lapply(hm_lm_sumtab[1:9], function(x) c(scale(x)))

library(pheatmap)

cat_df = data.frame("category" = c("Obese","Obese","Obese","Obese","NAFLD-Bx","NAFLD-Bx","NAFLD-Bx","NAFLD-Bx","NAFLD-Bx"))
rownames(cat_df) = colnames(hm_lm_sumtab)

col_labels_df = data.frame("label" = c("ALT","HOMA-IR","HFF%","TE (kPa)", "NAS","Steatosis","Fibrosis stage","Portal inflammation","HOMA-IR"))
rownames(col_labels_df) = colnames(hm_lm_sumtab)


pdf(file="hm_lm_sum_v1.pdf",width=6,height=12)
hm_lm_sum <- pheatmap(hm_lm_sumtab[1:9], cluster_rows = TRUE, cluster_cols = TRUE, cutree_rows = 6, cutree_cols = 3, fontsize_row = 3, angle_col = 45, labels_col = col_labels_df$label, annotation_col = cat_df, annotation_row = Group_simple, labels_row = rownames(hm_lm_sumtab))
hm_lm_sum
dev.off()

## filter hm for only those with qval <.05

library(gtools)

obese_data_ALT_lm_sum3 <- obese_data_ALT_lm_sum2
obese_data_HOMA_lm_sum3 <- obese_data_HOMA_lm_sum2
obese_data_HFF_lm_sum3 <- obese_data_HFF_lm_sum2
obese_data_TE_lm_sum3 <- obese_data_TE_lm_sum2
NAFLDBx_data_NAS_lm_sum3 <- NAFLDBx_data_NAS_lm_sum2
NAFLDBx_data_Steat_lm_sum3 <- NAFLDBx_data_Steat_lm_sum2
NAFLDBx_data_Fib_lm_sum3 <- NAFLDBx_data_Fib_lm_sum2
NAFLDBx_data_Portal_lm_sum3 <- NAFLDBx_data_Portal_lm_sum2
NAFLDBx_data_HOMA_lm_sum3 <- NAFLDBx_data_HOMA_lm_sum2

names(obese_data_ALT_lm_sum3)[names(obese_data_ALT_lm_sum3) == 'p'] <- 'Ob_ALT_pval'
names(obese_data_HOMA_lm_sum3)[names(obese_data_HOMA_lm_sum3) == 'p'] <- 'Ob_HOMA_pval'
names(obese_data_HFF_lm_sum3)[names(obese_data_HFF_lm_sum3) == 'p'] <- 'Ob_HFF_pval'
names(obese_data_TE_lm_sum3)[names(obese_data_TE_lm_sum3) == 'p'] <- 'Ob_TE_pval'
names(NAFLDBx_data_NAS_lm_sum3)[names(NAFLDBx_data_NAS_lm_sum3) == 'p'] <- 'NAFLD_NAS_pval'
names(NAFLDBx_data_Steat_lm_sum3)[names(NAFLDBx_data_Steat_lm_sum3) == 'p'] <- 'NAFLD_Steat_pval'
names(NAFLDBx_data_Fib_lm_sum3)[names(NAFLDBx_data_Fib_lm_sum3) == 'p'] <- 'NAFLD_Fib_pval'
names(NAFLDBx_data_Portal_lm_sum3)[names(NAFLDBx_data_Portal_lm_sum3) == 'p'] <- 'NAFLD_Portal_pval'
names(NAFLDBx_data_HOMA_lm_sum3)[names(NAFLDBx_data_HOMA_lm_sum3) == 'p'] <- 'NAFLD_HOMA_pval'

names(obese_data_ALT_lm_sum3)[names(obese_data_ALT_lm_sum3) == 'qval'] <- 'Ob_ALT_qval'
names(obese_data_HOMA_lm_sum3)[names(obese_data_HOMA_lm_sum3) == 'qval'] <- 'Ob_HOMA_qval'
names(obese_data_HFF_lm_sum3)[names(obese_data_HFF_lm_sum3) == 'qval'] <- 'Ob_HFF_qval'
names(obese_data_TE_lm_sum3)[names(obese_data_TE_lm_sum3) == 'qval'] <- 'Ob_TE_qval'
names(NAFLDBx_data_NAS_lm_sum3)[names(NAFLDBx_data_NAS_lm_sum3) == 'qval'] <- 'NAFLD_NAS_qval'
names(NAFLDBx_data_Steat_lm_sum3)[names(NAFLDBx_data_Steat_lm_sum3) == 'qval'] <- 'NAFLD_Steat_qval'
names(NAFLDBx_data_Fib_lm_sum3)[names(NAFLDBx_data_Fib_lm_sum3) == 'qval'] <- 'NAFLD_Fib_qval'
names(NAFLDBx_data_Portal_lm_sum3)[names(NAFLDBx_data_Portal_lm_sum3) == 'qval'] <- 'NAFLD_Portal_qval'
names(NAFLDBx_data_HOMA_lm_sum3)[names(NAFLDBx_data_HOMA_lm_sum3) == 'qval'] <- 'NAFLD_HOMA_qval'

hm_lm_sumtab2 <- merge(obese_data_ALT_lm_sum3, obese_data_HOMA_lm_sum3, by="var", all=T)
hm_lm_sumtab2 <- merge(hm_lm_sumtab2, obese_data_HFF_lm_sum3, by="var", all=T)
hm_lm_sumtab2 <- merge(hm_lm_sumtab2, obese_data_TE_lm_sum3, by="var", all=T)
hm_lm_sumtab2 <- merge(hm_lm_sumtab2, NAFLDBx_data_NAS_lm_sum3, by="var", all=T)
hm_lm_sumtab2 <- merge(hm_lm_sumtab2, NAFLDBx_data_Steat_lm_sum3, by="var", all=T)
hm_lm_sumtab2 <- merge(hm_lm_sumtab2, NAFLDBx_data_Fib_lm_sum3, by="var", all=T)
hm_lm_sumtab2 <- merge(hm_lm_sumtab2, NAFLDBx_data_Portal_lm_sum3, by="var", all=T)
hm_lm_sumtab2 <- merge(hm_lm_sumtab2, NAFLDBx_data_HOMA_lm_sum3, by="var", all=T)
rownames(hm_lm_sumtab2) = hm_lm_sumtab2$var

hm_lm_sumtab2 = subset(hm_lm_sumtab2, select = c("Ob_ALT_beta", "Ob_HOMA_beta", "Ob_HFF_beta", "Ob_TE_beta", "NAFLD_NAS_beta", "NAFLD_Steat_beta", "NAFLD_Fib_beta", "NAFLD_Portal_beta", "NAFLD_HOMA_beta","Ob_ALT_pval", "Ob_HOMA_pval", "Ob_HFF_pval", "Ob_TE_pval", "NAFLD_NAS_pval", "NAFLD_Steat_pval", "NAFLD_Fib_pval", "NAFLD_Portal_pval", "NAFLD_HOMA_pval", "Ob_ALT_qval", "Ob_HOMA_qval", "Ob_HFF_qval", "Ob_TE_qval", "NAFLD_NAS_qval", "NAFLD_Steat_qval", "NAFLD_Fib_qval", "NAFLD_Portal_qval", "NAFLD_HOMA_qval","LipidGroup.x"))

hm_lm_sumtab2[1:9] <- lapply(hm_lm_sumtab2[1:9], function(x) c(scale(x)))

hm_lm_sumtab2 = subset(hm_lm_sumtab2, Ob_ALT_qval <0.05 | Ob_HOMA_qval <0.05 | Ob_HFF_qval <0.05 | Ob_TE_qval <0.05 | NAFLD_NAS_qval <0.05 | NAFLD_Steat_qval <0.05 | NAFLD_Fib_qval <0.05 | NAFLD_Portal_qval <0.05 | NAFLD_HOMA_qval <0.05)

Group_simple2 = data.frame("Group_simple2" = hm_lm_sumtab2$LipidGroup.x)
rownames(Group_simple2) = rownames(hm_lm_sumtab2)

hm_lm_sumtab2_pval = subset(hm_lm_sumtab2, select = c("Ob_ALT_qval", "Ob_HOMA_qval", "Ob_HFF_qval", "Ob_TE_qval", "NAFLD_NAS_qval", "NAFLD_Steat_qval", "NAFLD_Fib_qval", "NAFLD_Portal_qval", "NAFLD_HOMA_qval")) 

hm_lm_sumtab2 = subset(hm_lm_sumtab2, select = c("Ob_ALT_beta", "Ob_HOMA_beta", "Ob_HFF_beta", "Ob_TE_beta", "NAFLD_NAS_beta", "NAFLD_Steat_beta", "NAFLD_Fib_beta", "NAFLD_Portal_beta", "NAFLD_HOMA_beta"))

library(pheatmap)

cat_df2 = data.frame("category" = c("Obese","Obese","Obese","Obese","NAFLD-Bx","NAFLD-Bx","NAFLD-Bx","NAFLD-Bx","NAFLD-Bx"))
rownames(cat_df2) = colnames(hm_lm_sumtab2)

col_labels_df2 = data.frame("label" = c("ALT","HOMA-IR","HFF%","TE (kPa)", "NAS","Steatosis","Fibrosis stage","Portal inflammation","HOMA-IR"))
rownames(col_labels_df2) = colnames(hm_lm_sumtab2)

hm_lm_sumtab2_pval_stars = as.data.frame(stars.pval(hm_lm_sumtab2_pval$Ob_ALT_qval))
hm_lm_sumtab2_pval_stars$Ob_HOMA_qval <- stars.pval(hm_lm_sumtab2_pval$Ob_HOMA_qval)
hm_lm_sumtab2_pval_stars$Ob_HFF_qval <- stars.pval(hm_lm_sumtab2_pval$Ob_HFF_qval)
hm_lm_sumtab2_pval_stars$Ob_TE_qval <- stars.pval(hm_lm_sumtab2_pval$Ob_TE_qval)
hm_lm_sumtab2_pval_stars$NAFLD_NAS_qval <- stars.pval(hm_lm_sumtab2_pval$NAFLD_NAS_qval)
hm_lm_sumtab2_pval_stars$NAFLD_Steat_qval <- stars.pval(hm_lm_sumtab2_pval$NAFLD_Steat_qval)
hm_lm_sumtab2_pval_stars$NAFLD_Fib_qval <- stars.pval(hm_lm_sumtab2_pval$NAFLD_Fib_qval)
hm_lm_sumtab2_pval_stars$NAFLD_Portal_qval <- stars.pval(hm_lm_sumtab2_pval$NAFLD_Portal_qval)
hm_lm_sumtab2_pval_stars$NAFLD_HOMA_qval <- stars.pval(hm_lm_sumtab2_pval$NAFLD_HOMA_qval)

pdf(file="hm_lm_sum2_v1.pdf",width=6,height=12)
hm_lm_sum2 <- pheatmap(hm_lm_sumtab2[1:9], cluster_rows = TRUE, cluster_cols = TRUE, cutree_rows = 6, cutree_cols = 3, fontsize_row = 8, angle_col = 45, labels_col = col_labels_df2$label, annotation_col = cat_df2, annotation_row = Group_simple2, labels_row = rownames(hm_lm_sumtab2), border_color = NA, scale = "none", display_numbers = hm_lm_sumtab2_pval_stars[1:9], fontsize_number=10)
dev.off()


######## make heatmap for metareg summary

Obese_ALT_metareg_summary
Obese_HOMA_metareg_summary
Obese_HFF_metareg_summary
Obese_TE_metareg_summary
NAFLDBx_NAS_metareg_summary
NAFLDBx_Steat_metareg_summary
NAFLDBx_Fib_metareg_summary
NAFLDBx_Portal_metareg_summary
NAFLDBx_HOMA_metareg_summary

Obese_ALT_metareg_summary$metareg_name <- as.character(paste(Obese_ALT_metareg_summary$LipidGroup, Obese_ALT_metareg_summary$MetaReg, sep = "_"))
Obese_HOMA_metareg_summary$metareg_name <- as.character(paste(Obese_HOMA_metareg_summary$LipidGroup, Obese_HOMA_metareg_summary$MetaReg, sep = "_"))
Obese_HFF_metareg_summary$metareg_name <- as.character(paste(Obese_HFF_metareg_summary$LipidGroup, Obese_HFF_metareg_summary$MetaReg, sep = "_"))
Obese_TE_metareg_summary$metareg_name <- as.character(paste(Obese_TE_metareg_summary$LipidGroup, Obese_TE_metareg_summary$MetaReg, sep = "_"))
NAFLDBx_NAS_metareg_summary$metareg_name <- as.character(paste(NAFLDBx_NAS_metareg_summary$LipidGroup, NAFLDBx_NAS_metareg_summary$MetaReg, sep = "_"))
NAFLDBx_Steat_metareg_summary$metareg_name <- as.character(paste(NAFLDBx_Steat_metareg_summary$LipidGroup, NAFLDBx_Steat_metareg_summary$MetaReg, sep = "_"))
NAFLDBx_Fib_metareg_summary$metareg_name <- as.character(paste(NAFLDBx_Fib_metareg_summary$LipidGroup, NAFLDBx_Fib_metareg_summary$MetaReg, sep = "_"))
NAFLDBx_Portal_metareg_summary$metareg_name <- as.character(paste(NAFLDBx_Portal_metareg_summary$LipidGroup, NAFLDBx_Portal_metareg_summary$MetaReg, sep = "_"))
NAFLDBx_HOMA_metareg_summary$metareg_name <- as.character(paste(NAFLDBx_HOMA_metareg_summary$LipidGroup, NAFLDBx_HOMA_metareg_summary$MetaReg, sep = "_"))

names(Obese_ALT_metareg_summary)[names(Obese_ALT_metareg_summary) == 'Estimate'] <- 'Ob_ALT_beta'
names(Obese_HOMA_metareg_summary)[names(Obese_HOMA_metareg_summary) == 'Estimate'] <- 'Ob_HOMA_beta'
names(Obese_HFF_metareg_summary)[names(Obese_HFF_metareg_summary) == 'Estimate'] <- 'Ob_HFF_beta'
names(Obese_TE_metareg_summary)[names(Obese_TE_metareg_summary) == 'Estimate'] <- 'Ob_TE_beta'
names(NAFLDBx_NAS_metareg_summary)[names(NAFLDBx_NAS_metareg_summary) == 'Estimate'] <- 'NAFLD_NAS_beta'
names(NAFLDBx_Steat_metareg_summary)[names(NAFLDBx_Steat_metareg_summary) == 'Estimate'] <- 'NAFLD_Steat_beta'
names(NAFLDBx_Fib_metareg_summary)[names(NAFLDBx_Fib_metareg_summary) == 'Estimate'] <- 'NAFLD_Fib_beta'
names(NAFLDBx_Portal_metareg_summary)[names(NAFLDBx_Portal_metareg_summary) == 'Estimate'] <- 'NAFLD_Portal_beta'
names(NAFLDBx_HOMA_metareg_summary)[names(NAFLDBx_HOMA_metareg_summary) == 'Estimate'] <- 'NAFLD_HOMA_beta'

names(Obese_ALT_metareg_summary)[names(Obese_ALT_metareg_summary) == 'qval'] <- 'Ob_ALT_qval'
names(Obese_HOMA_metareg_summary)[names(Obese_HOMA_metareg_summary) == 'qval'] <- 'Ob_HOMA_qval'
names(Obese_HFF_metareg_summary)[names(Obese_HFF_metareg_summary) == 'qval'] <- 'Ob_HFF_qval'
names(Obese_TE_metareg_summary)[names(Obese_TE_metareg_summary) == 'qval'] <- 'Ob_TE_qval'
names(NAFLDBx_NAS_metareg_summary)[names(NAFLDBx_NAS_metareg_summary) == 'qval'] <- 'NAFLD_NAS_qval'
names(NAFLDBx_Steat_metareg_summary)[names(NAFLDBx_Steat_metareg_summary) == 'qval'] <- 'NAFLD_Steat_qval'
names(NAFLDBx_Fib_metareg_summary)[names(NAFLDBx_Fib_metareg_summary) == 'qval'] <- 'NAFLD_Fib_qval'
names(NAFLDBx_Portal_metareg_summary)[names(NAFLDBx_Portal_metareg_summary) == 'qval'] <- 'NAFLD_Portal_qval'
names(NAFLDBx_HOMA_metareg_summary)[names(NAFLDBx_HOMA_metareg_summary) == 'qval'] <- 'NAFLD_HOMA_qval'

names(Obese_ALT_metareg_summary)[names(Obese_ALT_metareg_summary) == 'pval'] <- 'Ob_ALT_pval'
names(Obese_HOMA_metareg_summary)[names(Obese_HOMA_metareg_summary) == 'pval'] <- 'Ob_HOMA_pval'
names(Obese_HFF_metareg_summary)[names(Obese_HFF_metareg_summary) == 'pval'] <- 'Ob_HFF_pval'
names(Obese_TE_metareg_summary)[names(Obese_TE_metareg_summary) == 'pval'] <- 'Ob_TE_pval'
names(NAFLDBx_NAS_metareg_summary)[names(NAFLDBx_NAS_metareg_summary) == 'pval'] <- 'NAFLD_NAS_pval'
names(NAFLDBx_Steat_metareg_summary)[names(NAFLDBx_Steat_metareg_summary) == 'pval'] <- 'NAFLD_Steat_pval'
names(NAFLDBx_Fib_metareg_summary)[names(NAFLDBx_Fib_metareg_summary) == 'pval'] <- 'NAFLD_Fib_pval'
names(NAFLDBx_Portal_metareg_summary)[names(NAFLDBx_Portal_metareg_summary) == 'pval'] <- 'NAFLD_Portal_pval'
names(NAFLDBx_HOMA_metareg_summary)[names(NAFLDBx_HOMA_metareg_summary) == 'pval'] <- 'NAFLD_HOMA_pval'

hm_metareg_sumtab <- merge(Obese_ALT_metareg_summary, Obese_HOMA_metareg_summary, by="metareg_name")
hm_metareg_sumtab <- merge(hm_metareg_sumtab, Obese_HFF_metareg_summary, by="metareg_name")
hm_metareg_sumtab <- merge(hm_metareg_sumtab, Obese_TE_metareg_summary, by="metareg_name")
hm_metareg_sumtab <- merge(hm_metareg_sumtab, NAFLDBx_NAS_metareg_summary, by="metareg_name")
hm_metareg_sumtab <- merge(hm_metareg_sumtab, NAFLDBx_Steat_metareg_summary, by="metareg_name")
hm_metareg_sumtab <- merge(hm_metareg_sumtab, NAFLDBx_Portal_metareg_summary, by="metareg_name")
hm_metareg_sumtab <- merge(hm_metareg_sumtab, NAFLDBx_Fib_metareg_summary, by="metareg_name")
hm_metareg_sumtab <- merge(hm_metareg_sumtab, NAFLDBx_HOMA_metareg_summary, by="metareg_name")

hm_metareg_sumtab = subset(hm_metareg_sumtab, select = c("Ob_ALT_beta", "Ob_HOMA_beta", "Ob_HFF_beta", "Ob_TE_beta", "NAFLD_NAS_beta", "NAFLD_Steat_beta", "NAFLD_Fib_beta", "NAFLD_Portal_beta", "NAFLD_HOMA_beta","Ob_ALT_pval", "Ob_HOMA_pval", "Ob_HFF_pval", "Ob_TE_pval", "NAFLD_NAS_pval", "NAFLD_Steat_pval", "NAFLD_Fib_pval", "NAFLD_Portal_pval", "NAFLD_HOMA_pval", "Ob_ALT_qval", "Ob_HOMA_qval", "Ob_HFF_qval", "Ob_TE_qval", "NAFLD_NAS_qval", "NAFLD_Steat_qval", "NAFLD_Fib_qval", "NAFLD_Portal_qval", "NAFLD_HOMA_qval","LipidGroup.x", "metareg_name"))

hm_metareg_sumtab[1:9] <- lapply(hm_metareg_sumtab[1:9], function(x) c(scale(x)))

rownames(hm_metareg_sumtab) = hm_metareg_sumtab$metareg_name
metareg_name = data.frame("metareg_name" = hm_metareg_sumtab$metareg_name)
rownames(metareg_name) = metareg_name$metareg_name

cat_meta_df = data.frame("category" = c("Obese","Obese","Obese","Obese","NAFLD-Bx","NAFLD-Bx","NAFLD-Bx","NAFLD-Bx","NAFLD-Bx"))
rownames(cat_meta_df) = colnames(hm_metareg_sumtab[1:9])

hm_metareg_pval_sumtab = subset(hm_metareg_sumtab, select = c("Ob_ALT_qval", "Ob_HOMA_qval", "Ob_HFF_qval", "Ob_TE_qval", "NAFLD_NAS_qval", "NAFLD_Steat_qval", "NAFLD_Fib_qval", "NAFLD_Portal_qval", "NAFLD_HOMA_qval","metareg_name"))
rownames(hm_metareg_pval_sumtab) = hm_metareg_pval_sumtab$metareg_name

hm_metareg_pval_sumtab_stars = as.data.frame(stars.pval(hm_metareg_pval_sumtab$Ob_ALT_qval))
hm_metareg_pval_sumtab_stars$Ob_HOMA_qval <- stars.pval(hm_metareg_pval_sumtab$Ob_HOMA_qval)
hm_metareg_pval_sumtab_stars$Ob_HFF_qval <- stars.pval(hm_metareg_pval_sumtab$Ob_HFF_qval)
hm_metareg_pval_sumtab_stars$Ob_TE_qval <- stars.pval(hm_metareg_pval_sumtab$Ob_TE_qval)
hm_metareg_pval_sumtab_stars$NAFLD_NAS_qval <- stars.pval(hm_metareg_pval_sumtab$NAFLD_NAS_qval)
hm_metareg_pval_sumtab_stars$NAFLD_Steat_qval <- stars.pval(hm_metareg_pval_sumtab$NAFLD_Steat_qval)
hm_metareg_pval_sumtab_stars$NAFLD_Fib_qval <- stars.pval(hm_metareg_pval_sumtab$NAFLD_Fib_qval)
hm_metareg_pval_sumtab_stars$NAFLD_Portal_qval <- stars.pval(hm_metareg_pval_sumtab$NAFLD_Portal_qval)
hm_metareg_pval_sumtab_stars$NAFLD_HOMA_qval <- stars.pval(hm_metareg_pval_sumtab$NAFLD_HOMA_qval)
rownames(hm_metareg_pval_sumtab_stars) = rownames(hm_metareg_pval_sumtab)

pdf(file="hm_metareg_sum_v2.pdf",width=8,height=6)
hm_metareg_sum <- pheatmap(hm_metareg_sumtab[1:9], cluster_rows = TRUE, cluster_cols = TRUE, annotation_row = metareg_name, angle_col = 45, cutree_rows = 4, cutree_cols = 3, display_numbers = hm_metareg_pval_sumtab_stars[1:9], fontsize_number=10)
hm_metareg_sum
dev.off()


### repeat but with filtering for sig associations


hm_metareg_sumtab2 = subset(hm_metareg_sumtab, Ob_ALT_qval <0.05 | Ob_HOMA_qval <0.05 | Ob_HFF_qval <0.05 | Ob_TE_qval <0.05 | NAFLD_NAS_qval <0.05 | NAFLD_Steat_qval <0.05 | NAFLD_Fib_qval <0.05 | NAFLD_Portal_qval <0.05 | NAFLD_HOMA_qval <0.05)


## hm_metareg_sumtab2[1:9] <- lapply(hm_metareg_sumtab2[1:9], function(x) c(scale(x)))

rownames(hm_metareg_sumtab2) = hm_metareg_sumtab2$metareg_name
metareg_name = data.frame("metareg_name" = hm_metareg_sumtab2$metareg_name)
rownames(metareg_name) = metareg_name$metareg_name

cat_meta_df = data.frame("category" = c("Obese","Obese","Obese","Obese","NAFLD-Bx","NAFLD-Bx","NAFLD-Bx","NAFLD-Bx","NAFLD-Bx"))
rownames(cat_meta_df) = colnames(hm_metareg_sumtab2[1:9])

hm_metareg_pval_sumtab2 = subset(hm_metareg_sumtab2, select = c("Ob_ALT_qval", "Ob_HOMA_qval", "Ob_HFF_qval", "Ob_TE_qval", "NAFLD_NAS_qval", "NAFLD_Steat_qval", "NAFLD_Fib_qval", "NAFLD_Portal_qval", "NAFLD_HOMA_qval","metareg_name"))
rownames(hm_metareg_pval_sumtab2) = hm_metareg_pval_sumtab2$metareg_name

hm_metareg_pval_sumtab2_stars = as.data.frame(stars.pval(hm_metareg_pval_sumtab2$Ob_ALT_qval))
hm_metareg_pval_sumtab2_stars$Ob_HOMA_qval <- stars.pval(hm_metareg_pval_sumtab2$Ob_HOMA_qval)
hm_metareg_pval_sumtab2_stars$Ob_HFF_qval <- stars.pval(hm_metareg_pval_sumtab2$Ob_HFF_qval)
hm_metareg_pval_sumtab2_stars$Ob_TE_qval <- stars.pval(hm_metareg_pval_sumtab2$Ob_TE_qval)
hm_metareg_pval_sumtab2_stars$NAFLD_NAS_qval <- stars.pval(hm_metareg_pval_sumtab2$NAFLD_NAS_qval)
hm_metareg_pval_sumtab2_stars$NAFLD_Steat_qval <- stars.pval(hm_metareg_pval_sumtab2$NAFLD_Steat_qval)
hm_metareg_pval_sumtab2_stars$NAFLD_Fib_qval <- stars.pval(hm_metareg_pval_sumtab2$NAFLD_Fib_qval)
hm_metareg_pval_sumtab2_stars$NAFLD_Portal_qval <- stars.pval(hm_metareg_pval_sumtab2$NAFLD_Portal_qval)
hm_metareg_pval_sumtab2_stars$NAFLD_HOMA_qval <- stars.pval(hm_metareg_pval_sumtab2$NAFLD_HOMA_qval)
rownames(hm_metareg_pval_sumtab2_stars) = rownames(hm_metareg_pval_sumtab2)

pdf(file="hm_metareg_sum2_v2.pdf",width=8,height=6)
hm_metareg_sum2 <- pheatmap(hm_metareg_sumtab2[1:9], cluster_rows = TRUE, cluster_cols = TRUE, annotation_row = metareg_name, angle_col = 45, cutree_rows = 4, cutree_cols = 3, display_numbers = hm_metareg_pval_sumtab2_stars[1:9], fontsize_number=10)
hm_metareg_sum2
dev.off()




############  make summaries of total lipids from raw data

data_abs <- read_excel("Paed_Lipidom_data_abs.xlsx")

## only keep lipids with >70% complete
data_abs <- data_abs[colSums(is.na(data_abs))/nrow(data_abs) < .3]

## use minimum value imputation to replace blanks
data_abs[] <- lapply(data_abs, min_function)

## merge metadata  with lipid data
data_full_abs <- merge(meta_data, data_abs, by="Participant")
write.table(data_full_abs, file="data_full_abs.csv",sep=",")

Cer_totals <- data_full_abs[70:87] %>% mutate(Cer_total = rowSums(.))
data_full_abs$Cer_total <- Cer_totals$Cer_total
DG_totals <- data_full_abs[88:89] %>% mutate(DG_total = rowSums(.))
data_full_abs$DG_total <- DG_totals$DG_total
GM_totals <- data_full_abs[90:103] %>% mutate(GM_total = rowSums(.))
data_full_abs$GM_total <- GM_totals$GM_total
HexCer_totals <- data_full_abs[104:113] %>% mutate(HexCer_total = rowSums(.))
data_full_abs$HexCer_total <- HexCer_totals$HexCer_total
LacCer_totals <- data_full_abs[114:116] %>% mutate(LacCer_total = rowSums(.))
data_full_abs$LacCer_total <- LacCer_totals$LacCer_total
LPC_totals <- data_full_abs[117:132] %>% mutate(LPC_total = rowSums(.))
data_full_abs$LPC_total <- LPC_totals$LPC_total
LPE_totals <- data_full_abs[133:135] %>% mutate(LPE_total = rowSums(.))
data_full_abs$LPE_total <- LPE_totals$LPE_total
LPI_totals <- data_full_abs[136:141] %>% mutate(LPI_total = rowSums(.))
data_full_abs$LPI_total <- LPI_totals$LPI_total
PI_totals <- data_full_abs[142:155] %>% mutate(PI_total = rowSums(.))
data_full_abs$PI_total <- PI_totals$PI_total
PS_totals <- data_full_abs[156:164] %>% mutate(PS_total = rowSums(.))
data_full_abs$PS_total <- PS_totals$PS_total
PC_totals <- data_full_abs[165:205] %>% mutate(PC_total = rowSums(.))
data_full_abs$PC_total <- PC_totals$PC_total
PE_totals <- data_full_abs[206:212] %>% mutate(PE_total = rowSums(.))
data_full_abs$PE_total <- PE_totals$PE_total
PG_totals <- data_full_abs[213:215] %>% mutate(PG_total = rowSums(.))
data_full_abs$PG_total <- PG_totals$PG_total
SM_totals <- data_full_abs[216:247] %>% mutate(SM_total = rowSums(.))
data_full_abs$SM_total <- SM_totals$SM_total
S_totals <- data_full_abs[248:253] %>% mutate(S_total = rowSums(.))
data_full_abs$S_total <- S_totals$S_total
TG_totals <- data_full_abs[254:297] %>% mutate(TG_total = rowSums(.))
data_full_abs$TG_total <- TG_totals$TG_total

require(viridis)

data_full_abs$bmi_cat <- cut(data_full_abs$bmi, breaks=c(-Inf, -1, 0, 1, 2, 3, 4, Inf), labels=c("<-1","-1 to 0","0 to +1","+1 to +2","+2 to +3","+3 to +4",">+4"))
write.table(data_full_abs, file="data_full_abs.csv",sep=",")
data_full_abs$bmi_cat <- as.factor(data_full_abs$bmi_cat)

data_full_abs$ALT_cat <- cut(data_full_abs$ALT, breaks=c(-Inf, 25, 50, 100, 150, Inf), labels=c("<25","25 to 50","50 to 100","100 to 150",">150"))

names(data_full_abs)[names(data_full_abs) == 'HFF%'] <- 'HFF'
data_full_abs$HFF_cat <- cut(data_full_abs$HFF, breaks=c(-Inf, 2.5, 5, 7.5, 10, Inf), labels=c("<2.5%","2.5% to 5%","5% to 7.5%","7.5% to 10%",">10%"))

data_full_abs$NAS <- as.factor(data_full_abs$NAS)
data_full_abs_Rome = subset(data_full_abs, Centre =="Rome")
data_full_abs_Rome = subset(data_full_abs, NAS !=0)
data_full_abs_NotRome = subset(data_full_abs, Centre !="Rome")

data_full_abs_bmi = subset(data_full_abs, bmi_cat !="NA")
data_full_abs_NotRome_ALT = subset(data_full_abs_NotRome, ALT_cat !="NA")
data_full_abs_NotRome_HFF = subset(data_full_abs_NotRome, HFF_cat !="NA")

data_full_abs$Group <- as.factor(data_full_abs$Group)
data_full_abs$Group <- factor(data_full_abs$Group, levels = c("Lean", "Obese", "NAFLD"))


############### ------- triglycerides summary figure

plot.margin = margin(6, 10, 6, 6, "pt")


TG_box <- ggplot(data=data_full_abs, aes(x=Group, y=TG_total)) + geom_boxplot(aes(fill=Group), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=Group), show.legend=FALSE) + ylab("") + theme_classic() + theme(plot.margin = margin(10, 10, 10, 10, "pt"), legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=90, vjust=0.5), axis.text.x=element_text(angle=45, size=12, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Total TG") + ylab("Plasma TG \n (uM)") + scale_y_continuous(limits=c(0,6000), breaks=seq(0,6000,1000), expand = c(0,0))
TG_box

TG_box_bmi <- ggplot(data= data_full_abs_bmi, aes(x= bmi_cat, y=TG_total)) + geom_boxplot(aes(fill= bmi_cat), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill= bmi_cat), show.legend=FALSE) + ylab("") + theme_classic() + theme(plot.margin = margin(10, 10, 10, 10, "pt"), legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(angle=45, size=10, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Total TG \n BMI z-score") + scale_y_continuous(limits=c(0,6000), breaks=seq(0,6000,1000), expand = c(0,0))
TG_box_bmi

TG_box_NAS <- ggplot(data=data_full_abs_Rome, aes(x=NAS, y=TG_total)) + geom_boxplot(aes(fill=NAS), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=NAS), show.legend=FALSE) + ylab("") + theme_classic() + theme(plot.margin = margin(10, 10, 10, 10, "pt"), legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(size=12)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Total TG \n NAFLD Activity Score")
TG_box_NAS

TG_top <- plot_grid(TG_box, TG_box_bmi, TG_box_NAS, ncol = 3, labels = c('A','B','C'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'h',rel_widths = c(1, 0.9, 0.9))

Obese_ALT_TG_db <- ggplot(subset(obese_data_ALT_lm_sum2, LipidGroup %in% c("Triglyceride")), aes(x=db, y=Ob_ALT_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in TG") + ylab("Beta-regression \n coefficient") + theme_classic() + theme(plot.margin = margin(10, 10, 10, 10, "pt"), legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("")
Obese_ALT_TG_db

Obese_ALT_TG_Carb <- ggplot(subset(obese_data_ALT_lm_sum2, LipidGroup %in% c("Triglyceride")), aes(x=Carb, y=Ob_ALT_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in TG") + ylab("Beta-regression \n coefficient") + theme_classic() + theme(plot.margin = margin(10, 10, 10, 10, "pt"), legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("Serum ALT")
Obese_ALT_TG_Carb

TG_mid_left <- plot_grid(Obese_ALT_TG_Carb, Obese_ALT_TG_db, ncol = 1, labels = c('D','E'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'w')

Obese_HFF_TG_db <- ggplot(subset(obese_data_HFF_lm_sum2, LipidGroup %in% c("Triglyceride")), aes(x=db, y=Ob_HFF_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in TG") + ylab("") + theme_classic() + theme(plot.margin = margin(10, 10, 10, 10, "pt"), legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("")
Obese_HFF_TG_db

Obese_HFF_TG_Carb <- ggplot(subset(obese_data_HFF_lm_sum2, LipidGroup %in% c("Triglyceride")), aes(x=Carb, y=Ob_HFF_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in TG") + ylab("") + theme_classic() + theme(plot.margin = margin(10, 10, 10, 10, "pt"), legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("Hepatic \nfat fraction")
Obese_HFF_TG_Carb

TG_mid_mid <- plot_grid(Obese_HFF_TG_Carb, Obese_HFF_TG_db, ncol = 1, labels = c('F','G'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'w')

NAFLDBx_NAS_TG_db <- ggplot(subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup %in% c("Triglyceride")), aes(x=db, y=NAFLD_NAS_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in TG") + ylab("") + theme_classic() + theme(plot.margin = margin(10, 10, 10, 10, "pt"), legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("")
NAFLDBx_NAS_TG_db

NAFLDBx_NAS_TG_Carb <- ggplot(subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup %in% c("Triglyceride")), aes(x=Carb, y=NAFLD_NAS_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in TG") + ylab("") + theme_classic() + theme(plot.margin = margin(10, 10, 10, 10, "pt"), legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("NAFLD \nActivity Score")
NAFLDBx_NAS_TG_Carb

TG_mid_RIGHT <- plot_grid(NAFLDBx_NAS_TG_Carb, NAFLDBx_NAS_TG_db, ncol = 1, labels = c('H','I'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'w')

TG_mid_sum <- plot_grid(TG_mid_left, TG_mid_mid, TG_mid_RIGHT, ncol = 3, align = 'h',rel_widths = c(1, 0.9, 0.9))

TG_58_9_box_NAS <- ggplot(data=data_full_abs_Rome, aes(x=NAS, y=TG_58_9)) + geom_boxplot(aes(fill=NAS), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=NAS), show.legend=FALSE) + ylab("") + theme_classic() + theme(plot.margin = margin(10, 10, 10, 10, "pt"), legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(size=12)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("TG_58_9\n NAFLD Activity \n Score")
TG_58_9_box_NAS

TG_46_1_box_ALT <- ggplot(data= data_full_abs_NotRome_ALT, aes(x=ALT_cat, y=TG_46_1)) + geom_boxplot(aes(fill= ALT_cat), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill= ALT_cat), show.legend=FALSE) + ylab("") + theme_classic() + theme(plot.margin = margin(10, 10, 10, 10, "pt"), legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=90, vjust=0.5), axis.text.x=element_text(angle=45, size=10, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("TG_46_1\n Serum ALT") + ylab("Plasma TG species \n (uM)")
TG_46_1_box_ALT

TG_52_1_box_HFF <- ggplot(data= data_full_abs_NotRome_HFF, aes(x=HFF_cat, y=TG_52_1)) + geom_boxplot(aes(fill= HFF_cat), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill= HFF_cat), show.legend=FALSE) + ylab("") + theme_classic() + theme(plot.margin = margin(10, 10, 10, 10, "pt"), legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(angle=45, size=10, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("TG_52_1\n Hepatic fat \nfraction")
TG_52_1_box_HFF

TG_bottom <- plot_grid(TG_46_1_box_ALT, TG_52_1_box_HFF, TG_58_9_box_NAS, ncol = 3, labels = c('J','K','L'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'h',rel_widths = c(1, 0.9, 0.9))

TG_summary <- plot_grid(TG_top, TG_mid_sum, TG_bottom, ncol = 1, rel_heights = c(0.9, 1.4, 1.0))

pdf(file="Figure2.pdf",width=9,height=12)
TG_summary
dev.off()


############### ------- PC summary figure

PC_box <- ggplot(data=data_full_abs, aes(x=Group, y=PC_total)) + geom_boxplot(aes(fill=Group), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=Group), show.legend=FALSE) + ylab("") + theme_classic() + theme(plot.margin = margin(10, 10, 10, 10, "pt"), legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=90, vjust=0.5), axis.text.x=element_text(angle=45, size=12, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Total PC") + ylab("Plasma PC \n (uM)") + scale_y_continuous(limits=c(0, 3000), breaks=seq(0, 3000, 500), expand = c(0,0))
PC_box

PC_box_bmi <- ggplot(data= data_full_abs_bmi, aes(x= bmi_cat, y=PC_total)) + geom_boxplot(aes(fill= bmi_cat), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill= bmi_cat), show.legend=FALSE) + ylab("") + theme_classic() + theme(plot.margin = margin(10, 10, 10, 10, "pt"), legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(angle=45, size=10, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Total PC \n BMI z-score") + scale_y_continuous(limits=c(0, 3000), breaks=seq(0, 3000, 500), expand = c(0,0))
PC_box_bmi

PC_box_NAS <- ggplot(data=data_full_abs_Rome, aes(x=NAS, y=PC_total)) + geom_boxplot(aes(fill=NAS), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=NAS), show.legend=FALSE) + ylab("") + theme_classic() + theme(plot.margin = margin(10, 10, 10, 10, "pt"), legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(size=12)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Total PC \n NAFLD Activity Score")
PC_box_NAS

PC_top <- plot_grid(PC_box, PC_box_bmi, PC_box_NAS, ncol = 3, labels = c('A','B','C'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'h',rel_widths = c(1, 0.9, 0.9))

Obese_ALT_PC_db <- ggplot(subset(obese_data_ALT_lm_sum2, LipidGroup %in% c("PC")), aes(x=db, y=Ob_ALT_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in PC") + ylab("Beta-regression \n coefficient") + theme_classic() + theme(plot.margin = margin(10, 10, 10, 10, "pt"), legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("")
Obese_ALT_PC_db

Obese_ALT_PC_Carb <- ggplot(subset(obese_data_ALT_lm_sum2, LipidGroup %in% c("PC")), aes(x=Carb, y=Ob_ALT_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in PC") + ylab("Beta-regression \n coefficient") + theme_classic() + theme(plot.margin = margin(10, 10, 10, 10, "pt"), legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("Serum ALT")
Obese_ALT_PC_Carb

PC_mid_left <- plot_grid(Obese_ALT_PC_Carb, Obese_ALT_PC_db, ncol = 1, labels = c('D','E'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'w')

Obese_HFF_PC_db <- ggplot(subset(obese_data_HFF_lm_sum2, LipidGroup %in% c("PC")), aes(x=db, y=Ob_HFF_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in PC") + ylab("") + theme_classic() + theme(plot.margin = margin(10, 10, 10, 10, "pt"), legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("")
Obese_HFF_PC_db

Obese_HFF_PC_Carb <- ggplot(subset(obese_data_HFF_lm_sum2, LipidGroup %in% c("PC")), aes(x=Carb, y=Ob_HFF_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in PC") + ylab("") + theme_classic() + theme(plot.margin = margin(10, 10, 10, 10, "pt"), legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("Hepatic \nfat fraction")
Obese_HFF_PC_Carb

PC_mid_mid <- plot_grid(Obese_HFF_PC_Carb, Obese_HFF_PC_db, ncol = 1, labels = c('F','G'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'w')

NAFLDBx_NAS_PC_db <- ggplot(subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup %in% c("PC")), aes(x=db, y=NAFLD_NAS_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in PC") + ylab("") + theme_classic() + theme(plot.margin = margin(10, 10, 10, 10, "pt"), legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("")
NAFLDBx_NAS_PC_db

NAFLDBx_NAS_PC_Carb <- ggplot(subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup %in% c("PC")), aes(x=Carb, y=NAFLD_NAS_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in PC") + ylab("") + theme_classic() + theme(plot.margin = margin(10, 10, 10, 10, "pt"), legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("NAFLD \nActivity Score")
NAFLDBx_NAS_PC_Carb

PC_mid_RIGHT <- plot_grid(NAFLDBx_NAS_PC_Carb, NAFLDBx_NAS_PC_db, ncol = 1, labels = c('H','I'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'w')

PC_mid_sum <- plot_grid(PC_mid_left, PC_mid_mid, PC_mid_RIGHT, ncol = 3, align = 'h',rel_widths = c(1, 0.9, 0.9))

PC_38_5_box_NAS <- ggplot(data=data_full_abs_Rome, aes(x=NAS, y=PC_38_5)) + geom_boxplot(aes(fill=NAS), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=NAS), show.legend=FALSE) + ylab("") + theme_classic() + theme(plot.margin = margin(10, 10, 10, 10, "pt"), legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(size=12)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("PC_38_5\n NAFLD Activity \n Score")
PC_38_5_box_NAS

PC_30_0_box_ALT <- ggplot(data= data_full_abs_NotRome_ALT, aes(x=ALT_cat, y=PC_30_0)) + geom_boxplot(aes(fill= ALT_cat), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill= ALT_cat), show.legend=FALSE) + ylab("") + theme_classic() + theme(plot.margin = margin(10, 10, 10, 10, "pt"), legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=90, vjust=0.5), axis.text.x=element_text(angle=45, size=10, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("PC_30_0\n Serum ALT") + ylab("Plasma PC species \n (uM)")
PC_30_0_box_ALT

PC_36_1_box_HFF <- ggplot(data= data_full_abs_NotRome_HFF, aes(x=HFF_cat, y=PC_36_1)) + geom_boxplot(aes(fill= HFF_cat), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill= HFF_cat), show.legend=FALSE) + ylab("") + theme_classic() + theme(plot.margin = margin(10, 10, 10, 10, "pt"), legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(angle=45, size=10, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("PC_36_1\n Hepatic fat \nfraction")
PC_36_1_box_HFF

PC_bottom <- plot_grid(PC_30_0_box_ALT, PC_36_1_box_HFF, PC_38_5_box_NAS, ncol = 3, labels = c('J','K','L'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'h',rel_widths = c(1, 0.9, 0.9))

PC_summary <- plot_grid(PC_top, PC_mid_sum, PC_bottom, ncol = 1, rel_heights = c(0.9, 1.2, 1.0))

pdf(file="Figure3.pdf",width=9,height=12)
PC_summary
dev.off()


############### ------- Ceramide summary figure

Cer_box <- ggplot(data=data_full_abs, aes(x=Group, y=Cer_total)) + geom_boxplot(aes(fill=Group), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=Group), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, hjust=0.5), axis.text.x=element_text(angle=45, size=12, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Total ceramides")
Cer_box

Cer_box_bmi <- ggplot(data= data_full_abs_bmi, aes(x= bmi_cat, y=Cer_total)) + geom_boxplot(aes(fill= bmi_cat), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill= bmi_cat), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(angle=45, size=10, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Total ceramides \n BMI z-score")
Cer_box_bmi

Cer_box_NAS <- ggplot(data=data_full_abs_Rome, aes(x=NAS, y=Cer_total)) + geom_boxplot(aes(fill=NAS), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=NAS), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(size=12)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Total ceramides \n NAFLD Activity Score")
Cer_box_NAS

Cer_top <- plot_grid(Cer_box, Cer_box_bmi, Cer_box_NAS, ncol = 3, labels = c('A','B','C'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'h')

Obese_ALT_Cer_db <- ggplot(subset(obese_data_ALT_lm_sum2, LipidGroup %in% c("Ceramide")), aes(x=db, y=Ob_ALT_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in Ceramide") + ylab("Beta-regression \n coefficient") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("")
Obese_ALT_Cer_db

Obese_ALT_Cer_Carb <- ggplot(subset(obese_data_ALT_lm_sum2, LipidGroup %in% c("Ceramide")), aes(x=Carb, y=Ob_ALT_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in Ceramide") + ylab("Beta-regression \n coefficient") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("Serum ALT")
Obese_ALT_Cer_Carb

Cer_mid_left <- plot_grid(Obese_ALT_Cer_Carb, Obese_ALT_Cer_db, ncol = 1, labels = c('D','E'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'w')

Obese_HFF_Cer_db <- ggplot(subset(obese_data_HFF_lm_sum2, LipidGroup %in% c("Ceramide")), aes(x=db, y=Ob_HFF_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in Ceramide") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("")
Obese_HFF_Cer_db

Obese_HFF_Cer_Carb <- ggplot(subset(obese_data_HFF_lm_sum2, LipidGroup %in% c("Ceramide")), aes(x=Carb, y=Ob_HFF_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in Ceramide") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("Hepatic \nfat fraction")
Obese_HFF_Cer_Carb

Cer_mid_mid <- plot_grid(Obese_HFF_Cer_Carb, Obese_HFF_Cer_db, ncol = 1, labels = c('F','G'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'w')

NAFLDBx_NAS_Cer_db <- ggplot(subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup %in% c("Ceramide")), aes(x=db, y=NAFLD_NAS_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in Ceramide") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("")
NAFLDBx_NAS_Cer_db

NAFLDBx_NAS_Cer_Carb <- ggplot(subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup %in% c("Ceramide")), aes(x=Carb, y=NAFLD_NAS_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in Ceramide") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("NAFLD \nActivity Score")
NAFLDBx_NAS_Cer_Carb

Cer_mid_RIGHT <- plot_grid(NAFLDBx_NAS_Cer_Carb, NAFLDBx_NAS_Cer_db, ncol = 1, labels = c('H','I'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'w')

Cer_mid_sum <- plot_grid(Cer_mid_left, Cer_mid_mid, Cer_mid_RIGHT, ncol = 3, align = 'h')

Cer_36_1_box_NAS <- ggplot(data=data_full_abs_Rome, aes(x=NAS, y=Cer_36_1)) + geom_boxplot(aes(fill=NAS), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=NAS), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(size=12)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Cer_36_1\n NAFLD Activity \n Score")
Cer_36_1_box_NAS

Cer_42_0_box_HFF <- ggplot(data= data_full_abs_NotRome_HFF, aes(x=HFF_cat, y=Cer_42_0)) + geom_boxplot(aes(fill= HFF_cat), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill= HFF_cat), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(angle=45, size=10, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Cer_42_0\n Hepatic fat \nfraction")
Cer_42_0_box_HFF

Cer_42_0_box_ALT <- ggplot(data= data_full_abs_NotRome_ALT, aes(x=ALT_cat, y=Cer_42_0)) + geom_boxplot(aes(fill= ALT_cat), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill= ALT_cat), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(angle=45, size=10, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Cer_42_0\n Serum ALT")
Cer_42_0_box_ALT

Cer_bottom <- plot_grid(Cer_42_0_box_ALT, Cer_42_0_box_HFF, Cer_36_1_box_NAS, ncol = 3, labels = c('J','K','L'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'h')

Cer_summary <- plot_grid(Cer_top, Cer_mid_sum, Cer_bottom, ncol = 1, rel_heights = c(0.9, 1.2, 1.0))

pdf(file="Cer_summary_v1.pdf",width=8,height=12)
Cer_summary
dev.off()

############### ------- Ganglioside summary figure

GM_box <- ggplot(data=data_full_abs, aes(x=Group, y=GM_total)) + geom_boxplot(aes(fill=Group), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=Group), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, hjust=0.5), axis.text.x=element_text(angle=45, size=12, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Total Ganglioside")
GM_box

GM_box_bmi <- ggplot(data= data_full_abs_bmi, aes(x= bmi_cat, y=GM_total)) + geom_boxplot(aes(fill= bmi_cat), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill= bmi_cat), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(angle=45, size=10, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Total Ganglioside \n BMI z-score")
GM_box_bmi

GM_box_NAS <- ggplot(data=data_full_abs_Rome, aes(x=NAS, y=GM_total)) + geom_boxplot(aes(fill=NAS), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=NAS), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(size=12)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Total Ganglioside \n NAFLD Activity Score")
GM_box_NAS

GM_top <- plot_grid(GM_box, GM_box_bmi, GM_box_NAS, ncol = 3, labels = c('A','B','C'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'h')

Obese_ALT_GM_db <- ggplot(subset(obese_data_ALT_lm_sum2, LipidGroup %in% c("Ganglioside")), aes(x=db, y=Ob_ALT_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in Ganglioside") + ylab("Beta-regression \n coefficient") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("")
Obese_ALT_GM_db

Obese_ALT_GM_Carb <- ggplot(subset(obese_data_ALT_lm_sum2, LipidGroup %in% c("Ganglioside")), aes(x=Carb, y=Ob_ALT_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in Ganglioside") + ylab("Beta-regression \n coefficient") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("Serum ALT")
Obese_ALT_GM_Carb

GM_mid_left <- plot_grid(Obese_ALT_GM_Carb, Obese_ALT_GM_db, ncol = 1, labels = c('D','E'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'w')

Obese_HFF_GM_db <- ggplot(subset(obese_data_HFF_lm_sum2, LipidGroup %in% c("Ganglioside")), aes(x=db, y=Ob_HFF_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in Ganglioside") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("")
Obese_HFF_GM_db

Obese_HFF_GM_Carb <- ggplot(subset(obese_data_HFF_lm_sum2, LipidGroup %in% c("Ganglioside")), aes(x=Carb, y=Ob_HFF_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in Ganglioside") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("Hepatic \nfat fraction")
Obese_HFF_GM_Carb

GM_mid_mid <- plot_grid(Obese_HFF_GM_Carb, Obese_HFF_GM_db, ncol = 1, labels = c('F','G'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'w')

NAFLDBx_NAS_GM_db <- ggplot(subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup %in% c("Ganglioside")), aes(x=db, y=NAFLD_NAS_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in Ganglioside") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("")
NAFLDBx_NAS_GM_db

NAFLDBx_NAS_GM_Carb <- ggplot(subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup %in% c("Ganglioside")), aes(x=Carb, y=NAFLD_NAS_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in Ganglioside") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("NAFLD \nActivity Score")
NAFLDBx_NAS_GM_Carb

GM_mid_RIGHT <- plot_grid(NAFLDBx_NAS_GM_Carb, NAFLDBx_NAS_GM_db, ncol = 1, labels = c('H','I'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'w')

GM_mid_sum <- plot_grid(GM_mid_left, GM_mid_mid, GM_mid_RIGHT, ncol = 3, align = 'h')

GM1_34_1_box_NAS <- ggplot(data=data_full_abs_Rome, aes(x=NAS, y=GM1_34_1)) + geom_boxplot(aes(fill=NAS), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=NAS), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(size=12)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("GM1_34_1\n NAFLD Activity \n Score")
GM1_34_1_box_NAS

GD3_34_1_box_HFF <- ggplot(data= data_full_abs_NotRome_HFF, aes(x=HFF_cat, y=GD3_34_1)) + geom_boxplot(aes(fill= HFF_cat), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill= HFF_cat), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(angle=45, size=10, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("GD3_34_1\n Hepatic fat \nfraction")
GD3_34_1_box_HFF

GM3_39_1_box_ALT <- ggplot(data= data_full_abs_NotRome_ALT, aes(x=ALT_cat, y=GM3_39_1)) + geom_boxplot(aes(fill= ALT_cat), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill= ALT_cat), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(angle=45, size=10, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("GM3_39_1\n Serum ALT")
GM3_39_1_box_ALT

GM_bottom <- plot_grid(GM3_39_1_box_ALT, GD3_34_1_box_HFF, GM1_34_1_box_NAS, ncol = 3, labels = c('J','K','L'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'h')

GM_summary <- plot_grid(GM_top, GM_mid_sum, GM_bottom, ncol = 1, rel_heights = c(0.9, 1.2, 1.0))

pdf(file="GM_summary_v1.pdf",width=8,height=12)
GM_summary
dev.off()

############### ------- Hexosylceramide summary figure

HexCer_box <- ggplot(data=data_full_abs, aes(x=Group, y=HexCer_total)) + geom_boxplot(aes(fill=Group), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=Group), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, hjust=0.5), axis.text.x=element_text(angle=45, size=12, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Total Hexosylceramide")
HexCer_box

HexCer_box_bmi <- ggplot(data= data_full_abs_bmi, aes(x= bmi_cat, y=HexCer_total)) + geom_boxplot(aes(fill= bmi_cat), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill= bmi_cat), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(angle=45, size=10, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Total Hexosylceramide \n BMI z-score")
HexCer_box_bmi

HexCer_box_NAS <- ggplot(data=data_full_abs_Rome, aes(x=NAS, y=HexCer_total)) + geom_boxplot(aes(fill=NAS), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=NAS), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(size=12)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Total Hexosylceramide \n NAFLD Activity Score")
HexCer_box_NAS

HexCer_top <- plot_grid(HexCer_box, HexCer_box_bmi, HexCer_box_NAS, ncol = 3, labels = c('A','B','C'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'h')

Obese_ALT_HexCer_db <- ggplot(subset(obese_data_ALT_lm_sum2, LipidGroup %in% c("Hexosylceramide")), aes(x=db, y=Ob_ALT_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in Hexosylceramide") + ylab("Beta-regression \n coefficient") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("")
Obese_ALT_HexCer_db

Obese_ALT_HexCer_Carb <- ggplot(subset(obese_data_ALT_lm_sum2, LipidGroup %in% c("Hexosylceramide")), aes(x=Carb, y=Ob_ALT_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in Hexosylceramide") + ylab("Beta-regression \n coefficient") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("Serum ALT")
Obese_ALT_HexCer_Carb

HexCer_mid_left <- plot_grid(Obese_ALT_HexCer_Carb, Obese_ALT_HexCer_db, ncol = 1, labels = c('D','E'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'w')

Obese_HFF_HexCer_db <- ggplot(subset(obese_data_HFF_lm_sum2, LipidGroup %in% c("Hexosylceramide")), aes(x=db, y=Ob_HFF_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in Hexosylceramide") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("")
Obese_HFF_HexCer_db

Obese_HFF_HexCer_Carb <- ggplot(subset(obese_data_HFF_lm_sum2, LipidGroup %in% c("Hexosylceramide")), aes(x=Carb, y=Ob_HFF_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in Hexosylceramide") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("Hepatic \nfat fraction")
Obese_HFF_HexCer_Carb

HexCer_mid_mid <- plot_grid(Obese_HFF_HexCer_Carb, Obese_HFF_HexCer_db, ncol = 1, labels = c('F','G'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'w')

NAFLDBx_NAS_HexCer_db <- ggplot(subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup %in% c("Hexosylceramide")), aes(x=db, y=NAFLD_NAS_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in Hexosylceramide") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("")
NAFLDBx_NAS_HexCer_db

NAFLDBx_NAS_HexCer_Carb <- ggplot(subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup %in% c("Hexosylceramide")), aes(x=Carb, y=NAFLD_NAS_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in Hexosylceramide") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("NAFLD \nActivity Score")
NAFLDBx_NAS_HexCer_Carb

HexCer_mid_RIGHT <- plot_grid(NAFLDBx_NAS_HexCer_Carb, NAFLDBx_NAS_HexCer_db, ncol = 1, labels = c('H','I'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'w')

HexCer_mid_sum <- plot_grid(HexCer_mid_left, HexCer_mid_mid, HexCer_mid_RIGHT, ncol = 3, align = 'h')

Hex_Cer_40_1_box_NAS <- ggplot(data=data_full_abs_Rome, aes(x=NAS, y=Hex_Cer_40_1)) + geom_boxplot(aes(fill=NAS), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=NAS), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(size=12)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Hex_Cer_40_1\n NAFLD Activity \n Score")
Hex_Cer_40_1_box_NAS

Hex_Cer_43_1_box_HFF <- ggplot(data= data_full_abs_NotRome_HFF, aes(x=HFF_cat, y=Hex_Cer_43_1)) + geom_boxplot(aes(fill= HFF_cat), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill= HFF_cat), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(angle=45, size=10, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Hex_Cer_43_1\n Hepatic fat \nfraction")
Hex_Cer_43_1_box_HFF

Hex_Cer_42_1_box_ALT <- ggplot(data= data_full_abs_NotRome_ALT, aes(x=ALT_cat, y=Hex_Cer_42_1)) + geom_boxplot(aes(fill= ALT_cat), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill= ALT_cat), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(angle=45, size=10, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Hex_Cer_42_1\n Serum ALT")
Hex_Cer_42_1_box_ALT

HexCer_bottom <- plot_grid(Hex_Cer_42_1_box_ALT, Hex_Cer_43_1_box_HFF, Hex_Cer_40_1_box_NAS, ncol = 3, labels = c('J','K','L'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'h')

HexCer_summary <- plot_grid(HexCer_top, HexCer_mid_sum, HexCer_bottom, ncol = 1, rel_heights = c(0.9, 1.2, 1.0))

pdf(file="HexCer_summary_v1.pdf",width=8,height=12)
HexCer_summary
dev.off()

############### ------- LysoPC summary figure

LPC_box <- ggplot(data=data_full_abs, aes(x=Group, y=LPC_total)) + geom_boxplot(aes(fill=Group), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=Group), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, hjust=0.5), axis.text.x=element_text(angle=45, size=12, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Total LysoPC")
LPC_box

LPC_box_bmi <- ggplot(data= data_full_abs_bmi, aes(x= bmi_cat, y=LPC_total)) + geom_boxplot(aes(fill= bmi_cat), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill= bmi_cat), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(angle=45, size=10, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Total LysoPC \n BMI z-score")
LPC_box_bmi

LPC_box_NAS <- ggplot(data=data_full_abs_Rome, aes(x=NAS, y=LPC_total)) + geom_boxplot(aes(fill=NAS), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=NAS), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(size=12)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Total LysoPC \n NAFLD Activity Score")
LPC_box_NAS

LPC_top <- plot_grid(LPC_box, LPC_box_bmi, LPC_box_NAS, ncol = 3, labels = c('A','B','C'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'h')


Obese_ALT_LPC_db <- ggplot(subset(obese_data_ALT_lm_sum2, LipidGroup %in% c("LysoPC")), aes(x=db, y=Ob_ALT_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in LysoPC") + ylab("Beta-regression \n coefficient") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("")
Obese_ALT_LPC_db

Obese_ALT_LPC_Carb <- ggplot(subset(obese_data_ALT_lm_sum2, LipidGroup %in% c("LysoPC")), aes(x=Carb, y=Ob_ALT_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in LysoPC") + ylab("Beta-regression \n coefficient") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("Serum ALT")
Obese_ALT_LPC_Carb

LPC_mid_left <- plot_grid(Obese_ALT_LPC_Carb, Obese_ALT_LPC_db, ncol = 1, labels = c('D','E'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'w')

Obese_HFF_LPC_db <- ggplot(subset(obese_data_HFF_lm_sum2, LipidGroup %in% c("LysoPC")), aes(x=db, y=Ob_HFF_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in LysoPC") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("")
Obese_HFF_LPC_db

Obese_HFF_LPC_Carb <- ggplot(subset(obese_data_HFF_lm_sum2, LipidGroup %in% c("LysoPC")), aes(x=Carb, y=Ob_HFF_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in LysoPC") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("Hepatic \nfat fraction")
Obese_HFF_LPC_Carb

LPC_mid_mid <- plot_grid(Obese_HFF_LPC_Carb, Obese_HFF_LPC_db, ncol = 1, labels = c('F','G'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'w')

NAFLDBx_NAS_LPC_db <- ggplot(subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup %in% c("LysoPC")), aes(x=db, y=NAFLD_NAS_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in LysoPC") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("")
NAFLDBx_NAS_LPC_db

NAFLDBx_NAS_LPC_Carb <- ggplot(subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup %in% c("LysoPC")), aes(x=Carb, y=NAFLD_NAS_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in LysoPC") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("NAFLD \nActivity Score")
NAFLDBx_NAS_LPC_Carb

LPC_mid_RIGHT <- plot_grid(NAFLDBx_NAS_LPC_Carb, NAFLDBx_NAS_LPC_db, ncol = 1, labels = c('H','I'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'w')

LPC_mid_sum <- plot_grid(LPC_mid_left, LPC_mid_mid, LPC_mid_RIGHT, ncol = 3, align = 'h')

LPC_18_0_box_NAS <- ggplot(data=data_full_abs_Rome, aes(x=NAS, y=LPC_18_0)) + geom_boxplot(aes(fill=NAS), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=NAS), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(size=12)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("LPC_18_0\n NAFLD Activity \n Score")
LPC_18_0_box_NAS

LPC_14_0_box_HFF <- ggplot(data= data_full_abs_NotRome_HFF, aes(x=HFF_cat, y=LPC_14_0)) + geom_boxplot(aes(fill= HFF_cat), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill= HFF_cat), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(angle=45, size=10, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("LPC_14_0\n Hepatic fat \nfraction")
LPC_14_0_box_HFF

LPC_16_0_box_ALT <- ggplot(data= data_full_abs_NotRome_ALT, aes(x=ALT_cat, y=LPC_16_0)) + geom_boxplot(aes(fill= ALT_cat), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill= ALT_cat), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(angle=45, size=10, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("LPC_16_0\n Serum ALT")
LPC_16_0_box_ALT

LPC_bottom <- plot_grid(LPC_16_0_box_ALT, LPC_14_0_box_HFF, LPC_18_0_box_NAS, ncol = 3, labels = c('J','K','L'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'h')

LPC_summary <- plot_grid(LPC_top, LPC_mid_sum, LPC_bottom, ncol = 1, rel_heights = c(0.9, 1.2, 1.0))

pdf(file="LPC_summary_v1.pdf",width=8,height=12)
LPC_summary
dev.off()

############### ------- PE summary figure

PE_box <- ggplot(data=data_full_abs, aes(x=Group, y=PE_total)) + geom_boxplot(aes(fill=Group), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=Group), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, hjust=0.5), axis.text.x=element_text(angle=45, size=12, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Total PE")
PE_box

PE_box_bmi <- ggplot(data= data_full_abs_bmi, aes(x= bmi_cat, y=PE_total)) + geom_boxplot(aes(fill= bmi_cat), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill= bmi_cat), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(angle=45, size=10, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Total PE \n BMI z-score")
PE_box_bmi

PE_box_NAS <- ggplot(data=data_full_abs_Rome, aes(x=NAS, y=PE_total)) + geom_boxplot(aes(fill=NAS), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=NAS), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(size=12)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Total PE \n NAFLD Activity Score")
PE_box_NAS

PE_top <- plot_grid(PE_box, PE_box_bmi, PE_box_NAS, ncol = 3, labels = c('A','B','C'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'h')

Obese_ALT_PE_db <- ggplot(subset(obese_data_ALT_lm_sum2, LipidGroup %in% c("PE")), aes(x=db, y=Ob_ALT_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in PE") + ylab("Beta-regression \n coefficient") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("")
Obese_ALT_PE_db

Obese_ALT_PE_Carb <- ggplot(subset(obese_data_ALT_lm_sum2, LipidGroup %in% c("PE")), aes(x=Carb, y=Ob_ALT_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in PE") + ylab("Beta-regression \n coefficient") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("Serum ALT")
Obese_ALT_PE_Carb

PE_mid_left <- plot_grid(Obese_ALT_PE_Carb, Obese_ALT_PE_db, ncol = 1, labels = c('D','E'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'w')

Obese_HFF_PE_db <- ggplot(subset(obese_data_HFF_lm_sum2, LipidGroup %in% c("PE")), aes(x=db, y=Ob_HFF_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in PE") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("")
Obese_HFF_PE_db

Obese_HFF_PE_Carb <- ggplot(subset(obese_data_HFF_lm_sum2, LipidGroup %in% c("PE")), aes(x=Carb, y=Ob_HFF_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in PE") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("Hepatic \nfat fraction")
Obese_HFF_PE_Carb

PE_mid_mid <- plot_grid(Obese_HFF_PE_Carb, Obese_HFF_PE_db, ncol = 1, labels = c('F','G'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'w')

NAFLDBx_NAS_PE_db <- ggplot(subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup %in% c("PE")), aes(x=db, y=NAFLD_NAS_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in PE") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("")
NAFLDBx_NAS_PE_db

NAFLDBx_NAS_PE_Carb <- ggplot(subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup %in% c("PE")), aes(x=Carb, y=NAFLD_NAS_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in PE") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("NAFLD \nActivity Score")
NAFLDBx_NAS_PE_Carb

PE_mid_RIGHT <- plot_grid(NAFLDBx_NAS_PE_Carb, NAFLDBx_NAS_PE_db, ncol = 1, labels = c('H','I'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'w')

PE_mid_sum <- plot_grid(PE_mid_left, PE_mid_mid, PE_mid_RIGHT, ncol = 3, align = 'h')


PE_36_4_box_NAS <- ggplot(data=data_full_abs_Rome, aes(x=NAS, y=PE_36_4)) + geom_boxplot(aes(fill=NAS), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=NAS), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(size=12)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("PE_36_4\n NAFLD Activity \n Score")
PE_36_4_box_NAS

PE_36_1_box_HFF <- ggplot(data= data_full_abs_NotRome_HFF, aes(x=HFF_cat, y=PE_36_1)) + geom_boxplot(aes(fill= HFF_cat), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill= HFF_cat), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(angle=45, size=10, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("PE_36_1\n Hepatic fat \nfraction")
PE_36_1_box_HFF

PE_36_1_box_ALT <- ggplot(data= data_full_abs_NotRome_ALT, aes(x=ALT_cat, y=PE_36_1)) + geom_boxplot(aes(fill= ALT_cat), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill= ALT_cat), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(angle=45, size=10, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("PE_36_1\n Serum ALT")
PE_36_1_box_ALT

PE_bottom <- plot_grid(PE_36_1_box_ALT, PE_36_1_box_HFF, PE_36_4_box_NAS, ncol = 3, labels = c('J','K','L'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'h')

PE_summary <- plot_grid(PE_top, PE_mid_sum, PE_bottom, ncol = 1, rel_heights = c(0.9, 1.2, 1.0))

pdf(file="PE_summary_v1.pdf",width=8,height=12)
PE_summary
dev.off()

############### ------- PG summary figure

PG_box <- ggplot(data=data_full_abs, aes(x=Group, y=PG_total)) + geom_boxplot(aes(fill=Group), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=Group), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, hjust=0.5), axis.text.x=element_text(angle=45, size=12, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Total PG")
PG_box

PG_box_bmi <- ggplot(data= data_full_abs_bmi, aes(x= bmi_cat, y=PG_total)) + geom_boxplot(aes(fill= bmi_cat), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill= bmi_cat), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(angle=45, size=10, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Total PG \n BMI z-score")
PG_box_bmi

PG_box_NAS <- ggplot(data=data_full_abs_Rome, aes(x=NAS, y=PG_total)) + geom_boxplot(aes(fill=NAS), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=NAS), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(size=12)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Total PG \n NAFLD Activity Score")
PG_box_NAS

PG_top <- plot_grid(PG_box, PG_box_bmi, PG_box_NAS, ncol = 3, labels = c('A','B','C'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'h')

Obese_ALT_PG_db <- ggplot(subset(obese_data_ALT_lm_sum2, LipidGroup %in% c("PG")), aes(x=db, y=Ob_ALT_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in PG") + ylab("Beta-regression \n coefficient") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("")
Obese_ALT_PG_db

Obese_ALT_PG_Carb <- ggplot(subset(obese_data_ALT_lm_sum2, LipidGroup %in% c("PG")), aes(x=Carb, y=Ob_ALT_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in PG") + ylab("Beta-regression \n coefficient") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("Serum ALT")
Obese_ALT_PG_Carb

PG_mid_left <- plot_grid(Obese_ALT_PG_Carb, Obese_ALT_PG_db, ncol = 1, labels = c('D','E'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'w')

Obese_HFF_PG_db <- ggplot(subset(obese_data_HFF_lm_sum2, LipidGroup %in% c("PG")), aes(x=db, y=Ob_HFF_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in PG") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("")
Obese_HFF_PG_db

Obese_HFF_PG_Carb <- ggplot(subset(obese_data_HFF_lm_sum2, LipidGroup %in% c("PG")), aes(x=Carb, y=Ob_HFF_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in PG") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("Hepatic \nfat fraction")
Obese_HFF_PG_Carb

PG_mid_mid <- plot_grid(Obese_HFF_PG_Carb, Obese_HFF_PG_db, ncol = 1, labels = c('F','G'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'w')

NAFLDBx_NAS_PG_db <- ggplot(subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup %in% c("PG")), aes(x=db, y=NAFLD_NAS_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in PG") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("")
NAFLDBx_NAS_PG_db

NAFLDBx_NAS_PG_Carb <- ggplot(subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup %in% c("PG")), aes(x=Carb, y=NAFLD_NAS_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in PG") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("NAFLD \nActivity Score")
NAFLDBx_NAS_PG_Carb

PG_mid_RIGHT <- plot_grid(NAFLDBx_NAS_PG_Carb, NAFLDBx_NAS_PG_db, ncol = 1, labels = c('H','I'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'w')

PG_mid_sum <- plot_grid(PG_mid_left, PG_mid_mid, PG_mid_RIGHT, ncol = 3, align = 'h')

PG_40_4_box_NAS <- ggplot(data=data_full_abs_Rome, aes(x=NAS, y=PG_40_4)) + geom_boxplot(aes(fill=NAS), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=NAS), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(size=12)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("PG_40_4\n NAFLD Activity \n Score")
PG_40_4_box_NAS

PG_40_4_box_HFF <- ggplot(data= data_full_abs_NotRome_HFF, aes(x=HFF_cat, y=PG_40_4)) + geom_boxplot(aes(fill= HFF_cat), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill= HFF_cat), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(angle=45, size=10, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("PG_40_4\n Hepatic fat \nfraction")
PG_40_4_box_HFF

PG_38_0_box_ALT <- ggplot(data= data_full_abs_NotRome_ALT, aes(x=ALT_cat, y=PG_38_0)) + geom_boxplot(aes(fill= ALT_cat), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill= ALT_cat), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(angle=45, size=10, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("PG_38_0\n Serum ALT")
PG_38_0_box_ALT

PG_bottom <- plot_grid(PG_38_0_box_ALT, PG_40_4_box_HFF, PG_40_4_box_NAS, ncol = 3, labels = c('J','K','L'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'h')

PG_summary <- plot_grid(PG_top, PG_mid_sum, PG_bottom, ncol = 1, rel_heights = c(0.9, 1.2, 1.0))

pdf(file="PG_summary_v1.pdf",width=8,height=12)
PG_summary
dev.off()

############### ------- PI summary figure

PI_box <- ggplot(data=data_full_abs, aes(x=Group, y=PI_total)) + geom_boxplot(aes(fill=Group), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=Group), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, hjust=0.5), axis.text.x=element_text(angle=45, size=12, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Total PI")
PI_box

PI_box_bmi <- ggplot(data= data_full_abs_bmi, aes(x= bmi_cat, y=PI_total)) + geom_boxplot(aes(fill= bmi_cat), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill= bmi_cat), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(angle=45, size=10, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Total PI \n BMI z-score")
PI_box_bmi

PI_box_NAS <- ggplot(data=data_full_abs_Rome, aes(x=NAS, y=PI_total)) + geom_boxplot(aes(fill=NAS), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=NAS), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(size=12)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Total PI \n NAFLD Activity Score")
PI_box_NAS

PI_top <- plot_grid(PI_box, PI_box_bmi, PI_box_NAS, ncol = 3, labels = c('A','B','C'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'h')

Obese_ALT_PI_db <- ggplot(subset(obese_data_ALT_lm_sum2, LipidGroup %in% c("PI")), aes(x=db, y=Ob_ALT_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in PI") + ylab("Beta-regression \n coefficient") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("")
Obese_ALT_PI_db

Obese_ALT_PI_Carb <- ggplot(subset(obese_data_ALT_lm_sum2, LipidGroup %in% c("PI")), aes(x=Carb, y=Ob_ALT_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in PI") + ylab("Beta-regression \n coefficient") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("Serum ALT")
Obese_ALT_PI_Carb

PI_mid_left <- plot_grid(Obese_ALT_PI_Carb, Obese_ALT_PI_db, ncol = 1, labels = c('D','E'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'w')

Obese_HFF_PI_db <- ggplot(subset(obese_data_HFF_lm_sum2, LipidGroup %in% c("PI")), aes(x=db, y=Ob_HFF_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in PI") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("")
Obese_HFF_PI_db

Obese_HFF_PI_Carb <- ggplot(subset(obese_data_HFF_lm_sum2, LipidGroup %in% c("PI")), aes(x=Carb, y=Ob_HFF_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in PI") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("Hepatic \nfat fraction")
Obese_HFF_PI_Carb

PI_mid_mid <- plot_grid(Obese_HFF_PI_Carb, Obese_HFF_PI_db, ncol = 1, labels = c('F','G'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'w')

NAFLDBx_NAS_PI_db <- ggplot(subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup %in% c("PI")), aes(x=db, y=NAFLD_NAS_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in PI") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("")
NAFLDBx_NAS_PI_db

NAFLDBx_NAS_PI_Carb <- ggplot(subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup %in% c("PI")), aes(x=Carb, y=NAFLD_NAS_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in PI") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("NAFLD \nActivity Score")
NAFLDBx_NAS_PI_Carb

PI_mid_RIGHT <- plot_grid(NAFLDBx_NAS_PI_Carb, NAFLDBx_NAS_PI_db, ncol = 1, labels = c('H','I'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'w')

PI_mid_sum <- plot_grid(PI_mid_left, PI_mid_mid, PI_mid_RIGHT, ncol = 3, align = 'h')

PI_38_5_box_NAS <- ggplot(data=data_full_abs_Rome, aes(x=NAS, y=PI_38_5)) + geom_boxplot(aes(fill=NAS), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=NAS), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(size=12)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("PI_38_5\n NAFLD Activity \n Score")
PI_38_5_box_NAS

PI_34_2_box_HFF <- ggplot(data= data_full_abs_NotRome_HFF, aes(x=HFF_cat, y=PI_34_2)) + geom_boxplot(aes(fill= HFF_cat), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill= HFF_cat), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(angle=45, size=10, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("PI_34_2\n Hepatic fat \nfraction")
PI_34_2_box_HFF

PI_40_5_box_ALT <- ggplot(data= data_full_abs_NotRome_ALT, aes(x=ALT_cat, y=PI_40_5)) + geom_boxplot(aes(fill= ALT_cat), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill= ALT_cat), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(angle=45, size=10, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("PI_40_5\n Serum ALT")
PI_40_5_box_ALT

PI_bottom <- plot_grid(PI_40_5_box_ALT, PI_34_2_box_HFF, PI_38_5_box_NAS, ncol = 3, labels = c('J','K','L'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'h')

PI_summary <- plot_grid(PI_top, PI_mid_sum, PI_bottom, ncol = 1, rel_heights = c(0.9, 1.2, 1.0))

pdf(file="PI_summary_v1.pdf",width=8,height=12)
PI_summary
dev.off()

############### ------- PS summary figure

PS_box <- ggplot(data=data_full_abs, aes(x=Group, y=PS_total)) + geom_boxplot(aes(fill=Group), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=Group), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, hjust=0.5), axis.text.x=element_text(angle=45, size=12, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Total PS")
PS_box

PS_box_bmi <- ggplot(data= data_full_abs_bmi, aes(x= bmi_cat, y=PS_total)) + geom_boxplot(aes(fill= bmi_cat), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill= bmi_cat), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(angle=45, size=10, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Total PS \n BMI z-score")
PS_box_bmi

PS_box_NAS <- ggplot(data=data_full_abs_Rome, aes(x=NAS, y=PS_total)) + geom_boxplot(aes(fill=NAS), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=NAS), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(size=12)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Total PS \n NAFLD Activity Score")
PS_box_NAS

PS_top <- plot_grid(PS_box, PS_box_bmi, PS_box_NAS, ncol = 3, labels = c('A','B','C'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'h')


Obese_ALT_PS_db <- ggplot(subset(obese_data_ALT_lm_sum2, LipidGroup %in% c("PS")), aes(x=db, y=Ob_ALT_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in PS") + ylab("Beta-regression \n coefficient") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("")
Obese_ALT_PS_db

Obese_ALT_PS_Carb <- ggplot(subset(obese_data_ALT_lm_sum2, LipidGroup %in% c("PS")), aes(x=Carb, y=Ob_ALT_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in PS") + ylab("Beta-regression \n coefficient") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("Serum ALT")
Obese_ALT_PS_Carb

PS_mid_left <- plot_grid(Obese_ALT_PS_Carb, Obese_ALT_PS_db, ncol = 1, labels = c('D','E'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'w')

Obese_HFF_PS_db <- ggplot(subset(obese_data_HFF_lm_sum2, LipidGroup %in% c("PS")), aes(x=db, y=Ob_HFF_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in PS") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("")
Obese_HFF_PS_db

Obese_HFF_PS_Carb <- ggplot(subset(obese_data_HFF_lm_sum2, LipidGroup %in% c("PS")), aes(x=Carb, y=Ob_HFF_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in PS") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("Hepatic \nfat fraction")
Obese_HFF_PS_Carb

PS_mid_mid <- plot_grid(Obese_HFF_PS_Carb, Obese_HFF_PS_db, ncol = 1, labels = c('F','G'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'w')

NAFLDBx_NAS_PS_db <- ggplot(subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup %in% c("PS")), aes(x=db, y=NAFLD_NAS_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in PS") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("")
NAFLDBx_NAS_PS_db

NAFLDBx_NAS_PS_Carb <- ggplot(subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup %in% c("PS")), aes(x=Carb, y=NAFLD_NAS_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in PS") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("NAFLD \nActivity Score")
NAFLDBx_NAS_PS_Carb

PS_mid_RIGHT <- plot_grid(NAFLDBx_NAS_PS_Carb, NAFLDBx_NAS_PS_db, ncol = 1, labels = c('H','I'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'w')

PS_mid_sum <- plot_grid(PS_mid_left, PS_mid_mid, PS_mid_RIGHT, ncol = 3, align = 'h')

PS_40_2_box_NAS <- ggplot(data=data_full_abs_Rome, aes(x=NAS, y=PS_40_2)) + geom_boxplot(aes(fill=NAS), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=NAS), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(size=12)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("PS_40_2\n NAFLD Activity \n Score")
PS_40_2_box_NAS

PS_40_1_box_HFF <- ggplot(data= data_full_abs_NotRome_HFF, aes(x=HFF_cat, y=PS_40_1)) + geom_boxplot(aes(fill= HFF_cat), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill= HFF_cat), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(angle=45, size=10, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("PS_40_1\n Hepatic fat \nfraction")
PS_40_1_box_HFF

PS_42_6_box_ALT <- ggplot(data= data_full_abs_NotRome_ALT, aes(x=ALT_cat, y=PS_42_6)) + geom_boxplot(aes(fill= ALT_cat), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill= ALT_cat), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(angle=45, size=10, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("PS_42_6\n Serum ALT")
PS_42_6_box_ALT

PS_bottom <- plot_grid(PS_42_6_box_ALT, PS_40_1_box_HFF, PS_40_2_box_NAS, ncol = 3, labels = c('J','K','L'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'h')

PS_summary <- plot_grid(PS_top, PS_mid_sum, PS_bottom, ncol = 1, rel_heights = c(0.9, 1.2, 1.0))

pdf(file="PS_summary_v1.pdf",width=8,height=12)
PS_summary
dev.off()


############### ------- Sphingolipid summary figure

Sphingolipid_box <- ggplot(data=data_full_abs, aes(x=Group, y=S_total)) + geom_boxplot(aes(fill=Group), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=Group), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, hjust=0.5), axis.text.x=element_text(angle=45, size=12, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Total Sphingolipid")
Sphingolipid_box

Sphingolipid_box_bmi <- ggplot(data= data_full_abs_bmi, aes(x= bmi_cat, y=S_total)) + geom_boxplot(aes(fill= bmi_cat), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill= bmi_cat), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(angle=45, size=10, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Total Sphingolipid \n BMI z-score")
Sphingolipid_box_bmi

Sphingolipid_box_NAS <- ggplot(data=data_full_abs_Rome, aes(x=NAS, y=S_total)) + geom_boxplot(aes(fill=NAS), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=NAS), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(size=12)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Total Sphingolipid \n NAFLD Activity Score")
Sphingolipid_box_NAS

Sphingolipid_top <- plot_grid(Sphingolipid_box, Sphingolipid_box_bmi, Sphingolipid_box_NAS, ncol = 3, labels = c('A','B','C'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'h')

Obese_ALT_Sphingolipid_db <- ggplot(subset(obese_data_ALT_lm_sum2, LipidGroup %in% c("Sphingolipid")), aes(x=db, y=Ob_ALT_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in Sphingolipid") + ylab("Beta-regression \n coefficient") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("")
Obese_ALT_Sphingolipid_db

Obese_ALT_Sphingolipid_Carb <- ggplot(subset(obese_data_ALT_lm_sum2, LipidGroup %in% c("Sphingolipid")), aes(x=Carb, y=Ob_ALT_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in Sphingolipid") + ylab("Beta-regression \n coefficient") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("Serum ALT")
Obese_ALT_Sphingolipid_Carb

Sphingolipid_mid_left <- plot_grid(Obese_ALT_Sphingolipid_Carb, Obese_ALT_Sphingolipid_db, ncol = 1, labels = c('D','E'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'w')

Obese_HFF_Sphingolipid_db <- ggplot(subset(obese_data_HFF_lm_sum2, LipidGroup %in% c("Sphingolipid")), aes(x=db, y=Ob_HFF_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in Sphingolipid") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("")
Obese_HFF_Sphingolipid_db

Obese_HFF_Sphingolipid_Carb <- ggplot(subset(obese_data_HFF_lm_sum2, LipidGroup %in% c("Sphingolipid")), aes(x=Carb, y=Ob_HFF_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in Sphingolipid") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("Hepatic \nfat fraction")
Obese_HFF_Sphingolipid_Carb

Sphingolipid_mid_mid <- plot_grid(Obese_HFF_Sphingolipid_Carb, Obese_HFF_Sphingolipid_db, ncol = 1, labels = c('F','G'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'w')

NAFLDBx_NAS_Sphingolipid_db <- ggplot(subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup %in% c("Sphingolipid")), aes(x=db, y=NAFLD_NAS_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in Sphingolipid") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("")
NAFLDBx_NAS_Sphingolipid_db

NAFLDBx_NAS_Sphingolipid_Carb <- ggplot(subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup %in% c("Sphingolipid")), aes(x=Carb, y=NAFLD_NAS_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in Sphingolipid") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("NAFLD \nActivity Score")
NAFLDBx_NAS_Sphingolipid_Carb

Sphingolipid_mid_RIGHT <- plot_grid(NAFLDBx_NAS_Sphingolipid_Carb, NAFLDBx_NAS_Sphingolipid_db, ncol = 1, labels = c('H','I'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'w')

Sphingolipid_mid_sum <- plot_grid(Sphingolipid_mid_left, Sphingolipid_mid_mid, Sphingolipid_mid_RIGHT, ncol = 3, align = 'h')

S_34_2_box_NAS <- ggplot(data=data_full_abs_Rome, aes(x=NAS, y=S_34_2)) + geom_boxplot(aes(fill=NAS), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=NAS), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(size=12)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("S_34_2\n NAFLD Activity \n Score") + scale_y_continuous(breaks=seq(0,0.02,0.005), limits = c(0,0.02), expand = c(0.05,0))
S_34_2_box_NAS

S_42_2_box_HFF <- ggplot(data= data_full_abs_NotRome_HFF, aes(x=HFF_cat, y=S_42_2)) + geom_boxplot(aes(fill= HFF_cat), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill= HFF_cat), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(angle=45, size=10, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("S_42_2\n Hepatic fat \nfraction")
S_42_2_box_HFF

S_42_2_box_ALT <- ggplot(data= data_full_abs_NotRome_ALT, aes(x=ALT_cat, y=S_42_2)) + geom_boxplot(aes(fill= ALT_cat), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill= ALT_cat), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(angle=45, size=10, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("S_42_2\n Serum ALT")
S_42_2_box_ALT

Sphingolipid_bottom <- plot_grid(S_42_2_box_ALT, S_42_2_box_HFF, S_34_2_box_NAS, ncol = 3, labels = c('J','K','L'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'h')

Sphingolipid_summary <- plot_grid(Sphingolipid_top, Sphingolipid_mid_sum, Sphingolipid_bottom, ncol = 1, rel_heights = c(0.9, 1.2, 1.0))

pdf(file="Sphingolipid_summary_v1.pdf",width=8,height=12)
Sphingolipid_summary
dev.off()


############### ------- SM summary figure

SM_box <- ggplot(data=data_full_abs, aes(x=Group, y=SM_total)) + geom_boxplot(aes(fill=Group), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=Group), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, hjust=0.5), axis.text.x=element_text(angle=45, size=12, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Total SM") + scale_y_continuous(limits = c(0,1000), expand = c(.05,0))
SM_box

SM_box_bmi <- ggplot(data= data_full_abs_bmi, aes(x= bmi_cat, y=SM_total)) + geom_boxplot(aes(fill= bmi_cat), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill= bmi_cat), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(angle=45, size=10, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Total SM \n BMI z-score")  + scale_y_continuous(limits = c(0,1000), expand = c(.05,0))
SM_box_bmi

SM_box_NAS <- ggplot(data=data_full_abs_Rome, aes(x=NAS, y=SM_total)) + geom_boxplot(aes(fill=NAS), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=NAS), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(size=12)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Total SM \n NAFLD Activity Score")
SM_box_NAS

SM_top <- plot_grid(SM_box, SM_box_bmi, SM_box_NAS, ncol = 3, labels = c('A','B','C'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'h')


Obese_ALT_SM_db <- ggplot(subset(obese_data_ALT_lm_sum2, LipidGroup %in% c("Sphingomyelin")), aes(x=db, y=Ob_ALT_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in SM") + ylab("Beta-regression \n coefficient") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("")
Obese_ALT_SM_db

Obese_ALT_SM_Carb <- ggplot(subset(obese_data_ALT_lm_sum2, LipidGroup %in% c("Sphingomyelin")), aes(x=Carb, y=Ob_ALT_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in SM") + ylab("Beta-regression \n coefficient") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("Serum ALT")
Obese_ALT_SM_Carb

SM_mid_left <- plot_grid(Obese_ALT_SM_Carb, Obese_ALT_SM_db, ncol = 1, labels = c('D','E'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'w')

Obese_HFF_SM_db <- ggplot(subset(obese_data_HFF_lm_sum2, LipidGroup %in% c("Sphingomyelin")), aes(x=db, y=Ob_HFF_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in SM") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("")
Obese_HFF_SM_db

Obese_HFF_SM_Carb <- ggplot(subset(obese_data_HFF_lm_sum2, LipidGroup %in% c("Sphingomyelin")), aes(x=Carb, y=Ob_HFF_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in SM") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("Hepatic \nfat fraction")
Obese_HFF_SM_Carb

SM_mid_mid <- plot_grid(Obese_HFF_SM_Carb, Obese_HFF_SM_db, ncol = 1, labels = c('F','G'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'w')

NAFLDBx_NAS_SM_db <- ggplot(subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup %in% c("Sphingomyelin")), aes(x=db, y=NAFLD_NAS_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in SM") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("")
NAFLDBx_NAS_SM_db

NAFLDBx_NAS_SM_Carb <- ggplot(subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup %in% c("Sphingomyelin")), aes(x=Carb, y=NAFLD_NAS_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in SM") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("NAFLD \nActivity Score")
NAFLDBx_NAS_SM_Carb

SM_mid_RIGHT <- plot_grid(NAFLDBx_NAS_SM_Carb, NAFLDBx_NAS_SM_db, ncol = 1, labels = c('H','I'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'w')

SM_mid_sum <- plot_grid(SM_mid_left, SM_mid_mid, SM_mid_RIGHT, ncol = 3, align = 'h')

SM_36_1_box_NAS <- ggplot(data=data_full_abs_Rome, aes(x=NAS, y=SM_36_1)) + geom_boxplot(aes(fill=NAS), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=NAS), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(size=12)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("SM_36_1\n NAFLD Activity \n Score")
SM_36_1_box_NAS

SM_38_2_box_HFF <- ggplot(data= data_full_abs_NotRome_HFF, aes(x=HFF_cat, y=SM_38_2)) + geom_boxplot(aes(fill= HFF_cat), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill= HFF_cat), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(angle=45, size=10, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("SM_38_2\n Hepatic fat \nfraction") + scale_y_continuous(limits = c(0,15), expand = c(.05,0))
SM_38_2_box_HFF

SM_42_0_box_ALT <- ggplot(data= data_full_abs_NotRome_ALT, aes(x=ALT_cat, y=SM_42_0)) + geom_boxplot(aes(fill= ALT_cat), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill= ALT_cat), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(angle=45, size=10, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("SM_42_0\n Serum ALT")
SM_42_0_box_ALT

SM_bottom <- plot_grid(SM_42_0_box_ALT, SM_38_2_box_HFF, SM_36_1_box_NAS, ncol = 3, labels = c('J','K','L'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'h')

SM_summary <- plot_grid(SM_top, SM_mid_sum, SM_bottom, ncol = 1, rel_heights = c(0.9, 1.2, 1.0))

pdf(file="SM_summary_v1.pdf",width=8,height=12)
SM_summary
dev.off()

############### ------- ############### -------

############### ------- identify individuals species with consistent direction effect and significant for either NAS/PortalInf + HFF(in obNAFLD)

## subset obese data to only those with raised liver fat

obNAFLD = subset(obese_data, HFF >=1.8)

## Regress HFF with lipids in obNAFLD cohort
obNAFLD_HFF_lm_full <- lapply(obNAFLD[54:281], function(x) summary(lm(x ~ obNAFLD$log_HFF + obNAFLD$Sex + obNAFLD$Age)))
obNAFLD_HFF_lm <- lapply(obNAFLD_HFF_lm_full, coef)
obNAFLD_HFF_lm <- data.frame(obNAFLD_HFF_lm)
obNAFLD_HFF_lm <- t(obNAFLD_HFF_lm)
obNAFLD_HFF_lm = subset(obNAFLD_HFF_lm, select = -c(1,3,4) )
obNAFLD_HFF_lm <- data.frame(obNAFLD_HFF_lm)
obNAFLD_HFF_lm$annot <- rep(annotation$annotation, each=1, length.out=nrow(obNAFLD_HFF_lm))
obNAFLD_HFF_lm <- obNAFLD_HFF_lm[order(obNAFLD_HFF_lm$annot),]
obNAFLD_HFF_lm_beta <- obNAFLD_HFF_lm[1:((nrow(obNAFLD_HFF_lm)/4)),]
obNAFLD_HFF_lm_p <- obNAFLD_HFF_lm[((nrow(obNAFLD_HFF_lm)/4)+1):((nrow(obNAFLD_HFF_lm)/4)*2),]
obNAFLD_HFF_lm_SE <- obNAFLD_HFF_lm[(((nrow(obNAFLD_HFF_lm)/4)*2)+1):((nrow(obNAFLD_HFF_lm)/4)*3),]
obNAFLD_HFF_lm_t <- obNAFLD_HFF_lm[(((nrow(obNAFLD_HFF_lm)/4)*3)+1):(nrow(obNAFLD_HFF_lm)),]

obNAFLD_HFF_lm_beta$beta <- obNAFLD_HFF_lm_beta$obNAFLD.log_HFF
obNAFLD_HFF_lm_beta = subset(obNAFLD_HFF_lm_beta, select = -c(1,2))
obNAFLD_HFF_lm_SE$SE <- obNAFLD_HFF_lm_SE$obNAFLD.log_HFF
obNAFLD_HFF_lm_SE = subset(obNAFLD_HFF_lm_SE, select = -c(1,2))
obNAFLD_HFF_lm_p$p <- obNAFLD_HFF_lm_p$obNAFLD.log_HFF
obNAFLD_HFF_lm_p = subset(obNAFLD_HFF_lm_p, select = -c(1,2))
obNAFLD_HFF_lm_t$t <- obNAFLD_HFF_lm_t$obNAFLD.log_HFF
obNAFLD_HFF_lm_t = subset(obNAFLD_HFF_lm_t, select = -c(1,2))

obNAFLD_HFF_lm_beta$name <- row.names(obNAFLD_HFF_lm_beta)
obNAFLD_HFF_lm_beta$name2 = substr(obNAFLD_HFF_lm_beta$name,1,nchar(obNAFLD_HFF_lm_beta$name)-9)
obNAFLD_HFF_lm_p$name <- row.names(obNAFLD_HFF_lm_p)
obNAFLD_HFF_lm_p$name2 = substr(obNAFLD_HFF_lm_p$name,1,nchar(obNAFLD_HFF_lm_p$name)-9)
obNAFLD_HFF_lm_SE$name <- row.names(obNAFLD_HFF_lm_SE)
obNAFLD_HFF_lm_SE$name2 = substr(obNAFLD_HFF_lm_SE$name,1,nchar(obNAFLD_HFF_lm_SE$name)-11)
obNAFLD_HFF_lm_t$name <- row.names(obNAFLD_HFF_lm_t)
obNAFLD_HFF_lm_t$name2 = substr(obNAFLD_HFF_lm_t$name,1,nchar(obNAFLD_HFF_lm_t$name)-8)

obNAFLD_HFF_lm_sum <- merge(obNAFLD_HFF_lm_beta, obNAFLD_HFF_lm_SE, by="name2")
obNAFLD_HFF_lm_sum <- merge(obNAFLD_HFF_lm_sum, obNAFLD_HFF_lm_p, by="name2")
obNAFLD_HFF_lm_sum <- merge(obNAFLD_HFF_lm_sum, obNAFLD_HFF_lm_t, by="name2")

obNAFLD_HFF_lm_sum = subset(obNAFLD_HFF_lm_sum, select = c("name2","beta","SE","t","p"))
names(obNAFLD_HFF_lm_sum)[names(obNAFLD_HFF_lm_sum) == 'name2'] <- 'var'
obNAFLD_HFF_lm_sum2 <- merge(Lipids_annotation, obNAFLD_HFF_lm_sum, by="var")
obNAFLD_HFF_lm_sum2$num <- nrow(obNAFLD)
obNAFLD_HFF_lm_sum2$sig <- NA
obNAFLD_HFF_lm_sum2 <- obNAFLD_HFF_lm_sum2 %>% mutate(sig = ifelse(p < lipid_sig, "Significant", "Not significant"))

obNAFLD_HFF_lm_sum2$qval <- p.adjust(obNAFLD_HFF_lm_sum2$p, method = "hochberg")
obNAFLD_HFF_lm_sum2$neglog_p <- -log10(obNAFLD_HFF_lm_sum2$p)
write.table(obNAFLD_HFF_lm_sum2,file="Obese_HFF_lm_summary.csv",sep=",")

## repeat for ALT

obNAFLD_ALT_lm_full <- lapply(obNAFLD[54:281], function(x) summary(lm(x ~ obNAFLD$log_ALT + obNAFLD$Sex + obNAFLD$Age)))
obNAFLD_ALT_lm <- lapply(obNAFLD_ALT_lm_full, coef)
obNAFLD_ALT_lm <- data.frame(obNAFLD_ALT_lm)
obNAFLD_ALT_lm <- t(obNAFLD_ALT_lm)
obNAFLD_ALT_lm = subset(obNAFLD_ALT_lm, select = -c(1,3,4) )
obNAFLD_ALT_lm <- data.frame(obNAFLD_ALT_lm)
obNAFLD_ALT_lm$annot <- rep(annotation$annotation, each=1, length.out=nrow(obNAFLD_ALT_lm))
obNAFLD_ALT_lm <- obNAFLD_ALT_lm[order(obNAFLD_ALT_lm$annot),]
obNAFLD_ALT_lm_beta <- obNAFLD_ALT_lm[1:((nrow(obNAFLD_ALT_lm)/4)),]
obNAFLD_ALT_lm_p <- obNAFLD_ALT_lm[((nrow(obNAFLD_ALT_lm)/4)+1):((nrow(obNAFLD_ALT_lm)/4)*2),]
obNAFLD_ALT_lm_SE <- obNAFLD_ALT_lm[(((nrow(obNAFLD_ALT_lm)/4)*2)+1):((nrow(obNAFLD_ALT_lm)/4)*3),]
obNAFLD_ALT_lm_t <- obNAFLD_ALT_lm[(((nrow(obNAFLD_ALT_lm)/4)*3)+1):(nrow(obNAFLD_ALT_lm)),]

obNAFLD_ALT_lm_beta$beta <- obNAFLD_ALT_lm_beta$obNAFLD.log_ALT
obNAFLD_ALT_lm_beta = subset(obNAFLD_ALT_lm_beta, select = -c(1,2))
obNAFLD_ALT_lm_SE$SE <- obNAFLD_ALT_lm_SE$obNAFLD.log_ALT
obNAFLD_ALT_lm_SE = subset(obNAFLD_ALT_lm_SE, select = -c(1,2))
obNAFLD_ALT_lm_p$p <- obNAFLD_ALT_lm_p$obNAFLD.log_ALT
obNAFLD_ALT_lm_p = subset(obNAFLD_ALT_lm_p, select = -c(1,2))
obNAFLD_ALT_lm_t$t <- obNAFLD_ALT_lm_t$obNAFLD.log_ALT
obNAFLD_ALT_lm_t = subset(obNAFLD_ALT_lm_t, select = -c(1,2))

obNAFLD_ALT_lm_beta$name <- row.names(obNAFLD_ALT_lm_beta)
obNAFLD_ALT_lm_beta$name2 = substr(obNAFLD_ALT_lm_beta$name,1,nchar(obNAFLD_ALT_lm_beta$name)-9)
obNAFLD_ALT_lm_p$name <- row.names(obNAFLD_ALT_lm_p)
obNAFLD_ALT_lm_p$name2 = substr(obNAFLD_ALT_lm_p$name,1,nchar(obNAFLD_ALT_lm_p$name)-9)
obNAFLD_ALT_lm_SE$name <- row.names(obNAFLD_ALT_lm_SE)
obNAFLD_ALT_lm_SE$name2 = substr(obNAFLD_ALT_lm_SE$name,1,nchar(obNAFLD_ALT_lm_SE$name)-11)
obNAFLD_ALT_lm_t$name <- row.names(obNAFLD_ALT_lm_t)
obNAFLD_ALT_lm_t$name2 = substr(obNAFLD_ALT_lm_t$name,1,nchar(obNAFLD_ALT_lm_t$name)-8)

obNAFLD_ALT_lm_sum <- merge(obNAFLD_ALT_lm_beta, obNAFLD_ALT_lm_SE, by="name2")
obNAFLD_ALT_lm_sum <- merge(obNAFLD_ALT_lm_sum, obNAFLD_ALT_lm_p, by="name2")
obNAFLD_ALT_lm_sum <- merge(obNAFLD_ALT_lm_sum, obNAFLD_ALT_lm_t, by="name2")

obNAFLD_ALT_lm_sum = subset(obNAFLD_ALT_lm_sum, select = c("name2","beta","SE","t","p"))
names(obNAFLD_ALT_lm_sum)[names(obNAFLD_ALT_lm_sum) == 'name2'] <- 'var'
obNAFLD_ALT_lm_sum2 <- merge(Lipids_annotation, obNAFLD_ALT_lm_sum, by="var")
obNAFLD_ALT_lm_sum2$num <- nrow(obNAFLD)
obNAFLD_ALT_lm_sum2$sig <- NA
obNAFLD_ALT_lm_sum2 <- obNAFLD_ALT_lm_sum2 %>% mutate(sig = ifelse(p < lipid_sig, "Significant", "Not significant"))

obNAFLD_ALT_lm_sum2$qval <- p.adjust(obNAFLD_ALT_lm_sum2$p, method = "hochberg")
obNAFLD_ALT_lm_sum2$neglog_p <- -log10(obNAFLD_ALT_lm_sum2$p)
write.table(obNAFLD_ALT_lm_sum2,file="Obese_ALT_lm_summary.csv",sep=",")

############### ------- look for overlap

NAFLDBx_data_NAS_lm_sum2$NAS_p <- NAFLDBx_data_NAS_lm_sum2$p
NAFLDBx_data_NAS_lm_sum2$NAS_sig <- NAFLDBx_data_NAS_lm_sum2$sig
NAFLDBx_data_NAS_lm_sum2$NAS_qval <- NAFLDBx_data_NAS_lm_sum2$qval
NAFLDBx_data_NAS_lm_sum2$NAS_beta <- NAFLDBx_data_NAS_lm_sum2$NAFLD_NAS_beta

obese_data_ALT_lm_sum2$ALT_p <- obese_data_ALT_lm_sum2$p
obese_data_ALT_lm_sum2$ALT_sig <- obese_data_ALT_lm_sum2$sig
obese_data_ALT_lm_sum2$ALT_qval <- obese_data_ALT_lm_sum2$qval
obese_data_ALT_lm_sum2$ALT_beta <- obese_data_ALT_lm_sum2$Ob_ALT_beta
TopLip_ALT_NAS <- merge (obese_data_ALT_lm_sum2, NAFLDBx_data_NAS_lm_sum2, by="var")
TopLip_ALT_NAS = subset(TopLip_ALT_NAS, select = c('var', 'ALT_p', 'ALT_sig', 'ALT_qval', 'ALT_beta', 'NAS_p', 'NAS_sig', 'NAS_qval', 'NAS_beta'))
TopLip_ALT_NAS = subset(TopLip_ALT_NAS, NAS_sig =="Significant")
TopLip_ALT_NAS = subset(TopLip_ALT_NAS, ALT_sig =="Significant")


obese_data_HFF_lm_sum2$HFF_p <- obese_data_HFF_lm_sum2$p
obese_data_HFF_lm_sum2$HFF_sig <- obese_data_HFF_lm_sum2$sig
obese_data_HFF_lm_sum2$HFF_qval <- obese_data_HFF_lm_sum2$qval
obese_data_HFF_lm_sum2$HFF_beta <- obese_data_HFF_lm_sum2$Ob_HFF_beta
TopLip_HFF_NAS <- merge (obese_data_HFF_lm_sum2, NAFLDBx_data_NAS_lm_sum2, by="var")
TopLip_HFF_NAS = subset(TopLip_HFF_NAS, select = c('var', 'HFF_p', 'HFF_sig', 'HFF_qval', 'HFF_beta', 'NAS_p', 'NAS_sig', 'NAS_qval', 'NAS_beta'))
TopLip_HFF_NAS = subset(TopLip_HFF_NAS, NAS_sig =="Significant")
TopLip_HFF_NAS = subset(TopLip_HFF_NAS, HFF_sig =="Significant")


NAFLDBx_data_Portal_lm_sum2$Portal_p <- NAFLDBx_data_Portal_lm_sum2$p
NAFLDBx_data_Portal_lm_sum2$Portal_sig <- NAFLDBx_data_Portal_lm_sum2$sig
NAFLDBx_data_Portal_lm_sum2$Portal_qval <- NAFLDBx_data_Portal_lm_sum2$qval
NAFLDBx_data_Portal_lm_sum2$Portal_beta <- NAFLDBx_data_Portal_lm_sum2$NAFLD_Portal_beta
## nil overlap for portal (only a single lipid significant)


TopLip_ALT_NAS_sum = subset(TopLip_ALT_NAS, select = c(var, NAS_p, NAS_sig, NAS_qval, NAS_beta))
TopLip_ALT_NAS_sum$analysis <- 'ALT_NAS'
TopLip_HFF_NAS_sum = subset(TopLip_HFF_NAS, select = c(var, NAS_p, NAS_sig, NAS_qval, NAS_beta))
TopLip_HFF_NAS_sum$analysis <- 'HFF_NAS'
colnames(TopLip_ALT_NAS_sum) <- c("var", 'p', 'sig', 'qval', 'beta', 'analysis')
colnames(TopLip_HFF_NAS_sum) <- c("var", 'p', 'sig', 'qval',  'beta', 'analysis')
TopLip_summary <- rbind(TopLip_ALT_NAS_sum, TopLip_HFF_NAS_sum)

TopLip_summary <- TopLip_summary %>% distinct(var, .keep_all = TRUE)
write.table(TopLip_summary,file="TopLip_summary.csv",sep=",")


############### ------- explore phenotypic associations of NAS in the biopsied cohort

ALT_NAS <- ggplot(data=data_full_abs_Rome, aes(x=NAS, y=ALT)) + geom_boxplot(aes(fill=NAS), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=NAS), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(size=12)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("") + xlab("NAFLD Activity Score") + ylab("Serum ALT \n (IU/L)") + theme(plot.margin = margin(1, 1, 1, 1, "cm"))  + scale_y_continuous(limits=c(0, 250), breaks=seq(0, 250, 25), expand = c(0,0))
ALT_NAS

AST_NAS <- ggplot(data=data_full_abs_Rome, aes(x=NAS, y=AST)) + geom_boxplot(aes(fill=NAS), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=NAS), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(size=12)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("") + xlab("NAFLD Activity Score") + ylab("Serum AST \n (IU/L)") + theme(plot.margin = margin(1, 1, 1, 1, "cm")) + scale_y_continuous(limits=c(0, 175), breaks=seq(0, 175, 25), expand = c(0,0))
AST_NAS

HOMA_NAS <- ggplot(data=data_full_abs_Rome, aes(x=NAS, y=HOMA)) + geom_boxplot(aes(fill=NAS), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=NAS), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(size=12)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("") + xlab("NAFLD Activity Score") + ylab("HOMA-IR") + theme(plot.margin = margin(1, 1, 1, 1, "cm")) + scale_y_continuous(limits=c(0, 8), breaks=seq(0, 8, 1), expand = c(0,0))
HOMA_NAS

bmi_NAS <- ggplot(data=data_full_abs_Rome, aes(x=NAS, y=bmi)) + geom_boxplot(aes(fill=NAS), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=NAS), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(size=12)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("") + xlab("NAFLD Activity Score") + ylab("BMI \n z-score") + theme(plot.margin = margin(1, 1, 1, 1, "cm")) + scale_y_continuous(limits=c(0, 3.5), breaks=seq(0, 3.5, .5), expand = c(0,0))
bmi_NAS

Age_NAS <- ggplot(data=data_full_abs_Rome, aes(x=NAS, y=Age)) + geom_boxplot(aes(fill=NAS), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=NAS), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(size=12)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("") + xlab("NAFLD Activity Score") + ylab("Age (y)") + theme(plot.margin = margin(1, 1, 1, 1, "cm")) + scale_y_continuous(limits=c(6, 16), breaks=seq(6, 16, 2), expand = c(0,0))
Age_NAS

Trig_NAS <- ggplot(data=data_full_abs_Rome, aes(x=NAS, y=Trig)) + geom_boxplot(aes(fill=NAS), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=NAS), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(size=12)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("") + xlab("NAFLD Activity Score") + ylab("Triglycerides \n (mmol/L)") + theme(plot.margin = margin(1, 1, 1, 1, "cm")) + scale_y_continuous(limits=c(0, 4), breaks=seq(0, 4, 0.5), expand = c(0,0))
Trig_NAS

NAS_top <- plot_grid(Age_NAS, bmi_NAS, HOMA_NAS, ncol = 3, labels = c('A','B','C'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'h', hjust = -5, vjust = 3)
NAS_bottom <- plot_grid(ALT_NAS, AST_NAS, Trig_NAS, ncol = 3, labels = c('C','D','E'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'h', hjust = -5, vjust = 3)

NAS_summary <- plot_grid(NAS_top, NAS_bottom, ncol = 1, rel_heights = c(1.0, 1.0), align = 'h')

pdf(file="Figure1.pdf",width=12,height=8)
NAS_summary
dev.off()



############### ------- explore phenotypic associations of Portal in the biopsied cohort

data_full_abs_Rome$Portal <- as.factor(data_full_abs_Rome$Portal)

ALT_Portal <- ggplot(data=data_full_abs_Rome, aes(x=Portal, y=ALT)) + geom_boxplot(aes(fill=Portal), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=Portal), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(size=12)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("") + xlab("Portal Inflammation Score") + ylab("Serum ALT \n (IU/L)") + theme(plot.margin = margin(1, 1, 1, 1, "cm"))  + scale_y_continuous(limits=c(0, 250), breaks=seq(0, 250, 25), expand = c(0,0))
ALT_Portal

AST_Portal <- ggplot(data=data_full_abs_Rome, aes(x=Portal, y=AST)) + geom_boxplot(aes(fill=Portal), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=Portal), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(size=12)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("") + xlab("Portal Inflammation Score") + ylab("Serum AST \n (IU/L)") + theme(plot.margin = margin(1, 1, 1, 1, "cm")) + scale_y_continuous(limits=c(0, 175), breaks=seq(0, 175, 25), expand = c(0,0))
AST_Portal

HOMA_Portal <- ggplot(data=data_full_abs_Rome, aes(x=Portal, y=HOMA)) + geom_boxplot(aes(fill=Portal), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=Portal), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(size=12)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("") + xlab("Portal Inflammation Score") + ylab("HOMA-IR") + theme(plot.margin = margin(1, 1, 1, 1, "cm")) + scale_y_continuous(limits=c(0, 8), breaks=seq(0, 8, 1), expand = c(0,0))
HOMA_Portal

bmi_Portal <- ggplot(data=data_full_abs_Rome, aes(x=Portal, y=bmi)) + geom_boxplot(aes(fill=Portal), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=Portal), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(size=12)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("") + xlab("Portal Inflammation Score") + ylab("BMI \n z-score") + theme(plot.margin = margin(1, 1, 1, 1, "cm")) + scale_y_continuous(limits=c(0, 3.5), breaks=seq(0, 3.5, .5), expand = c(0,0))
bmi_Portal

Age_Portal <- ggplot(data=data_full_abs_Rome, aes(x=Portal, y=Age)) + geom_boxplot(aes(fill=Portal), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=Portal), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(size=12)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("") + xlab("Portal Inflammation Score") + ylab("Age (y)") + theme(plot.margin = margin(1, 1, 1, 1, "cm")) + scale_y_continuous(limits=c(6, 16), breaks=seq(6, 16, 2), expand = c(0,0))
Age_Portal

Trig_Portal <- ggplot(data=data_full_abs_Rome, aes(x=Portal, y=Trig)) + geom_boxplot(aes(fill=Portal), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=Portal), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=0, vjust=0.5), axis.text.x=element_text(size=12)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("") + xlab("Portal Inflammation Score") + ylab("Triglycerides \n (mmol/L)") + theme(plot.margin = margin(1, 1, 1, 1, "cm")) + scale_y_continuous(limits=c(0, 4), breaks=seq(0, 4, 0.5), expand = c(0,0))
Trig_Portal

Portal_top <- plot_grid(Age_Portal, bmi_Portal, HOMA_Portal, ncol = 3, labels = c('A','B','C'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'h', hjust = -5, vjust = 3)
Portal_bottom <- plot_grid(ALT_Portal, AST_Portal, Trig_Portal, ncol = 3, labels = c('C','D','E'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'h', hjust = -5, vjust = 3)

Portal_summary <- plot_grid(Portal_top, Portal_bottom, ncol = 1, rel_heights = c(1.0, 1.0), align = 'h')

pdf(file="Figure S2.pdf",width=12,height=8)
Portal_summary
dev.off()


#### ------ #### ------ #### ------ 
#### ------ make final figures for paper

#### histograms of traits in cohorts

hist_data = subset(data_full, Group != "Lean")

all_bmi_hist <- ggplot(hist_data, aes(x=bmi, fill = Group)) + geom_histogram(color="black", alpha = 0.5, position = 'identity', binwidth=0.25) + theme_classic() + labs(x="BMI z-score", y = "Number \nof participants") + theme(plot.title = element_text(face = "bold")) + theme(legend.position = "none", plot.margin = margin(6, 10, 6, 6, "pt"), plot.title = element_text(face = "bold"), axis.title.y=element_text(angle = 0, vjust = 0.5)) + theme(plot.title = element_text(hjust = 0.5)) + scale_y_continuous(limits=c(0,40), breaks=seq(0,40,5), expand = c(0,0)) + scale_x_continuous(limits=c(1,5), breaks=seq(1,5,0.5), expand = c(0,0)) 
all_bmi_hist

all_ALT_hist <- ggplot(hist_data, aes(x=ALT, fill = Group)) + geom_histogram(color="black", alpha = 0.5, position = 'identity', binwidth=5) + theme_classic() + labs(x="Serum ALT (IU/L)", y = "Number \nof participants") + theme(plot.title = element_text(face = "bold")) + theme(legend.position = "none", plot.margin = margin(6, 10, 6, 6, "pt"), plot.title = element_text(face = "bold"), axis.title.y=element_text(angle = 0, vjust = 0.5)) + theme(plot.title = element_text(hjust = 0.5)) + scale_y_continuous(limits=c(0,30), breaks=seq(0,30,5), expand = c(0,0)) + scale_x_continuous(limits=c(0,300), breaks=seq(0,300,25), expand = c(0,0))
all_ALT_hist

all_HOMA_hist <- ggplot(hist_data, aes(x=HOMA, fill = Group)) + geom_histogram(color="black", alpha = 0.5, position = 'identity', binwidth=0.5) + theme_classic() + labs(x="HOMA-IR", y = "") + theme(plot.title = element_text(face = "bold")) + theme(legend.position = c(0.8,0.8), plot.margin = margin(6, 10, 6, 20, "pt"), plot.title = element_text(face = "bold"), axis.title.y=element_text(angle = 0, vjust = 0.5)) + theme(plot.title = element_text(hjust = 0.5)) + scale_y_continuous(limits=c(0,25), breaks=seq(0,25,5), expand = c(0,0)) + scale_x_continuous(limits=c(0,15), breaks=seq(0,15,5), expand = c(0,0)) 
all_HOMA_hist

all_Chol_hist <- ggplot(hist_data, aes(x=Chol, fill = Group)) + geom_histogram(color="black", alpha = 0.5, position = 'identity', binwidth=0.25) + theme_classic() + labs(x="Serum cholesterol (mmol/L)", y = "") + theme(plot.title = element_text(face = "bold")) + theme(legend.position = "none", plot.margin = margin(6, 10, 6, 20, "pt"), plot.title = element_text(face = "bold"), axis.title.y=element_text(angle = 0, vjust = 0.5)) + theme(plot.title = element_text(hjust = 0.5)) + scale_y_continuous(limits=c(0,30), breaks=seq(0,30,5), expand = c(0,0)) + scale_x_continuous(limits=c(1,8), breaks=seq(1,8,1), expand = c(0,0))
all_Chol_hist

all_Trig_hist <- ggplot(hist_data, aes(x=Trig, fill = Group)) + geom_histogram(color="black", alpha = 0.5, position = 'identity', binwidth=0.1) + theme_classic() + labs(x="Serum triglycerides (mmol/L)", y = "Number \nof participants") + theme(plot.title = element_text(face = "bold")) + theme(legend.position = "none", plot.margin = margin(6, 10, 6, 6, "pt"), plot.title = element_text(face = "bold"), axis.title.y=element_text(angle = 0, vjust = 0.5)) + theme(plot.title = element_text(hjust = 0.5)) + scale_y_continuous(limits=c(0,20), breaks=seq(0,20,5), expand = c(0,0)) + scale_x_continuous(limits=c(0,6), breaks=seq(0,6,1), expand = c(0,0)) 
all_Trig_hist

all_AST_hist <- ggplot(hist_data, aes(x=AST, fill = Group)) + geom_histogram(color="black", alpha = 0.5, position = 'identity', binwidth=5) + theme_classic() + labs(x="Serum AST (IU/L)", y = "Number \nof participants") + theme(plot.title = element_text(face = "bold")) + theme(legend.position = "none", plot.margin = margin(6, 10, 6, 6, "pt"), plot.title = element_text(face = "bold"), axis.title.y=element_text(angle = 0, vjust = 0.5)) + theme(plot.title = element_text(hjust = 0.5)) + scale_y_continuous(limits=c(0,30), breaks=seq(0,30,5), expand = c(0,0)) + scale_x_continuous(limits=c(0,175), breaks=seq(0,175,25), expand = c(0,0))
all_AST_hist

ob_HFF_hist <- ggplot(obese_data, aes(x=HFF)) + geom_histogram(color="black", fill="#00BFC4", alpha = 0.5, binwidth=0.5) + theme_classic() + labs(x="MRS hepatic fat fraction (%)", y = "") + theme(plot.title = element_text(face = "bold")) + theme(legend.position = "none", plot.margin = margin(6, 10, 6, 20, "pt"), plot.title = element_text(face = "bold"), axis.title.y=element_text(angle = 0, vjust = 0.5)) + theme(plot.title = element_text(hjust = 0.5)) + scale_y_continuous(limits=c(0,20), breaks=seq(0,20,5), expand = c(0,0)) + scale_x_continuous(limits=c(0,30), breaks=seq(0,30,5), expand = c(0,0)) 
ob_HFF_hist

hist_top <- plot_grid(all_bmi_hist, all_HOMA_hist, ncol = 2, labels = c('A','B'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'h', rel_widths = c(1.0, 0.9))
hist_mid <- plot_grid(all_Trig_hist, all_Chol_hist, ncol = 2, labels = c('C','D'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'h', rel_widths = c(1.0, 0.9))
hist_bottom <- plot_grid(all_ALT_hist, ob_HFF_hist, ncol = 2, labels = c('E','F'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'h', rel_widths = c(1.0, 0.9))

hist_summary <- plot_grid(hist_top, hist_mid, hist_bottom, ncol = 1, rel_heights = c(1.0, 1.0), align = 'h')

pdf(file="Figure S1.pdf",width=12,height=8)
hist_summary
dev.off()

#### PCA for all lipids by obese/lean/NAFLD
Lipids_pca3_plot_final <- ggbiplot(Lipids_pca3, var.axes=FALSE, ellipse=TRUE, groups=data_full22$Group) + theme_minimal()
pdf(file="Lipids_pca3_plot_final_v1.pdf")
Lipids_pca3_plot_final
dev.off()


###### summary table from all linear models

obese_data_ALT_lm_sum2$LipidClass = obese_data_ALT_lm_sum2$LipidGroup
obese_data_ALT_lm_sum2$Lipid = obese_data_ALT_lm_sum2$var
obese_data_ALT_lm_sum2$DoubleBonds = obese_data_ALT_lm_sum2$db
obese_data_ALT_lm_sum2$Carbons = obese_data_ALT_lm_sum2$Carb
obese_data_ALT_lm_sum2$OH_Group = obese_data_ALT_lm_sum2$OH

obese_data_TE_lm_sum2$TE_p = obese_data_TE_lm_sum2$p
obese_data_TE_lm_sum2$TE_sig = obese_data_TE_lm_sum2$sig
obese_data_TE_lm_sum2$TE_qval = obese_data_TE_lm_sum2$qval
obese_data_TE_lm_sum2$TE_beta = obese_data_TE_lm_sum2$Ob_TE_beta

NAFLDBx_data_Fib_lm_sum2$Fib_p = NAFLDBx_data_Fib_lm_sum2$p
NAFLDBx_data_Fib_lm_sum2$Fib_sig = NAFLDBx_data_Fib_lm_sum2$sig
NAFLDBx_data_Fib_lm_sum2$Fib_qval = NAFLDBx_data_Fib_lm_sum2$qval
NAFLDBx_data_Fib_lm_sum2$Fib_beta = NAFLDBx_data_Fib_lm_sum2$NAFLD_Fib_beta

NAFLDBx_data_Steat_lm_sum2$Steat_p = NAFLDBx_data_Steat_lm_sum2$p
NAFLDBx_data_Steat_lm_sum2$Steat_sig = NAFLDBx_data_Steat_lm_sum2$sig
NAFLDBx_data_Steat_lm_sum2$Steat_qval = NAFLDBx_data_Steat_lm_sum2$qval
NAFLDBx_data_Steat_lm_sum2$Steat_beta = NAFLDBx_data_Steat_lm_sum2$NAFLD_Steat_beta

NAFLDBx_data_Portal_lm_sum2$Portal_p = NAFLDBx_data_Portal_lm_sum2$p
NAFLDBx_data_Portal_lm_sum2$Portal_sig = NAFLDBx_data_Portal_lm_sum2$sig
NAFLDBx_data_Portal_lm_sum2$Portal_qval = NAFLDBx_data_Portal_lm_sum2$qval
NAFLDBx_data_Portal_lm_sum2$Portal_beta = NAFLDBx_data_Portal_lm_sum2$NAFLD_Portal_beta

NAFLDBx_data_HOMA_lm_sum2$NAFLD_HOMA_p = NAFLDBx_data_HOMA_lm_sum2$p
NAFLDBx_data_HOMA_lm_sum2$NAFLD_HOMA_sig = NAFLDBx_data_HOMA_lm_sum2$sig
NAFLDBx_data_HOMA_lm_sum2$NAFLD_HOMA_qval = NAFLDBx_data_HOMA_lm_sum2$qval
NAFLDBx_data_HOMA_lm_sum2$NAFLD_HOMA_beta = NAFLDBx_data_HOMA_lm_sum2$NAFLD_HOMA_beta

obese_data_HOMA_lm_sum2$Ob_HOMA_p = obese_data_HOMA_lm_sum2$p
obese_data_HOMA_lm_sum2$Ob_HOMA_sig = obese_data_HOMA_lm_sum2$sig
obese_data_HOMA_lm_sum2$Ob_HOMA_qval = obese_data_HOMA_lm_sum2$qval
obese_data_HOMA_lm_sum2$Ob_HOMA_beta = obese_data_HOMA_lm_sum2$Ob_HOMA_beta

NAFLDBx_data_NAS_lm_sum2$NAS_p = NAFLDBx_data_NAS_lm_sum2$p
NAFLDBx_data_NAS_lm_sum2$NAS_sig = NAFLDBx_data_NAS_lm_sum2$sig
NAFLDBx_data_NAS_lm_sum2$NAS_qval = NAFLDBx_data_NAS_lm_sum2$qval
NAFLDBx_data_NAS_lm_sum2$NAS_beta = NAFLDBx_data_NAS_lm_sum2$NAFLD_NAS_beta


lm_sumtab_final <- merge(obese_data_ALT_lm_sum2, obese_data_HOMA_lm_sum2, by="var")
lm_sumtab_final <- merge(lm_sumtab_final, obese_data_HFF_lm_sum2, by="var")
lm_sumtab_final <- merge(lm_sumtab_final, obese_data_TE_lm_sum2, by="var")
lm_sumtab_final <- merge(lm_sumtab_final, NAFLDBx_data_NAS_lm_sum2, by="var")
lm_sumtab_final <- merge(lm_sumtab_final, NAFLDBx_data_Steat_lm_sum2, by="var")
lm_sumtab_final <- merge(lm_sumtab_final, NAFLDBx_data_Fib_lm_sum2, by="var")
lm_sumtab_final <- merge(lm_sumtab_final, NAFLDBx_data_Portal_lm_sum2, by="var")
lm_sumtab_final <- merge(lm_sumtab_final, NAFLDBx_data_HOMA_lm_sum2, by="var")

lm_sumtab_final = subset(lm_sumtab_final, select = c("Lipid", "LipidClass", "DoubleBonds", "Carbons", "OH_Group", "ALT_beta", "ALT_p", "ALT_qval", "ALT_sig", "TE_beta", "TE_p", "TE_qval", "TE_sig","Fib_beta", "Fib_p", "Fib_qval", "Fib_sig","Steat_beta", "Steat_p", "Steat_qval", "Steat_sig","Portal_beta", "Portal_p", "Portal_qval", "Portal_sig","NAFLD_HOMA_beta", "NAFLD_HOMA_p", "NAFLD_HOMA_qval", "NAFLD_HOMA_sig","Ob_HOMA_beta", "Ob_HOMA_p", "Ob_HOMA_qval", "Ob_HOMA_sig", "NAS_beta", "NAS_p", "NAS_qval", "NAS_sig"))

write.table(lm_sumtab_final, file="Table S2.csv",sep=",")

#### metareg summary table (already made)
write.table(hm_metareg_sumtab, file="Table S3.csv",sep=",")


### last summary figure from multiple lipid classes


LPC_box <- ggplot(data=data_full_abs, aes(x=Group, y=LPC_total)) + geom_boxplot(aes(fill=Group), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=Group), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=90, hjust=0.5), axis.text.x=element_text(angle=45, size=12, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Total LysoPC") + ylab("Plasma lysoPC (uM)")
LPC_box

LPC_box_NAS <- ggplot(data=data_full_abs_Rome, aes(x=NAS, y=LPC_total)) + geom_boxplot(aes(fill=NAS), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=NAS), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=90, vjust=0.5), axis.text.x=element_text(size=12)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Total LysoPC \n NAFLD Activity Score") + ylab("Plasma lysoPC (uM)")
LPC_box_NAS

LPC_18_0_box_NAS <- ggplot(data=data_full_abs_Rome, aes(x=NAS, y=LPC_18_0)) + geom_boxplot(aes(fill=NAS), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=NAS), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=90, vjust=0.5), axis.text.x=element_text(size=12)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("LPC_18_0\n NAFLD Activity \n Score") + ylab("Plasma lysoPC(18:0) (uM)")
LPC_18_0_box_NAS

PG_box <- ggplot(data=data_full_abs, aes(x=Group, y=PG_total)) + geom_boxplot(aes(fill=Group), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=Group), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=90, hjust=0.5), axis.text.x=element_text(angle=45, size=12, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Total PG") + ylab("Plasma PG (uM)")
PG_box

GM_box <- ggplot(data=data_full_abs, aes(x=Group, y=GM_total)) + geom_boxplot(aes(fill=Group), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=Group), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=90, hjust=0.5), axis.text.x=element_text(angle=45, size=12, vjust=0.7)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Total Ganglioside") + ylab("Plasma gangliosides (uM)")
GM_box

NAFLDBx_NAS_PI_Carb <- ggplot(subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup %in% c("PI")), aes(x=Carb, y=NAFLD_NAS_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Carbons in PI") + ylab("") + theme_classic() + theme(legend.position="FALSE", axis.title.y=element_text(size=12, angle=90, vjust=0.5), plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ggtitle("PI chain legnth \n NAFLD Activity Score") + ylab("Beta-regression coefficient") 
NAFLDBx_NAS_PI_Carb

PG_40_4_box_NAS <- ggplot(data=data_full_abs_Rome, aes(x=NAS, y=PG_40_4)) + geom_boxplot(aes(fill=NAS), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=NAS), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=90, vjust=0.5), axis.text.x=element_text(size=12)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("PG_40_4\n NAFLD Activity \n Score") + ylab("Plasma PG(40:4) (uM)")
PG_40_4_box_NAS

Hex_Cer_40_1_box_NAS <- ggplot(data=data_full_abs_Rome, aes(x=NAS, y=Hex_Cer_40_1)) + geom_boxplot(aes(fill=NAS), outlier.shape=NA) + geom_point(position=position_jitterdodge(), size=0.4, alpha=0.5, aes(fill=NAS), show.legend=FALSE) + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), axis.title.y=element_text(size=12, angle=90, vjust=0.5), axis.text.x=element_text(size=12)) + labs(fill = "") + xlab("") + scale_fill_viridis(discrete=TRUE, option = "C") + scale_color_manual(values = c("A" = "black", "B" = "red")) + ggtitle("Hex_Cer_40_1\n NAFLD Activity \n Score") + ylab("Plasma HexCer(40:1) (uM)")
Hex_Cer_40_1_box_NAS

NAFLDBx_NAS_PI_db <- ggplot(subset(NAFLDBx_data_NAS_lm_sum2, LipidGroup %in% c("PI")), aes(x=db, y=NAFLD_NAS_beta)) + geom_point(size=2, aes(colour=sig)) + xlab("Double bonds in PI") + ylab("") + theme_classic() + theme(legend.position="FALSE", plot.title = element_text(hjust = 0.5, face = "bold", size=11), legend.title = element_blank()) + theme(plot.title = element_text(face = "bold")) + geom_line(y = 0, color = "black", linetype = "dashed") + scale_color_manual(values = c("grey42", "red1")) + geom_smooth(method='lm', color="Black", fill="dodgerblue4", alpha = 0.2, size = 0.2) + ylab("Beta-regression coefficient") + ggtitle("PI saturation \n NAFLD Activity Score")
NAFLDBx_NAS_PI_db

Fig4_top <- plot_grid(LPC_box, LPC_box_NAS, LPC_18_0_box_NAS, ncol = 3, labels = c('A','B','C'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'h')

Fig4_mid <- plot_grid(PG_box, GM_box, NAFLDBx_NAS_PI_Carb, ncol = 3, labels = c('D','E','F'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'h')

Fig4_bottom <- plot_grid(PG_40_4_box_NAS, Hex_Cer_40_1_box_NAS, NAFLDBx_NAS_PI_db, ncol = 3, labels = c('G','H','I'), label_fontfamily = 'sans', label_fontface = 'bold', label_size = 15, align = 'h')

Fig4_summary <- plot_grid(Fig4_top, Fig4_mid, Fig4_bottom, ncol = 1, rel_heights = c(1,1,1))

pdf(file="Figure4.pdf",width=8,height=12)
Fig4_summary
dev.off()


### full table of siginficant lipids (for either NAS, Portal inflam, or fibrosis)

Tab2_Fib = NAFLDBx_data_Fib_lm_sum2
Tab2_Fib$beta = Tab2_Fib$NAFLD_Fib_beta
Tab2_Fib <- subset(Tab2_Fib, select = c("var", "LipidGroup", "beta", "p", "qval", "sig"))
Tab2_Fib$histol <- "Fibrosis"

Tab2_Portal = NAFLDBx_data_Portal_lm_sum2
Tab2_Portal$beta = Tab2_Portal$NAFLD_Portal_beta
Tab2_Portal <- subset(Tab2_Portal, select = c("var", "LipidGroup", "beta", "p", "qval", "sig"))
Tab2_Portal$histol <- "Portal"

Tab2_NAS = NAFLDBx_data_NAS_lm_sum2
Tab2_NAS$beta = Tab2_NAS$NAFLD_NAS_beta
Tab2_NAS <- subset(Tab2_NAS, select = c("var", "LipidGroup", "beta", "p", "qval", "sig"))
Tab2_NAS$histol <- "NAS"

Tab2_final <- rbind(Tab2_Fib, Tab2_Portal, Tab2_NAS)
Tab2_final <- subset(Tab2_final, sig =="Significant")
write.table(Tab2_final, file="Table S4.csv",sep=",")

## merge with other lipid databases (annotated to same format)

HMG_annot <- read_excel("HMG_annot.xlsx")
mwas_annot <- read_excel("mwas_annot.xlsx")

Tab2_annotHMG <- merge(Tab2_final, HMG_annot,by="var")
Tab2_annotHMG <- Tab2_annotHMG %>% mutate(beta_dir = ifelse(beta < 0, "Negative", "Positive"))
Tab2_annotHMG <- Tab2_annotHMG %>% mutate(HMG_beta_dir = ifelse(HMG_beta < 0, "Negative", "Positive"))
Tab2_annotHMG <- Tab2_annotHMG %>% mutate(HMGcomp = ifelse(beta_dir == HMG_beta_dir, "Consistent", "False"))
Tab2_annotHMG = subset(Tab2_annotHMG, HMGcomp=="Consistent")
write.table(Tab2_annotHMG, file="Tab2_annotHMG.csv",sep=",")

Tab2_annotmwas <- merge(Tab2_final, mwas_annot,by="var")
Tab2_annotmwas <- Tab2_annotmwas %>% mutate(beta_dir = ifelse(beta < 0, "Negative", "Positive"))
Tab2_annotmwas <- Tab2_annotmwas %>% mutate(mwas_beta_dir = ifelse(mwas_beta < 0, "Negative", "Positive"))
Tab2_annotmwas <- Tab2_annotmwas %>% mutate(mwascomp = ifelse(beta_dir == mwas_beta_dir, "Consistent", "False"))
Tab2_annotmwas = subset(Tab2_annotmwas, mwascomp=="Consistent")
write.table(Tab2_annotmwas, file="Tab2_annotmwas.csv",sep=",")

## merge mwas and HMG annotations to make supplementary table S5
names(Tab2_annotHMG)[names(Tab2_annotHMG) == 'beta'] <- 'Lipid_beta'
names(Tab2_annotHMG)[names(Tab2_annotHMG) == 'p'] <- 'Lipid_p'
names(Tab2_annotHMG)[names(Tab2_annotHMG) == 'qval'] <- 'Lipid_qval'
names(Tab2_annotHMG)[names(Tab2_annotHMG) == 'HMG_Trait'] <- 'Trait'
names(Tab2_annotHMG)[names(Tab2_annotHMG) == 'HMG_beta'] <- 'Trait_beta'
names(Tab2_annotHMG)[names(Tab2_annotHMG) == 'HMG_p'] <- 'Trait_p'
names(Tab2_annotHMG)[names(Tab2_annotHMG) == 'HMG_q'] <- 'Trait_qval'
names(Tab2_annotHMG)[names(Tab2_annotHMG) == 'HMG_n'] <- 'Trait_n'
Tab2_annotHMG$Trait_n_event <- "N/A"
Tab2_annotHMG$Trait_HazardRatio <- "N/A"
Tab2_annotHMG$Study <- "Mann et al. (HMG, 2020)"
TabS5_p1 = subset(Tab2_annotHMG, select = c("var", "LipidGroup", "Lipid_beta", "Lipid_p", "histol", "Trait", "Trait_beta", "Trait_p", "Trait_HazardRatio", "Trait_n", "Trait_n_event", "Study"))

names(Tab2_annotmwas)[names(Tab2_annotmwas) == 'beta'] <- 'Lipid_beta'
names(Tab2_annotmwas)[names(Tab2_annotmwas) == 'p'] <- 'Lipid_p'
names(Tab2_annotmwas)[names(Tab2_annotmwas) == 'qval'] <- 'Lipid_qval'
names(Tab2_annotmwas)[names(Tab2_annotmwas) == 'mwas_trait'] <- 'Trait'
names(Tab2_annotmwas)[names(Tab2_annotmwas) == 'mwas_beta'] <- 'Trait_beta'
names(Tab2_annotmwas)[names(Tab2_annotmwas) == 'mwas_pval'] <- 'Trait_p'
names(Tab2_annotmwas)[names(Tab2_annotmwas) == 'mwas_q'] <- 'Trait_qval'
names(Tab2_annotmwas)[names(Tab2_annotmwas) == 'mwas_n'] <- 'Trait_n'
names(Tab2_annotmwas)[names(Tab2_annotmwas) == 'mwas_nevent'] <- 'Trait_n_event'
names(Tab2_annotmwas)[names(Tab2_annotmwas) == 'mwas_harzard.ratio'] <- 'Trait_HazardRatio'
Tab2_annotmwas$Study <- "Pietzner et al. (Nat Med, 2021)"

TabS5_p2 = subset(Tab2_annotmwas, select = c("var", "LipidGroup", "Lipid_beta", "Lipid_p", "histol", "Trait", "Trait_beta", "Trait_p", "Trait_HazardRatio", "Trait_n", "Trait_n_event", "Study"))

TabS5_final <- rbind(TabS3_p1, TabS3_p2)
write.table(TabS5_final, file="Table S5.csv",sep=",")



## annotate with GWAS-sig loci for table S6

loci_annot <- read_excel("Loci_annot_v2.xlsx")
Tab2_loci <- merge(Tab2_final, loci_annot,by="var")
write.table(Tab2_loci, file="Table S6.csv",sep=",")


## annotate loci with PheWAS CVD results

PheWAS_annot <- read_excel("PheWAS_annot.xlsx")
Tab2_PheWas <- merge(Tab2_loci, PheWAS_annot,by="SNP")

## search phenoscanner more broadly with phewas using all loci

loci_dedup <- Tab2_loci %>% distinct(SNP, .keep_all = TRUE)

loci_dedup_SNPs1 <- loci_dedup %>% arrange(desc(SNP)) %>% slice(1:99)
res1 <- phenoscanner(snpquery=c(loci_dedup_SNPs1$SNP))
results1 <- as.data.frame(res1[["results"]])

loci_dedup_SNPs2 <- loci_dedup %>% arrange(desc(SNP)) %>% slice(100:199)
res2 <- phenoscanner(snpquery=c(loci_dedup_SNPs2$SNP))
results2 <- as.data.frame(res2[["results"]])

loci_dedup_SNPs3 <- loci_dedup %>% arrange(desc(SNP)) %>% slice(200:299)
res3 <- phenoscanner(snpquery=c(loci_dedup_SNPs3$SNP))
results3 <- as.data.frame(res3[["results"]])

loci_dedup_SNPs4 <- loci_dedup %>% arrange(desc(SNP)) %>% slice(300:399)
res4 <- phenoscanner(snpquery=c(loci_dedup_SNPs4$SNP))
results4 <- as.data.frame(res4[["results"]])

loci_dedup_SNPs5 <- loci_dedup %>% arrange(desc(SNP)) %>% slice(400:nrow(loci_dedup))
res5 <- phenoscanner(snpquery=c(loci_dedup_SNPs5$SNP))
results5 <- as.data.frame(res5[["results"]])

results_all <- rbind(results1, results2, results3, results4, results5)
write.table(results_all, file="results_all.csv",sep=",")

# filter for cardio-metabolic traits
PhenoScan_all_CVD = subset(results_all, trait=='Arm fat percentage right' | trait=='Body mass index' | trait=='Cardiovascular disease risk factors' | trait=='Cause of death: acute vascular disorders of intestine' | trait=='Cause of death: cerebrovascular disease, unspecified' | trait=='Cause of death: chronic or unspecified with haemorrhage' | trait=='Cause of death: gastro-intestinal haemorrhage, unspecified' | trait=='Cause of death: peripheral vascular disease, unspecified' | trait=='Cause of death: subarachnoid haemorrhage, unspecified' | trait=='Colorectal cancer' | trait=='Fasting blood glucose' | trait=='Fasting blood glucose in low BMI subjects' | trait=='Fasting glucose' | trait=='Fasting glucose related traits' | trait=='Fasting glucose related traits interaction with BMI' | trait=='Fasting plasma glucose' | trait=='Glucose tolerance test' | trait=='Glycated hemoglobin levels' | trait=='HbA1c' | trait=='HOMA B' | trait=='Leg fat percentage left' | trait=='Leg fat percentage right' | trait=='Liver enzyme levels alkaline phosphatase' | trait=='Metabolic syndrome' | trait=='Metabolic syndrome bivariate traits' | trait=='Metabolic syndrome domains Atherogenic Dyslipidemia   PC2' | trait=='Metabolic syndrome domains Multivariate analysis' | trait=='Metabolic syndrome x' | trait=='Weight kg in children')

names(PhenoScan_all_CVD)[names(PhenoScan_all_CVD) == 'snp'] <- 'SNP'

Tab2_PhenoScan <- merge(Tab2_loci, PhenoScan_all_CVD,by="SNP")


## merege PheWas and Phenoscanner results to make table S7

Tab2_PheWas$n <- "N/A"
Tab2_PheWas$Source <- "Tabassum"

TabS7_p1 = subset(Tab2_PheWas, select = c("SNP", "Ref", "Alt", "PheWAS_outcome", "PheWAS_Beta", "PheWAS_SE", "PheWAS_P", "n", "Study", "Source"))

names(PhenoScan_all_CVD)[names(PhenoScan_all_CVD) == 'a2'] <- 'Ref'
names(PhenoScan_all_CVD)[names(PhenoScan_all_CVD) == 'a1'] <- 'Alt'
names(PhenoScan_all_CVD)[names(PhenoScan_all_CVD) == 'trait'] <- 'PheWAS_outcome'
names(PhenoScan_all_CVD)[names(PhenoScan_all_CVD) == 'beta'] <- 'PheWAS_Beta'
names(PhenoScan_all_CVD)[names(PhenoScan_all_CVD) == 'se'] <- 'PheWAS_SE'
names(PhenoScan_all_CVD)[names(PhenoScan_all_CVD) == 'p'] <- 'PheWAS_P'
names(PhenoScan_all_CVD)[names(PhenoScan_all_CVD) == 'dataset'] <- 'Study'
PhenoScan_all_CVD$Source <- "Phenoscanner_v2"

TabS7_p2 = subset(PhenoScan_all_CVD, select = c("SNP", "Ref", "Alt", "PheWAS_outcome", "PheWAS_Beta", "PheWAS_SE", "PheWAS_P", "n", "Study", "Source"))

TabS7_working <- rbind(TabS7_p1, TabS7_p2)
TabS7_working = subset(TabS7_working, PheWAS_Beta !="NA")

loci_merge = subset(Tab2_loci, select = c("var", "LipidGroup", "SNP", "Nearest_gene", "histol"))

TabS7_final <- merge(TabS7_working, loci_merge, by="SNP")

S7_col_order <- c("var", "LipidGroup", "histol", "SNP", "Ref", "Alt", "Nearest_gene", "PheWAS_outcome", "PheWAS_Beta", "PheWAS_SE", "PheWAS_P", "n", "Study", "Source")
TabS7_final <- TabS7_final[, S7_col_order]
write.table(TabS7_final, file="Table S7.csv",sep=",")




### --- assimilate above supplementary tables into a final table 2, with only lipids associated with steatosis in fenland

## re-import data for annotation (as now has different column headers)
HMG_annot2 <- read_excel("HMG_annot.xlsx")
mwas_annot2 <- read_excel("mwas_annot.xlsx")

Tab2_annot2HMG <- merge(Tab2_final, HMG_annot2,by="var")
Tab2_annot2HMG <- Tab2_annot2HMG %>% mutate(beta_dir = ifelse(beta < 0, "Negative", "Positive"))
Tab2_annot2HMG <- Tab2_annot2HMG %>% mutate(HMG_beta_dir = ifelse(HMG_beta < 0, "Negative", "Positive"))
Tab2_annot2HMG <- Tab2_annot2HMG %>% mutate(HMGcomp = ifelse(beta_dir == HMG_beta_dir, "Consistent", "False"))
Tab2_annot2HMG = subset(Tab2_annot2HMG, HMGcomp=="Consistent")

Tab2_annot2mwas <- merge(Tab2_final, mwas_annot2,by="var")
Tab2_annot2mwas <- Tab2_annot2mwas %>% mutate(beta_dir = ifelse(beta < 0, "Negative", "Positive"))
Tab2_annot2mwas <- Tab2_annot2mwas %>% mutate(mwas_beta_dir = ifelse(mwas_beta < 0, "Negative", "Positive"))
Tab2_annot2mwas <- Tab2_annot2mwas %>% mutate(mwascomp = ifelse(beta_dir == mwas_beta_dir, "Consistent", "False"))
Tab2_annot2mwas = subset(Tab2_annot2mwas, mwascomp=="Consistent")

## filtering for variants associated with steatosis in Fenland
Tab2_steat = subset(Tab2_annot2HMG, HMG_Trait=="Steatosis")
Tab2_steat = subset(Tab2_steat, select = c("var", "LipidGroup", "beta", "p", "histol", "HMG_Trait", "HMG_beta", "HMG_p"))
colnames(Tab2_steat) <- c("var", "LipidGroup", "Lipid_beta", "Lipid_p", "histol", "HMG_trait", "HMG_beta", "HMG_p")

## tidy mwas table before merging
Tab2_annot2mwas = subset(Tab2_annot2mwas, select = c("var", "mwas_trait", "mwas_beta", "mwas_pval", "mwas_harzard.ratio", "mwas_beta_dir"))
colnames(Tab2_annot2mwas) <- c("var", "mwas_trait", "mwas_beta", "mwas_pval", "mwas_HR", "mwas_beta_dir")
Tab2_annot2mwas$mwas_beta_dir2 <- ifelse(Tab2_annot2mwas$mwas_beta_dir =="Positive", "+", "-")
Tab2_annot2mwas$mwas_trait2 <- paste(Tab2_annot2mwas$mwas_trait, Tab2_annot2mwas$mwas_beta_dir2, sep = " (", collapse = NULL)
Tab2_annot2mwas$mwas_trait2 <- paste(Tab2_annot2mwas$mwas_trait2, "", sep = ")", collapse = NULL)
Tab2_annot2mwas = subset(Tab2_annot2mwas, select = c("var", "mwas_trait2"))

Tab2_annot2mwas <- Tab2_annot2mwas %>% arrange(var, mwas_trait2) %>% group_by(var) %>% mutate(Traits8=str_c(mwas_trait2[1], mwas_trait2[2], mwas_trait2[3], mwas_trait2[4],  mwas_trait2[5], mwas_trait2[6], mwas_trait2[7], mwas_trait2[8], sep = ", ")) %>% mutate(Traits7=str_c(mwas_trait2[1], mwas_trait2[2], mwas_trait2[3], mwas_trait2[4], mwas_trait2[5], mwas_trait2[6], mwas_trait2[7], sep = ", ")) %>% mutate(Traits6=str_c(mwas_trait2[1], mwas_trait2[2], mwas_trait2[3], mwas_trait2[4], mwas_trait2[5], mwas_trait2[6],sep = ", ")) %>% mutate(Traits5=str_c(mwas_trait2[1], mwas_trait2[2], mwas_trait2[3], mwas_trait2[4], mwas_trait2[5], sep = ", ")) %>% mutate(Traits4=str_c(mwas_trait2[1], mwas_trait2[2], mwas_trait2[3], mwas_trait2[4], sep = ", ")) %>% mutate(Traits3=str_c(mwas_trait2[1], mwas_trait2[2], mwas_trait2[3], sep = ", ")) %>% mutate(Traits2=str_c(mwas_trait2[1], mwas_trait2[2], sep = ", ")) %>% mutate(Traits1=str_c(mwas_trait2[1]))

Tab2_annot2mwas$Traits_sum <- ifelse(is.na(Tab2_annot2mwas$Traits8), Tab2_annot2mwas$Traits7, Tab2_annot2mwas$Traits8)
Tab2_annot2mwas$Traits_sum <- ifelse(is.na(Tab2_annot2mwas$Traits_sum), Tab2_annot2mwas$Traits6, Tab2_annot2mwas$Traits_sum)
Tab2_annot2mwas$Traits_sum <- ifelse(is.na(Tab2_annot2mwas$Traits_sum), Tab2_annot2mwas$Traits5, Tab2_annot2mwas$Traits_sum)
Tab2_annot2mwas$Traits_sum <- ifelse(is.na(Tab2_annot2mwas$Traits_sum), Tab2_annot2mwas$Traits4, Tab2_annot2mwas$Traits_sum)
Tab2_annot2mwas$Traits_sum <- ifelse(is.na(Tab2_annot2mwas$Traits_sum), Tab2_annot2mwas$Traits3, Tab2_annot2mwas$Traits_sum)
Tab2_annot2mwas$Traits_sum <- ifelse(is.na(Tab2_annot2mwas$Traits_sum), Tab2_annot2mwas$Traits2, Tab2_annot2mwas$Traits_sum)
Tab2_annot2mwas$Traits_sum <- ifelse(is.na(Tab2_annot2mwas$Traits_sum), Tab2_annot2mwas$Traits1, Tab2_annot2mwas$Traits_sum)

Tab2_annot2mwas = subset(Tab2_annot2mwas, select = c("var", "Traits_sum"))
Tab2_annot2mwas <- Tab2_annot2mwas %>% distinct(var, .keep_all = TRUE)

Tab2_merge <- merge(Tab2_steat, Tab2_annot2mwas, by="var",all=TRUE)
Tab2_merge = subset(Tab2_merge, LipidGroup !="")

## annotate with SNPs from gwas loci
## first de-duplicate to nearest gene
Tab2_loci_genes <- Tab2_loci %>% distinct(var, Nearest_gene, .keep_all = TRUE)
Tab2_loci_genes = subset(Tab2_loci_genes, select = c("var", "Nearest_gene"))

Tab2_loci_genes_v2 <- Tab2_loci_genes %>% arrange(var, Nearest_gene) %>% group_by(var) %>% mutate(Genes4=str_c(Nearest_gene[1], Nearest_gene[2], Nearest_gene[3], Nearest_gene[4], sep = ", ")) %>% mutate(Genes3=str_c(Nearest_gene[1], Nearest_gene[2], Nearest_gene[3], sep = ", ")) %>% mutate(Genes2=str_c(Nearest_gene[1], Nearest_gene[2], sep = ", ")) %>% mutate(Genes1=str_c(Nearest_gene[1]))

Tab2_loci_genes_v2$Genes_sum <- ifelse(is.na(Tab2_loci_genes_v2$Genes4), Tab2_loci_genes_v2$Genes3, Tab2_loci_genes_v2$Genes4)
Tab2_loci_genes_v2$Genes_sum <- ifelse(is.na(Tab2_loci_genes_v2$Genes_sum), Tab2_loci_genes_v2$Genes2, Tab2_loci_genes_v2$Genes_sum)
Tab2_loci_genes_v2$Genes_sum <- ifelse(is.na(Tab2_loci_genes_v2$Genes_sum), Tab2_loci_genes_v2$Genes1, Tab2_loci_genes_v2$Genes_sum)

Tab2_loci_genes_v2 = subset(Tab2_loci_genes_v2, select = c("var", "Genes_sum"))
Tab2_loci_genes_v2 <- Tab2_loci_genes_v2 %>% distinct(var, .keep_all = TRUE)

## then merge with annotated table
Tab2_merge <- merge(Tab2_merge, Tab2_loci_genes_v2, by="var",all=TRUE)
Tab2_merge = subset(Tab2_merge, LipidGroup !="")
write.table(Tab2_merge, file="Table2.csv",sep=",")

## annotate SNPs with phewas results
## first de-duplicate by gene
TabS7_final_dedup <- TabS7_final %>% distinct(Nearest_gene, PheWAS_outcome, .keep_all = TRUE)
TabS7_final_dedup = subset(TabS7_final_dedup, select = c("Nearest_gene", "PheWAS_outcome"))
## export for manual annotation of genes/gene lists
write.table(TabS7_final_dedup, file="TabS7_final_dedup.csv",sep=",")






















